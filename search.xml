<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>09ç¿»è¯‘</title>
      <link href="/2022/11/25/06%E8%8B%B1%E8%AF%AD/09%E7%BF%BB%E8%AF%91/"/>
      <url>/2022/11/25/06%E8%8B%B1%E8%AF%AD/09%E7%BF%BB%E8%AF%91/</url>
      
        <content type="html"><![CDATA[<h1 id="å®šè¯­"><a href="#å®šè¯­" class="headerlink" title="å®šè¯­"></a>å®šè¯­</h1><h2 id="è¯†åˆ«"><a href="#è¯†åˆ«" class="headerlink" title="è¯†åˆ«"></a>è¯†åˆ«</h2><p>åè¯åå¯èƒ½æ˜¯: å®šè¯­&#x2F;çŠ¶è¯­&#x2F;åŒä½è¯­&#x2F;æ’å…¥è¯­&#x2F;è°“è¯­</p><p>æ’å…¥è¯­ å‰åéƒ½ é€—å· éš”å¼€</p><p>ç¿»è¯‘ä¸­ å®šè¯­å’ŒåŒä½è¯­ ç¿»è¯‘ä¸€æ ·</p><p>çŠ¶è¯­æš‚æ—¶ä¸è®²</p><blockquote><p>åªè¦åè¯åæœ‰ä¸€å¨ä¸œè¥¿, åªè¦å®ƒä¸æ˜¯åŠ¨è¯, å°±æš‚å®šä¸ºä¿®é¥°è¿™ä¸ªåè¯çš„å®šè¯­æˆåˆ†(è¿˜æœ‰å¯èƒ½æ˜¯çŠ¶è¯­)</p></blockquote><h2 id="ç¿»è¯‘"><a href="#ç¿»è¯‘" class="headerlink" title="ç¿»è¯‘"></a>ç¿»è¯‘</h2><ol><li>å‰ç½®</li><li>åç½®</li><li>èåˆæ³•</li></ol><h3 id="å‰ç½®"><a href="#å‰ç½®" class="headerlink" title="å‰ç½®"></a>å‰ç½®</h3><p>å½“å®šè¯­çš„æˆåˆ†æ¯”è¾ƒç®€å•, ä¿¡æ¯é‡ä¸å¤§çš„æ—¶å€™, å°±æŠŠå®šè¯­ç¿»è¯‘åœ¨å®ƒæ‰€ä¿®é¥°çš„åè¯å‰é¢</p><h3 id="åç½®"><a href="#åç½®" class="headerlink" title="åç½®"></a>åç½®</h3><p>å½“å®šè¯­çš„æˆåˆ†æ¯”è¾ƒå¤æ‚, ä¿¡æ¯é‡æ¯”è¾ƒå¤§çš„æ—¶å€™, å°±æŠŠå®šè¯­ç¿»è¯‘åœ¨å®ƒæ‰€ä¿®é¥°çš„åè¯çš„åé¢, æ­¤æ—¶é€šå¸¸éœ€è¦é‡å¤å…ˆè¡Œè¯æˆ–ä½¿ç”¨ä»£è¯</p><h3 id="èåˆæ³•"><a href="#èåˆæ³•" class="headerlink" title="èåˆæ³•"></a>èåˆæ³•</h3><p>æŠŠå…³ç³»è¯å½“ä½œè°“è¯­ç¿»è¯‘(æˆ–è€…ç›´æ¥å¿½ç•¥å…³ç³»è¯)</p><h3 id="ç¿»è¯‘-1"><a href="#ç¿»è¯‘-1" class="headerlink" title="ç¿»è¯‘"></a>ç¿»è¯‘</h3><ol><li>å¦‚æœå•è¯æŒ‡ä»£çš„å†…å®¹å¾ˆæ˜ç¡®, åˆ™æ— éœ€æŸ¥æ‰¾ä»£è¯æ‰€æŒ‡ä»£çš„å†…å®¹</li><li>å¦‚æœä¸æ˜ç¡®, å°±ä¸€å®šè¦æ‰¾å‡ºä»£è¯æ‰€æŒ‡ä»£çš„å†…å®¹ ä¸€ä¸€ <code>å°±è¿‘åŸåˆ™å’Œä¸€è‡´åŸåˆ™(è¯­æ³•ä¸Šçš„ä¸€è‡´å’Œæ„æ€ä¸Šçš„ä¸€è‡´)</code></li><li>å¦‚æœæ‰¾ä¸åˆ°ä»£è¯æ‰€æŒ‡ä»£çš„å†…å®¹æˆ–è€…ä¸ä¼šç¿»è¯‘, å°±æŠŠä»£è¯ç¿»è¯‘æˆ â€œè¿™â€ æˆ–è€…æ˜¯ â€œé‚£â€</li></ol><p>They may teach very well and more than earn their salaries, but most of them make little or no independent reflections on human problems which involve moral judgment.</p><p>theyåœ¨ä¸Šä¸‹æ–‡æ˜¯å¾ˆå¤šçš„çŸ¥è¯†åˆ†å­</p><p>They may teach very well &#x2F;&#x2F; and more than earn their salaries &#x2F;&#x2F; , but most of them make little or no independent reflections on human problems &#x2F;&#x2F; which involve moral judgment.</p><p>çŸ¥è¯†åˆ†å­å¯ä»¥æ•™å¾—å¾ˆå¥½ï¼Œè€Œä¸”ä¸ä»…ä»…æ˜¯ä¸ºäº†æŒ£è–ªæ°´ï¼Œä½†ä»–ä»¬å¤§å¤šæ•°äººå´å¾ˆå°‘æˆ–æ²¡æœ‰å¯¹éœ€è¦è¿›è¡Œé“å¾·æ‰¹åˆ¤çš„äººçš„é—®é¢˜è¿›è¡Œç‹¬ç«‹æ€è€ƒ</p><p>His function is analogous to that of a judge &#x2F;&#x2F; , who must accept the obligation &#x2F;&#x2F; of revealing in as obvious a manner as possible the course of reasoning &#x2F;&#x2F; which led him to his decision.</p><p>ä»–çš„èŒè´£ä¸æ³•å®˜çš„èŒè´£ç›¸ä¼¼ï¼Œä»–å¿…é¡»æ‰¿æ‹…è¿™æ ·çš„è´£ä»»ï¼šç”¨å°½å¯èƒ½æ¸…æ¥šæ˜äº†çš„æ–¹å¼æ¥å‘Šè¯‰å¤§å®¶è‡ªå·±åšå‡ºå†³å®šçš„æ¨ç†è¿‡ç¨‹ã€‚</p><h1 id="çŠ¶è¯­"><a href="#çŠ¶è¯­" class="headerlink" title="çŠ¶è¯­"></a>çŠ¶è¯­</h1><h2 id="è¯†åˆ«-1"><a href="#è¯†åˆ«-1" class="headerlink" title="è¯†åˆ«"></a>è¯†åˆ«</h2><p>åªè¦åœ¨å¥å­ä¸­è§åˆ°ä¸‹é¢ä¸€å¨ä¸œè¥¿éƒ½è®¤ä¸ºæ˜¯çŠ¶è¯­</p><ol><li>å‰¯è¯(ä»€ä¹ˆæ ·åœ°åŠ¨ä½œ)</li><li>åŸå› (ä»€ä¹ˆæ ·çš„åŸå› å‘å‡ºè¿™ä¸ªåŠ¨ä½œ)</li><li>æ¡ä»¶(ä»€ä¹ˆæ ·çš„æ¡ä»¶ä¸‹åšè¿™ä¸ªåŠ¨ä½œ)</li><li>ç›®çš„(ä»€ä¹ˆæ ·çš„ç›®çš„åšè¿™ä¸ªåŠ¨ä½œ)(<code>to do</code> or <code>in order to</code>)</li><li>ç»“æœ(è¿™ä¸ªåŠ¨è¿‡å¯¼è‡´ä»€ä¹ˆæ ·çš„ç»“æœ)(<code>so ... that</code>)</li><li>æ–¹å¼(ä»¥ä»€ä¹ˆæ–¹å¼åšè¿™ä¸ªåŠ¨ä½œ)(manner or by)</li><li>æ¯”è¾ƒ(åšè¿™ä¸ªåŠ¨ä½œæ¯”ä½ åšçš„å¦‚ä½•)(as â€¦ as or than)</li><li>although(è®©æ­¥)</li><li>ä¼´éš(è¿™ä¸ªåŠ¨ä½œä¼´éšç€ä»€ä¹ˆç°è±¡)</li></ol><h3 id="å®šè¯­å’ŒçŠ¶è¯­çš„åŒºåˆ«"><a href="#å®šè¯­å’ŒçŠ¶è¯­çš„åŒºåˆ«" class="headerlink" title="å®šè¯­å’ŒçŠ¶è¯­çš„åŒºåˆ«"></a>å®šè¯­å’ŒçŠ¶è¯­çš„åŒºåˆ«</h3><p>å¦‚æœæœ‰æ—¶é—´æˆ–åœ°ç‚¹å‡ºç°åœ¨åè¯ä¹‹å, æœ‰å¯èƒ½æ˜¯å®šè¯­, ä¹Ÿå¯èƒ½æ˜¯çŠ¶è¯­</p><p>å½“æ— æ³•ç¡®å®æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­æ—¶, å®šè¯­ä¼˜å…ˆåŸåˆ™, åªæœ‰ç¿»è¯‘æˆå®šè¯­åŸåˆ™ä¹‹åæ¶å¿ƒå°±æ˜¯çŠ¶è¯­</p><h2 id="ç¿»è¯‘-2"><a href="#ç¿»è¯‘-2" class="headerlink" title="ç¿»è¯‘"></a>ç¿»è¯‘</h2><ol><li>è‹±è¯­åŸæ–‡ä¸­çš„çŠ¶è¯­ç¿»è¯‘æˆçŠ¶è¯­çš„æ—¶å€™, çŠ¶è¯­é€šå¸¸æ”¾åœ¨ç¦»ä»–æœ€è¿‘çš„é‚£å¥è¯çš„å‰é¢æˆ–è€…æ˜¯é‚£å¥è¯çš„ä¸»è°“ä¹‹é—´</li><li>ä¸€å¥è¯å½“ä¸­æ—¢æœ‰æ—¶é—´åˆæœ‰åœ°ç‚¹çŠ¶è¯­çš„, å…ˆç¿»è¯‘æ—¶é—´åç¿»è¯‘çŠ¶è¯­</li><li>å¦‚æœè¡¨ç¤ºåŸå› çš„çŠ¶è¯­æ¯”è¾ƒå¤æ‚, ä¹Ÿå¯ä»¥ç›´æ¥ç¿»è¯‘æˆâ€ä¹‹æ‰€ä»¥â€¦æ˜¯å› ä¸ºâ€¦â€</li></ol><p>He adds humbly that perhaps he was â€œsuperior to the common run of men in noticing things which easily escape attention, and in observing them carefully.â€</p><blockquote><p>in doing sth è¡¨ç¤ºåœ¨ä»€ä¹ˆä»€ä¹ˆè¿‡ç¨‹ä¸­, åœ¨ä»€ä¹ˆä»€ä¹ˆçš„æ—¶å€™</p></blockquote><p>Creates a RateLimiter with the specified stable throughput, given as â€œpermits per secondâ€ (commonly referred to as QPS, queries per second).</p><p>åˆ›å»ºä¸€ä¸ªå…·æœ‰ç¨³å®šååé‡çš„ RateLimiter å¯¹è±¡ï¼Œä»¥â€permits per secondï¼ˆæ¯ç§’è®¸å¯æ¬¡æ•°ï¼‰â€çš„å½¢å¼ç»™å‡ºï¼ˆé€šå¸¸ï¼Œ ä½œä¸ºæˆä¸ºQPSï¼šæ¯ç§’æŸ¥è¯¢æ•°ï¼‰</p><p>The returned RateLimiter ensures that on average no more than permitsPerSecond are issued during any given second, with sustained requests being smoothly spread over each second. </p><p>è¿”å› RateLimiter å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç¡®ä¿åœ¨å¹³å‡å€¼ä¸Šæ²¡æœ‰è¶…å‡º ä»»ä½•ç»™å®šç§’å†…çš„ permitsPerSecond ï¼Œè€ŒæŒç»­çš„è¯·æ±‚ä¹Ÿå°†è¢«åˆ†æ•£åœ¨æ¯ä¸€ç§’ä¸­</p><p>When the incoming request rate exceeds permitsPerSecond the rate limiter will release one permit every (1.0 &#x2F; permitsPerSecond) seconds. </p><p>å½“è¯·æ±‚çš„é€Ÿç‡è¶…å‡º permitsPerSecond å€¼æ—¶ï¼Œé™é€Ÿå™¨å°†ä¼šåœ¨æ¯ä¸€ä¸ªï¼ˆ1.0 &#x2F; permitsPerSecondï¼‰ç§’é‡Šæ”¾ä¸€ä¸ªè®¸å¯ã€‚</p><p>When the rate limiter is unused, bursts of up to permitsPerSecond permits will be allowed, with subsequent requests being smoothly limited at the stable rate of permitsPerSecond.</p><p>å½“æœªä½¿ç”¨é™é€Ÿå™¨æ—¶ï¼Œå°†å…è®¸æœ€å¤šä¸ºpermitsPerSecondè®¸å¯çš„çˆ†å‘ï¼Œéšåçš„è¯·æ±‚å°†è¢«å¹³ç¨³åœ°é™åˆ¶åœ¨permitsPerSecondçš„ç¨³å®šé€Ÿç‡ä¸Šã€‚</p><p>If none of the configured AuthenticationProviders can authenticate, then authentication will fail with a ProviderNotFoundException which is a special AuthenticationException that indicates the ProviderManager was not configured to support the type of Authentication that was passed into it.</p><p>å¦‚æœé…ç½®çš„AuthenticationProvidersç±»æ²¡æœ‰ä¸€ä¸ªå¯ä»¥è¿›è¡Œèº«ä»½è®¤è¯ï¼Œåˆ™èº«ä»½è®¤è¯å°†ä¼šå¤±è´¥å¹¶æŠ›å‡ºProviderNotFoundExceptionå¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„AuthenticationExceptionå¼‚å¸¸ï¼Œå®ƒè¡¨æ˜ProviderManagerç±»æœªé…ç½®ä»¥æ”¯æŒä¼ é€’ç»™å®ƒï¼ˆProviderManagerç±»ï¼‰çš„Authenticationç±»å‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è‹±è¯­ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çŠ¶è¯­ </tag>
            
            <tag> ç¿»è¯‘ </tag>
            
            <tag> å‰ç½® </tag>
            
            <tag> åç½® </tag>
            
            <tag> èåˆæ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>08è¡¥å……</title>
      <link href="/2022/11/25/06%E8%8B%B1%E8%AF%AD/08%E8%A1%A5%E5%85%85/"/>
      <url>/2022/11/25/06%E8%8B%B1%E8%AF%AD/08%E8%A1%A5%E5%85%85/</url>
      
        <content type="html"><![CDATA[<h1 id="â˜…åˆ°åº•æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­"><a href="#â˜…åˆ°åº•æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­" class="headerlink" title="â˜…åˆ°åº•æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­?"></a>â˜…åˆ°åº•æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­?</h1><p>çœ‹äº†å¥½å¤šæ–¹æ³•æ¥åˆ¤æ–­å®šè¯­è¿˜æ˜¯çŠ¶è¯­ï¼Œä¸è¿‡å¥½åƒéƒ½ä¸å¤ªå¥½ç”¨</p><p>æˆ‘æ€»ç»“äº†äº›æ­¥éª¤åˆ¤æ–­åˆ°åº•æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­</p><ol><li>å¦‚æœæ˜¯ åè¯ + ä»‹è¯çŸ­è¯­ è¿™ç§å½¢å¼ï¼Œä¸€èˆ¬å…ˆè®¤å®šä¸º å®šè¯­ ç¿»è¯‘æˆä»€ä¹ˆä»€ä¹ˆçš„ï¼Œ å…¶ä»– + ä»‹è¯çŸ­è¯­å½¢å¼ï¼Œç»å¯¹æ˜¯çŠ¶è¯­ï¼ˆå½“ç„¶è¿˜å¯ä»¥åœ¨ä»–ä»¬ä¸­é—´åŠ ä¸Š be åŠ¨è¯ï¼Œåˆ¤æ–­ åè¯ å’Œ ä»‹å®¾ å½¢å¼ä¸­çš„ åè¯ å’Œ å®¾è¯­ æ˜¯ä¸æ˜¯æœ‰å…³ç³»ï¼Œä¸€èˆ¬æœ‰å…³ç³»ä¹Ÿå¯ä»¥è®¤ä¸ºå¤§æ¦‚ç‡æ˜¯å®šè¯­ï¼‰</li><li>æŠŠä»‹è¯çŸ­è¯­çš„æ„æ€ç¿»è¯‘å‡ºæ¥ï¼Œç„¶åå’ŒåŠ¨è¯åšç»„åˆï¼Œä»‹è¯çŸ­è¯­ + åŠ¨è¯ï¼ˆå¯èƒ½æ˜¯çŠ¶è¯­ï¼‰ï¼Œæˆ–è€…åŠ¨è¯ + ä»‹è¯çŸ­è¯­ï¼ˆå¯èƒ½æ˜¯å®šè¯­ï¼‰ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ç¿»è¯‘ï¼Œå¦‚æœç¿»è¯‘ä¸é€šé¡ºé‚£ç»å¯¹æ˜¯å®šè¯­æ— ç–‘</li><li>è¿˜ä¸æ‡‚å¾—åˆ°åº•æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­ï¼Œä¸€å¾‹çœ‹ä½œå®šè¯­ï¼Œåªè¦æ•´å¥ç¿»è¯‘å‡ºæ¥æ„æ€ä¸Šè¿‡å¾—å»é€»è¾‘æ­£ç¡®å°±è¡Œï¼Œä¸å¼ºæ±‚</li><li>è¿˜ä¸æ¸…æ¥šåˆ°åº•æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­ï¼Œä½†å®šè¯­å’ŒçŠ¶è¯­éƒ½æ²¡æœ‰é”™çš„è¯ï¼Œé‚£å¸¦å…¥ä¸Šä¸‹æ–‡åˆ¤æ–­å§</li></ol><p>ç°åœ¨æˆ‘ä»¬æŠŠä¸‹é¢å…¨éƒ¨ç½‘å‹ä¸¾çš„ä¾‹å­éƒ½è¯•ä¸€é</p><p>ï¼ˆ1ï¼‰The doctors and nurses in the hospital are very patient with patients.</p><p>in the hospital ä¸ç”¨å¤šè¯´äº†å§ï¼Ÿè¿™æ˜æ˜¾æ˜¯å®šè¯­ï¼Œä¸ºä»€ä¹ˆæˆ‘è¿™ä¹ˆè®¤ä¸ºå‘¢ï¼Ÿ</p><p>ä¸»å¹²æ˜¯ ä¸»ç³»è¡¨ï¼Œ æ’å…¥ä½ç½®æ ‡å·ï¼š 1 ä¸» 2 ç³» 3 è¡¨ 4 </p><p>æ˜æ˜¾ä¸Šé¢çš„ in the hospital ä½ç½® æ˜¯ 2 å· ä½ç½®ï¼Œ ä¿®é¥°çš„ ä¸»è¯­ï¼Œæœ‰æ—¶å€™è¿˜å¾—æ³¨æ„ 4 å·ä½ç½®ï¼Œå¦‚æœä¸»å¹²æ˜¯ 1 ä¸» 2 è°“ 3 å®¾ 4 æ­¤æ—¶ 4 å·ä½ç½®çš„ä»‹è¯çŸ­è¯­æœ‰ç™¾åˆ†ä¹‹60çš„å¯èƒ½æ˜¯å®¾è¯­ï¼Œ è®°ä½æ˜¯å¯èƒ½</p><p>ç„¶åè¿˜éœ€è¦æ³¨æ„ 1ï¼Œ3 å· ä½ç½®çš„ ä»‹è¯çŸ­è¯­ï¼Œç™¾åˆ†ä¹‹ä¹åä¹æ˜¯ çŠ¶è¯­ï¼Œç‰¹åˆ«æ˜¯ 1 å·ä½ç½®åé¢è¿˜å¯èƒ½æœ‰é€—å·ï¼Œé‚£ç™¾åˆ†ç™¾æ˜¯çŠ¶è¯­</p><p>ç„¶ååˆ° with patientsï¼Œ å…ˆä¸æå·²ç»æœ‰çš„å›ºå®šæ­é…â€be patient withâ€¦å¯¹â€¦æœ‰è€å¿ƒâ€œ</p><p>ä»ä¸»å¹²å…¥æ‰‹åˆ†æå‰é¢çš„ are very patient æ˜¯è¡¨è¯­ï¼Œ è¡¨ç¤ºæœ‰è€å¿ƒçš„ï¼Œå‰é¢çš„ patient æ˜¯å½¢å®¹è¯ with patients ä¿®é¥°å½¢å®¹è¯ï¼Œç¬¦åˆâ€œå…¶ä»– + ä»‹è¯çŸ­è¯­â€æ¡ä»¶æ˜æ˜¾æ˜¯çŠ¶è¯­</p><p>å¦‚æœä½ è¿˜ä¸ç¡®å®šä»–æ˜¯çŠ¶è¯­ï¼Œç”¨æˆ‘æ€»ç»“çš„ç¬¬äºŒä¸ªæ­¥éª¤ï¼š are with patients æˆ–è€… with patients areï¼Œåˆ¤æ–­å‘ç° ç¬¬äºŒä¸ªå¥å­å¯ä»¥ç¿»è¯‘â€å¯¹å¾…ç—…äººæ˜¯ä»€ä¹ˆä»€ä¹ˆâ€œ å†æ¬¡è¯æ˜æ˜¯çŠ¶è¯­</p><p>æ•´å¥ç¿»è¯‘ï¼šåŒ»é™¢é‡Œçš„åŒ»ç”Ÿå’ŒæŠ¤å£«å¯¹å¾…ç—…äººï¼ˆæ˜¯ï¼‰éå¸¸æœ‰è€å¿ƒï¼ˆçš„ï¼‰ perfect~~~</p><p>ï¼ˆ2ï¼‰Donâ€™t make noise in the hospital.</p><p>åè¯ + ä»‹è¯çŸ­è¯­ å¯èƒ½æ˜¯å®šè¯­ï¼Œç¿»è¯‘æˆ â€ä¸è¦åˆ¶é€ åœ¨åŒ»é™¢é‡Œçš„å™ªéŸ³â€œ å¾ˆå¥‡æ€ªä¸æ˜¯ï¼Ÿä½œä¸ºçº¯ç§ä¸­å›½äººèƒ½æ˜æ˜¾åœ°æ„Ÿåˆ°è¿™å¥è¯ä¸é€šé¡ºä½†èƒ½æ˜ç™½å®ƒçš„æ„æ€ï¼ˆè¿™å°±æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸‰æ­¥éª¤ï¼šåˆ¤æ–­æ˜¯å¦é€šé¡ºæ–¹æ³•ï¼‰</p><p>ç”¨ä½ç½®çš„æ–¹æ³•ä¹Ÿè¯´ä»–æ˜¯å®šè¯­ï¼ˆåœ¨4å·ä½ç½®ä¿®é¥°å®¾è¯­ï¼‰ </p><p>å½“ç„¶ç«™åœ¨ä¸Šå¸è§†è§’èƒ½çœ‹å‡ºæ¥è¿™ä¹ˆç†è§£ä¹Ÿæ²¡é—®é¢˜ï¼Œé‚£è®¤å®šä¸ºå®šè¯­åˆä½•å¦¨ï¼Ÿä½†ä¸æ•¢ä¿è¯ï¼Œä¿è¯å…¶ä»–è¯­å¥ä¸ä¼šç¿»è¯‘å‡ºå…¶ä»–æ„æ€</p><p>ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼šmake in the hospital å’Œ in the hospital make æ˜æ˜¾ </p><p>in the hospital make èƒ½ç¿»è¯‘é€šé¡ºâ€åœ¨åŒ»é™¢ä¸­åˆ¶é€ &#x2F;å¼•èµ·&#x2F;å‘å‡º ä»€ä¹ˆä»€ä¹ˆâ€œï¼ŒçŠ¶è¯­æ— ç–‘</p><p>æ•´å¥ç¿»è¯‘ï¼šä¸è¦åœ¨åŒ»é™¢åˆ¶é€ å™ªéŸ³ </p><p>å†å½»åº•æ±‰åŒ–ä¸‹ï¼š ä¸è¦åœ¨åŒ»é™¢ä¸­å¤§å£°å–§å“—</p><p>ï¼ˆ3ï¼‰Look at the sentences on the blackboard.<br>Write the sentences on the blackboard.</p><p>æ˜æ˜¾ç¬¬ä¸€ç§ç”¨ åè¯ + ä»‹è¯ çŸ­è¯­çš„æ–¹å¼ï¼Œå…¨éƒ¨è®¤å®šä¸º å®šè¯­ ç¿»è¯‘æˆâ€çœ‹åœ¨é»‘æ¿ä¸Šçš„å¥å­â€œï¼Œ â€å†™åœ¨é»‘æ¿ä¸Šçš„å¥å­â€œ ç¬¬ä¸€å¥æ²¡é—®é¢˜ï¼Œç¬¬äºŒå¥ä¹Ÿæ²¡é—®é¢˜</p><p>ä½ç½®æ–¹æ³•ä¹Ÿæ˜¯ å®šè¯­ï¼ˆ4å·ä½ç½®ï¼‰</p><p>é‚£å½“ä½œå®šè¯­åˆä½•å¦¨ï¼Ÿ</p><p>ç¬¬äºŒç§æ–¹æ³•ï¼šon the blackboard look åœ¨é»‘æ¿ä¸Šçœ‹ï¼Ÿï¼ï¼ï¼ look on the blackboard ä¸å¯¹ è¦ at</p><p>èšäººè¯´ï¼šæˆ‘èƒ½ç«™åœ¨é»‘æ¿ä¸Šçœ‹ä»€ä¹ˆä»€ä¹ˆã€‚ã€‚ã€‚ï¼ˆæ˜æ˜¾ä¸å¯¹ï¼Œæ˜¯å®šè¯­ï¼‰</p><p>on the blackboard write åœ¨é»‘æ¿ä¸Šå†™ï¼Œniceï¼Œ write on the blackboard å†™åœ¨é»‘æ¿ä¸Š nice</p><p>éƒ½è¡Œï¼Œé‚£ä¹ˆæˆ‘é€‰æ‹©ç¬¬å››ç§æ–¹æ³•ï¼šå¸¦å…¥ä¸Šä¸‹æ–‡åˆ¤æ–­æ˜¯</p><p> â€åœ¨é»‘æ¿ä¸Šå†™å¥å­â€œï¼ˆçŠ¶è¯­ï¼‰ or â€å†™åœ¨é»‘æ¿ä¸Šçš„å¥å­â€œï¼ˆå®šè¯­ï¼‰</p><h1 id="ç‹¬ç«‹ä¸»æ ¼éœ€è¦æ³¨æ„çš„åœ°æ–¹"><a href="#ç‹¬ç«‹ä¸»æ ¼éœ€è¦æ³¨æ„çš„åœ°æ–¹" class="headerlink" title="ç‹¬ç«‹ä¸»æ ¼éœ€è¦æ³¨æ„çš„åœ°æ–¹"></a>ç‹¬ç«‹ä¸»æ ¼éœ€è¦æ³¨æ„çš„åœ°æ–¹</h1><p>ç‹¬ç«‹ä¸»æ ¼éœ€è¦æ³¨æ„:</p><ol><li>being å¯ä»¥çœç•¥(è¿™ç‚¹å¯ä»¥è§£å†³å¾ˆå¤šå›°æƒ‘)</li><li>ä¸»è¯­ç›¸åŒ, å¿…é¡»çœç•¥æ‰ä¸€ä¸ª (ä¸è¿‡åˆ™æ˜¯ä¼´éšçŠ¶è¯­äº†)</li><li>ä¸»è¯­ä¸åŒ, å¯ä»¥åŠ ä¸Š with ä½œåŒºåˆ†åŠŸèƒ½</li></ol><h1 id="æ±‰è¯­ä¸­å®šè¯­çš„ä½ç½®å’Œè‹±è¯­çš„å·®åˆ«"><a href="#æ±‰è¯­ä¸­å®šè¯­çš„ä½ç½®å’Œè‹±è¯­çš„å·®åˆ«" class="headerlink" title="æ±‰è¯­ä¸­å®šè¯­çš„ä½ç½®å’Œè‹±è¯­çš„å·®åˆ«"></a>æ±‰è¯­ä¸­å®šè¯­çš„ä½ç½®å’Œè‹±è¯­çš„å·®åˆ«</h1><p>å¯¹äºä¸­æ–‡å’Œè‹±æ–‡çš„ä¸»å¹²æ¥è¯´, é¡ºåºä¸€è‡´, ä½†è‹±æ–‡çš„ä¿®é¥°æˆåˆ†å’Œä¸­æ–‡å­˜åœ¨å·®å¼‚</p><p>æ‰€ä»¥, æˆ‘ä»¬æ±‰åŒ–çš„è¿‡ç¨‹ä¸­, éœ€è¦æ³¨æ„, å®šè¯­, ä¸€èˆ¬åœ¨åè¯é™„è¿‘, å¯èƒ½åœ¨åè¯å‰é¢, å«<strong>å‰ç½®å®šè¯­</strong>, è¿™ç§å®šè¯­&#x2F;ä½œå®šè¯­çš„çŸ­è¯­ä¸€èˆ¬æ¯”è¾ƒçŸ­</p><p>è¿˜æœ‰å°±æ˜¯ä½œ<strong>åç½®å®šè¯­</strong>, è¿™ç§å®šè¯­ä¸€èˆ¬è¾ƒé•¿</p><blockquote><p><code>1 ä¸» 2 è°“ 3 å®¾ 4 </code></p><p><strong><code>è‹±è¯­ä¸­å®šè¯­å¯èƒ½åœ¨ 1 2 ä½ç½®, ä¿®é¥°ä¸»è¯­, å¯èƒ½åœ¨ 3 4 ä½ç½®ä¿®é¥°å®¾è¯­</code></strong></p><p><strong><code>ä½†åœ¨ä¸­æ–‡ä¸­å®¾è¯­åªèƒ½æ”¾åœ¨ 1 ä½ç½®ä¿®é¥°ä¸»è¯­, 3ä½ç½®ä¿®é¥°å®¾è¯­</code></strong></p></blockquote><h2 id="A-of-B"><a href="#A-of-B" class="headerlink" title="A of B"></a><code>A of B</code></h2><ul><li>ç™¾åˆ†ä¹‹99éƒ½ç¿»è¯‘æˆ B çš„ A</li><li>Aæœ‰å½¢å®¹è¯å«ä¹‰: A çš„ B</li><li>Aæœ‰åŠ¨è¯å«ä¹‰: AB</li><li>AæŠ½è±¡æ„æ€Bå…·ä½“äº‹ç‰©: BAæˆ–è€…åªç¿»è¯‘B (ä¸Šä¹‰è¯ä¸­æœ‰ä¸ªç±»å‹æ˜¯ä¸‹ä¹‰è¯, æ¯”å¦‚åŸå¸‚å’Œå—äº¬)</li></ul><p>ä¸Šä¹‰è¯å’Œä¸‹ä¹‰è¯: in 2022 ä½¿ç”¨è¿™ç§æ–¹å¼ in the year of 2022 </p><blockquote><p>è¿™ç§æ–¹å¼æ¯”è¾ƒæ­£å¼</p></blockquote><h1 id="æ±‰è¯­ä¸­çŠ¶è¯­çš„ä½ç½®å’Œè‹±è¯­ä¸­çš„å·®åˆ«"><a href="#æ±‰è¯­ä¸­çŠ¶è¯­çš„ä½ç½®å’Œè‹±è¯­ä¸­çš„å·®åˆ«" class="headerlink" title="æ±‰è¯­ä¸­çŠ¶è¯­çš„ä½ç½®å’Œè‹±è¯­ä¸­çš„å·®åˆ«"></a>æ±‰è¯­ä¸­çŠ¶è¯­çš„ä½ç½®å’Œè‹±è¯­ä¸­çš„å·®åˆ«</h1><p>è‹±è¯­çŠ¶è¯­çš„ä½ç½®æ˜¯éšæœºçš„, ä½†ç¿»è¯‘æˆæ±‰è¯­å, çŠ¶è¯­çš„ä½ç½®å¹¶ä¸æ˜¯éšæœºçš„, <strong>åªèƒ½æ”¾åœ¨è°“è¯­ä¹‹å‰</strong></p><p>ç¿»è¯‘æˆä¸­æ–‡å, çŠ¶è¯­çš„ä½ç½®å¿…é¡»åœ¨è°“è¯­å‰é¢</p><blockquote><p><code>1 ä¸» 2 è°“ 3 å®¾ 4</code></p><p><strong><code>ä¸Šé¢æ˜¯ 1 ~ 4 å·ä½ç½®åœ¨è‹±æ–‡ä¸­éƒ½å¯ä»¥æ”¾çŠ¶è¯­</code></strong></p><p><strong><code>ä½†åœ¨ä¸­æ–‡ä¸­, çŠ¶è¯­åªèƒ½æ”¾åœ¨ 1 2 4 ä½ç½®</code></strong></p></blockquote><blockquote><p>çŠ¶è¯­ä¸€èˆ¬æƒ…å†µä¸‹, ä¸ä¼šæ”¾åœ¨ <code>å®¾ å®¾ ä¹‹é—´</code>, ä¹Ÿä¸ä¼šæ”¾åœ¨ <code>å®¾ å®¾è¡¥ä¹‹é—´</code></p></blockquote><h2 id="ä¸ºä»€ä¹ˆä¼šå¼ºè°ƒ3å·ä½ç½®çš„çŠ¶è¯­"><a href="#ä¸ºä»€ä¹ˆä¼šå¼ºè°ƒ3å·ä½ç½®çš„çŠ¶è¯­" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå¼ºè°ƒ3å·ä½ç½®çš„çŠ¶è¯­?"></a>ä¸ºä»€ä¹ˆä¼šå¼ºè°ƒ3å·ä½ç½®çš„çŠ¶è¯­?</h2><p><code>1 A 2 è°“è¯­ 3 B 4</code></p><p>å¦‚æœçŠ¶è¯­å†™åˆ°é™¤ 3 å·ä½ç½®æ„å¤–çš„åœ°æ–¹å®¹æ˜“é€ æˆé˜…è¯»è€…è¯¯åˆ¤ä¸ºå®šè¯­, ç‰¹åˆ«æ˜¯ 2 å’Œ 4 å·ä½ç½®, çŠ¶è¯­å†™ 2 4 ä½ç½®æœ‰äº›æƒ…å†µä¸‹ç‰¹åˆ«éš¾ä»¥åˆ¤æ–­</p><blockquote><p>çŠ¶è¯­å†™åœ¨ 1 å·ä½ç½®è¿˜å¯ä»¥ç”¨é€—å·éš”å¼€, è¿˜ç®—å¥½äº›</p></blockquote><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­:"></a>ä¾‹å­:</h3><p>They maintain with a certain fidelity the principle of this school.</p><p>è°“è¯­æ˜¯ maintain</p><p>with a certain fidelity æ˜¯çŠ¶è¯­</p><p>â€œä»–ä»¬åšå®šåœ°æ”¯æŒè¿™ä¸ªå­¦æ´¾çš„åŸåˆ™â€</p><blockquote><p>å°† 3 å·ä½ç½®ä¸Šçš„çŠ¶è¯­æ”¾åˆ°2å·ä½ç½®ä¸Šç¿»è¯‘</p></blockquote><p>He has elected as his primary duty and pleasure in life the activity of thinking in a Socratic way about moral problems.</p><p>è°“è¯­  has  elected</p><p>as his primary duty and pleasure in life çŠ¶è¯­</p><p>of thinking in a Socratic way about moral problems. å®šè¯­</p><p>ä»–æŠŠç”¨è‹æ ¼æ‹‰åº•çš„æ–¹å¼æ¥æ€è€ƒé“å¾·é—®é¢˜çš„è¡Œä¸ºå½“æˆä»–ä¸€ç”Ÿçš„åŸºæœ¬è´£ä»»å’Œæœ€å¤§çš„å¿«ä¹</p><blockquote><p>è¿™é‡Œå°±è¦æŠŠä¸‰å·ä½ä¸Šçš„çŠ¶è¯­æ”¾åˆ°4å·ä½ç½®ä¸Šç¿»è¯‘, ä¸€èˆ¬æƒ…å†µä¸‹, æ”¾åœ¨ 2 å·ä½ä¸Šå°±ä¸é”™äº†, ä¸è¡Œå°±æ”¾ 1 å·ä½ä¸Š, ç»“æœè¿™çŠ¶è¯­ 1 2 éƒ½ä¸è¡Œ, ç¿»è¯‘ä¸é¡ºåˆ©, åªèƒ½æ”¾åœ¨ 4 å·ä½ç½®ä¸Š</p></blockquote><h3 id="å®šè¯­å’ŒçŠ¶è¯­ä¸ç¡®å®šæ€ä¹ˆåŠ"><a href="#å®šè¯­å’ŒçŠ¶è¯­ä¸ç¡®å®šæ€ä¹ˆåŠ" class="headerlink" title="å®šè¯­å’ŒçŠ¶è¯­ä¸ç¡®å®šæ€ä¹ˆåŠ?"></a>å®šè¯­å’ŒçŠ¶è¯­ä¸ç¡®å®šæ€ä¹ˆåŠ?</h3><p>ä¼˜å…ˆè€ƒè™‘ä¸ºå®šè¯­, å¦‚æœä¸é€šé¡º, åˆ™æ”¹æˆçŠ¶è¯­</p><h3 id="å®šè¯­å’ŒçŠ¶è¯­éƒ½å¯ä»¥æ—¶æ€ä¹ˆåŠ"><a href="#å®šè¯­å’ŒçŠ¶è¯­éƒ½å¯ä»¥æ—¶æ€ä¹ˆåŠ" class="headerlink" title="å®šè¯­å’ŒçŠ¶è¯­éƒ½å¯ä»¥æ—¶æ€ä¹ˆåŠ?"></a>å®šè¯­å’ŒçŠ¶è¯­éƒ½å¯ä»¥æ—¶æ€ä¹ˆåŠ?</h3><blockquote><p>æ”¾åˆ°ä¸Šä¸‹æ–‡ä¸­åˆ¤æ–­</p></blockquote><p>åœ¨å®é™…æ±‰åŒ–è¿‡ç¨‹ä¸­, å¯èƒ½ä¼šé‡åˆ° æ—¢æ˜¯ çŠ¶è¯­ ä¹Ÿæ˜¯ å®šè¯­ çš„æƒ…å†µ, æ¯”å¦‚:</p><p>I saw a man with a telescope.</p><ul><li>è¿™é‡Œçš„ with a telescope æ—¢å¯ä»¥ä½œå®šè¯­, ä¿®é¥° man , åœ¨ 4 å·ä½ç½®, ç¿»è¯‘æ—¶éœ€è¦æ”¾åˆ° 3 å·ä½ç½®</li></ul><p>æ±‰åŒ–ä¸º: â€œæˆ‘çœ‹åˆ°ä¸€ä¸ªå¸¦ç€æœ›è¿œé•œçš„ç”·äººâ€</p><ul><li>ä¹Ÿå¯ä»¥ä½œçŠ¶è¯­, ä¿®é¥° saw åŠ¨è¯, åœ¨ 4 å·ä½ç½®, ç¿»è¯‘æ—¶éœ€è¦æ”¾åˆ° 1 æˆ– 2 å·ä½ç½®(è°“è¯­ä¹‹å‰), è¿™é‡Œæ”¾åˆ° 2 å·ä½ç½®æ›´å¥½ç¿»è¯‘</li></ul><p>æ±‰åŒ–ä¸º: æˆ‘å¸¦ç€æœ›è¿œé•œçœ‹åˆ°ä¸€ä¸ªç”·äºº</p><p>ä¸Šé¢è¿™ç§æƒ…å†µ, åªèƒ½å¤Ÿå€ŸåŠ© è¯­å¢ƒ (ä¹Ÿå°±æ˜¯ä¸Šä¸‹æ–‡æƒ…å†µ) å…·ä½“åˆ†æåˆ°åº•æ˜¯ä¿®é¥°çš„åŠ¨è¯è¿˜æ˜¯åè¯</p><h2 id="ä¸€äº›å‰¯è¯åœ¨ä¿®é¥°ä¸€ä¸ªå¥å­"><a href="#ä¸€äº›å‰¯è¯åœ¨ä¿®é¥°ä¸€ä¸ªå¥å­" class="headerlink" title="ä¸€äº›å‰¯è¯åœ¨ä¿®é¥°ä¸€ä¸ªå¥å­"></a>ä¸€äº›å‰¯è¯åœ¨ä¿®é¥°ä¸€ä¸ªå¥å­</h2><blockquote><p>æˆ‘ä»¬å¯ä»¥ç‹¬ç«‹ç¿»è¯‘æˆä¸€å¥è¯, â€œè¿™æ˜¯ â€¦ çš„â€</p></blockquote><p>She is admittedly reliable. å¥¹å¾ˆå¯é , è¿™æ˜¯å¤§å®¶æ‰¿è®¤çš„</p><p>It is painfully apparent that she is a liar.</p><p>å¾ˆæ˜æ˜¾å¥¹æ˜¯ä¸€ä¸ªéª—å­, è¿™å¾ˆä»¤äººå¿ƒç—›</p><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„, è¿™å¥è¯æ˜¯ä¸»è¯­ä»å¥å˜å‡ºæ¥çš„, åŸå¥æ˜¯ That she is a liar is painfully apparent, æ‰€ä»¥è¿™é‡Œçš„å‰¯è¯åœ¨ä¸‰å·ä½ç½®, æå‰åˆ°å‰é¢ 1å· 2å·æˆ–è€…4å·ä½ç½®, è¿™é‡Œæåˆ°4å·ä½ç½®, ç¿»è¯‘æˆâ€å¾ˆæ˜æ˜¾å¥¹æ˜¯ä¸€ä¸ªéª—å­, è¿™å¾ˆä»¤äººå¿ƒç—›â€</p></blockquote><h1 id="é•¿éš¾å¥"><a href="#é•¿éš¾å¥" class="headerlink" title="é•¿éš¾å¥"></a>é•¿éš¾å¥</h1><p>while it is easy to ignore in our contact with them the effect of our acts upon their disposition, it is not so easy as in dealing with adults</p><p>While it is â€¦, it is â€¦</p><p>While æ”¾åœ¨å¥é¦–ä¸€èˆ¬è¢«ç¿»è¯‘æˆâ€œè™½ç„¶ã€‚ã€‚ã€‚ä½†æ˜¯â€</p><p>æ‰¾ä¸‹è¿è¯:</p><p>while æ²¡äº†</p><p>æ–­å¥ï¼š</p><ul><li>while it is easy to ignore in our contact with them the effect of our acts upon their disposition, </li><li>it is not so easy as in dealing with adults</li></ul><p>æ‰¾ä¸‹è°“è¯­å€™é€‰ï¼š</p><p>is is æ–­å¥æ²¡é—®é¢˜</p><p>ç®€åŒ–ï¼š</p><ul><li>while it is easy to ignore ã€in ã€‚ã€‚ã€‚ with ã€‚ã€‚ã€‚ã€‘ the effect ã€of ã€‚ã€‚ã€‚ upon ã€‚ã€‚ã€‚ã€‘, </li><li>it is not so easy as ã€in ã€‚ã€‚ã€‚ã€‘</li></ul><blockquote><p>ä¸ºä»€ä¹ˆ to ignore ã€‚ã€‚ã€‚ effect ä¸­é—´ä¼šæœ‰in our contact with themï¼Ÿ</p><p>è¿™é‡Œå…¶å®æ¶‰åŠåˆ° 3å· ä½ç½®çš„çŠ¶è¯­é—®é¢˜ï¼Œå¦‚æœä½ æŠŠin our contact with themæ”¾åœ¨their dispositionä¹‹åï¼Œä¼šäº§ç”ŸäºŒä¹‰æ€§ï¼Œin our contact with themåˆ°åº•ä¿®é¥°çš„æ˜¯dispositionè¿˜æ˜¯ä¿®é¥°çš„ignoreï¼Ÿ</p><p>ä½œè€…æƒ³è¦ä¿®é¥°çš„æ˜¯åŠ¨è¯ ignoreï¼ˆä½œçŠ¶è¯­ï¼‰ï¼Œè€Œä¸æ˜¯åè¯ dispositionï¼ˆä½œå®šè¯­ï¼‰</p></blockquote><p>ç®€å•ç¿»è¯‘ï¼š</p><p>è™½ç„¶ å¿½ç•¥å½±å“å¾ˆç®€å•ï¼Œä½†æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼ˆå¾ˆå›°éš¾ï¼‰ä»¥è‡³äºã€‚ã€‚ã€‚</p><blockquote><p>è¿™é‡Œå‰é¢çš„ä¸€å¥ç¿»è¯‘æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†åé¢ä¸€å¥å¾ˆå¥‡æ€ªï¼Œè¿™é‡Œçš„ so adj&#x2F;adv as to do sthï¼Œè¯´æ˜åé¢ä¸€å¥è¯æœ‰çœç•¥çš„éƒ¨åˆ†ï¼Œä¸ç„¶çªå…€çš„åŠ ä¸Š in dealing with adults å°±å¾ˆå¥‡æ€ªä¸æ˜¯ï¼Ÿ</p></blockquote><p>è¿˜åŸï¼š</p><p>å‰é¢ä¸€å¥æˆ‘ä»¬èƒ½å¤Ÿç¿»è¯‘çš„å‡ºæ¥ï¼š</p><p>è™½ç„¶åœ¨æˆ‘ä»¬æ¥è§¦ä»–ä»¬æ—¶å¿½ç•¥äº†æˆ‘ä»¬çš„è¡Œä¸ºå¯¹ä»–ä»¬å¿ƒç†çš„å½±å“</p><p>åé¢ä¸€å¥è¯ï¼Œç¿»è¯‘éœ€è¦è¡¥å……çœç•¥çš„éƒ¨åˆ†</p><blockquote><ol><li><p>æˆ‘ä»¬çŸ¥é“çœç•¥ä¸€èˆ¬éƒ½æ˜¯å‰é¢å·²ç»æœ‰çš„æˆåˆ†ï¼Œåé¢å¯ä»¥å¿½ç•¥æ‰</p></li><li><p>è¿™æ¬¡çš„çœç•¥æé†’äº†æˆ‘ä»¬æœªå¿…å°±ä¸€å®šéœ€è¦ è¿è¯ æ‰èƒ½å¤Ÿäº§ç”Ÿçœç•¥</p></li></ol></blockquote><p>è·Ÿä¸Šé¢çš„æç¤ºæˆ‘ä»¬è¡¥å……çœç•¥çš„éƒ¨åˆ†ï¼š</p><p>it is easy to ignore ã€in our contact with them çŠ¶è¯­ã€‘ ï¼ˆthe effect of our acts upon their dispositionï¼‰</p><p>it is not so easy as to ignore the effect of our acts upon their disposition in dealing with adults</p><p>è¿™æ ·æˆ‘ä»¬å°±è¡¥å…¨äº†æˆ‘ä»¬çš„ä»£ç ï¼ŒåŒæ—¶ä¸ºäº†é˜²æ­¢çŠ¶è¯­ä»å¥è¢«äºŒä¹‰æˆå®šè¯­ï¼Œéœ€è¦æ”¾åœ¨ 3 å·ä½ç½®</p><p>it is not so easy as to ignore in dealing with adults the effect of our acts upon their disposition</p><p>å¯ä»¥ç¿»è¯‘äº†</p><p>ä½†åœ¨é¢å¯¹æˆå¹´äººçš„æ—¶å€™ï¼Œå®ƒæ˜¯å¦‚æ­¤çš„å›°éš¾ï¼Œä»¥è‡³äºå¿½è§†äº†æˆ‘ä»¬çš„è¡Œä¸ºå¯¹ä»–ä»¬ï¼ˆæˆå¹´äººï¼‰å¿ƒç†çš„å½±å“</p><p>å®Œæ•´ç¿»è¯‘ï¼š</p><p>è™½ç„¶åœ¨é¢å¯¹æœªæˆå¹´äººæ—¶å¿½ç•¥äº†æˆ‘ä»¬çš„è¡Œä¸ºå¯¹ä»–ä»¬å¿ƒç†çš„å½±å“ï¼Œä½†åœ¨é¢å¯¹æˆå¹´äººçš„æ—¶å€™ï¼Œå®ƒæ›´åŠ çš„å›°éš¾ã€ä»¥è‡³äºå¿½è§†äº†æˆ‘ä»¬çš„è¡Œä¸ºå¯¹ä»–ä»¬å¿ƒç†çš„å½±å“ã€‘</p><p>Now the nationâ€™s top patent court appears completely ready to scale back on business-method patents, which have been controversial ever since they were first authorized 10 years ago.</p><p>ç°åœ¨, å›½å®¶é¡¶çº§ä¸“åˆ©æ³•æ¡ˆä¼¼ä¹å·²ç»å®Œæˆå¹¶å‡†å¤‡ç¼©å‡å•†ä¸šåŠæ³•æ³•æ¡ˆ, è‡ªä»åå¹´å‰ä»–ä»¬é¦–æ¬¡æˆæƒä»¥æ¥, è¿™é¡¹æ³•æ¡ˆå·²ç»å¼•èµ·äº†äº‰è®®.</p><p>Curbs(é™åˆ¶) on business-method claims would be a dramatic about-face(åè½¬), because it was the Federal Circuit itself that introduced such patents with is 1998 decision in the so-called state Street Bank case, approving a patent on a way of pooling mutual-fund assets.</p><p>å¯¹å•†ä¸šæ–¹æ³•ç´¢èµ”çš„é™åˆ¶å°†æ˜¯ä¸€ä¸ªæˆå‰§æ€§çš„è½¬æŠ˜ç‚¹ï¼Œå› ä¸ºæ­£æ˜¯è”é‚¦å·¡å›æ³•é™¢æœ¬èº«åœ¨1998å¹´çš„æ‰€è°“çš„é“å¯Œé“¶è¡Œæ¡ˆä¸­æå‡ºäº†è¿™ç±»ä¸“åˆ©ï¼Œæ‰¹å‡†äº†ä¸€é¡¹å…±åŒåŸºé‡‘èµ„äº§é›†èµ„æ–¹æ³•çš„ä¸“åˆ©ã€‚</p><blockquote><p>è¿™å¥è¯çš„ on a way of pooling mutual-fund assets åˆ°åº•æ˜¯çŠ¶è¯­è¿˜æ˜¯å®šè¯­? é»˜è®¤å®šè¯­</p></blockquote><p>The Federal Circuit issued(å‘å¸ƒ) an unusual order stating that the case would be heard by all 12 of the courtâ€™s judges, rather than a typical panel of three, and that one issue it wants to evaluate is whether it shouldâ€œreconsiderâ€its State Street Bank ruling.</p><ul><li><p>The Federal Circuit issued an unusual order è¿™æ˜¯ä¸ªä¸»å¹²</p></li><li><p>stating that the case would be heard by all 1 2 of the courtâ€™s judges å®¾è¯­ä»å¥è¿™æ˜¯ä¸€ä¸ªåŠ¨å®¾ç»“æ„</p></li><li><p>, rather than a typical panel of three, çœ‹èµ·æ¥å¾ˆåƒæ’å…¥è¯­, ä½†æ˜¯çœ‹åˆ°äº†åé¢çš„ and, å¯èƒ½æ˜¯ , , and å½¢å¼, çœ‹çœ‹å¥å­è¯æ€§é¡ºåºæ˜¯å¦ç›¸åŒ, å‰é¢çš„ that å®¾è¯­ä»å¥å’Œåé¢çš„ that å®¾è¯­ä»å¥ éƒ½æ˜¯ä¸»è°“å®¾ç»“æ„, ä½†æ˜¯ä¸­é—´çš„ ,rather than â€¦, å´æ²¡æœ‰, æ˜æ˜¾æ˜¯æ’å…¥è¯­</p></li><li><p>and that one issue it wants to evaluate is whether it shouldâ€œreconsiderâ€its State Street Bank ruling. å¹¶åˆ—å¥, çœ‹æƒ…å†µå¯¹åº”å‰é¢çš„ that the case would be heardâ€¦ æ‰€ä»¥åé¢çš„å¥å­çœç•¥äº† stating</p></li><li><p>whether it shouldâ€œreconsiderâ€its State Street Bank ruling. åˆšçœ‹çš„æ—¶å€™ä»¥ä¸ºæ˜¯ to evaluate çš„å®¾è¯­ä»å¥å½¢å¼, ä¹Ÿå°±æ˜¯åŠ¨å®¾å½¢å¼</p><blockquote><p>è¿™ä¹Ÿæ˜¯åªæ‰¾è¿è¯çš„é—®é¢˜, ä¸æ¸…æ¥šæœ‰äº›å¥å­çš„å½¢å¼, æŒ‰æˆ‘æ€»ç»“æ¥çœ‹, è¿è¯å¿…é¡»é…åˆè°“è¯­, åº”è¯¥è¦ è°“è¯­å’Œè¿è¯ä¸€èµ·æ‰¾, æ‰€ä»¥ä»¥åæ”¹ä¸‹, ä¸Šé¢çš„æ€»ç»“æ­¥éª¤ç›´æ¥ä¸è¦, é‡æ–°åˆ†æ</p></blockquote></li></ul><ol><li>æ‰¾åŠ¨è¯</li></ol><ul><li><code>issued</code>: æ²¡æœ‰è¿è¯, æ€€ç–‘æ˜¯ è°“è¯­, å†å‰é¢åŠ ä¸Š <code>is issued</code> åˆ¤æ–­æ˜¯å¦æ˜¯è¢«åŠ¨å½¢å¼, â€œè”é‚¦å·¡å›æ³•åº­è¢«å‘å¸ƒäº†ä¸€é¡¹ä¸å¯»å¸¸çš„æŒ‡ç¤ºâ€, æ˜æ˜¾ä¸æ˜¯è¢«åŠ¨å‘å¸ƒçš„æŒ‡ç¤º, æ‰€ä»¥æ˜¯ <code>è°“è¯­</code>, æ‰¾åˆ°äº†ä¸»å¹²â€<code>The Federal Circuit issued an unusual order</code>â€œ</li><li>æ‰¾åˆ° <code>that</code> è¿è¯, æ‰¾æ‰¾åé¢çš„ åŠ¨è¯ æ˜¯å“ªä¸ª, <code>would be heard</code></li><li>æ‰¾åˆ°å¹¶åˆ—è¿è¯<code>and that one issue</code>, å‘ç°æœ‰çœç•¥(å‰é¢æœ‰å¯¹åº”çš„ <code>that the case</code>), æ‰€ä»¥åé¢çš„å¥å­åŠ ä¸Š<code>and stating that one issue </code></li><li>æ‰¾åˆ°è¿è¯ <code>and that</code>, å‰é¢è¿˜æœ‰ä¸¤ä¸ª <code>,</code> çš„å½¢å¼, é€šè¿‡åˆ†æå¥å­çš„è¯æ€§, å‘ç°ä¸­é—´çš„éƒ¨åˆ†æ˜¯æ’å…¥è¯­, å¯ä»¥ä¸çœ‹, åœ¨åé¢æ‰¾åˆ°äº†ä¸¤ä¸ª åŠ¨è¯, <code>wants</code> å’Œ <code>is</code> è¯´æ˜æœ‰ <code>ä¸»ä¸»è°“è°“</code> æˆ–è€… <code>ä¸»è°“ä¸»è°“</code>çš„å½¢å¼, æˆ‘ä»¬åˆ†æä¸‹è°“è¯­å’Œè°“è¯­ä¹‹é—´æ˜¯å¦æœ‰åˆé€‚çš„ä¸»è¯­, å‘ç°ä¹‹é—´æ˜¯ <code>to evaluate</code> ä¸æ˜¯åè¯æˆ–è€…ä»£è¯, æ‰€ä»¥æ˜¯ <code>ä¸»ä¸»è°“è°“</code>å½¢å¼, å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥ä»<code>åè¯ + åè¯</code>çš„å½¢å¼åˆ¤æ–­, å¦‚æœæœ‰<code>åè¯ + åè¯</code> è¿™ç§å½¢å¼å°±èƒ½åˆ¤æ–­æ˜¯<code>ä¸»ä¸»è°“è°“</code>å½¢å¼, æ˜æ˜¾è¿™é‡Œæœ‰<code>one issue it</code>, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çŸ¥é“<code>ä¸»ä¸»è°“è°“</code>ä¸­é—´çš„<code>ä¸»è°“</code>æ˜¯ä»å¥, å‰é¢æ˜¯ä¸ªåè¯, æ‰€ä»¥ä¸­é—´çš„<code>ä¸»è°“</code>æ˜¯<code>å®šè¯­ä»å¥</code> : <code>it wants to evaluate</code></li><li><code>is whether it shouldâ€œreconsiderâ€its State Street Bank ruling.</code> æ˜æ˜¾è¿™æ˜¯ä¸ª<code>è¡¨è¯­ä»å¥</code>, è¿è¯æ˜¯<code>whether</code>åé¢çš„åŠ¨è¯æ˜¯<code>shouldâ€œreconsiderâ€</code></li></ul><p>è‡³æ­¤è¯­æ³•åˆ†æå®Œæ¯•</p><ol start="2"><li>åˆ†æä¸»å¹²å’Œä¿®é¥°éƒ¨åˆ†</li></ol><ul><li><p>ä¸»å¹²æ˜¯: <code>The Federal Circuit issued(å‘å¸ƒ) an unusual order</code> æ„æ€æ˜¯ â€œè”é‚¦å·¡å›æ³•é™¢å‘å¸ƒäº†ä¸€é¡¹ä¸åŒå¯»å¸¸çš„æŒ‡ç¤ºâ€</p></li><li><p><code>order stating(é™ˆè¿°) that</code> æ˜¯<code>åŠ¨å®¾ç»“æ„</code>, <code>order</code> æ˜¯åè¯, é»˜è®¤ç©¶ç«Ÿä¿®é¥°è¡¨<code>å®šè¯­</code></p></li><li><p><code>by all 1 2 of the court&#39;s judges</code> è¿˜æ˜¯<code>å°±è¿‘ä¿®é¥°</code>, çœ‹åˆ°å‰é¢çš„ <code>would be heard</code> æ˜¯åŠ¨è¯, è¯´æ˜è¿™æ˜¯çŠ¶è¯­</p></li><li><p><code>, rather than a typical panel of three,</code> æ’å…¥è¯­ä¸çœ‹, ä¸è¿‡è¿˜æ˜¯å°±è¿‘ä¿®é¥°ä¿®é¥°<code>the court&#39;s judges</code></p></li></ul><ol start="3"><li>æ•´ä½“ç¿»è¯‘</li></ol><p>è”é‚¦å·¡å›æ³•é™¢å‘å¸ƒäº†ä¸€é¡¹ç‰¹æ®Šçš„æŒ‡ç¤º, è¿™é¡¹æŒ‡ç¤ºæè¿°äº†è¯¥æ¡ˆä»¶å°†ç”±12ä¸ªæ³•é™¢çš„æ³•å®˜å¬å®¡, è€Œä¸æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¸‰äººé™ªå®¡ç»„, å¹¶ä¸”ä¹Ÿæè¿°äº†æ³•é™¢æƒ³è¦å®¡æŸ¥çš„é—®é¢˜æ˜¯ æ˜¯å¦åº”è¯¥â€é‡æ–°è€ƒè™‘â€å¯¹é“å¯Œé“¶è¡Œçš„è£å®š</p>]]></content>
      
      
      <categories>
          
          <category> è‹±è¯­ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç‹¬ç«‹ä¸»æ ¼ </tag>
            
            <tag> çŠ¶è¯­ </tag>
            
            <tag> å®šè¯­ </tag>
            
            <tag> ofä»å± </tag>
            
            <tag> 3å·ä½ç½® </tag>
            
            <tag> ä½ç½® </tag>
            
            <tag> æ±‰è¯­å’Œè‹±è¯­çš„åŒºåˆ« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>07é•¿éš¾å¥åˆ†æ</title>
      <link href="/2022/11/25/06%E8%8B%B1%E8%AF%AD/07%E9%95%BF%E9%9A%BE%E5%8F%A5%E5%88%86%E6%9E%90/"/>
      <url>/2022/11/25/06%E8%8B%B1%E8%AF%AD/07%E9%95%BF%E9%9A%BE%E5%8F%A5%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="é•¿éš¾å¥åˆ†æ-â€”â€”-æ–­å¥"><a href="#é•¿éš¾å¥åˆ†æ-â€”â€”-æ–­å¥" class="headerlink" title="é•¿éš¾å¥åˆ†æ â€”â€” æ–­å¥"></a>é•¿éš¾å¥åˆ†æ â€”â€” æ–­å¥</h1><blockquote><p>å°†å¥å­æ–­å¼€</p></blockquote><h2 id="æ ‡ç‚¹ç¬¦å·"><a href="#æ ‡ç‚¹ç¬¦å·" class="headerlink" title="æ ‡ç‚¹ç¬¦å·"></a>æ ‡ç‚¹ç¬¦å·</h2><p>, åé¢ä¸€èˆ¬æœ‰è¿è¯</p><p>; ç›¸å½“äºå¹¶åˆ—è¿è¯</p><p>: ç›¸å½“äºåŒä½è¯­</p><h2 id="è¿æ¥è¯"><a href="#è¿æ¥è¯" class="headerlink" title="è¿æ¥è¯"></a>è¿æ¥è¯</h2><h3 id="ä½¿ç”¨è¿è¯æ–­å¼€å¥å­"><a href="#ä½¿ç”¨è¿è¯æ–­å¼€å¥å­" class="headerlink" title="ä½¿ç”¨è¿è¯æ–­å¼€å¥å­"></a>ä½¿ç”¨è¿è¯æ–­å¼€å¥å­</h3><blockquote><p>åæœŸæ€»ç»“ï¼šç”°é™è€å¸ˆçš„æ–¹å¼æ˜¯æ‰¾è¿è¯</p><p><strong><code>æˆ‘çš„å»ºè®®æ˜¯ è¿è¯å’ŒåŠ¨è¯ä¸€èµ·æ‰¾ æ¥æ–­å¥ï¼Œå› ä¸ºæœ‰äº›ç±»è¿è¯å…¶å®ä¸æ˜¯è¿è¯ï¼Œæœ‰äº›è¿è¯è¿˜è¢«çœç•¥</code></strong></p></blockquote><blockquote><p><strong><code>è®°ä½ï¼Œåªè¦ä»å¥å‰é¢æœ‰ä¸ªåè¯ï¼Œå°±æœ‰å¯èƒ½æ˜¯åŒä½è¯­æˆ–è€…å®šè¯­</code></strong></p><p><strong><code>å¦‚æœ å¼•å¯¼è¯ è¿˜åšä»å¥æˆåˆ†ï¼Œé‚£æ¯•ç«Ÿæ˜¯å®šè¯­ä»å¥ï¼Œå¦åˆ™å°±æ˜¯åŒä½è¯­ä»å¥</code></strong></p><p><strong><code>å¦‚æœ that è¿˜æ²¡çœç•¥äº†ï¼Œé‚£å¿…å®šæ˜¯å®šè¯­ä»å¥</code></strong></p></blockquote><p>ä»å¥å¼€å§‹äºè¿æ¥è¯, ç»“æŸäºä¸‰ä¸ªä½ç½®ï¼š</p><ol><li>ç»“æŸäºæ ‡ç‚¹</li><li>ç»“æŸäºä¸‹ä¸€ä¸ªè¿æ¥è¯ä¹‹å‰</li><li>ç»“æŸäºç¬¬äºŒä¸ªè°“è¯­å‰</li><li>å¥æœ«</li></ol><hr><p>One of the reasons why the appointment came as such a surprise, however, is that Gilbert is comparatively little known.</p><ol><li><p>æ‰¾æ ‡ç‚¹ï¼Œçœ‹åˆ°ä¸¤ä¸ªé€—å·ï¼Œåé¢ä¸€ä¸ªé€—å·ç›´æ¥è¿æ¥ç€è°“è¯­ï¼Œåˆ¤å®šä»–æ˜¯ä¸€ä¸ªæ’å…¥è¯­</p></li><li><p>æ‰¾åˆ°ä¸¤ä¸ªè¿è¯ï¼Œ why å’Œ that</p></li></ol><p>why åˆ°æ ‡ç‚¹ç¬¦å·ç»“æŸï¼Œthatåˆ°å¥æœ«</p><ol start="3"><li>çœ‹ä¸»å¹²</li></ol><p>One of the reasons is that ã€‚ã€‚ã€‚ ä¸»ç³»è¡¨</p><ol start="4"><li>çœ‹ä»å¥</li></ol><p>reason åé¢çš„ why å®šè¯­ä»å¥</p><p>ç¿»è¯‘æˆ â€œè¿™ä¸ªä»»å‘½æ¥çš„è¿™ä¹ˆçªç„¶çš„ä¸€ç§ä¸€ä¸ªåŸå› â€</p><p>is that + ä»å¥ æ˜æ˜¾æ˜¯è¡¨è¯­ä»å¥</p><h2 id="ä¾‹å¥ã€æ”»ç•¥çš„ä½¿ç”¨"><a href="#ä¾‹å¥ã€æ”»ç•¥çš„ä½¿ç”¨" class="headerlink" title="ä¾‹å¥ã€æ”»ç•¥çš„ä½¿ç”¨"></a>ä¾‹å¥ã€æ”»ç•¥çš„ä½¿ç”¨</h2><blockquote><p>åœ¨å®é™…ç¿»è¯‘è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“ä»–åˆ°åº•æ˜¯ä»€ä¹ˆä»å¥ï¼Œåªéœ€è¦ç¬¦åˆ<strong>å°±è¿‘ä¿®é¥°åŸåˆ™</strong>å°±è¡Œ</p><p>æ­¤æ–¹æ³•æ˜¯æ ¹æ®è¿è¯æ–­å¥ï¼Œæ–¹æ³•ç‰¹åˆ«å¥½ï¼Œæ¯”æ ¹æ®è°“è¯­æ–­å¥é—¨æ§›ä½å¤šäº†</p><p>ä½†æ‰¾è¿è¯çš„æ–¹å¼æœ‰é—®é¢˜ï¼Œçœç•¥äº†æ€ä¹ˆåŠï¼Ÿå¦‚æœæ˜¯å®¾è¯­ä»å¥æˆ–è€…å®šè¯­ä»å¥ä½œå…³ç³»è¯ä½œå®¾è¯­çš„æƒ…å†µï¼Œæ ¹æœ¬å°±ä¸èƒ½çŸ¥é“è¿è¯å·²ç»çœç•¥</p></blockquote><blockquote><p>æ‰¾åˆ°è¿è¯çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ è¿è¯å’Œè°“è¯­çš„æ¯” n ï¼šn + 1 æ¥çœ‹ï¼Œæ‰¾åˆ°ä¸¤ä¸ªè¿è¯å°±æœ‰ä¸‰ä»¶äº‹ï¼ˆä¸¤ä¸ªåŠ¨è¯+ä¸€ä¸ªè°“è¯­ï¼‰ï¼Œæ‰¾åˆ°å››ä¸ªè¿è¯å°±æœ‰äº”ä»¶äº‹ï¼ˆå››ä¸ªåŠ¨è¯+ä¸€ä¸ªè°“è¯­ï¼‰ï¼Œæ²¡æœ‰æ‰¾åˆ°è¿è¯å°±åªæœ‰ä¸€ä»¶äº‹ï¼ˆä¸€ä¸ªè°“è¯­ï¼‰</p></blockquote><hr><p>Some species of trees have been â€œread out of the partyâ€ by economics-minded foresters<br><em>because</em> they grow too slowly, <em>or</em> have too low a sale value to pay as timber crops.</p><p>æ‰¾åˆ° because å’Œ or ï¼ˆæ‰¾åˆ°ä¸¤ä¸ªè¿è¯ï¼Œåº”è¯¥ä¼šæœ‰ä¸‰ä¸ªå¥å­ï¼‰</p><ul><li>Some species of trees have been â€œread out of the partyâ€ by economics-minded forestersï¼ˆä¸»å¹²ï¼Œä¸»ç³»è¡¨ç»“æ„ï¼‰</li><li><em>because</em> they grow too slowly, ï¼ˆåŸå› çŠ¶è¯­ä»å¥ï¼Œä¸»è°“ç»“æ„ï¼‰</li><li>they have too low a sale value to pay as timber crops. ï¼ˆåŸå› çŠ¶è¯­ä»å¥ï¼Œä¸»è°“å®¾ç»“æ„ï¼‰</li></ul><blockquote><p>å‘ç° or åé¢çš„å¥å­ä¸å®Œæ•´ï¼Œçœç•¥äº†ä¸»è¯­</p></blockquote><hr><p>Today they argue that market prices overstate losses, because they largely reflect the<br>temporary illiquidity of markets, not the likely extent of bad debts.</p><p>that ä»å¥ä½œå®¾è¯­ä»å¥ï¼Œbecause å¼•å‡ºäº†åŸå› çŠ¶è¯­ä»å¥</p><p>æ‰¾åˆ°ä¸¤ä¸ªè¿è¯ï¼Œåº”è¯¥ä¼šæœ‰ä¸‰ä¸ªåŠ¨è¯</p><p>å¥å­åˆ†æˆï¼š</p><ul><li><p>Today they argue</p></li><li><p>that market prices overstate losses,</p></li><li><p>because they largely reflect the temporary illiquidity of markets, not the likely extent of bad debts</p></li></ul><hr><p>But take a longer view and there is a surprising amount that we can say with considerable assurance.</p><p>and that æ‰¾åˆ°ä¸¤ä¸ªè¿è¯ï¼Œåº”è¯¥ä¼šæœ‰ä¸‰ä¸ªåŠ¨è¯</p><p>å¥å­æ–­æˆï¼š </p><ul><li>But take a longer view </li><li>and there is a surprising amount </li><li>that we can say with considerable assurance. ï¼ˆå®šè¯­ä»å¥ï¼Œä¿®é¥° amountï¼‰</li></ul><blockquote><p>å¦‚æœä¸çŸ¥é“æ˜¯å¦æ–­å¥æˆåŠŸï¼Œå¯ä»¥çœ‹çœ‹æ¯ä¸ªå¥å­æ˜¯å¦æœ‰ä¸”åªæœ‰ä¸€ä¸ªè°“è¯­</p></blockquote><hr><p>Now the nationâ€™s top patent court appears completely ready to scale back on business-method patents, which have been controversial ever since they were first authorized 10 years ago.</p><p>, which è¿™é‡Œæ˜æ˜¾æœ‰è¿è¯</p><p>ever since ä»ã€‚ã€‚ã€‚å¼€å§‹</p><p>æ‰¾åˆ°ä¸¤ä¸ªè¿è¯ï¼Œåº”è¯¥ä¼šæœ‰ä¸‰ä¸ªåŠ¨è¯</p><ul><li>Now the nationâ€™s top patent court appears completely ready to scale back on business-method patents</li><li>, which have been controversial ï¼ˆå®šè¯­ä»å¥ï¼Œä¿®é¥°å‰é¢ä¸€ä»¶äº‹ï¼‰</li><li>ever since they were first authorized 10 years ago.ï¼ˆæ—¶é—´çŠ¶è¯­ä»å¥ï¼‰</li></ul><hr><p>The principle of British welfare is no longer that you can insure yourself against the risk of unemployment and receive unconditional payments if the disaster happens.</p><p>è¿™é‡Œæ–­å¥æœ‰ä¸ªå°å‘</p><p>è¿è¯æœ‰ that and å’Œ if</p><p>æ‰¾åˆ°ä¸‰ä¸ªè¿è¯ï¼Œåº”è¯¥ä¼šæœ‰å››ä¸ªåŠ¨è¯</p><p>ä½†æ˜¯æ–­å¥çš„è¯æ˜¯ï¼š</p><ul><li>The principle of British welfare is no longer </li><li>that you can insure yourself against the risk of unemployment  ï¼ˆè¡¨è¯­ä»å¥ï¼Œå‰é¢çš„ no longeræ˜¯çŠ¶è¯­ï¼‰</li><li>and you can receive unconditional payments ï¼ˆè¡¨è¯­ä»å¥ï¼Œå‰é¢çš„ no longeræ˜¯çŠ¶è¯­ï¼‰</li><li>if the disaster happens ï¼ˆæ¡ä»¶çŠ¶è¯­ä»å¥ï¼‰</li></ul><p>å› ä¸º and åé¢çš„å¥å­ä¸å®Œæ•´ï¼Œè¢«çœç•¥äº†ä¸»è¯­ you can </p><blockquote><p>ä¸Šé¢æœ‰ä¸¤ä¸ªè¡¨è¯­ä»å¥</p></blockquote><hr><p>Until now, many sellers that have a physical presence in only a single state or a few states have been able to avoid charging sales taxes when they ship to addresses outside those states.</p><p>è¿™é‡Œä¹Ÿæœ‰å‘ï¼Œä½†å…¶å®ä¹Ÿæ²¡æœ‰</p><p>æ‰¾è¿è¯ï¼šthat or when </p><p>æ‰¾åˆ°ä¸‰ä¸ªè¿è¯ï¼Œåº”è¯¥ä¼šæœ‰å››ä¸ªåŠ¨è¯</p><p>å¥å­åˆ†æ–­æ—¶å‘ç°ä¸è¡Œï¼š</p><ul><li>Until now, many sellers</li></ul><p>è¿™æ ·ä½œä¸€å¥æ˜æ˜¾ç¼ºå°‘äº†æˆåˆ†ï¼Œæ‰€ä»¥åé¢çš„ thatä»å¥ è‚¯å®šæœ‰ä¸¤ä¸ªåŠ¨è¯</p><p>è¦è¿™æ ·åˆ†æ–­ï¼š</p><ul><li>Until nowï¼ˆæ”¾å¥é¦–ç”¨é€—å·éš”å¼€ï¼Œæ˜æ˜¾æ˜¯çŠ¶è¯­ï¼Œæ— æ‰€è°“äº†ï¼‰, many sellers have been able to avoid charging sales taxes ï¼ˆä¸»è°“å®¾ï¼‰</li><li>that have a physical presence in only a single state or a few states ï¼ˆå®šè¯­ä»å¥ï¼Œå…ˆè¡Œè¯ sellersï¼Œå·®ç‚¹åˆ¤æ–­æ˜¯åŒä½è¯­ä»å¥ï¼Œä¸è¿‡thatåšäº†ä»å¥æˆåˆ†ï¼‰</li><li>when they ship to addresses outside those states.ï¼ˆæ—¶é—´çŠ¶è¯­ä»å¥ï¼Œwhenå‰é¢æ²¡æœ‰ç±»ä¼¼æ—¶é—´çš„åè¯ï¼Œæ‰€ä»¥ä¸æ˜¯å®šè¯­ï¼Œå‰é¢ä¸»ç³»è¡¨éƒ½æœ‰ï¼Œä¸»å¹²ä¸ç¼ºæˆåˆ†ï¼Œæ‰€ä»¥ä¹Ÿä¸æ˜¯åè¯æ€§ä»å¥ï¼‰</li></ul><hr><p>Second, the majority of people who use networked computers to upload are not even aware of the significance of what they are doing.</p><p>å¥é¦–çŸ­è¯­+é€—å·ä¸€èˆ¬è®¤ä¸ºæ˜¯çŠ¶è¯­</p><p>è¿è¯ï¼šwho what</p><p>æ‰¾åˆ°ä¿©ä¸ªè¿è¯ï¼Œåº”è¯¥ä¼šæœ‰ä¸‰ä¸ªåŠ¨è¯</p><p>è¿˜æ˜¯åŒæ ·é—®é¢˜ï¼Œæ–­å¼€å¥å­å­˜åœ¨ä¸å®Œæ•´çš„åœ°æ–¹</p><ul><li>the majority of people</li></ul><p>æ‰€ä»¥ who å¼•å¯¼çš„ä»å¥æœ‰ä¸¤ä¸ªåŠ¨è¯ï¼Œwhoä»å¥åˆ°ä¸‹ä¸€ä¸ªåŠ¨è¯å‰é¢ç»“æŸï¼Œ æ˜æ˜¾åˆ° are</p><p>æ–­å¥ï¼š</p><ul><li>the majority of people are not even aware of the significanceï¼ˆä¸»ç³»è¡¨ï¼‰</li><li>who use networked computers to upload(å®šè¯­ä»å¥ï¼Œä¿®é¥° people)</li><li>of what they are doingï¼ˆå®¾è¯­ä»å¥ï¼Œä»‹å®¾ç»“æ„ï¼‰</li></ul><hr><p>If the bar exam is truly a stern enough test for a would-be lawyer, those who can sit it earlier should be allowed to do so.</p><p>é€—å· å¯ä»¥æ–­å¼€æˆä¸¤å¥</p><ul><li>If the bar exam is truly a stern enough test for a would-be lawyer,</li><li>those who can sit it earlier should be allowed to do so.</li></ul><p>æ‰¾è¿è¯ï¼šifï¼Œwho</p><p>æ‰¾åˆ°ä¿©ä¸ªè¿è¯ï¼Œåº”è¯¥ä¼šæœ‰ä¸‰ä¸ªåŠ¨è¯</p><p>è¿˜æ˜¯åŒæ ·çš„é—®é¢˜ï¼Œæ–­å¥ï¼Œæ–­å‡ºæ¥çš„å¥å­å¿…é¡»æˆåˆ†å®Œæ•´ those who æ˜¾ç„¶ä¸å®Œæ•´ï¼Œåªæœ‰ thoseï¼Œ who åé¢æœ‰ä¸¤ä¸ªåŠ¨è¯</p><p>æ–­å¥ï¼š</p><ul><li>those should be allowed to do so. (ä¸»è°“ï¼Œ to doä½œä¸»è¯­çš„è¡¥è¶³è¯­)</li><li>If the bar exam is truly a stern enough test for a would-be lawyer, ï¼ˆæ¡ä»¶çŠ¶è¯­ä»å¥ï¼‰</li><li>who can sit it earlierï¼ˆå®šè¯­ä»å¥ï¼Œä¿®é¥°å…ˆè¡Œè¯thoseï¼‰</li></ul><hr><p>When the competitive environment pushed our ancestors to achieve that potential, they could in turn afford more education.</p><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼šthat å¼•å¯¼çš„æ˜¯ä¸€ä¸ªä»å¥æ‰ç®—æ˜¯ è¿è¯</p><p>ä¸Šé¢çš„å¥å­ä¸­ that potential åªå¼•å¯¼äº†ä¸€ä¸ªå•è¯ï¼Œæ‰€ä»¥æ˜æ˜¾ä¸æ˜¯ è¿è¯</p><p>è¿è¯ï¼šwhen</p><p>æ‰¾åˆ°ä¸€ä¸ªè¿è¯ï¼Œåº”è¯¥ä¼šæœ‰ä¿©ä¸ªåŠ¨è¯</p><p>æ–­å¥ï¼š</p><ul><li><p>they could in turn afford more education.ï¼ˆä¸»å¹² ä¸»è°“å®¾ç»“æ„ï¼‰</p></li><li><p>When the competitive environment pushed our ancestors to achieve that potential,ï¼ˆæ—¶é—´çŠ¶è¯­ä»å¥ï¼Œä»å¥åˆ°æ ‡ç‚¹ç¬¦å·ç»“æŸï¼‰</p></li></ul><hr><p>Amazon.comâ€¦ also collects sales tax in every state that charges it, though third-party sellers who use the site donâ€™t have to.</p><p>å‘ç°é€—å·å¯ä»¥æ–­å¼€æˆä¸¤å¥ï¼š</p><ul><li>Amazon.comâ€¦ also collects sales tax in every state that charges it</li><li>though third-party sellers who use the site donâ€™t have to.</li></ul><p>æ‰¾è¿æ¥è¯ï¼šthatï¼Œthoughï¼Œwho <code>ä¸‰ä¸ªè¿è¯å¯ä»¥æ–­æˆå››ä¸ªåŠ¨è¯</code></p><ul><li>Amazon.comâ€¦ also collects sales tax in every state</li><li>that charges it</li><li>though third-party sellers donâ€™t have to.</li><li>who use the site</li></ul><hr><p>People who perceived greater social support were less likely to come down with a cold,<br>and the researchers calculated that the stress-reducing effects of hugging explained about 32 percent of that beneficial effect.</p><p>è¿è¯ï¼šwhoï¼Œandï¼Œthatï¼Œthatï¼ˆä½†å…¶å®ä¸æ˜¯ that beneficial[adj] effect[åªèƒ½æ˜¯åè¯]ï¼‰</p><p>æ‰¾åˆ° ä¸‰ä¸ªè¿è¯ï¼Œå…±æœ‰å››ä¸ªåŠ¨è¯</p><ul><li>People were less likely to come down with a coldï¼ˆä¸»ç³»è¡¨ï¼‰</li><li>who perceived greater social support (å®šè¯­ä»å¥ï¼Œå…ˆè¡Œè¯People)</li><li>and the researchers calculated ï¼ˆä¸»è°“å®¾ï¼‰</li><li>that the stress-reducing effects of hugging explained about 32 percent of that beneficial effectï¼ˆå®¾è¯­ä»å¥ï¼‰</li></ul><hr><p>We have to suspect that continuing economic growth promotes the development of education even when governments donâ€™ t force it.</p><p>è¿è¯ï¼šthatï¼Œwhen æ‰¾åˆ°ä¸¤ä¸ªè¿è¯ï¼Œæœ‰ä¸‰å¥è¯</p><ul><li>We have to suspect ï¼ˆä¸»è°“å®¾ï¼‰</li><li>that continuing economic growth promotes the development of education ï¼ˆå®¾è¯­ä»å¥ï¼Œä½œå®¾è¯­ï¼‰</li><li>even when governments donâ€™ t force itï¼ˆæ—¶é—´çŠ¶è¯­ä»å¥ï¼‰</li></ul><hr><p>The notion is that people have failed to detect the massive changes which have happened in the ocean because they have been looking back only a relatively short time into the pastã€‚</p><p>è¿è¯ï¼šthatï¼Œwhichï¼Œbecause</p><p>æ‰¾åˆ°ä¸‰ä¸ªè¿è¯ï¼Œå¿…å®šæœ‰å››ä¸ªåŠ¨è¯</p><ul><li>The notion is ï¼ˆä¸»ç³»è¡¨ï¼‰</li><li>that people have failed to detect the massive changes ï¼ˆè¡¨è¯­ä»å¥ï¼‰</li><li>which have happened in the ocean ï¼ˆå®šè¯­ä»å¥ï¼Œå…ˆè¡Œè¯æ˜¯changesï¼‰</li><li>because they have been looking back only a relatively short time into the pastã€‚ï¼ˆåŸå› çŠ¶è¯­ä»å¥ï¼‰</li></ul><hr><p>They are the possessions of the autonomous (self-governing) man of traditional theory, and they are essential to practices in which a person is held responsible for his conduct and given credit for his achievements.</p><p>æ‰¾å¹¶åˆ—è¿è¯ï¼šandï¼Œand</p><p>æ‰¾ä¸»ä»è¿è¯ï¼šin which</p><p>æ‰¾åˆ°ä¸‰ä¸ªè¿è¯ï¼Œå°±æœ‰å››ä¸ªåŠ¨è¯</p><ul><li>They are the possessions of the autonomous (self-governing) man of traditional theory,ï¼ˆä¸»ç³»è¡¨ï¼‰</li><li>and they are essential to practices ï¼ˆä¸»ç³»è¡¨ï¼‰</li><li>in which a person is held responsible for his conduct ï¼ˆå®šè¯­ä»å¥ï¼‰</li><li>and a person is given credit for his achievements.</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><blockquote><p>æ‰¾è¿è¯ï¼Œæ–­å¥å­ï¼ˆä¸åŒ…å«çœç•¥çš„æ–¹å¼ï¼Œçœç•¥æ–¹å¼éœ€è¦é…åˆ #åˆ†æä¸»è°“ ç« èŠ‚ï¼‰</p></blockquote><p>æ”»ç•¥1.ç°åœ¨ä»å¥ï¼Œä½†å…ˆçœ‹ä¸»å¥</p><p>æ”»ç•¥2.ä¸è¦çº ç»“ä»å¥</p><p>æ”»ç•¥3.å¹¶åˆ—æ³¨æ„å¿½ç•¥</p><blockquote><ul><li><p>ä»å¥ä¿®é¥°å‰é¢çš„åè¯å¹¶ä¸”å…³ç³»è¯ä½œä»å¥æˆåˆ† &#x3D;&#x3D;&gt; å®šè¯­ä»å¥</p></li><li><p>ä¸»å¹²ç¼ºå°‘æˆåˆ†ï¼Œä½¿ç”¨ä»å¥ä»£æ›¿åè¯æˆåˆ†ï¼Œå¹¶ä¸”å¼•å¯¼è¯ä¸åšä»å¥æˆåˆ† &#x3D;&#x3D;&gt; åè¯æ€§ä»å¥</p></li><li><p>ä»å±è¿è¯ + å®Œæ•´çš„å¥å­ï¼ˆä¸»è°“å®¾ï¼‰ &#x3D;&#x3D;&gt; çŠ¶è¯­ä»å¥</p></li></ul></blockquote><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><blockquote><p>è¿è¯çš„æ–¹å¼ç¡®å®æ›´åŠ ç®€å•ï¼ˆåˆ˜æ™“è‰³æ¨èä»¥æ‰¾åŠ¨è¯ä¸ºä¸»ï¼Œä¸å¤ªä¸€æ ·ï¼‰ï¼Œä½†å…¶å¸¦æ¥çš„äº†çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯è¿è¯çœç•¥äº†å’‹åŠï¼Ÿæ‰€ä»¥éœ€è¦åˆ«çš„æ–¹æ³•è§£å†³é‡åˆ°è¿è¯çœç•¥çš„é—®é¢˜</p></blockquote><h2 id="åˆ†æä¸»è°“"><a href="#åˆ†æä¸»è°“" class="headerlink" title="åˆ†æä¸»è°“"></a>åˆ†æä¸»è°“</h2><p>è¿™ç§æ–¹å¼åˆé€‚æ²¡æœ‰è¿è¯ï¼Œæ²¡æœ‰æ ‡ç‚¹ç¬¦å·çš„æƒ…å†µï¼Œæ¯”å¦‚ï¼šè¿è¯è¢«çœç•¥äº†ï¼Œæˆ–æ˜¯ç‹¬ç«‹ä¸»æ ¼ï¼Œåˆæˆ–è€…æ˜¯ä¼´éšå…³ç³»çŠ¶è¯­ä»å¥</p><ul><li><strong><code>ä¸»è°“ä¸»è°“(åé¢çš„ä¸»è°“æ˜¯ä»å¥)</code></strong></li><li><strong><code>ä¸»ä¸»è°“è°“(ä¸­é—´çš„ä¸»è°“æ˜¯ä»å¥)</code></strong></li></ul><blockquote><p>é™å®šè¯ + å•è¯ï¼Œè¿™ä¸ªå•è¯åº”è¯¥æ˜¯ åè¯&#x2F;ä»£è¯</p></blockquote><blockquote><p>ä»ä¸Šé¢å¯ä»¥æ‰¾åˆ°è¿™ç§æ–¹æ³•ï¼š</p><ul><li>æ‰¾æ‰¾æœ‰æ²¡æœ‰ <strong>åŒåè¯ï¼ˆä¸åšå®šè¯­åŒä½è¯­ï¼‰</strong> å½¢å¼ï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡æ˜¯ <strong>ä¸»ä¸»è°“è°“</strong>ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ˜¯ <strong>ä¸»è°“ä¸»è°“</strong></li><li><strong>æ‰¾åˆ°è°“è¯­å’Œè°“è¯­ä¹‹é—´æ˜¯å¦æœ‰åˆé€‚çš„åè¯ä½œä¸»è¯­</strong>ï¼Œæ²¡æœ‰åˆ™æ˜¯ <strong>ä¸»ä¸»è°“è°“</strong>ï¼Œå¦åˆ™å¯èƒ½æ˜¯ <strong>ä¸»è°“ä¸»è°“</strong></li></ul></blockquote><hr><p>The IASB says it does not want to act without overall planning, </p><p>ä¸»å¹²ï¼šThe IASB says </p><p>ä»å¥ï¼šit does not want to act without overall planning</p><blockquote><p>says it does not want to act ï¼ˆä¸»è°“ä¸»è°“ï¼‰</p><p> ğŸ‘†   ğŸ‘†        ğŸ‘†     says å’Œ does not want ä¸¤ä¸ªåŠ¨è¯  ä¸­é—´æœ‰ä¸ªä»£è¯ï¼ˆåè¯ï¼‰</p></blockquote><hr><p>Allenâ€™s contribution was to take an assumption we all shareâ€¦</p><p>ä¸»å¹²ï¼šAllenâ€™s contribution was to take an assumption </p><p>ä»å¥ï¼šwe all share</p><p>è¿™é‡Œä»å¥å¯èƒ½æ˜¯å®šè¯­ä»å¥ï¼Œå› ä¸ºå‰é¢æ˜¯ä¸€ä¸ªåè¯ assumption</p><blockquote><p>was to take an assumption we all share ä¸»è°“ä¸»è°“</p><p>ğŸ‘†                         ğŸ‘†       ğŸ‘† è°“è¯­ åè¯ è°“è¯­</p></blockquote><hr><p>When the court deals with social policy decisions, the law it shapes is inescapably political..</p><p>æ‰¾ç¬¦å·ï¼šï¼Œ</p><p>æ‰¾è¿è¯ï¼šwhen</p><p>å¥å­åˆ†æˆä¸¤å¥ï¼š</p><ul><li>When the court deals with social policy decisions,ï¼ˆæ—¶é—´çŠ¶è¯­ä»å¥ï¼‰</li><li>the law it shapes is inescapably political..ï¼ˆä¸»ä¸»è°“è°“ï¼‰</li></ul><p>æ‰¾åŠ¨è¯ï¼šshapesï¼Œisä¸¤ä¸ªåŠ¨è¯ï¼Œè¯´æ˜è¿™å¥è¯è¯´äº†ä¸¤ä»¶äº‹</p><ul><li><p>it shapes ï¼ˆä»å¥ï¼‰</p></li><li><p>the law is inescapably political..ï¼ˆä¸»å¹²ï¼‰</p></li></ul><p>è¿™é‡Œçš„ it shapes ä¿®é¥°çš„ law æ˜¯åè¯ï¼Œæ‰€ä»¥å¤§æ¦‚ç‡æ˜¯å®šè¯­ä»å¥</p><blockquote><p>the law it shapes is inescapably political..</p><p>â€‹     ğŸ‘† ğŸ‘†   ğŸ‘†    ğŸ‘†   n + n + v + v è°“è¯­è°“è¯­ä¸­é—´æ²¡ä¸œè¥¿ï¼Œä¸»ä¸»è°“è°“ï¼Œå½“ç„¶è¿˜å¯ä»¥ç”¨ n + n é…åˆåˆ¤æ–­</p></blockquote><blockquote><p>the law it shapes is </p><p>åè¯ + åè¯ + è°“è¯­ + è°“è¯­ï¼Œ æ ¹æ®ä¸‹é¢ #ä¸¤ä¸ªåè¯è¿ç»­å¾…åœ¨ä¸€èµ· ç« èŠ‚</p><p>æ˜æ˜¾ï¼Œthe law çš„ law æ˜¯åè¯ï¼Œå› ä¸ºå‰é¢ç”¨äº†é™å®šè¯ the</p><p>ä½†æ˜¯ it ä¹Ÿæ˜¯ åè¯ï¼šitæ˜¯ä»£è¯å±äºåè¯</p><p>æŒ‰ç…§ä¸Šé¢ç« èŠ‚ç»™å‡ºçš„å››ç§æƒ…å†µï¼Œæ˜æ˜¾ï¼Œä½œå®šè¯­ï¼ŒçŠ¶è¯­çš„æƒ…å†µéƒ½ä¸ç¬¦åˆï¼Œå¥å­ä¸­é—´æ²¡æœ‰ä»‹è¯ä¹Ÿä¸ç¬¦åˆç¬¬å››ç§æƒ…å†µï¼Œåªèƒ½æ˜¯ ä¸»ä¸»è°“è°“ è¿™ç§æƒ…å†µï¼Œå…¶ä¸­ä¸­é—´çš„ä¸»è°“æ˜¯ä»å¥ it shapes æ˜¯ä»å¥ï¼Œå‰é¢ law æ˜¯åè¯ï¼Œæ‰€ä»¥æ˜¯å®šè¯­ä»å¥</p></blockquote><blockquote><p>è¿™å¥ç»ä¸å¯èƒ½æ˜¯åŒä½è¯­ä»å¥ï¼Œå› ä¸ºåŒä½è¯­ä»å¥å¼•å¯¼è¯ä¸èƒ½çœç•¥ï¼Œä¹Ÿä¸æ˜¯åè¯æ€§ä»å¥ï¼Œå› ä¸ºä¸»å¹²ä¸ç¼ºå°‘åè¯æˆåˆ†</p></blockquote><hr><p>The way consumers now approach the process of making purchase decisions means that marketingâ€™s impact stems from a broad range of factors beyond conventional paid media.</p><blockquote><p>ä¸»ä¸»è°“è°“</p><p>The way consumers now approach the process è¿™é‡Œææœ‰å¯èƒ½æœ‰è°“è¯­</p><p>â€‹     â†‘    â†‘               ğŸ‘†           â†‘   å¦‚æœä¸çœ‹æ„æ€ï¼Œçœ‹è¯æ€§çš„è¯ï¼Œæ ‡æ ‡çš„ä½ç½®å…¨æ˜¯åè¯ï¼Œè¿ç»­4ä¸ªåè¯ï¼Œæ€ä¹ˆå¯èƒ½ï¼Ÿæ˜æ˜¾ approach æ˜¯ åŠ¨è¯ å½¢å¼</p></blockquote><blockquote><p>marketingâ€™s impact stems from a broad range è¿™å¥è¯æ€ä¹ˆåˆ†æï¼Ÿ</p><p>marketingâ€™s impactï¼š impact è¿™ä¸ªæ˜æ˜¾æ˜¯ åè¯</p><p>stems fromï¼šå›ºå®šæ­é…ï¼Œæºè‡ªâ€¦ </p><p><code>a broad range</code>ï¼šrange èŒƒå›´ï¼Œbroad å½¢å®¹è¯ å®½æ³›çš„</p></blockquote><p>è¿è¯ï¼šthatï¼Œ è¯´æ˜æœ‰ä¸¤ä¸ªåŠ¨è¯ï¼Œä½†å®é™…ä¸Šæœ‰ä¸‰ä¸ªåŠ¨è¯ï¼Œä¸€ä¸ªè¿è¯ thatï¼ˆin whichï¼‰è¢«çœç•¥</p><ul><li>consumers now approach the process of making purchase decisions meansï¼ˆå®šè¯­ä»å¥ï¼Œä¿®é¥°wayï¼‰</li><li>The way means that ã€‚ã€‚ã€‚ï¼ˆä¸»å¹²ï¼Œä¸»è°“å®¾ï¼‰</li><li>that marketingâ€™s impact stems from a broad range of factors beyond conventional paid media.ï¼ˆå®¾è¯­ä»å¥ï¼‰</li></ul><blockquote><p>ä¸Šé¢ The way consumers ä¹‹é—´æœ‰ä¸ª in whichï¼ˆthatï¼‰æˆåˆ†è¢«çœç•¥ï¼Œæˆ‘çœ‹è¿‡å¦ä¸€ä¸ªè€ƒç ”ç”·è€å¸ˆè¯´çš„ï¼Œåªè¦æ˜¯ that éƒ½å¯ä»¥çœç•¥ï¼Œè€Œå¤§éƒ¨åˆ†è€å¸ˆéƒ½è¯´thatä½œå®¾è¯­ä»å¥ã€å®šè¯­ä»å¥çš„å®¾è¯­æˆåˆ†æ—¶æ‰èƒ½çœç•¥ï¼Œçœ‹åˆ°è¿™å¥è¯ï¼Œæˆ‘è§‰å¾— that å¥½åƒéƒ½èƒ½çœç•¥ä¼¼çš„ã€‚ã€‚ã€‚</p></blockquote><hr><p>the way you present yourself has an impact. </p><p>the way you åè¯ + åè¯</p><p>è¿™é‡Œ present ç¿»è¯‘æˆ â€œç¤¼ç‰©â€ï¼Œä½†å¤§æ¦‚ç‡æ˜¯åŠ¨è¯ï¼Œä¸ç„¶å°±ä¼šå˜æˆ <code>å† è¯ + åè¯ + åè¯ + åè¯ + ä»£è¯(åè¯) + åŠ¨è¯ã€‚ã€‚ã€‚</code>ä½ è§‰å¾—å¯èƒ½ä¹ˆï¼Ÿ</p><p>ä¸‰ä¸ªåè¯éƒ½é¡¶å¤©äº†ï¼ˆé™¤éæ˜¯ä¸“ä¸šæ€§æœ¯è¯­ï¼‰ï¼Œè¿™é‡Œæ˜¯å››ä¸ªåè¯ï¼Œæ ¹æœ¬ä¸å¯èƒ½</p><p>æ‰€ä»¥è¿™é‡Œæ˜¯ ä¸»ä¸»è°“è°“ çš„æƒ…å†µï¼Œå®é™…æƒ…å†µæ˜¯ ä¸»ä¸»è°“å®¾è°“å®¾</p><p>æ‰€ä»¥å¥å­æ˜¯</p><ul><li>the way has an impact</li><li>you present yourselfï¼ˆå®šè¯­ä»å¥ï¼‰</li></ul><p>è¿™é‡Œçš„ present ä½œåŠ¨è¯ä¸çŸ¥é“çš„è¯ï¼Œå°±ç¿»è¯‘æˆâ€œç¤¼ç‰©â€å§ï¼Œä½ ç¤¼ç‰©ä½ è‡ªå·±ï¼Ÿä¸å°±æ˜¯ä½ æŠŠè‡ªå·±é€å‡ºå»äº†ä¹ˆï¼Ÿå†å¥½å¬ç‚¹ â€œä½ å±•ç°äº†ä½ è‡ªå·±â€</p><p>ç¿»è¯‘â€œä½ å±•ç¤ºä½ è‡ªå·±çš„æ–¹å¼ä¼šäº§ç”Ÿå½±å“â€</p><blockquote><p>é™å®šè¯åªèƒ½é™å®šåè¯æˆ–ä»£è¯ï¼Œæ‰€ä»¥åªè¦é‡åˆ°é™å®šè¯é‚£ä¹ˆä¹‹åå°±æ˜¯åè¯</p></blockquote><hr><p>Cartwright believes one can exercise conscious control over recurring bad dreams.</p><p>æ²¡æœ‰è¿è¯ï¼Œä½†åˆæœ‰ä¸¤ä¸ªåŠ¨è¯ï¼ˆbelievesï¼Œcan exerciseï¼‰ï¼Œå­˜åœ¨è¢«çœç•¥çš„è¿è¯</p><p>ä¸»è°“ä¸»è°“ç»“æ„ï¼Œæ˜¯ï¼šä¸»è°“ + å¼•å¯¼è¯ + ä¸»è°“ï¼Œ å®¾è¯­ä»å¥</p><ul><li>Cartwright believes thatã€‚ã€‚ã€‚ï¼ˆä¸»è°“å®¾ï¼‰</li><li>one can exercise conscious control over recurring bad dreams.ï¼ˆå®¾è¯­ä»å¥ï¼‰</li></ul><hr><p>But the regular time it takes to get a doctoral degree in the humanities is nine years.</p><p>the regular time è¿™é‡Œä¸ç®¡ regular æ˜¯åè¯è¿˜æ˜¯å½¢å®¹è¯ï¼Œéƒ½æ˜¯å®šè¯­ï¼Œæ ¹æ®å‰é¢çš„å››ç§åŒåè¯å½¢å¼</p><p>é‚£ä¸ºä»€ä¹ˆ time ä¸å¯ä»¥æ˜¯åŠ¨è¯å½¢å¼å‘¢ï¼Ÿ</p><p>è¿™ä¹ˆåˆ¤æ–­ï¼š</p><p>But è¿è¯ï¼Œæ‰€ä»¥ä¼šæŠµæ¶ˆæ‰åé¢çš„ä¸€ä¸ªåŠ¨è¯ï¼Œ æ‰€ä»¥è‡³å°‘æœ‰ä¸¤ä¸ªåŠ¨è¯ï¼ˆå½“ç„¶ä¹Ÿæœ‰å¯èƒ½çœç•¥äº†è¿è¯ï¼Œéœ€è¦æ³¨æ„æ˜¯å¦æœ‰ç®—åè¯çš„æƒ…å†µï¼‰</p><p>æ‰¾æ‰¾å¯ç–‘çš„åŠ¨è¯éƒ½æœ‰å“ªäº›ï¼štime</p><p>ä¿è¯ä»–æ˜¯åŠ¨è¯çš„æœ‰ï¼štasksï¼Œis</p><p>å¤§æ¦‚ç‡ time ä¸æ˜¯åŠ¨è¯</p><ul><li>But the regular time is nine years.</li><li>it takes to get a doctoral degree in the humanities</li></ul><hr><p>Instead, the new habits we deliberately press into ourselves create parallel pathways that can bypass those old roads.</p><p>that è¿è¯ï¼Œè¯´æ˜è‡³å°‘æœ‰ä¸¤ä¸ªåŠ¨è¯</p><p>ç»“æœå‘ç°ä¸‰ä¸ªï¼ˆpress into, create, can bypassï¼‰ï¼Œè¯´æ˜çœç•¥äº†ä¸€ä¸ªè¿è¯</p><p>æ‰¾å¤šåè¯ç»„åˆæˆ–è€…æ‰¾è°“è¯­ä¹‹é—´çš„åè¯</p><p>the new habits we &#x3D;&#x3D;&gt; åŒåè¯ç»“æ„</p><p>press into, create &#x3D;&#x3D;&gt; è°“è¯­ä¹‹é—´çš„åè¯ï¼šæ²¡æœ‰</p><p>æ¨æ–­å‡ºæ˜¯ï¼šä¸»ä¸»è°“è°“ ç»“æ„ &#x3D;&#x3D;&gt; ä¸» + ä»å¥ + ä¸» + è°“ + è°“</p><ul><li>ï¼ˆthatï¼‰we deliberately press into ourselves  ï¼ˆå®šè¯­ä»å¥ï¼Œä¿®é¥° habitsï¼‰å¤ä¹ ä¸‹ï¼Œä»å¥ä»è¿è¯å¼€å§‹åˆ°ä¸‹ä¸€ä¸ªè°“è¯­å‰ç»“æŸ</li><li>the new habits create parallel pathways that ã€‚ã€‚ã€‚ ï¼ˆä¸»å¹²ï¼Œä¸»è°“å®¾ç»“æ„ï¼‰</li><li>that can bypass those old roads.ï¼ˆå®šè¯­ä»å¥ï¼Œä¿®é¥° pathwaysï¼‰</li></ul><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><p>åˆ¤æ–­çœç•¥è¿è¯çš„æˆåˆ†</p><h4 id="æ ¸å¿ƒ"><a href="#æ ¸å¿ƒ" class="headerlink" title="æ ¸å¿ƒ"></a>æ ¸å¿ƒ</h4><p>ä¸»ä¸»è°“è°“</p><p>ä¸»è°“ä¸»è°“</p><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><p>æ ¹æ®æ ¸å¿ƒæ‰¾æ–¹æ³•ï¼š</p><ol><li>å¤šåè¯ç»“æ„åˆ¤æ–­ï¼ˆåè¯ä½œå®šè¯­ï¼›åè¯ä½œåŒä½è¯­ï¼›ä»‹è¯+åè¯+åè¯ï¼›ä¸»ä¸»è°“è°“ï¼‰</li><li>æ‰¾è°“è¯­ä¹‹é—´æ˜¯å¦æœ‰åˆé€‚çš„åè¯åˆ¤æ–­</li></ol><hr><p>an inability to consider the big picture was leading decision-makers to be biased by the daily samples of information they were working with.</p><h2 id="ä¿©åè¯è¿ç»­å¾…åœ¨ä¸€èµ·"><a href="#ä¿©åè¯è¿ç»­å¾…åœ¨ä¸€èµ·" class="headerlink" title="ä¿©åè¯è¿ç»­å¾…åœ¨ä¸€èµ·"></a>ä¿©åè¯è¿ç»­å¾…åœ¨ä¸€èµ·</h2><p>ä¸€èˆ¬é‡åˆ°è¿ç»­ä¸¤ä¸ªåè¯åœ¨ä¸€èµ·çš„æ—¶å€™éœ€è¦æ³¨æ„å¯èƒ½æ˜¯ä¸‹é¢è¿™äº›æƒ…å†µï¼š</p><ol><li><p><code>A Bï¼šA ä½œ B çš„å®šè¯­ B of Aï¼Œé™å®š Bï¼ˆBèŒƒå›´å¤ªå¹¿éœ€è¦Aé™åˆ¶èŒƒå›´ï¼‰</code></p></li><li><p><code>A Bï¼šB ä½œ A çš„åŒä½è¯­ï¼Œè§£é‡Š Aï¼ˆAä¸å¤Ÿè¯¦ç»†éœ€è¦Bè§£é‡Šï¼‰</code></p></li><li><p><code>ä¸»ä¸»è°“è°“çš„æƒ…å†µ</code></p></li><li><p><code>è°“ + ä»‹è¯ + åè¯ + åè¯ï¼ˆè°“è¯­~åè¯ä¹‹é—´å¯èƒ½è¿ç»­å‡ºç° ä»‹è¯ + åè¯çš„ç»“æ„ï¼Œè€Œä¸”ä¸­é—´çš„è¿™ä¸ªä»‹å®¾ç»“æ„åœ¨åŠ¨è¯ä¹‹åå¤§æ¦‚ç‡åªèƒ½æ˜¯çŠ¶è¯­ï¼‰</code></p></li></ol><p>æ‰€ä»¥çœ‹åˆ°ä¸¤ä¸ªåè¯è¿ç»­çš„æƒ…å†µéœ€è¦è­¦æƒ•ï¼Œå¯èƒ½æ˜¯ä¸Šé¢å››ç§æƒ…å†µä¹‹ä¸€</p><h3 id="åŒä½è¯­çš„æ–¹å¼"><a href="#åŒä½è¯­çš„æ–¹å¼" class="headerlink" title="åŒä½è¯­çš„æ–¹å¼"></a>åŒä½è¯­çš„æ–¹å¼</h3><ul><li>A, B</li><li>A ç ´æŠ˜å· B</li><li>A or B</li><li>A of B</li><li>å¥å­ + ç ´æŠ˜å· or é€—å· + åè¯(åè¯å¯èƒ½è¢«ä¿®é¥°)</li></ul><h3 id="æ ¹æ®å¥å­çŸ­è¯­è¯æ€§åˆ¤æ–­çŠ¶è¯­"><a href="#æ ¹æ®å¥å­çŸ­è¯­è¯æ€§åˆ¤æ–­çŠ¶è¯­" class="headerlink" title="æ ¹æ®å¥å­çŸ­è¯­è¯æ€§åˆ¤æ–­çŠ¶è¯­"></a>æ ¹æ®å¥å­çŸ­è¯­è¯æ€§åˆ¤æ–­çŠ¶è¯­</h3><p><code>V + ä»‹è¯ + N1 + N2</code> ä¸€èˆ¬æƒ…å†µä¸‹, ä¸­é—´çš„ <code>ä»‹è¯ + N1</code> è‚¯å®šä¸æ˜¯å®¾è¯­ä½†å¯èƒ½æ˜¯çŠ¶è¯­, å› ä¸ºåœ¨åŠ¨è¯ä¹‹åçš„ä»‹å®¾çŸ­è¯­, <code>N2</code>å¯èƒ½æ˜¯å®¾è¯­</p><hr><p>A few art collections established in their respective communities the idea of the value art.</p><p>in their respective communities è¿™æ®µå°±æ˜¯ ä»‹è¯ + åè¯ çš„éƒ¨åˆ†</p><h1 id="é•¿éš¾å¥åˆ†æ-â€”â€”-ç®€åŒ–"><a href="#é•¿éš¾å¥åˆ†æ-â€”â€”-ç®€åŒ–" class="headerlink" title="é•¿éš¾å¥åˆ†æ â€”â€” ç®€åŒ–"></a>é•¿éš¾å¥åˆ†æ â€”â€” ç®€åŒ–</h1><blockquote><p>æ‰¾æ ¸å¿ƒï¼šä¸»è¯­ï¼Œè°“è¯­ï¼Œå®¾è¯­ï¼Œè¡¥è¯­ï¼ˆå®¾è¡¥ï¼Œä¸»è¡¥ã€è¡¨è¯­ã€‘ï¼‰</p></blockquote><h2 id="ä¸»è¦æ–¹æ³•"><a href="#ä¸»è¦æ–¹æ³•" class="headerlink" title="ä¸»è¦æ–¹æ³•"></a>ä¸»è¦æ–¹æ³•</h2><p>æ‰¾éæ ¸å¿ƒï¼Œå»æ‰éæ ¸å¿ƒ</p><blockquote><p>å½¢å®¹è¯ã€å‰¯è¯ã€ä»‹è¯çŸ­è¯­ã€éè°“è¯­åŠ¨è¯ã€åŒä½è¯­ã€æ’å…¥è¯­ã€çŠ¶è¯­ä»å¥ç­‰</p></blockquote><hr><p>Also, some research suggests that the explanation for rising rates of mortality, mental-health problems, and addiction among poorly-educated, middle-aged people is shortage of well-paid jobs.</p><p>æ­¥éª¤éƒ½ä¸€æ ·</p><h3 id="ä¸€ã€æ‰¾é€—å·"><a href="#ä¸€ã€æ‰¾é€—å·" class="headerlink" title="ä¸€ã€æ‰¾é€—å·"></a>ä¸€ã€æ‰¾é€—å·</h3><p>å‘ç° â€œï¼Œâ€ éƒ½æ˜¯andè¿æ¥çš„åè¯ï¼Œæ‰€ä»¥ä¸çœ‹</p><h3 id="äºŒã€æ‰¾è¿è¯"><a href="#äºŒã€æ‰¾è¿è¯" class="headerlink" title="äºŒã€æ‰¾è¿è¯"></a>äºŒã€æ‰¾è¿è¯</h3><p>that åªæœ‰ä¸€ä¸ª</p><p>æ‰¾åŠ¨è¯ï¼Œsuggests is åªæœ‰ä¸¤ä¸ª</p><h3 id="ä¸‰ã€æ–­å¼€å¥å­"><a href="#ä¸‰ã€æ–­å¼€å¥å­" class="headerlink" title="ä¸‰ã€æ–­å¼€å¥å­"></a>ä¸‰ã€æ–­å¼€å¥å­</h3><ul><li>Also, some research suggests thatâ€¦</li><li>that the explanation for rising rates of mortality, mental-health problems, and addiction among poorly-educated, middle-aged people is shortage of well-paid jobs.</li></ul><p>å‘ç°å¥å­å¤ªå¤æ‚äº†ï¼Œ</p><h3 id="å››ã€ç®€åŒ–å¥å­ï¼ˆæ‰¾åˆ°ä¸»å¹²ï¼‰"><a href="#å››ã€ç®€åŒ–å¥å­ï¼ˆæ‰¾åˆ°ä¸»å¹²ï¼‰" class="headerlink" title="å››ã€ç®€åŒ–å¥å­ï¼ˆæ‰¾åˆ°ä¸»å¹²ï¼‰"></a>å››ã€ç®€åŒ–å¥å­ï¼ˆæ‰¾åˆ°ä¸»å¹²ï¼‰</h3><hr><p>the explanation for rising rates of mortality, mental-health problems, and addiction among poorly-educated, middle-aged people is shortage of well-paid jobs.</p><p>ä»‹è¯çŸ­è¯­ï¼š</p><ul><li>for rising rates of mortality, mental-health problems, and addiction</li><li>among poorly-educated, middle-aged people</li><li>of well-paid jobs</li></ul><p>ç®€åŒ–å®Œæ¯•ï¼š</p><p>some research suggests that the explanation is shortage.</p><h3 id="äº”ã€æ‰¾åˆ°åŠ¨è¯"><a href="#äº”ã€æ‰¾åˆ°åŠ¨è¯" class="headerlink" title="äº”ã€æ‰¾åˆ°åŠ¨è¯"></a>äº”ã€æ‰¾åˆ°åŠ¨è¯</h3><p>suggestsï¼Œis</p><h3 id="å…­ã€åˆ†æä¿®é¥°æˆåˆ†æ˜¯å®šã€çŠ¶è¯­"><a href="#å…­ã€åˆ†æä¿®é¥°æˆåˆ†æ˜¯å®šã€çŠ¶è¯­" class="headerlink" title="å…­ã€åˆ†æä¿®é¥°æˆåˆ†æ˜¯å®šã€çŠ¶è¯­"></a>å…­ã€åˆ†æä¿®é¥°æˆåˆ†æ˜¯å®šã€çŠ¶è¯­</h3><p>for rising rates of mortality, mental-health problems, and addiction &#x3D;&#x3D;&gt; å®šè¯­</p><p>among poorly-educated, middle-aged people &#x3D;&#x3D;&gt; çŠ¶è¯­</p><p>of well-paid jobs &#x3D;&#x3D;&gt; å®šè¯­</p><blockquote><p>æˆ‘çš„åˆ¤æ–­æ–¹æ³•æ˜¯ï¼š</p><ol><li>åˆ¤æ–­ä»‹è¯å‰é¢æ˜¯å¦æœ‰åè¯ï¼Ÿ</li></ol><p>æœ‰ï¼Œå¤§æ¦‚ç‡æ˜¯å®šè¯­</p><p>æ²¡æœ‰ï¼Œå¤§æ¦‚ç‡æ˜¯çŠ¶è¯­</p><p>ä½†è¿˜ä¸èƒ½æ–­å®šä»–å°±æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­ï¼Œéœ€è¦ä¸‹é¢è¿™ä¸ªæ­¥éª¤åˆ¤æ–­</p><ol start="2"><li>æ˜¯å¦èƒ½å¤Ÿç¿»è¯‘æˆ â€œã€‚ã€‚ã€‚çš„â€å¹¶ä¸”ä¿®é¥°â€œåè¯â€ï¼Ÿ &#x3D;&#x3D;&gt; å®šè¯­ï¼ˆåªè¦ä¸ä¿®é¥°åŠ¨è¯æˆ–è€…æ•´ä¸ªå¥å­ï¼‰</li><li>æ˜¯å¦èƒ½å¤Ÿç¿»è¯‘å‡ºè¡¨ç¤ºï¼š â€œç›®çš„ï¼Œç»“æœï¼Œå¯¹æ¯”ï¼Œæ¡ä»¶ï¼ŒåŸå› ï¼Œè®©æ­¥ï¼Œæ–¹å¼â€ &#x3D;&#x3D;&gt; æ˜¯ï¼Œå°±æ˜¯çŠ¶è¯­ï¼ˆå…¶ä¸­æ—¶é—´å’Œåœ°ç‚¹ä¸èƒ½å¤Ÿç¡®å®šä¸€å®šæ˜¯çŠ¶è¯­ï¼‰</li></ol></blockquote><hr><p>When people in developing countries worry about migration, they are usually concerned at the prospect of their best and brightest departure to Silicon Valley or to hospitals and universities in the developed world.</p><p>åŒæ ·çš„æ–¹æ³•</p><p>æ‰¾æ ‡ç‚¹ï¼šæ²¡æœ‰</p><p>æ‰¾è¿è¯ï¼šwhenï¼Œè‡³å°‘ä¸¤ä¸ªåŠ¨è¯</p><p>æ–­å¼€å¥å­ï¼š</p><ul><li>When people in developing countries worry about migration,</li><li>they are usually concerned at the prospect of their best and brightest departure to Silicon Valley or to hospitals and universities in the developed world.</li></ul><p>ç®€åŒ–å¥å­ï¼š</p><ul><li>When people worry,</li><li>they are concerned.</li></ul><p>æ‰¾åˆ°åŠ¨è¯ï¼š</p><p>worryï¼Œare concerned</p><p>å®šã€çŠ¶è¯­ï¼š</p><p>åè¯n + in developing countriesï¼šå®šè¯­</p><p>about migration æ²¡æœ‰åè¯ä¿®é¥°ï¼š çŠ¶è¯­</p><p>at the prospect of their best and brightest departure to Silicon Valley or to hospitals and universities çŠ¶è¯­</p><p>in the developed world å®šè¯­ ä¿®é¥° hospitals and universities</p><blockquote><p>åè¯ + ä»‹å®¾ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä»‹å®¾ä¿®é¥°çš„åè¯ä½œå®šè¯­ï¼Œå¦åˆ™ä½œçŠ¶è¯­</p></blockquote><hr><p>From the beginning of our history, says Hofstadter, our democratic and populist urges have driven us to reject anything that smells of elitism.</p><p>æˆ‘ä»¬æŠŠä¸»è¦æ­¥éª¤ç®€åŒ–ä¸‹ï¼Œè¦ä¸ç„¶æœ‰ å…­ä¸ª æ­¥éª¤å¤ªè¿‡äºå¤æ‚äº†</p><h2 id="ç®€åŒ–æ­¥éª¤"><a href="#ç®€åŒ–æ­¥éª¤" class="headerlink" title="ç®€åŒ–æ­¥éª¤"></a>ç®€åŒ–æ­¥éª¤</h2><h3 id="ä¸€ã€æ–­å¥"><a href="#ä¸€ã€æ–­å¥" class="headerlink" title="ä¸€ã€æ–­å¥"></a>ä¸€ã€æ–­å¥</h3><blockquote><p>çœ‹ç¬¦å·ï¼Œçœ‹è¿è¯</p></blockquote><ul><li>From the beginning of our history, says Hofstadter, our democratic and populist urges have driven us to reject anything</li><li>that smells of elitism.</li></ul><h3 id="äºŒã€ç®€åŒ–ï¼ˆæ‰¾åŠ¨è¯ï¼‰"><a href="#äºŒã€ç®€åŒ–ï¼ˆæ‰¾åŠ¨è¯ï¼‰" class="headerlink" title="äºŒã€ç®€åŒ–ï¼ˆæ‰¾åŠ¨è¯ï¼‰"></a>äºŒã€ç®€åŒ–ï¼ˆæ‰¾åŠ¨è¯ï¼‰</h3><blockquote><p>ç®€åŒ–å¹¶ä¸æ˜¯å…¨éƒ¨éƒ¨åˆ†éƒ½ç®€åŒ–çš„å¹²å¹²å‡€å‡€ï¼Œä¿ç•™éƒ¨åˆ†ï¼ˆç®€çŸ­çš„ï¼‰ä¿®é¥°æˆåˆ†å¥½ç†è§£ä¸»å¹²çš„æ„æ€</p><p>ä¹Ÿå¯ä»¥å«ä»£æ›¿ï¼Œç”¨ â€œã€‚ã€‚ã€‚â€æˆ–è€…â€œâ€¦â€ä»£æ›¿ä¿®é¥°çš„éƒ¨åˆ†</p></blockquote><ul><li>ã€‚ã€‚ã€‚ï¼Œã€‚ã€‚ã€‚ï¼Œour democratic and populist urges have driven us to reject anythingï¼ˆä¸»è°“å®¾å®¾è¡¥ï¼‰</li><li>that smells of elitism.ï¼ˆå®šè¯­æˆåˆ†ï¼‰</li></ul><blockquote><p>è¿™æ­¥éª¤çš„ç›®çš„ä¸»è¦æ˜¯ï¼š</p><ul><li>çœ‹çœ‹æ–­å¥æ˜¯å¦é”™è¯¯</li><li>æ‰¾åˆ°è°“è¯­</li></ul></blockquote><p>have drivenï¼Œsmells</p><p>ç®€åŒ–åçš„ç¿»è¯‘ï¼šâ€œæˆ‘ä»¬å¯¹æ°‘ä¸»åŒ–å’Œå¹³æ°‘åŒ–çš„æ¸´æ±‚é©±ä½¿æˆ‘ä»¬æ‹’ç»ä¸€åˆ‡ç²¾è‹±ä¸»ä¹‰çš„äº‹ç‰©â€</p><h3 id="ä¸‰ã€è¿˜åŸï¼ˆç¿»è¯‘ï¼‰"><a href="#ä¸‰ã€è¿˜åŸï¼ˆç¿»è¯‘ï¼‰" class="headerlink" title="ä¸‰ã€è¿˜åŸï¼ˆç¿»è¯‘ï¼‰"></a>ä¸‰ã€è¿˜åŸï¼ˆç¿»è¯‘ï¼‰</h3><blockquote><p>è¿˜åŸä¿®é¥°éƒ¨åˆ†åˆ°ç®€åŒ–çš„å¥å­ä¸­</p></blockquote><p>éœå¤«æ–¯å¡”å¾·è¯´ï¼ˆæ’å…¥è¯­æ²¡äººæƒå¯ä»¥ä¸çœ‹ï¼‰ï¼Œè‡ªæˆ‘ä»¬çš„å†å²å¼€å§‹ï¼Œæˆ‘ä»¬å¯¹æ°‘ä¸»åŒ–å’Œå¹³æ°‘åŒ–çš„æ¸´æ±‚é©±ä½¿æˆ‘ä»¬æ‹’ç»ä¸€åˆ‡ç²¾è‹±ä¸»ä¹‰çš„äº‹ç‰©</p><hr><p>The coming of age of the postwar baby boom and an entry of women into the male-dominated job market have limited the opportunities of teenagers who are already questioning the heavy personal sacrifices involved in climbing Japanâ€™s rigid social ladder to good schools and jobs.</p><p>æ–­å¥ï¼šwho</p><ul><li>The coming of age of the postwar baby boom and an entry of women into the male-dominated job market have limited the opportunities of teenagers</li><li>who are already questioning the heavy personal sacrifices involved in climbing Japanâ€™s rigid social ladder to good schools and jobs.</li></ul><p>ç®€åŒ–ï¼š</p><ul><li>The coming ã€‚ã€‚ã€‚ and an entry ã€‚ã€‚ã€‚ have limited the opportunities of teenagers</li><li>who are already questioning the heavy personal sacrifices ã€‚ã€‚ã€‚.</li></ul><blockquote><p>çœ‹åˆ°ä»‹è¯ä¹‹åçš„ä¸œè¥¿ï¼Œä¸ç®¡æœ‰å‡ ä¸ªåè¯ï¼Œå¤§èƒ†çš„åˆ é™¤ æ¯”å¦‚ï¼š of the postwar baby boom</p></blockquote><blockquote><p>involved è¿™ä¸ªåˆ†è¯å¼•å¯¼çš„å¥å­ï¼Œè¦ä¹ˆä½œå®šè¯­ï¼ˆè¿™é‡Œä½œå®šè¯­ä¿®é¥°sacrificesï¼‰ï¼Œè¦ä¹ˆä½œçŠ¶è¯­ï¼Œç›´æ¥åˆ é™¤</p></blockquote><p>ç®€å•çš„ç¿»è¯‘ä¸‹ï¼š</p><p>ã€‚ã€‚ã€‚åˆ°æ¥å’Œã€‚ã€‚ã€‚è¿›å…¥ç°è±¡çš„å‡ºç°å·²ç»é™åˆ¶äº†é’å°‘å¹´çš„æœºä¼šï¼Œä»–ä»¬æ­£åœ¨è´¨ç–‘è¿™æ²‰é‡çš„ä¸ªäººç‰ºç‰²ã€‚ã€‚ã€‚</p><p>è¿˜åŸï¼š</p><p>æˆ˜åå©´å„¿æ½®æ—¶æœŸçš„åˆ°æ¥å’Œå¦‡å¥³è¿›å…¥ç”·æ€§ä¸»å¯¼çš„å·¥ä½œï¼Œè¿™ç§ç°è±¡çš„å‡ºç°å·²ç»é™åˆ¶äº†é’å°‘å¹´çš„å‘å±•æœºä¼šï¼Œä»–ä»¬æ­£åœ¨è´¨ç–‘å‚ä¸æ”€ç™»æ—¥æœ¬ç­‰çº§æ£®ä¸¥çš„ç¤¾ä¼šé˜¶æ¢¯ä»¥è·å¾—å¥½çš„æ•™è‚²å’Œå·¥ä½œæ‰€ä»˜å‡ºçš„æ²‰é‡ç‰ºç‰²æ˜¯å¦å€¼å¾—</p><blockquote><p>ç¿»è¯‘å°±ä¸æ˜¯ä¸€è¹´è€Œå°±çš„äº‹æƒ…ï¼Œç‰¹åˆ«æ˜¯éƒ¨åˆ†æ¶å¿ƒäººçš„ç¿»è¯‘ï¼Œæˆ‘ä»¬éœ€è¦åŠ ä¸Šè‡ªå·±å¯¹è¯¥è‹±è¯­å¥å­æ„æ€çš„ç†è§£ç„¶ååŠ ä¸Šéƒ¨åˆ†è¯¥å¥å­ä¸­æ ¹æœ¬å°±ä¸å­˜åœ¨çš„æ±‰å­—ï¼Œè¡¥å……å®Œæ•´ä¸ªæ±‰åŒ–çš„æ„æ€</p></blockquote><hr><p>For example, British anthropologists Grafton Elliot Smith and W. J. Perry incorrectly suggested, on the basis of inadequate information, that farming, pottery making, and metallurgy all originated in ancient Egypt and diffused throughout the world.</p><p>æ–­å¥ï¼š</p><ul><li>For example, British anthropologists Grafton Elliot Smith and W. J. Perry incorrectly suggested, on the basis of inadequate information, </li><li>that farming, pottery making, and metallurgy all originated in ancient Egypt and diffused throughout the world.</li></ul><p>ç®€åŒ–ï¼š</p><ul><li>ã€‚ã€‚ã€‚ã€‚British anthropologists ã€‚ã€‚ã€‚ incorrectly suggested,ã€‚ã€‚ã€‚, ï¼ˆä¸»è°“å®¾ï¼‰</li><li>that farming, pottery making, and metallurgy all originated ã€‚ã€‚ã€‚ and diffused ã€‚ã€‚ã€‚.ï¼ˆå®¾è¯­ä»å¥ï¼‰</li></ul><p>ç®€å•ç¿»è¯‘ï¼šâ€œè‹±å›½äººç±»å­¦å®¶é”™è¯¯åœ°è®¤ä¸ºå†œä¸šã€åˆ¶é™¶å’Œå†¶é‡‘éƒ½èµ·æºå’Œä¼ æ’­â€</p><p>è¿˜åŸï¼š</p><p>ä¾‹å¦‚ï¼Œè‹±å›½äººç±»å­¦å®¶Grafton Elliot Smith å’Œ W. J. Perry é”™è¯¯åœ°è®¤ä¸ºå†œä¸šã€åˆ¶é™¶å’Œå†¶é‡‘éƒ½èµ·æºäºå¤åŸƒåŠå¹¶ä¸”ä¼ æ’­åˆ°ä¸–ç•Œ</p><h2 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="é€—å·"><a href="#é€—å·" class="headerlink" title="é€—å·"></a>é€—å·</h3><ol><li>é‡åˆ°ä¸¤ä¸ª+é€—å·ï¼Œæ¯”å¦‚ aï¼Œbï¼Œc and d è¿™ç§åªè¦çœ‹åˆ°æœ«å°¾çš„ and æˆ–è€… or è¿™ç§è¿è¯ï¼Œç›´æ¥æ–­å®š ï¼Œä¸æ–­å¥å­</li></ol><h3 id="ä¸¤æ­¥åˆ†ææ³•"><a href="#ä¸¤æ­¥åˆ†ææ³•" class="headerlink" title="ä¸¤æ­¥åˆ†ææ³•"></a>ä¸¤æ­¥åˆ†ææ³•</h3><hr><p>The same dramatic technological changes that have provided marketers with more (and more diverse) communications choices have also increased the risk that passionate consumers will voice their opinions in quicker, more visible, and much more damaging ways.</p><p>è¿è¯ï¼šthat that</p><p>æ–­å¥ï¼š</p><ul><li>The same dramatic technological changesï¼ˆchangesæ˜¯åè¯ï¼‰</li><li>that have provided marketers with more (and more diverse) communications choices have also increased the riskï¼ˆå®šè¯­ä»å¥ï¼Œä¸ºä»€ä¹ˆï¼Ÿthatä½œä»å¥æˆåˆ†æ‰€ä»¥æ˜¯å®šè¯­ä»å¥ï¼Œæ‰€ä»¥ä¸Šé¢çš„changesæ˜¯åè¯ã€å…ˆè¡Œè¯ã€‘ï¼Œä¸»å¹²æ²¡æœ‰è°“è¯­ï¼Œä¼°è®¡åœ¨è¿™å¥è¯ä¸­ï¼‰</li><li>that passionate consumers will voice their opinions in quicker, more visible, and much more damaging ways.ï¼ˆåŒä½è¯­ä»å¥ï¼Œthatä¸åšæˆåˆ†ï¼Œè§£é‡Šä¿®é¥° riskï¼‰</li></ul><h3 id="ç°åœ¨æˆ‘ä»¬æ¢ä¸€ç§æ–¹å¼æ–­å¥"><a href="#ç°åœ¨æˆ‘ä»¬æ¢ä¸€ç§æ–¹å¼æ–­å¥" class="headerlink" title="ç°åœ¨æˆ‘ä»¬æ¢ä¸€ç§æ–¹å¼æ–­å¥"></a><strong>ç°åœ¨æˆ‘ä»¬æ¢ä¸€ç§æ–¹å¼æ–­å¥</strong></h3><h4 id="æ–­å¥ï¼š"><a href="#æ–­å¥ï¼š" class="headerlink" title="æ–­å¥ï¼š"></a>æ–­å¥ï¼š</h4><ul><li><p>The same dramatic technological changes thatä»å¥1 have also increased the risk thatä»å¥2.</p></li><li><p>that have provided marketers with more (and more diverse) communications choices</p></li><li><p>that passionate consumers will voice their opinions in quicker, more visible, and much more damaging ways</p></li></ul><h4 id="ç®€åŒ–ï¼š"><a href="#ç®€åŒ–ï¼š" class="headerlink" title="ç®€åŒ–ï¼š"></a>ç®€åŒ–ï¼š</h4><ul><li><p>ã€‚ã€‚ã€‚ changes thatä»å¥1 have also increased the risk thatä»å¥2.</p></li><li><p>that have provided marketers ã€‚ã€‚ã€‚</p></li><li><p>that passionate consumers will voice their opinions ã€‚ã€‚ã€‚</p></li></ul><blockquote><p>é»˜è®¤ä»å¥éƒ½æ˜¯ä¿®é¥°çš„å‰é¢çš„å•è¯</p></blockquote><p>é‚£ä¹ˆç¿»è¯‘å‡ºæ¥å°†ä¼šæ˜¯è¿™æ ·ï¼š</p><p><strong>ä»€ä¹ˆæ ·çš„ changes ä¹Ÿä¼šå®Œæˆ ä»€ä¹ˆæ ·çš„ risk</strong></p><p>è¿™ä¸¤ä¸ªä»€ä¹ˆæ ·çš„ï¼Œåˆšå¥½é…åˆä¸‹é¢çš„ä¸¤ä¸ª that</p><h4 id="è¿˜åŸï¼š"><a href="#è¿˜åŸï¼š" class="headerlink" title="è¿˜åŸï¼š"></a>è¿˜åŸï¼š</h4><ul><li><p>ã€The same dramatic technologicalã€‘ changes thatä»å¥1 have also increased the risk thatä»å¥2.</p></li><li><p>that have provided marketers ã€with more (and more diverse) communications choicesã€‘</p></li><li><p>that passionate consumers will voice their opinions ã€in quicker, more visible, and much more damaging waysã€‘</p></li></ul><h1 id="é•¿éš¾å¥çš„ç»“æ„-â€”â€”-åˆ†è£‚"><a href="#é•¿éš¾å¥çš„ç»“æ„-â€”â€”-åˆ†è£‚" class="headerlink" title="é•¿éš¾å¥çš„ç»“æ„ â€”â€” åˆ†è£‚"></a>é•¿éš¾å¥çš„ç»“æ„ â€”â€” åˆ†è£‚</h1><blockquote><p>åœ¨æ–­å¼€å’Œç®€åŒ–ä¹‹å‰ï¼Œè¦è¿›è¡Œä¸€æ¬¡åˆ†è£‚ç»“æ„çš„è¿˜åŸ</p></blockquote><h2 id="æ’å…¥å¼ï¼ˆåŒä½è¯­ï¼Œæ’å…¥è¯­å’ŒçŠ¶è¯­ä»å¥ï¼‰"><a href="#æ’å…¥å¼ï¼ˆåŒä½è¯­ï¼Œæ’å…¥è¯­å’ŒçŠ¶è¯­ä»å¥ï¼‰" class="headerlink" title="æ’å…¥å¼ï¼ˆåŒä½è¯­ï¼Œæ’å…¥è¯­å’ŒçŠ¶è¯­ä»å¥ï¼‰"></a>æ’å…¥å¼ï¼ˆåŒä½è¯­ï¼Œæ’å…¥è¯­å’ŒçŠ¶è¯­ä»å¥ï¼‰</h2><blockquote><ol><li><p>å¦‚æœæ˜¯æ’å…¥è¯­ä¸€èˆ¬éƒ½ä¼šæœ‰æˆå¯¹çš„é€—å·&#x2F;ç ´æŠ˜å·å‡ºç°</p></li><li><p>è€Œä¸”æ’å…¥è¯­æ¯”è¾ƒçªå…€çš„å‡ºç°ï¼Œå¯èƒ½æˆªæ–­äº†å…¶ä»–å¥å­æœ¬èº«çš„è¡¨è¾¾ï¼ˆä¹Ÿå°±æ˜¯è¯´æ’å…¥è¯­ä¼˜å…ˆçº§è¾ƒé«˜ç›´æ¥é”™å¼€çš„åŸæœ¬çš„å¥å­ï¼‰</p></li><li><p>æ’å…¥è¯­å¦‚æœæ˜¯åŒä½è¯­çš„è¯ï¼Œä½œç”¨å°±æ˜¯è§£é‡Šå‰é¢çš„åè¯ï¼›å¦‚æœæ˜¯å•çº¯æ’å…¥è¯­çš„è¯ï¼Œåˆ™å¯ä»¥ä¸çœ‹ï¼›å¦‚æœæ˜¯çŠ¶è¯­ä»å¥çš„æ’å…¥è¯­å¿…é¡»è¦çœ‹</p></li></ol></blockquote><hr><p>Bob Liodice, the chief executive of the Association of National Advertisers, says consumers will be worse off if the industry cannot collect information about their preferences.</p><ul><li>Bob Liodice, the chief executive of the Association of National Advertisers, says consumers will be worse off</li><li>if the industry cannot collect information about their preferences.</li></ul><p>æ–­å¼€å¥å­ï¼Œå‘ç°å‰é¢ä¸€å¥æœ‰ä¸¤ä¸ªè°“è¯­ï¼šsaysï¼Œwill be</p><ul><li><p>Bob Liodice, æ’å…¥è¯­ , says consumers will be worse off</p></li><li><p>the chief executive of the Association of National Advertisers</p></li></ul><p>says consumers will be åŠ¨è¯ + åè¯ + åŠ¨è¯ï¼Œä¸»è°“ä¸»è°“ç»“æ„</p><ul><li><p>Bob Liodice, æ’å…¥è¯­ , says(ä¸»è°“å®¾)</p></li><li><p>(that) consumers will be worse offï¼ˆä¸»ç³»è¡¨ï¼‰</p></li><li><p>the chief executive of the Association of National Advertisersï¼ˆæ’å…¥è¯­ï¼‰</p></li><li><p>if the industry cannot collect information about their preferences.ï¼ˆæ¡ä»¶çŠ¶è¯­ä»å¥ï¼Œä¸»è°“å®¾ï¼‰</p></li></ul><hr><p>These benefactors have succeeded in their chosen fields, they say, and they want to use their wealth to draw attention to those who have succeeded in science.</p><ul><li>These benefactors have succeeded in their chosen fields,(ä¸»è°“)</li><li>they sayï¼ˆæ’å…¥è¯­ï¼‰, </li><li>and they want to use their wealth to draw attention to thoseï¼ˆä¸»è°“å®¾ï¼‰</li><li>who have succeeded in science.ï¼ˆå®šè¯­ä»å¥ä¿®é¥° thoseï¼›ä¸»è°“ï¼‰</li></ul><blockquote><p>ç®€åŒ–æœªå¿…æ˜¯å¿…é¡»çš„ï¼Œè¦çœ‹æ–­å¥ä¹‹åçš„å¥å­æ˜¯å¦è¿˜æ˜¯å¾ˆå¤æ‚</p></blockquote><hr><p>Yet these creatures are members of the biotic community and, if its stability depends on its integrity, they are entitled to continuance.</p><ul><li>Yet these creatures are members of the biotic community and,ï¼ˆä¸»ç³»è¡¨ï¼‰</li><li>if its stability depends on its integrity,ï¼ˆæ¡ä»¶çŠ¶è¯­ä»å¥ï¼›æ’å…¥è¯­ï¼‰</li><li>they are entitled to continuance.ï¼ˆä¸»è°“å®¾ï¼‰</li></ul><blockquote><p>ä¸æ˜¯æ¯ä¸ªæ’å…¥è¯­éƒ½å¯ä»¥çœç•¥ï¼Œåªæœ‰åŒä½è¯­ï¼Œä¸€äº›è§£é‡Šæ€§çš„æ’å…¥è¯­å¯ä»¥ä¸çœ‹ï¼Œä½†åƒä¸Šé¢çš„çŠ¶è¯­ä»å¥å°±ä¸èƒ½çœç•¥</p></blockquote><p>ä¸Šé¢çš„æ¡ä»¶çŠ¶è¯­ä»å¥å¦‚æœæ˜¯æ’å…¥è¯­çš„è¯ï¼Œå»ºè®®è½¬ç§»åˆ°åˆ«çš„åœ°æ–¹</p><blockquote><p>éé™å®šæ€§å®šè¯­ä»å¥ä¹Ÿå¯ä»¥æ’å…¥åˆ°å¥å­ä¸­é—´ï¼Œä½†å¯ä»¥ä¸çœ‹</p></blockquote><h2 id="åç§»å¼ï¼ˆä»å¥å¤ªé•¿åç§»ï¼‰"><a href="#åç§»å¼ï¼ˆä»å¥å¤ªé•¿åç§»ï¼‰" class="headerlink" title="åç§»å¼ï¼ˆä»å¥å¤ªé•¿åç§»ï¼‰"></a>åç§»å¼ï¼ˆä»å¥å¤ªé•¿åç§»ï¼‰</h2><blockquote><p>ä»å¥å¤ªé•¿äº†ï¼Œåç§»ï¼Œé‚£ä¹ˆäº§ç”Ÿäº†æ–°çš„é—®é¢˜ï¼Œå°±æ˜¯æ‰¾ä¸åˆ°ä»å¥æ‰€ä¿®é¥°çš„æˆåˆ†</p></blockquote><blockquote><p>å¦‚æœä»å¥å‰é¢çš„é‚£ä¸ªçŸ­è¯­æ˜¯ çŸ­è¯­ï¼ˆä¸€èˆ¬æ˜¯ä»‹è¯çŸ­è¯­ï¼‰ï¼Œåˆ™å¯èƒ½éœ€è¦æ³¨æ„ ä»å¥åç§» çš„æƒ…å†µ</p></blockquote><h3 id="ä»€ä¹ˆæ ·çš„æ¦‚å¿µå«å¤ªé•¿äº†ï¼Ÿ"><a href="#ä»€ä¹ˆæ ·çš„æ¦‚å¿µå«å¤ªé•¿äº†ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ ·çš„æ¦‚å¿µå«å¤ªé•¿äº†ï¼Ÿ"></a>ä»€ä¹ˆæ ·çš„æ¦‚å¿µå«å¤ªé•¿äº†ï¼Ÿ</h3><p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fwx1.sinaimg.cn%2Forj360%2F006wfW1Zly1g5fwsy13n1j30k00na3z9.jpg&refer=http%3A%2F%2Fwx1.sinaimg.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1652250933&t=7c1623965c34943b1e76df6648459d20" alt="æˆ‘å’Œå¤§ä½¬çš„å·®è·å°±ä¸€ç‚¹ç‚¹"></p><blockquote><p>è¯´æ˜æœ‰ä¸ªéƒ¨åˆ†æ¯”ä»å¥çŸ­ï¼Œè€Œä¸”æ–­å¾—å¤š</p></blockquote><p>æ¯”å¦‚ä¸‹é¢è¿™äº›ï¼š</p><ol><li>evidence was found that levels of productivity were related to changes in lighting.</li></ol><p>åŸå¥æ˜¯ï¼ševidence that levels of productivity were related to changes in lighting was found.</p><p>that ä¿®é¥°çš„æ˜¯ evidence ä½†å®ƒæ”¾åˆ°äº†åé¢</p><p>åˆ°åº•æ˜¯é•¿äº†å¤šå°‘å‘¢ï¼Ÿ</p><p>was found &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p><p>that levels of productivity were related to changes in lighting</p><ol start="2"><li>keep in mind what promises from Entergy are worth</li></ol><p>åŸå¥æ˜¯ï¼škeep what promises from Entergy are worth in mind</p><p>whatä»å¥ åšçš„æ˜¯ keep çš„å®¾è¯­</p><p>in mind &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p><p>what promises from Entergy are worth</p><h3 id="æ‰¾ä»å¥ä¿®é¥°è¯çš„æ–¹æ³•"><a href="#æ‰¾ä»å¥ä¿®é¥°è¯çš„æ–¹æ³•" class="headerlink" title="æ‰¾ä»å¥ä¿®é¥°è¯çš„æ–¹æ³•"></a>æ‰¾ä»å¥ä¿®é¥°è¯çš„æ–¹æ³•</h3><blockquote><p>éå¸¸ç®€å•ï¼Œæ—¢ç„¶å‰é¢çš„é‚£ä¸ªå•è¯ä¸æ˜¯ï¼Œé‚£å°±å¾€å‰é¢æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°åˆé€‚çš„</p></blockquote><hr><p>Contrary to the descriptions on record, no systematic evidence was found that levels of productivity were related to changes in lighting.</p><ul><li>Contrary to the descriptions on record, no systematic evidence was found</li><li>that levels of productivity were related to changes in lighting.</li></ul><p>å¦‚æœä½ æŠŠ that çš„å…ˆè¡Œè¯è®¤ä¸ºæ˜¯ found é‚£å°±ä¸å¯¹åŠ²äº†</p><p>was found æ˜¯ä¸€æ•´ä¸ªè°“è¯­ï¼Œ that æ˜æ˜¾ä¸æ˜¯ä¿®é¥°çš„ found</p><p>that levels of productivity were related to changes in lighting. è¿™å¥è¯æœ¬èº«å°±ä¸æ˜¯å®šè¯­ä»å¥ï¼Œè‡³å°‘ that ä¸åšæˆåˆ†ï¼Œ æ‰€ä»¥å¤§æ¦‚ç‡æ˜¯ å®¾è¯­ä»å¥ï¼Ÿ</p><p>çœ‹çœ‹ä¸»å¹²æ˜¯å¦ç¼ºå°‘æˆåˆ†ï¼Ÿ</p><p>ä¸»å¹²ç¿»è¯‘æˆ â€œæ²¡æœ‰ç³»ç»Ÿæ€§çš„è¯æ®è¢«æ‰¾åˆ°â€ æ˜æ˜¾ä¸ç¼ºå°‘æˆåˆ†</p><p>æ‰€ä»¥ä¹Ÿä¸æ˜¯å®¾è¯­ä»å¥</p><p>é‚£ä¹ˆåªèƒ½æ˜¯ åŒä½è¯­ä»å¥</p><p>é‚£åŒä½è¯­ä»å¥ä¿®é¥°çš„å“ªä¸ªè¯å‘¢ï¼Ÿ</p><p>ç®€å•ï¼Œæ—¢ç„¶ found ä¸æ˜¯ï¼Œé‚£ä¹ˆå°±å¾€å‰æ‰¾ï¼Œæ‰¾åˆ°äº† evidence ï¼ˆå†å¾€å‰æ‰¾å¯å°±æ²¡è´§äº†ï¼‰</p><p>è¿™å°±æ˜¯ä»å¥åç§»çš„æƒ…å†µ</p><hr><p>But as the Nuclear Regulatory Commission (NRC) reviews the companyâ€™s application, it should keep in mind what promises from Entergy are worth.</p><p>è¿™é‡Œçš„ç¬¬ä¸€ä¸ª But å¯ä»¥ä¸çœ‹</p><p>as the Nuclear Regulatory Commission (NRC) reviews the companyâ€™s application è¿™æ˜¯ä¸€ä¸ªçŠ¶è¯­ä»å¥</p><p>keep in mind what promises from Entergy are worth.</p><p>what å¼•å¯¼çš„ä»å¥ï¼Œåªæœ‰åè¯æ€§ä»å¥ï¼Œæ‰€ä»¥åº”è¯¥æ”¾åœ¨ keep ä¹‹åï¼Œä½†ä¸Šé¢çš„ä¾‹å­ä¸­å´æ”¾åœ¨ in mind ä¹‹å</p><p>What is being called artificial general intelligence, machines that would mimic the way humans think, continues to elude scientists.</p><p>, machines that would mimic the way humans think,è¿™æ˜¯æ’å…¥è¯­ï¼Œé¢å¤–çš„è¡¥å……è¯´æ˜ç½¢äº†</p><p>â€‹            ğŸ‘†      ğŸ‘†                ğŸ‘†     ğŸ‘†</p><p>åé¢çš„ humans think è¿˜æ˜¯ä¸€ä¸ªå®šè¯­ä»å¥ ä¸»è°“ä¸»è°“</p><hr><p>Concerns were raised that witnesses might be encouraged to exaggerate their stories in court to ensure guilty verdicts.</p><p>æ‹…å¿ƒï¼Œä¸åŠç‰© ä¸»è°“ç»“æ„</p><p>that witnesses might be encouraged to exaggerate their stories in court to ensure guilty verdicts æ˜¯åŒä½è¯­ï¼Œåç½®äº†</p><hr><p>Consumers say theyâ€™ re not in despair because, despite the dreadful headlines, their own fortunes still feel pretty good.</p><p>, despite the dreadful headlines, è¿™æ˜¯ä¸€ä¸ªä»‹è¯çŸ­è¯­ä½œæ’å…¥è¯­</p><hr><p>George Annas, chair of the health law department at Boston University, maintains that, as long as a doctor prescribes a drug for a legitimate medical purpose, the doctor has done nothing illegal even if the patient uses the drug to hasten death.</p><p>George Annasåè¯ä½œä¸»è¯­ï¼Œç„¶åçªç„¶è¢«é€—å·ä¸­æ–­äº†åŸå…ˆçš„å¥å­ï¼Œæ’å…¥äº†æ’å…¥è¯­ , chair of the health law department at Boston University, è¿™ç§è·Ÿåœ¨åè¯åçš„æ’å…¥è¯­ä¸€èˆ¬éƒ½æ˜¯è§£é‡Šçš„å‰é¢çš„åè¯</p><p>maintains that è°“è¯­ + ä»å¥åˆè¢«æ’å…¥è¯­ä¸­æ–­äº† , as long as a doctor prescribes a drug for a legitimate medical purpose, ä¸è¿‡æ­¤å¤„çš„æ’å…¥è¯­æ˜¯ æ¡ä»¶çŠ¶è¯­ä»å¥ å¿…é¡»ç¿»è¯‘å‡ºæ¥</p><p>the doctor has done nothing illegal even if the patient uses the drug to hasten deathè¿™å¥å°±æ˜¯ä»å¥çš„æœ¬ä½“</p><p>å…¶ä¸­è¿˜æœ‰ä¸€ä¸ªè®©æ­¥çŠ¶è¯­ä»å¥even if the patient uses the drug to hasten death</p><p>ä¸»å¹²æ˜¯ï¼šGeorge Annas maintains that the doctor has done nothing illegal even if the patient uses the drug to hasten death</p><h2 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li><p>çŠ¶è¯­ä»å¥çš„æ’å…¥è¯­ä¸èƒ½çœç•¥å¤–ï¼ŒåŒä½è¯­ï¼Œæ’å…¥è¯­å’Œéé™å®šæ€§å®šè¯­ä»å¥éƒ½å¯ä»¥çœç•¥ä¸çœ‹ï¼Œä¸ä¼šå½±å“å¥å­çš„æ„æ€</p></li><li><p>ä»å¥åç½®ä¸»è¦çš„åŸå› æ˜¯å¯¹æ¯”ä¸»å¹²çš„éƒ¨åˆ†å¤ªé•¿äº†</p></li></ol><p>æ¯”å¦‚ï¼š</p><p><strong>A + ä»å¥ + è°“è¯­ + å®¾è¯­&#x2F;è¡¥è¯­&#x2F;çŸ­è¯­ç­‰</strong></p><p>å¦‚æœä»å¥å¯¹æ¯” è°“è¯­å’Œå®¾è¯­&#x2F;è¡¥è¯­&#x2F;çŸ­è¯­ç­‰ å¤ªé•¿äº†</p><p>æ­¤æ—¶æœ€å¥½æŠŠä»å¥åç½®ä¸ºä¸‹é¢è¿™æ ·ï¼š</p><p><strong>A + è°“è¯­ + å®¾è¯­&#x2F;è¡¥è¯­&#x2F;çŸ­è¯­ç­‰ + ä»å¥</strong></p><h1 id="é•¿éš¾å¥çš„ç»“æ„-â€”â€”-åµŒå¥—ç»“æ„"><a href="#é•¿éš¾å¥çš„ç»“æ„-â€”â€”-åµŒå¥—ç»“æ„" class="headerlink" title="é•¿éš¾å¥çš„ç»“æ„ â€”â€” åµŒå¥—ç»“æ„"></a>é•¿éš¾å¥çš„ç»“æ„ â€”â€” åµŒå¥—ç»“æ„</h1><h2 id="æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>ä¿„ç½—æ–¯å¥—å¨ƒå¼çš„è‹±è¯­</p><blockquote><p>å¤§ä»å¥å†…æœ‰å°ä»å¥ï¼Œå°ä»å¥å†…æœ‰å°å°ä»å¥ è¿™ç§ã€‚ã€‚ã€‚</p></blockquote><h2 id="æ€ä¹ˆåˆ†æï¼Ÿ"><a href="#æ€ä¹ˆåˆ†æï¼Ÿ" class="headerlink" title="æ€ä¹ˆåˆ†æï¼Ÿ"></a>æ€ä¹ˆåˆ†æï¼Ÿ</h2><blockquote><p>æˆ‘çš„å»ºè®®æ˜¯ä»å°ä»å¥åˆ†æåˆ°å¤§ä»å¥ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»å¤–å¾€é‡Œçœ‹ï¼Œè¿™æ ·æ¯”è¾ƒæœ‰é¡ºåº</p></blockquote><hr><p>The great question is who should benefit from the analysis of all the data that our lives now generate.</p><ul><li>The great question isï¼ˆä¸»ç³»è¡¨ï¼‰</li><li>who should benefit from the analysis of all the dataï¼ˆè¡¨è¯­ä»å¥ï¼‰</li><li>that our lives now generate.ï¼ˆå®šè¯­ä»å¥ï¼Œå…ˆè¡Œè¯æ˜¯ dataï¼‰</li></ul><p>If we are serious about ensuring that our science is both meaningful and reproducible, we must ensure that our institutions incentivise that kind of science.</p><ul><li>If we are serious about ensuring that our science is both meaningful and reproducible,</li><li>we must ensure that our institutions incentivise that kind of science.</li></ul><p>è¿™é‡Œå¤´è¿è¯æ¯”è¾ƒå¤šï¼Œéœ€è¦åˆ¤æ–­å“ªä¸ªè¿è¯æ²¡æœ‰ç”¨</p><table><thead><tr><th>è¿è¯</th><th>åŠ¨è¯</th></tr></thead><tbody><tr><td>ifï¼ˆæ¡ä»¶çŠ¶è¯­ä»å¥ï¼‰</td><td>are serious</td></tr><tr><td>thatï¼ˆå…ˆè¡Œè¯æ˜¯ensuringï¼‰</td><td>is</td></tr><tr><td>ä¸»è°“å®¾ç»“æ„ï¼Œå®¾è¯­æ˜¯ä»å¥</td><td>must ensure ï¼ˆæ˜æ˜¾è¿™æ˜¯è°“è¯­ï¼‰</td></tr><tr><td>thatï¼ˆå®¾è¯­ä»å¥ï¼‰</td><td>incentivise</td></tr><tr><td>thatï¼ˆæ˜æ˜¾è¿™ä¸ª that ä¸æ˜¯è¿è¯ï¼‰</td><td></td></tr></tbody></table><p>ä¸Šé¢éœ€è¦æ³¨æ„ï¼Œæœ‰å¤§ä»å¥åŒ…å«å°ä»å¥çš„æƒ…å†µ</p><p>If we are serious about ensuring that our science is both meaningful and reproducible</p><p>ensuring æ˜¯åŠç‰©åŠ¨è¯ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Šå®¾è¯­ æ‰€ä»¥ ensuring that åé¢çš„ä»å¥å°±æ˜¯å®¾è¯­</p><hr><p>It hoped they would learn how shop-floor lighting affected workersâ€™ productivity.</p><p>â†‘   ğŸ‘†  â‘   â†‘        ğŸ‘†                       â†‘        ğŸ‘†</p><p>ä¸Šé¢çš„ â†‘ éƒ½æ˜¯åè¯ï¼ŒğŸ‘†éƒ½æ˜¯åŠ¨è¯</p><p>æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ° â‘  å·ä½ç½®ç¼ºå°‘äº† å¼•å¯¼è¯ï¼Œè¿™é‡Œ hope æ˜¯å¸Œæœ›çš„æ„æ€ï¼Œæ˜¯åŠç‰©åŠ¨è¯ï¼Œæ‰€ä»¥åé¢å°†ä¼šæœ‰å®¾è¯­ä»å¥</p><p>ä¸­é—´æœ‰ä¸ªè¿è¯ï¼šhow</p><p>æˆ‘ä»¬è¿˜å¯ä»¥æ–­å¼€å¥å­ï¼šhow shop-floor lighting affected workersâ€™ productivity</p><p>ä½¿ç”¨ how çš„è¯å°±æ˜¯å®¾è¯­ä»å¥</p><p>Carnegie would be right if arguments were fights, which is how we often think of them.</p><ul><li>Carnegie would be rightï¼ˆä¸»ç³»è¡¨ï¼‰</li><li>if arguments were fightsï¼ˆæ¡ä»¶çŠ¶è¯­ä»å¥ï¼‰</li><li>, which isï¼ˆéé™å®šæ€§å®šè¯­ä»å¥ï¼‰</li><li>how we often think of them.ï¼ˆè¡¨è¯­ä»å¥ï¼‰</li></ul><p>A few generative rules are then sufficient to unfold the entire fundamental structure of a language, which is why children can learn it So quickly.</p><h1 id="é•¿éš¾å¥çš„ç»“æ„-â€”â€”-å¹³è¡Œç»“æ„"><a href="#é•¿éš¾å¥çš„ç»“æ„-â€”â€”-å¹³è¡Œç»“æ„" class="headerlink" title="é•¿éš¾å¥çš„ç»“æ„ â€”â€” å¹³è¡Œç»“æ„"></a>é•¿éš¾å¥çš„ç»“æ„ â€”â€” å¹³è¡Œç»“æ„</h1><p>è¿è¯å’Œé€—å·é…åˆçš„ä¸€ç§å¥å‹</p><p>Aï¼ŒBï¼ŒC and&#x2F;or D</p><p>æˆ–è€…æ˜¯ not only ã€‚ã€‚ã€‚but alsoã€‚ã€‚ã€‚ è¿™ç§å¹¶åˆ—æ–¹å¼</p><p>å…¶å®è¿™ç§å¥å‹æ²¡ä»€ä¹ˆå¥½è®²çš„ï¼Œä¸»è¦å°±æ˜¯æ‰¾çœç•¥æˆåˆ†ï¼Œè¿™åœ¨å¹¶åˆ—å¥ä¸­è®²çš„å¾ˆæ¸…æ¥šäº†</p><blockquote><p><strong><code>A and B</code></strong></p><p><strong><code>ä¸€èˆ¬æƒ…å†µä¸‹ A æ‰€æ‹¥æœ‰çš„æˆåˆ† &gt;= B æ‰€æ‹¥æœ‰çš„æˆåˆ†</code></strong></p><p><strong><code>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ B ä¸­çš„æˆåˆ†å» A ä¸­ä¸€ä¸ªä¸ªå¯¹åº”ç€æ‰¾åŒ¹é…æˆåˆ†ï¼Œæœ€åå°±èƒ½çœ‹åˆ° A ä¸­å“ªäº›æˆåˆ† B ä¸­æ²¡æœ‰</code></strong></p><p><strong><code>é‚£ä¹ˆè¿™äº›æ²¡æœ‰çš„æˆåˆ†å°±æ˜¯ B ä¸­çœç•¥çš„éƒ¨åˆ†</code></strong></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> è‹±è¯­ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¿è¯ </tag>
            
            <tag> æ–­å¥ </tag>
            
            <tag> æ ‡ç‚¹ç¬¦å· </tag>
            
            <tag> åˆ†æä¸»è°“ </tag>
            
            <tag> å¤šä¸ªåŠ¨è¯è¯†åˆ«è°“è¯­ </tag>
            
            <tag> é•¿éš¾å¥ç®€åŒ– </tag>
            
            <tag> ä¿®é¥°æˆåˆ†å®šè¯­è¿˜æ˜¯çŠ¶è¯­ </tag>
            
            <tag> è¿˜åŸ </tag>
            
            <tag> ä¸¤æ­¥åˆ†ææ³• </tag>
            
            <tag> åˆ†è£‚ </tag>
            
            <tag> åµŒå¥—ç»“æ„ </tag>
            
            <tag> å¹³è¡Œç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>06å€’è£…</title>
      <link href="/2022/11/25/06%E8%8B%B1%E8%AF%AD/06%E7%89%B9%E6%AE%8A/"/>
      <url>/2022/11/25/06%E8%8B%B1%E8%AF%AD/06%E7%89%B9%E6%AE%8A/</url>
      
        <content type="html"><![CDATA[<h1 id="å€’è£…"><a href="#å€’è£…" class="headerlink" title="å€’è£…"></a>å€’è£…</h1><h2 id="å…¨éƒ¨å€’è£…"><a href="#å…¨éƒ¨å€’è£…" class="headerlink" title="å…¨éƒ¨å€’è£…"></a>å…¨éƒ¨å€’è£…</h2><h3 id="ä¸ºä»€ä¹ˆä¼šæœ‰å€’è£…ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šæœ‰å€’è£…ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šæœ‰å€’è£…ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šæœ‰å€’è£…ï¼Ÿ</h3><ol><li>çªå‡ºå¼ºè°ƒ</li><li>ä¸»è¯­å¤ªå¤æ‚å¾€åé¢æ”¾</li></ol><h3 id="ä»€ä¹ˆæ˜¯å…¨éƒ¨å€’è£…ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å…¨éƒ¨å€’è£…ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å…¨éƒ¨å€’è£…ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å…¨éƒ¨å€’è£…ï¼Ÿ</h3><p>è°“è¯­åŠ¨è¯è·‘åˆ°ä¸»è¯­å‰</p><p>On the north bank of the Ohio River sits Evansville, Ind.</p><p>Also unclear is why Microsoft has gone it alone.</p><h3 id="æ€ä¹ˆåˆ¤æ–­æ˜¯å€’è£…ï¼Ÿ"><a href="#æ€ä¹ˆåˆ¤æ–­æ˜¯å€’è£…ï¼Ÿ" class="headerlink" title="æ€ä¹ˆåˆ¤æ–­æ˜¯å€’è£…ï¼Ÿ"></a>æ€ä¹ˆåˆ¤æ–­æ˜¯å€’è£…ï¼Ÿ</h3><p>æ‰¾åˆ°è°“è¯­ï¼Œçœ‹ä¸‹é¢çš„ä¸»è¯­æ˜¯å¦ä¸º ä»‹è¯ æˆ– å‰¯è¯ ç­‰ è¿™ç§ä¸èƒ½ä½œä¸»è¯­çš„æˆåˆ†ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ˜¯å€’è£…</p><h3 id="There-be-å¥å‹ï¼ˆå¿…ä¼šï¼‰"><a href="#There-be-å¥å‹ï¼ˆå¿…ä¼šï¼‰" class="headerlink" title="There be å¥å‹ï¼ˆå¿…ä¼šï¼‰"></a>There be å¥å‹ï¼ˆå¿…ä¼šï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">There be + n. + [ä»‹è¯çŸ­è¯­]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">There is a girl.</span><br></pre></td></tr></table></figure><blockquote><p>å®¢è§‚å­˜åœ¨ï¼Œä¸æ˜¯æ‹¥æœ‰</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">There is a book on the table.</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">There is a great deal of this kind of nonsense in the medical journals </span><br></pre></td></tr></table></figure><blockquote><p>ä¸»è¯­åœ¨å‰é¢ï¼Œæ ¹æ®ä¸»è¯­åˆ¤æ–­æ˜¯ is è¿˜æ˜¯ are</p></blockquote><p>be å¯ä»¥æ˜¯ wasï¼Œ wereï¼Œ has beï¼Œ have beï¼Œmust beï¼Œmay be</p><h2 id="éƒ¨åˆ†å€’è£…"><a href="#éƒ¨åˆ†å€’è£…" class="headerlink" title="éƒ¨åˆ†å€’è£…"></a>éƒ¨åˆ†å€’è£…</h2><h3 id="ä»€ä¹ˆæ˜¯éƒ¨åˆ†å€’è£…ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯éƒ¨åˆ†å€’è£…ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯éƒ¨åˆ†å€’è£…ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯éƒ¨åˆ†å€’è£…ï¼Ÿ</h3><p>ä¸»è¯­çš„ä¸€éƒ¨åˆ†ç§»åŠ¨åˆ°è°“è¯­å‰é¢</p><h3 id="æ€ä¹ˆæ ·å†™ä¸€ä¸ªéƒ¨åˆ†å€’è£…ï¼Ÿ"><a href="#æ€ä¹ˆæ ·å†™ä¸€ä¸ªéƒ¨åˆ†å€’è£…ï¼Ÿ" class="headerlink" title="æ€ä¹ˆæ ·å†™ä¸€ä¸ªéƒ¨åˆ†å€’è£…ï¼Ÿ"></a>æ€ä¹ˆæ ·å†™ä¸€ä¸ªéƒ¨åˆ†å€’è£…ï¼Ÿ</h3><p>ç›¸å½“äºå†™ä¸€ä¸ªç–‘é—®å¥, å°†è°“è¯­çš„éƒ¨åˆ†æˆåˆ†æå‰çš„ä¸»è¯­å‰é¢</p><h4 id="1-å¦å®šå‰¯è¯æˆ–è¯ç»„è°“è¯­å¥é¦–"><a href="#1-å¦å®šå‰¯è¯æˆ–è¯ç»„è°“è¯­å¥é¦–" class="headerlink" title="1. å¦å®šå‰¯è¯æˆ–è¯ç»„è°“è¯­å¥é¦–"></a>1. å¦å®šå‰¯è¯æˆ–è¯ç»„è°“è¯­å¥é¦–</h4><p>it has never served so much to connect different peoples and nations beforeâ€¦</p><h5 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h5><ol><li><p>has æå‰ï¼Œç›¸å½“äºå†™ä¸ªç–‘é—®å¥</p></li><li><p>never before è¯ç»„æå‰</p></li></ol><p>never before has it served so much to connect different peoples and nations.</p><blockquote><p>éƒ¨åˆ†å€’è£…ä¹Ÿæ˜¯å¼ºè°ƒçš„æ„æ€</p></blockquote><h5 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h5><p>They developed not only such a device..</p><p>Not only did they develop such a deviceâ€¦</p><h4 id="2-only-æå‰"><a href="#2-only-æå‰" class="headerlink" title="2. only æå‰"></a>2. only æå‰</h4><p>They will be useful servants and not  Frankensteinâ€™s out-of-control monster only then.</p><ol><li>æŠŠ only å’Œ only æ‰€å¸¦çš„è¯æå‰</li><li>å†™ä¸ªç–‘é—®å¥çš„æ–¹å¼</li></ol><p>Only then will they be useful servants and not Frankensteinâ€™s out-of-control monster.</p><p>And scholars have examined history from the bottom up only over the past 30 years.</p><p>And only over the past 30 years have scholars examined history from the bottom up.</p><h4 id="3-è™šæ‹Ÿæ¡ä»¶çœç•¥ifåå€’è£…"><a href="#3-è™šæ‹Ÿæ¡ä»¶çœç•¥ifåå€’è£…" class="headerlink" title="3. è™šæ‹Ÿæ¡ä»¶çœç•¥ifåå€’è£…"></a>3. è™šæ‹Ÿæ¡ä»¶çœç•¥ifåå€’è£…</h4><p>But if Entergy had kept its word, that debate would be beside the point.</p><ol><li>çœç•¥ if</li><li>å†™ä¸ªç–‘é—®å¥</li></ol><p>But had Entergy kept its word, that debate would be beside the point.</p><h1 id="å¼ºè°ƒå¥"><a href="#å¼ºè°ƒå¥" class="headerlink" title="å¼ºè°ƒå¥"></a>å¼ºè°ƒå¥</h1><h2 id="ä»€ä¹ˆæ˜¯å¼ºè°ƒå¥ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¼ºè°ƒå¥ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¼ºè°ƒå¥ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¼ºè°ƒå¥ï¼Ÿ</h2><p>å°†ä¸€ä¸ªæ™®é€šçš„å®Œæ•´çš„å¥å­æ‹†åˆ†å‡ºéœ€è¦å¼ºè°ƒçš„éƒ¨åˆ†ï¼Œæ”¾ä¸­é—´ï¼Œå…¶ä½™çš„æ”¾åé¢</p><h2 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">It is ...(å¼ºè°ƒçš„éƒ¨åˆ†) that ...ï¼ˆå¥å­çš„å‰©ä½™éƒ¨åˆ†ï¼‰</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯å¼ºè°ƒäººæˆ–è€…è¿‡å»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">It is/was ... that/who ...</span><br></pre></td></tr></table></figure><p>we hear the more honest argument only in recent yearsã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦å¼ºè°ƒ only in recent yearsï¼Œé‚£å°±æ”¾åˆ° is that ä¹‹é—´ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†æ”¾åˆ° that </p><p>It is only in recent years that we hear the more honest argument.</p><p>It is they, not America, who have become anti-intellectual. </p><p>it was not until the 19th century that the newspaper became the dominant pre-electronic medium,</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><blockquote><p>åªæœ‰å½¢å®¹è¯å’ŒåŠ¨è¯ä¸èƒ½å¼ºè°ƒ</p></blockquote><h2 id="åˆ¤æ–­æ˜¯ä¸æ˜¯å¼ºè°ƒå¥ï¼Ÿ"><a href="#åˆ¤æ–­æ˜¯ä¸æ˜¯å¼ºè°ƒå¥ï¼Ÿ" class="headerlink" title="åˆ¤æ–­æ˜¯ä¸æ˜¯å¼ºè°ƒå¥ï¼Ÿ"></a>åˆ¤æ–­æ˜¯ä¸æ˜¯å¼ºè°ƒå¥ï¼Ÿ</h2><p>ä¸»è¯­ä»å¥å¾€åæ”¾å’Œå¼ºè°ƒå¥</p><h3 id="ç¬¬ä¸€ç§æ–¹æ³•"><a href="#ç¬¬ä¸€ç§æ–¹æ³•" class="headerlink" title="ç¬¬ä¸€ç§æ–¹æ³•"></a>ç¬¬ä¸€ç§æ–¹æ³•</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿˜åŸæ³•ï¼ˆå»æ‰ it isï¼Œç„¶åå†è¿˜åŸï¼‰ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯å®Œæ•´çš„å¥å­ï¼Œå¦‚æœæ˜¯å®Œæ•´çš„å¥å­é‚£ä¹ˆå°±æ˜¯å¼ºè°ƒå¥ï¼Œå¦åˆ™å°±æ˜¯ä¸»è¯­ä»å¥</p><h3 id="ç¬¬äºŒç§æ–¹æ³•"><a href="#ç¬¬äºŒç§æ–¹æ³•" class="headerlink" title="ç¬¬äºŒç§æ–¹æ³•"></a>ç¬¬äºŒç§æ–¹æ³•</h3><p>å¦‚æœ is that ä¸­é—´ä¸æ˜¯å½¢å®¹è¯å’ŒåŠ¨è¯ï¼Œå°±æ˜¯å¼ºè°ƒå¥</p><h1 id="è™šæ‹Ÿ"><a href="#è™šæ‹Ÿ" class="headerlink" title="è™šæ‹Ÿ"></a>è™šæ‹Ÿ</h1><h2 id="è™šæ‹Ÿæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#è™šæ‹Ÿæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è™šæ‹Ÿæ˜¯ä»€ä¹ˆï¼Ÿ"></a>è™šæ‹Ÿæ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li>è·ŸçœŸå®å¯¹æ¯”ä¸ç›¸ç¬¦çš„ï¼Œå°±æ˜¯è™šæ‹Ÿ</li><li>å‡è®¾çš„æƒ…å†µï¼Œå°±æ˜¯è™šæ‹Ÿ</li></ul><h2 id="å¦‚ä½•è¡¨è¾¾è™šæ‹Ÿï¼Ÿ"><a href="#å¦‚ä½•è¡¨è¾¾è™šæ‹Ÿï¼Ÿ" class="headerlink" title="å¦‚ä½•è¡¨è¾¾è™šæ‹Ÿï¼Ÿ"></a>å¦‚ä½•è¡¨è¾¾è™šæ‹Ÿï¼Ÿ</h2><p>è°“è¯­åŠ¨è¯å˜æ€ï¼šè°“è¯­åŠ¨è¯æ”¹å˜æ—¶æ€</p><h2 id="è™šæ‹Ÿç”¨åœ¨å“ªï¼Ÿ"><a href="#è™šæ‹Ÿç”¨åœ¨å“ªï¼Ÿ" class="headerlink" title="è™šæ‹Ÿç”¨åœ¨å“ªï¼Ÿ"></a>è™šæ‹Ÿç”¨åœ¨å“ªï¼Ÿ</h2><h3 id="ifè™šæ‹Ÿæ¡ä»¶"><a href="#ifè™šæ‹Ÿæ¡ä»¶" class="headerlink" title="ifè™šæ‹Ÿæ¡ä»¶"></a>ifè™šæ‹Ÿæ¡ä»¶</h3><h4 id="å‡è®¾ç°åœ¨æ—¶"><a href="#å‡è®¾ç°åœ¨æ—¶" class="headerlink" title="å‡è®¾ç°åœ¨æ—¶"></a>å‡è®¾ç°åœ¨æ—¶</h4><p><strong>ä»å¥å¾€å‰æ¨ä¸€ä¸ªæ—¶æ€, ä¸»å¥4åŠ ä¸€ï¼Œå°†æ¥åŒç°åœ¨</strong></p><p>if ä»å¥ + å¾€å‰æ¨ä¸€ä¸ªæ—¶æ€ did + be åŠ¨è¯åªèƒ½ç”¨ were + ä¸»å¥ could&#x2F;would&#x2F;should&#x2F;might + do</p><blockquote><p>ç°åœ¨æ—¶ï¼Œå¾€å‰æ¨ä¸€ä¸ªæ—¶æ€å°±æ˜¯ didï¼Œä»å¥ 4 ä¸ªè¯ could&#x2F;would&#x2F;should&#x2F;might åŠ ä¸Šä¸€ä¸ª do</p></blockquote><p>Your prospects would be almost as dismal if arguments were even just competitionsä¸€ä¸€like, say, tennis games.</p><h4 id="å‡è®¾è¿‡å»"><a href="#å‡è®¾è¿‡å»" class="headerlink" title="å‡è®¾è¿‡å»"></a>å‡è®¾è¿‡å»</h4><p>if ä»å¥ + è¿‡å»å®Œæˆæ—¶ï¼ˆè¿‡å»çš„ä¹‹å‰ï¼‰ had done + ä¸»å¥ could&#x2F;would&#x2F;should&#x2F;might + have done</p><blockquote><p>åªèƒ½ç”¨ haveï¼Œhasä¸æ˜¯åŸå‹</p></blockquote><p>If he had played last season, however, he would have been one of 42.</p><h4 id="å‡è®¾å°†æ¥"><a href="#å‡è®¾å°†æ¥" class="headerlink" title="å‡è®¾å°†æ¥"></a>å‡è®¾å°†æ¥</h4><p>å£è¯€ï¼šå°†æ¥åŒç°åœ¨</p><blockquote><p>å‡è®¾å°†æ¥ï¼Œæœ‰å¯èƒ½ä¼šå®ç°ï¼Œæ‰€ä»¥ç”¨çš„å¾ˆå°‘</p></blockquote><p>ifä»å¥ + didï¼ˆwereï¼‰&#x2F;were to do&#x2F;should do + ä¸»å¥ could&#x2F;would&#x2F;should&#x2F;might + do</p><p>If railroads <em>charged</em> all customers the same average rateâ€¦ shippersâ€¦ <em>would do</em> so, leaving remaining customers to shoulder the cost of keeping up the line.</p><h3 id="åè¯æ€§ä»å¥çš„è™šæ‹Ÿ"><a href="#åè¯æ€§ä»å¥çš„è™šæ‹Ÿ" class="headerlink" title="åè¯æ€§ä»å¥çš„è™šæ‹Ÿ"></a>åè¯æ€§ä»å¥çš„è™šæ‹Ÿ</h3><p>ä¸»å¥å½“ä¸­æœ‰è¡¨ç¤ºå»ºè®®ï¼Œå‘½ä»¤å’Œè¦æ±‚çš„è¯ï¼Œé‡Œé¢çš„å°ä»å¥éƒ½éœ€è¦è™šæ‹Ÿ</p><p>This year, it was proposed that the system (should) be changed:</p><p>European ministers instantly demanded that the International Accounting Standards Board (IASB) do likewise.</p>]]></content>
      
      
      <categories>
          
          <category> è‹±è¯­ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å€’è£… </tag>
            
            <tag> å…¨éƒ¨å€’è£… </tag>
            
            <tag> éƒ¨åˆ†å€’è£… </tag>
            
            <tag> there beå¥å‹ </tag>
            
            <tag> å¼ºè°ƒå¥ </tag>
            
            <tag> è™šæ‹Ÿè¯­æ°” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>05çŠ¶è¯­ä»å¥(å‰¯è¯æ€§ä»å¥)</title>
      <link href="/2022/11/25/06%E8%8B%B1%E8%AF%AD/05%E7%8A%B6%E8%AF%AD%E4%BB%8E%E5%8F%A5(%E5%89%AF%E8%AF%8D%E6%80%A7%E4%BB%8E%E5%8F%A5)/"/>
      <url>/2022/11/25/06%E8%8B%B1%E8%AF%AD/05%E7%8A%B6%E8%AF%AD%E4%BB%8E%E5%8F%A5(%E5%89%AF%E8%AF%8D%E6%80%A7%E4%BB%8E%E5%8F%A5)/</url>
      
        <content type="html"><![CDATA[<h1 id="å½¢å®¹è¯å’Œå‰¯è¯"><a href="#å½¢å®¹è¯å’Œå‰¯è¯" class="headerlink" title="å½¢å®¹è¯å’Œå‰¯è¯"></a>å½¢å®¹è¯å’Œå‰¯è¯</h1><h2 id="å½¢å®¹è¯"><a href="#å½¢å®¹è¯" class="headerlink" title="å½¢å®¹è¯"></a>å½¢å®¹è¯</h2><ol><li>æ”¾åœ¨ç³»åŠ¨è¯åé¢åšè¡¨è¯­</li><li>æ”¾åœ¨å®¾è¯­ä¹‹ååšè¡¥è¯­</li><li>æ”¾åœ¨åè¯å‰é¢åšå®šè¯­</li></ol><blockquote><p>å½¢å®¹è¯åªä¿®é¥°åè¯&#x2F;ä»£è¯</p></blockquote><h2 id="å‰¯è¯"><a href="#å‰¯è¯" class="headerlink" title="å‰¯è¯"></a>å‰¯è¯</h2><ol><li><p>å‰¯è¯åšçŠ¶è¯­, ä¿®é¥°å®ä¹‰åŠ¨è¯, å½¢å®¹è¯, å‰¯è¯å’Œæ•´ä¸ªå¥å­</p><p>He smiles sweetly.(å‰¯è¯ä¿®é¥°åŠ¨è¯)</p><p>He looks pretty sweet. (çŠ¶è¯­ä¿®é¥°å½¢å®¹è¯)</p><p>He smiles especially sweetly.(å‰¯è¯ä¿®é¥°å‰¯è¯)</p><p>Actually, he smiles sweetly. (å‰¯è¯ä¿®é¥°æ•´ä¸ªå¥å­)</p></li></ol><h1 id="ä»€ä¹ˆæ˜¯çŠ¶è¯­"><a href="#ä»€ä¹ˆæ˜¯çŠ¶è¯­" class="headerlink" title="ä»€ä¹ˆæ˜¯çŠ¶è¯­"></a>ä»€ä¹ˆæ˜¯çŠ¶è¯­</h1><p>çŠ¶è¯­å°±æ˜¯åœ¨ä¸€å¥è¯å½“ä¸­ä¿®é¥°å®ä¹‰åŠ¨è¯, å½¢å®¹è¯, å‰¯è¯å’Œå¥å­çš„æˆåˆ†, å°±æ˜¯çŠ¶è¯­.</p><blockquote><p>å®šè¯­ä¿®é¥°åè¯, çŠ¶è¯­ä¿®é¥°é™¤åè¯å¤–çš„æ‰€æœ‰æˆåˆ†</p></blockquote><h2 id="å……å½“çŠ¶è¯­çš„æˆåˆ†"><a href="#å……å½“çŠ¶è¯­çš„æˆåˆ†" class="headerlink" title="å……å½“çŠ¶è¯­çš„æˆåˆ†"></a>å……å½“çŠ¶è¯­çš„æˆåˆ†</h2><ol><li>å‰¯è¯&#x2F;å‰¯è¯çŸ­è¯­: She smiles sweetly.  I tried again and again.</li><li>ä»‹è¯çŸ­è¯­: He runs fast like a crazy dog.</li><li>éè°“è¯­åŠ¨è¯: He leaves, crying.</li><li>ä»å¥: I will return the book as soon as I have read it.</li></ol><blockquote><p>åè¯ä¸èƒ½åšçŠ¶è¯­</p></blockquote><h2 id="çŠ¶è¯­çš„ä½ç½®"><a href="#çŠ¶è¯­çš„ä½ç½®" class="headerlink" title="çŠ¶è¯­çš„ä½ç½®"></a>çŠ¶è¯­çš„ä½ç½®</h2><blockquote><p>çŠ¶è¯­çš„ä½ç½®éšä¾¿æ”¾, å½“æ˜¯, å½“çŠ¶è¯­æ”¾åœ¨å¥é¦–æˆ–å¥ä¸­é€šå¸¸è¦ç”¨é€—å·éš”å¼€(å½“ç„¶ä¹Ÿå¯ä»¥ä¸åŠ )</p></blockquote><ol><li>In Chongqing, I am now working.</li><li>I am now working in Chongqing.</li><li>Now, in Chongqing, I am working.</li><li>I now am in Chongqing working.</li><li>â€¦</li></ol><h1 id="çŠ¶è¯­ä»å¥"><a href="#çŠ¶è¯­ä»å¥" class="headerlink" title="çŠ¶è¯­ä»å¥"></a>çŠ¶è¯­ä»å¥</h1><p>çŠ¶è¯­ä»å¥çš„å¼•å¯¼è¯æ˜¯æŒ‰ç…§å¼•å¯¼è¯æœ¬èº«çš„<code>è¯æ„</code>åˆ†çš„ç±», ä¸€å…±æŠŠå¼•å¯¼è¯åˆ†æˆ9ç±»</p><blockquote><p>åè¯æ€§ä»å¥æŒ‰ç…§ä»å¥çš„ç±»å‹åˆ†ç±»</p></blockquote><blockquote><p>å®šè¯­ä»å¥çš„ç§ç±»æŒ‰ç…§å…ˆè¡Œè¯çš„ç§ç±»åˆ†ç±», åæ¥åˆæŒ‰ç…§å¼•å¯¼è¯çš„æ–¹å¼åˆ†ç±»</p></blockquote><blockquote><p>çŠ¶è¯­ä»å¥çš„å¼•å¯¼è¯è¢«å«ä½œâ€œä»å±è¿è¯â€ï¼Œå¯¹çš„ä»–æ˜¯ä¸€ä¸ªå¸¦è¿è¯æ„æ€çš„è¿è¯</p></blockquote><h2 id="ä¹å¤§çŠ¶è¯­ä»å¥"><a href="#ä¹å¤§çŠ¶è¯­ä»å¥" class="headerlink" title="ä¹å¤§çŠ¶è¯­ä»å¥"></a>ä¹å¤§çŠ¶è¯­ä»å¥</h2><h3 id="æ—¶é—´çŠ¶è¯­ä»å¥"><a href="#æ—¶é—´çŠ¶è¯­ä»å¥" class="headerlink" title="æ—¶é—´çŠ¶è¯­ä»å¥"></a><code>æ—¶é—´çŠ¶è¯­ä»å¥</code></h3><h4 id="å¼•å¯¼è¯"><a href="#å¼•å¯¼è¯" class="headerlink" title="å¼•å¯¼è¯"></a>å¼•å¯¼è¯</h4><p>(è¿è¯): <code>when</code>, <code>as</code>, <code>while</code>, <code>once</code>, <code>as soon as</code>, <code>before</code> , <code>after</code>, <code>since</code>, <code>until/till...</code>, not â€¦ until, by the time, each time&#x2F;every time, the next time</p><blockquote><p>when, as, while éƒ½ç¿»è¯‘æˆ å½“â€¦çš„æ—¶å€™</p><p>since è‡ªä»</p><p>as soon as ä¸€â€¦å°±</p><p>once ä¸€æ—¦</p></blockquote><p>(åè¯çŸ­è¯­) the moment, every time, the day, the instant</p><p>(å‰¯è¯) immediately, directly, no soonerâ€¦ than, hardlyâ€¦when, scarcelyâ€¦when</p><h4 id="when-while-as-çš„åŒºåˆ«"><a href="#when-while-as-çš„åŒºåˆ«" class="headerlink" title="when, while, as çš„åŒºåˆ«"></a>when, while, as çš„åŒºåˆ«</h4><ul><li><p>when å¼•å¯¼çš„ä»å¥, å…¶è°“è¯­åŠ¨è¯å¯å»¶ç»­å¯çŸ­æš‚</p><p>When the teacher came in, we stopped talking. (çŸ­æš‚æ€§åŠ¨è¯)</p><p>When I lived in the countryside, I used to live a tough life.(å»¶ç»­æ€§åŠ¨è¯)</p></li><li><p>while å»¶ç»­æ€§</p><p>While my mother was reading the newspaper, I was watching TV.</p></li><li><p>as å»¶ç»­æ€§, è¡¨ç¤ºâ€ä¸€è¾¹â€¦ä¸€è¾¹â€, ä¸€èˆ¬ç”¨äºä¸»å¥å’Œä»å¥åŠ¨è¯åŒæ—¶å‘ç”Ÿ; as ä¹Ÿå¯ä»¥è¡¨ç¤ºä¼´éš</p><p>As families moved away from their stable community, the informal flow of information is cut off.</p></li></ul><h4 id="until-å’Œ-not-â€¦-untilçš„åŒºåˆ«"><a href="#until-å’Œ-not-â€¦-untilçš„åŒºåˆ«" class="headerlink" title="until å’Œ not â€¦ untilçš„åŒºåˆ«"></a>until å’Œ not â€¦ untilçš„åŒºåˆ«</h4><ul><li>I will wait here until you come.</li><li>I will not leave until you come.</li></ul><blockquote><p>åŒºåˆ«åœ¨äº: wait å’Œ leave</p><p>until æ˜¯å»¶ç»­æ€§åŠ¨è¯</p><p>not â€¦ until æ˜¯çŸ­æš‚æ€§åŠ¨è¯</p></blockquote><blockquote><p>çœ‹ä¸»å¥çš„è°“è¯­åŠ¨è¯æ˜¯ç¬é—´åŠ¨è¯è¿˜æ˜¯å»¶ç»­æ€§åŠ¨è¯, å¦‚æœæ˜¯ç¬é—´åŠ¨è¯å°±ç”¨ not â€¦ until, å¦‚æœæ˜¯å»¶ç»­æ€§åŠ¨è¯å°±ç”¨ until</p></blockquote><p>çŸ¥é“æˆ‘æœ‰äº†è‡ªå·±çš„å¥³å„¿, æˆ‘æ‰æ„è¯†åˆ°æ¯äº²çš„ä¼Ÿå¤§</p><p>æ„è¯†: ç¬é—´åŠ¨è¯, ç”¨ not â€¦ until</p><p>I did not realize the greatness of mother until I had my own daughter.</p><h3 id="åœ°ç‚¹çŠ¶è¯­ä»å¥"><a href="#åœ°ç‚¹çŠ¶è¯­ä»å¥" class="headerlink" title="åœ°ç‚¹çŠ¶è¯­ä»å¥"></a>åœ°ç‚¹çŠ¶è¯­ä»å¥</h3><ol><li><p>å¼•å¯¼è¯: <code>where</code>, wherever, anywhere, everywhere</p><p>è¿™ç§æ ‘åœ¨æ½®æ¹¿çš„åœ°æ–¹ç”Ÿé•¿çš„å¾ˆå¥½</p><p>The tree grows well in wet places.</p><p>The tree grows well where it is wet.</p><blockquote><p>å……å½“åœ°ç‚¹çš„çŠ¶è¯­é€šå¸¸éƒ½æ˜¯ä»‹è¯çŸ­è¯­, è€Œä¸æ˜¯ä»å¥.</p></blockquote></li><li><p>where å¼•å¯¼çš„çŠ¶è¯­ä»å¥å’Œå®šè¯­ä»å¥</p></li></ol><p>åŒºåˆ«: çœ‹ where æ˜¯å¦æŒ‡ä»£å‰é¢çš„å…ˆè¡Œè¯</p><p>I find my phone where I had lost it.(çŠ¶è¯­)</p><p>This is the house where I lived two years ago.(å®šè¯­)</p><blockquote><p>åªéœ€è¦çœ‹ where å‰é¢çš„è¿™ä¸ªå•è¯, å¦‚æœä»–æ˜¯ä¸€ä¸ªè¡¨ç¤º<code>åœ°ç‚¹</code>çš„<code>åè¯</code>(å¹¶ä¸”è¯¥åè¯éœ€è¦è¢«æ˜ç¡®é™å®šèŒƒå›´)å°±æ˜¯å®šè¯­ä»å¥å¹¶ä¸”å……å½“ä»å¥çš„æˆåˆ†, å¦‚æœä¸æ˜¯åˆ™æ˜¯çŠ¶è¯­ä»å¥</p></blockquote><h3 id="åŸå› çŠ¶è¯­ä»å¥"><a href="#åŸå› çŠ¶è¯­ä»å¥" class="headerlink" title="åŸå› çŠ¶è¯­ä»å¥"></a><code>åŸå› çŠ¶è¯­ä»å¥</code></h3><p><code>because</code>, <code>since</code>, <code>as</code>, <code>for...</code>, <code>now that</code></p><p>seeing that, now that, in that, considering that, given that, as much as, so much as</p><blockquote><p>éƒ½ç¿»è¯‘æˆå› ä¸º</p></blockquote><p>because of , due to, owing to , thanks to, for the sake of, as a result of + N&#x2F;Ving</p><blockquote><p>éƒ½æ˜¯ä»‹è¯</p></blockquote><p>Because he was careless, he had a car accident yesterday.</p><p>Because of his carelessness, ~</p><h3 id="ç›®çš„çŠ¶è¯­ä»å¥"><a href="#ç›®çš„çŠ¶è¯­ä»å¥" class="headerlink" title="ç›®çš„çŠ¶è¯­ä»å¥"></a>ç›®çš„çŠ¶è¯­ä»å¥</h3><p><code>so that</code>, <code>in order that...</code></p><blockquote><p>ç¿»è¯‘æˆ : ä¸ºäº†&#x2F;ä»¥ä¾¿</p></blockquote><p>åŠ¨è¯ä¸å®šå¼: to , in order to, so as to</p><blockquote><p>éƒ½ç¿»è¯‘æˆ ä¸ºäº†æ˜¯, æˆ–è€… ç›®çš„æ˜¯</p></blockquote><p>We climb higher in order to see farther.</p><p>We climb higher so that We see farther.</p><blockquote><p>so that åé¢éœ€è¦æ¥ä¸Šä¸»è¯­, è€Œ in order to åé¢æ¥åŠ¨è¯, to Ving, åŠ¨è¯ä¸å®šå¼, ä¸»è¯­å·²ç»åœ¨å‰é¢äº†, ä¸éœ€è¦å†åŠ ä¸ª</p></blockquote><p>so as to ä¸èƒ½æ”¾åœ¨å¥é¦– &#x3D;&#x3D; in order to</p><blockquote><p>so that å¯ä»¥å¼•å¯¼ ç›®çš„ å’Œ ç»“æœ çŠ¶è¯­ä»å¥, å¦‚æœ so that åé¢æœ‰æƒ…æ€åŠ¨è¯, é‚£ä¹ˆå°±æ˜¯ç›®çš„çŠ¶è¯­, å¦åˆ™å°±æ˜¯ç»“æœçŠ¶è¯­</p></blockquote><h3 id="ç»“æœçŠ¶è¯­ä»å¥"><a href="#ç»“æœçŠ¶è¯­ä»å¥" class="headerlink" title="ç»“æœçŠ¶è¯­ä»å¥"></a><code>ç»“æœçŠ¶è¯­ä»å¥</code></h3><p><code>so that</code>, <code>so...that(ä¸­é—´adj)...</code>, <code>such...that(ä¸­é—´è·ŸN)...</code></p><p>to the degree that, to the extent that â€¦</p><p>so that , so â€¦ that å’Œ such â€¦ that çš„åŒºåˆ«</p><ul><li>so that å¼•å¯¼ç›®çš„çŠ¶è¯­(ä¸æƒ…æ€åŠ¨è¯è¿ç”¨)å’Œç»“æœçŠ¶è¯­ä»å¥</li></ul><p>I hurried through my work so that I could be on time for the TV.</p><p>We moved to the country so that we were away from the noisy city.</p><ul><li>so â€¦ that çš„åŒºåˆ«</li></ul><p>so + adj&#x2F;adv + that</p><p>The movie was so boring that I gave up watching it halfway though.</p><blockquote><p>åªè¦ç”¨åˆ°å½¢å®¹è¯æˆ–è€…å‰¯è¯çš„åœ°æ–¹éƒ½å¯ä»¥è€ƒè™‘å†™æˆ so â€¦ that</p></blockquote><p>so + å½¢å®¹è¯ + a&#x2F;an + å¯æ•°åè¯å•æ•° + that</p><p><code>Zhanglili is so nice a teacher that everyone loves and respects her.</code></p><ul><li>such â€¦ that çš„ç”¨æ³•</li></ul><p><code>such + a/an + å½¢å®¹è¯ + å¯æ•°åè¯å•æ•° + that</code></p><p>It was such a terrible show that none of us would pay for watching it again.</p><p><code>such + å½¢å®¹è¯ + ä¸å¯æ•°åè¯å•æ•° + that</code></p><h3 id="æ¡ä»¶çŠ¶è¯­ä»å¥"><a href="#æ¡ä»¶çŠ¶è¯­ä»å¥" class="headerlink" title="æ¡ä»¶çŠ¶è¯­ä»å¥"></a><code>æ¡ä»¶çŠ¶è¯­ä»å¥</code></h3><p><code>if</code> <code>once</code>, unless</p><p><code>as/so long as</code>, <code>so long as</code>, only if, providing&#x2F;provided that, on condition thatâ€¦</p><p>If love is a cup of poison, I will drink it up without hesitating.</p><h3 id="è®©æ­¥çŠ¶è¯­ä»å¥"><a href="#è®©æ­¥çŠ¶è¯­ä»å¥" class="headerlink" title="è®©æ­¥çŠ¶è¯­ä»å¥"></a><code>è®©æ­¥çŠ¶è¯­ä»å¥</code></h3><p><code>though</code>, <code>although</code>, <code>even if</code>, <code>even though</code>, <code>while</code>, <code>however</code></p><blockquote><p>è®©æ­¥å°±æ˜¯è¯è¯´çš„ä¸¥é‡, åé¢ä¸€éƒ¨åˆ†è¦é€€ä¸€æ­¥, è¯´è¯è¦ç”¨è®©æ­¥, è¯´çš„å¾ˆä¸¥é‡, æ€•äººç”Ÿæ°”, æŒ½å›, è¯´å¥½è¯</p><p>â€œç›²ç›®è¿½æ˜Ÿä¼šå½±å“åˆ°é’å°‘å¹´æ­£å¸¸å·¥ä½œå’Œå­¦ä¹ , è™½ç„¶ä»–ä»¬å·¥ä½œçš„å¾ˆåŠªåŠ›(è™½ç„¶ä»–ä»¬é•¿å¾—å¾ˆå¥½çœ‹)â€</p></blockquote><p>as, while, no matterâ€¦, in spite of the fact that, whatever, whoever, wherever, whenever, however, whichever</p><p>Although&#x2F;Though he failed again and again, he still adheres to pursuing his dream.</p><h4 id="è®©æ­¥çŠ¶è¯­ä»å¥çš„ä½¿ç”¨"><a href="#è®©æ­¥çŠ¶è¯­ä»å¥çš„ä½¿ç”¨" class="headerlink" title="è®©æ­¥çŠ¶è¯­ä»å¥çš„ä½¿ç”¨"></a>è®©æ­¥çŠ¶è¯­ä»å¥çš„ä½¿ç”¨</h4><ol><li>å¥¹æ˜¯ä¸€ä¸ªç¾å¥³, ç¾å¥³ä¹Ÿæœ‰ç¼ºç‚¹</li></ol><p>She is a beauty although she has a pair of small eyes.</p><ol start="2"><li>å® ç‰©çš„ç¡®ç»™æˆ‘å¥¶å¥¶å¸¦æ¥äº†å¾ˆå¤šå¿«ä¹</li></ol><p>Pets indeed bring much delight to my grandma although taking care of them needs enough time and energy.</p><h3 id="æ–¹å¼çŠ¶è¯­ä»å¥"><a href="#æ–¹å¼çŠ¶è¯­ä»å¥" class="headerlink" title="æ–¹å¼çŠ¶è¯­ä»å¥"></a>æ–¹å¼çŠ¶è¯­ä»å¥</h3><p><code>as</code>, <code>as if</code>, as though (å¥½åƒ;ä¼¼ä¹)</p><p>ä»‹è¯: by, through, inâ€¦ way, inâ€¦manner</p><ul><li><p>She talks with me as she were my mother.</p><p>è¯´è¯çš„æ–¹å¼åƒâ€¦ were è™šæ‹Ÿè¯­æ°”</p></li><li><p>I can still remember the whole thing in great detail as though it happened yesterday.</p></li></ul><h3 id="æ¯”è¾ƒçŠ¶è¯­ä»å¥"><a href="#æ¯”è¾ƒçŠ¶è¯­ä»å¥" class="headerlink" title="æ¯”è¾ƒçŠ¶è¯­ä»å¥"></a>æ¯”è¾ƒçŠ¶è¯­ä»å¥</h3><p><code>as</code>, <code>than</code></p><p>the moreâ€¦ the moreâ€¦, more thanâ€¦, more â€¦ thanâ€¦, not so much â€¦ asâ€¦</p><p>ä½ çœ‹èµ·æ¥æ¯”æˆ‘å¹´è½»</p><p>You look younger than I (look).</p><blockquote><p>ä»–æ˜¯çŠ¶è¯­ä»å¥, æ‰€ä»¥ than ä¹‹åéœ€è¦æœ‰ä¸€ä¸ªå®Œæ•´çš„ å¥å­, æ‰€ä»¥åé¢æ˜¯ I look ä½†æ˜¯ä¸ç¾è§‚, æ‰€ä»¥ lookçœç•¥äº†</p></blockquote><h4 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><p><code>A is to B what/as C is to D</code></p><p>A å¯¹ B æ¥è¯´, å°±åƒ C å¯¹ D æ¥è¯´</p><p>Honesty is to humans as perfume is to a flower.</p><p>Confidence is to university students as water is to fish.</p><h3 id="more-than-çš„ç”¨æ³•"><a href="#more-than-çš„ç”¨æ³•" class="headerlink" title="more than çš„ç”¨æ³•"></a>more than çš„ç”¨æ³•</h3><p>He is more than a teacher. In fact, he writes some poems in his spare time.</p><p>ä»–ä¸ä»…ä»…æ˜¯ä¸€ä¸ªè€å¸ˆâ€¦</p><blockquote><p>more than åé¢å¦‚æœåŠ çš„æ˜¯åè¯æˆ–è€…æ˜¯åŠ¨è¯å°±ç¿»è¯‘æˆ â€œä¸ä»…ä»…æ˜¯â€</p></blockquote><p>Americans are more than hospitable when facing strangers.</p><blockquote><p>more than + adj&#x2F;adv ç¿»è¯‘æˆ very</p></blockquote><p>I have more than 10 boyfriends.</p><blockquote><p>more than + æ•°è¯ &#x3D;&#x3D;&gt; è¶…è¿‡</p></blockquote><blockquote><p>more than + åŠ¨è¯ &#x3D;&#x3D;&gt; ä¸ä»…ä»…æ˜¯</p></blockquote><p><code>not so much as == not even ç”šè‡³ä¸/æ²¡æœ‰</code></p><p>He cannot so much as sing a song.</p><p><code>not so much A as B ä¸å…¶è¯´A, å€’ä¸å¦‚è¯´ B</code></p><p>He is not so much a teacher as a poet.</p><p><code>more A than B ä¸å…¶è¯´B, ä¸å¦‚è¯´A</code></p><p>He is more a teacher than a poet.</p><h2 id="åˆ†è¯åšçŠ¶è¯­"><a href="#åˆ†è¯åšçŠ¶è¯­" class="headerlink" title="åˆ†è¯åšçŠ¶è¯­"></a>åˆ†è¯åšçŠ¶è¯­</h2><blockquote><p>éè°“è¯­åŠ¨è¯åšçŠ¶è¯­</p></blockquote><h3 id="çŠ¶è¯­ä»å¥è½¬åŒ–æˆåˆ†è¯çŠ¶è¯­"><a href="#çŠ¶è¯­ä»å¥è½¬åŒ–æˆåˆ†è¯çŠ¶è¯­" class="headerlink" title="çŠ¶è¯­ä»å¥è½¬åŒ–æˆåˆ†è¯çŠ¶è¯­"></a>çŠ¶è¯­ä»å¥è½¬åŒ–æˆåˆ†è¯çŠ¶è¯­</h3><blockquote><p>è¿™å°±æ˜¯ä¼´éšçŠ¶è¯­ä»å¥</p></blockquote><p>Because I am fat, I feel delighted.</p><p>I feel delighted being fat.</p><blockquote><p>è¿™é‡Œéœ€è¦åŒºåˆ†ä¸‹, ä¸»è¯­ä¸ä¸€è‡´å°±æ˜¯ç‹¬ç«‹ä¸»æ ¼, å¦‚æœä¸»è¯­ä¸€è‡´å°±æ˜¯ä¼´éšçŠ¶è¯­</p></blockquote><p>å·¥ä½œç»“æŸå, æˆ‘ä»¬éƒ½å„è‡ªå›å®¶äº†</p><p>After the job was finished , we went home respectively.</p><p>The job finished, we went home respectively.</p><blockquote><p>åªè¦å‡ºç°é€—å·åˆ†å¼€å‰åä¸¤å¥è¯, åªè¦æŠŠä¸é‡è¦çš„å¥å­å˜æˆåˆ†è¯åšçŠ¶è¯­å°±è¡Œ</p></blockquote><p>è‡ªä¿¡æ˜¯ä¸€ç§ç§¯æçš„å¿ƒæ€, å®ƒèƒ½ä½¿å¾ˆå¤šå¥‡è¿¹é™ä¸´</p><p>Self-confidence is an active mentality, it enable many miracles to happen.</p><p>Being an active mentality, self-confidence enable many miracles to happen.</p><blockquote><p>å¦‚æœæŠŠçŠ¶è¯­ä»å¥å˜æˆåˆ†æˆåšçŠ¶è¯­</p><ol><li>å»æ‰çŠ¶è¯­ä»å¥çš„å¼•å¯¼è¯</li><li>æŠŠä»å¥çš„è°“è¯­åŠ¨è¯å˜æˆéè°“è¯­åŠ¨è¯</li><li>çœ‹åˆ†è¯çš„ä¸»è¯­æ˜¯å¦å’Œå¥å­çš„ä¸»è¯­ä¸€è‡´, å¦‚æœä¸€è‡´åˆ†è¯ä¸»è¯­çœç•¥, å¦‚æœä¸ä¸€è‡´, åˆ†è¯çš„ä¸»è¯­ä¿ç•™</li></ol></blockquote><h2 id="çŠ¶è¯­å’ŒçŠ¶è¯­ä»å¥çš„åº”ç”¨"><a href="#çŠ¶è¯­å’ŒçŠ¶è¯­ä»å¥çš„åº”ç”¨" class="headerlink" title="çŠ¶è¯­å’ŒçŠ¶è¯­ä»å¥çš„åº”ç”¨"></a>çŠ¶è¯­å’ŒçŠ¶è¯­ä»å¥çš„åº”ç”¨</h2><blockquote><p>ä½œæ–‡ä¸­ä»»ä½•ä¸€å¥è¯çš„æ—è¾¹éƒ½å¯ä»¥åŠ ä¸ŠçŠ¶è¯­çš„æˆåˆ†æŠŠå¥å­æ‹‰é•¿</p></blockquote><p>Setting off firecrackers can add the atmosphere.</p><p>Although quite a few individuals argue that it sounds too noisy(è®©æ­¥çŠ¶è¯­)ï¼Œsetting off firecrackers, an ancient Chinese tradition with thousands of years (åŒä½è¯­)ï¼Œcan add the<br>atmosphere of holidays and festivals (å®šè¯­) when Chinese are gathering with their families or their friends at home (æ—¶é—´çŠ¶è¯­)</p><h2 id="é•¿éš¾å¥åˆ†æ"><a href="#é•¿éš¾å¥åˆ†æ" class="headerlink" title="é•¿éš¾å¥åˆ†æ"></a>é•¿éš¾å¥åˆ†æ</h2><blockquote><p>åªè¦åœ¨å¥å­ä¸­è§åˆ°ä»¥ä¸‹çš„ä¸€å¨ä¸œè¥¿å°±ä¸€å®šæ˜¯çŠ¶è¯­: é™¤äº†æ—¶é—´å’Œåœ°ç‚¹å¯èƒ½æ˜¯å®šè¯­ä»¥å¤–, è§åˆ°å‰¯è¯, åŸå› , æ¡ä»¶, ç›®çš„, ç»“æœ, æ¯”è¾ƒ, æ–¹å¼, ä¼´éš, è®©æ­¥ä¸€å®šæ˜¯çŠ¶è¯­. æ—¶é—´å’Œåœ°ç‚¹çœ‹ä½ç½®è€Œå®š</p><p>å¦‚æœåè¯åæœ‰æ—¶é—´æˆ–åœ°ç‚¹, æ—¢åƒå®šè¯­åˆåƒçŠ¶è¯­çš„æ—¶å€™, å®šè¯­ä¼˜å…ˆåŸåˆ™, åªæœ‰ç¿»è¯‘æˆå®šè¯­ç‰¹åˆ«æ¶å¿ƒçš„æ—¶å€™, æ‰æ˜¯çŠ¶è¯­</p></blockquote><p>The Greeks assumed that the structure of language had some connection with the process of thought, which took root in Europe long before people realized how diverse languages could be.</p><p>è·å…°äººè®¤ä¸ºè¯­è¨€çš„ç»“æ„å’Œæ€æƒ³çš„è¿‡ç¨‹æœ‰å…³, åœ¨äººä»¬æ„è¯†åˆ°è¯­è¨€çš„å¤šæ ·åŒ–ä¹‹å‰, åœ¨æ¬§æ´²è¿™ç§æ€æƒ³å·²ç»æ‰æ ¹</p><p>Social science is that branch of intellectual enquiry(çŸ¥è¯†æ¢ç´¢) which seeks to study humans and their endeavors(åŠªåŠ›) in the same reasoned, orderly, systematic, and dispassioned manner that natural scientists use for the study of natural phenomena.  </p><p>When this practice first started decades ago, it was usually limited to freshmen, to give them a second chance to take a class in their first year if they struggled in their transition to college-level courses.</p><p>The history of the EEOB began long before its foundations were laid.</p>]]></content>
      
      
      <categories>
          
          <category> è‹±è¯­ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å½¢å®¹è¯ </tag>
            
            <tag> å‰¯è¯ </tag>
            
            <tag> çŠ¶è¯­ </tag>
            
            <tag> çŠ¶è¯­ä»å¥ </tag>
            
            <tag> æ—¶é—´çŠ¶è¯­ä»å¥ </tag>
            
            <tag> å¼•å¯¼è¯ </tag>
            
            <tag> when </tag>
            
            <tag> while </tag>
            
            <tag> as </tag>
            
            <tag> until </tag>
            
            <tag> åœ°ç‚¹çŠ¶è¯­ä»å¥ </tag>
            
            <tag> åŸå› çŠ¶è¯­ä»å¥ </tag>
            
            <tag> ç›®çš„çŠ¶è¯­ä»å¥ </tag>
            
            <tag> ç»“æœçŠ¶è¯­ä»å¥ </tag>
            
            <tag> æ¡ä»¶çŠ¶è¯­ä»å¥ </tag>
            
            <tag> è®©æ­¥çŠ¶è¯­ä»å¥ </tag>
            
            <tag> æ–¹å¼çŠ¶è¯­ä»å¥ </tag>
            
            <tag> æ¯”è¾ƒçŠ¶è¯­ä»å¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>04å½¢å®¹è¯æ€§ä»å¥(å®šè¯­ä»å¥)</title>
      <link href="/2022/11/25/06%E8%8B%B1%E8%AF%AD/04%E5%BD%A2%E5%AE%B9%E8%AF%8D%E6%80%A7%E4%BB%8E%E5%8F%A5(%E5%AE%9A%E8%AF%AD%E4%BB%8E%E5%8F%A5)/"/>
      <url>/2022/11/25/06%E8%8B%B1%E8%AF%AD/04%E5%BD%A2%E5%AE%B9%E8%AF%8D%E6%80%A7%E4%BB%8E%E5%8F%A5(%E5%AE%9A%E8%AF%AD%E4%BB%8E%E5%8F%A5)/</url>
      
        <content type="html"><![CDATA[<h1 id="å®šè¯­"><a href="#å®šè¯­" class="headerlink" title="å®šè¯­"></a>å®šè¯­</h1><h2 id="ä»€ä¹ˆæ˜¯å®šè¯­"><a href="#ä»€ä¹ˆæ˜¯å®šè¯­" class="headerlink" title="ä»€ä¹ˆæ˜¯å®šè¯­?"></a>ä»€ä¹ˆæ˜¯å®šè¯­?</h2><p>ä¿®é¥°åè¯çš„æˆåˆ†å°±æ˜¯å®šè¯­</p><blockquote><p>åªè¦å¬åˆ° â€œâ€¦çš„ + åè¯â€æˆ–è€…â€åè¯ + of â€¦â€å°±æ˜¯å®šè¯­</p></blockquote><h2 id="ä»€ä¹ˆæ ·çš„ç»“æ„å¯ä»¥åšå®šè¯­"><a href="#ä»€ä¹ˆæ ·çš„ç»“æ„å¯ä»¥åšå®šè¯­" class="headerlink" title="ä»€ä¹ˆæ ·çš„ç»“æ„å¯ä»¥åšå®šè¯­?"></a>ä»€ä¹ˆæ ·çš„ç»“æ„å¯ä»¥åšå®šè¯­?</h2><h3 id="å½¢å®¹è¯ä¿®é¥°åè¯-åšå®šè¯­"><a href="#å½¢å®¹è¯ä¿®é¥°åè¯-åšå®šè¯­" class="headerlink" title="å½¢å®¹è¯ä¿®é¥°åè¯(åšå®šè¯­)"></a>å½¢å®¹è¯ä¿®é¥°åè¯(åšå®šè¯­)</h3><p>é‚£åªå–„è‰¯çš„å¤œèºå¤±å»äº†ä»–çš„ç”Ÿå‘½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The naive nightingale lost his life.</span><br></pre></td></tr></table></figure><h3 id="åè¯ä¿®é¥°åè¯-åšå®šè¯­"><a href="#åè¯ä¿®é¥°åè¯-åšå®šè¯­" class="headerlink" title="åè¯ä¿®é¥°åè¯(åšå®šè¯­)"></a>åè¯ä¿®é¥°åè¯(åšå®šè¯­)</h3><p>åè¯ä¿®é¥°åè¯æ—¶, è¯¥åè¯å·²ç»è¢«å½¢å®¹è¯åŒ–äº†</p><p>å¤œèºçš„æ­Œå£°èƒ½ä½¿è¿™æœµç«ç‘°èŠ±å¼€æ”¾ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The nightingale&#x27;s singing can make the rose bloom.</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The singing of nightingale can make the rose bloom.</span><br></pre></td></tr></table></figure><h3 id="ä»‹è¯çŸ­è¯­åšå®šè¯­"><a href="#ä»‹è¯çŸ­è¯­åšå®šè¯­" class="headerlink" title="ä»‹è¯çŸ­è¯­åšå®šè¯­"></a>ä»‹è¯çŸ­è¯­åšå®šè¯­</h3><p>çª—å¤–çš„å¤œèºå¬åˆ°äº†å¹´è½»äººçš„æ„Ÿå¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The nightingale out of the window heard the sighs of the young man.</span><br></pre></td></tr></table></figure><h3 id="éè°“è¯­åŠ¨è¯ä¿®é¥°åè¯-åšå®šè¯­"><a href="#éè°“è¯­åŠ¨è¯ä¿®é¥°åè¯-åšå®šè¯­" class="headerlink" title="éè°“è¯­åŠ¨è¯ä¿®é¥°åè¯(åšå®šè¯­)"></a>éè°“è¯­åŠ¨è¯ä¿®é¥°åè¯(åšå®šè¯­)</h3><p>å”±æ­Œçš„å¤œèºæœ€ç»ˆå› çˆ±è€Œæ­»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">In the end, the singing nightingale died because of love.</span><br></pre></td></tr></table></figure><p>å•çº¯çš„å¤œèºä¸€å®šæ˜¯çˆ±ä¸Šäº†é‚£ä¸ªè¢«å¥³å­©æ¬ºéª—çš„å­¦ç”Ÿã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The innocent nightingale must have fallen in love with the student deceived by the girl.</span><br></pre></td></tr></table></figure><h3 id="ä»å¥ä¿®é¥°åè¯-ä»å¥åšå®šè¯­"><a href="#ä»å¥ä¿®é¥°åè¯-ä»å¥åšå®šè¯­" class="headerlink" title="ä»å¥ä¿®é¥°åè¯(ä»å¥åšå®šè¯­)"></a>ä»å¥ä¿®é¥°åè¯(ä»å¥åšå®šè¯­)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The rose which the nightingale exchanged with his life failed to help the student.</span><br></pre></td></tr></table></figure><h2 id="å®šè¯­çš„ä½ç½®"><a href="#å®šè¯­çš„ä½ç½®" class="headerlink" title="å®šè¯­çš„ä½ç½®"></a>å®šè¯­çš„ä½ç½®</h2><p>å½“ä¸€ä¸ªå•è¯ä¿®é¥°åè¯(çŸ­è¯­)æ—¶, é€šå¸¸æ”¾åœ¨å•è¯ä¹‹å‰</p><p>å½“å¤šä¸ªå•è¯ä¿®é¥°åè¯(çŸ­è¯­)æ—¶, é€šå¸¸æ”¾åœ¨å•è¯ä¹‹å</p><blockquote><p>å‰å°åå¤§</p></blockquote><p>è¿™æ˜¯ä¸€ä¸ªå¤œèºå’Œç«ç‘°çš„æ•…äº‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is a story about a rose and a nightingale.</span><br></pre></td></tr></table></figure><blockquote><p><strong><code>å¯æ•°åè¯ä¸èƒ½å•ç‹¬ä½¿ç”¨</code></strong></p></blockquote><p>åœ¨ç‹å­çš„èˆä¼šä¸Šï¼Œé‚£ä¸ªæ‡‚çˆ±çš„å¹´è½»äººè¢«æ‹’ç»äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">At the party of prince, the young man understanding love was rejected.</span><br></pre></td></tr></table></figure><p>é‚£ä¸ªè¢«æŠ›å¼ƒçš„ç”·å­©çœ‹èµ·æ¥å¾ˆå¯æ€œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The dumped boy looks pitiful.</span><br><span class="line"></span><br><span class="line">The boy dumped looks pitiful.</span><br></pre></td></tr></table></figure><blockquote><p> å½“è¿‡å»åˆ†è¯ä¿®é¥°åè¯çš„æ—¶å€™å³ä½¿æ˜¯ä¸€ä¸ªå•è¯çš„æ—¶å€™éƒ½æ”¾åœ¨åè¯ä¹‹å</p></blockquote><h1 id="å®šè¯­ä»å¥"><a href="#å®šè¯­ä»å¥" class="headerlink" title="å®šè¯­ä»å¥"></a>å®šè¯­ä»å¥</h1><h2 id="ä»€ä¹ˆæ˜¯å®šè¯­ä»å¥"><a href="#ä»€ä¹ˆæ˜¯å®šè¯­ä»å¥" class="headerlink" title="ä»€ä¹ˆæ˜¯å®šè¯­ä»å¥?"></a>ä»€ä¹ˆæ˜¯å®šè¯­ä»å¥?</h2><p>æ‰¾ä¸ªå¥å­é™å®š<code>ä¸»å¹²éœ€è¦é™å®šçš„åè¯</code>(æˆ‘ä»¬å«<code>å…ˆè¡Œè¯</code>), å¹¶ä¸”ç”¨<code>å…³ç³»è¯</code>è¿æ¥èµ·æ¥, è€Œ<code>å…³ç³»è¯</code>å……å½“ä»å¥æˆåˆ†</p><blockquote><p>æ‰€ç™½äº†å°±æ˜¯ä¸¤ä¸ªå¥å­, æ‰¾ä¸ªç›¸åŒçš„åè¯, ç”¨å…³ç³»è¯ä»£æ›¿, å¹¶å°†å…³ç³»è¯æå‰, æœ€åè¿æ¥ä¸¤ä¸ªå¥å­</p><p><code>Law is discipline. discipline encourages responsible judgement.</code></p><p>å°†ä¸Šé¢ä¸¤ä¸ªå¥å­æ‰¾å‡ºç›¸åŒçš„åè¯è¿æ¥èµ·æ¥</p><p><code>Law is discipline(å…ˆè¡Œè¯) which(å…³ç³»è¯, è¿™é‡Œå«å…³ç³»ä»£è¯) encourages responsible judgment</code></p></blockquote><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><blockquote><p><strong><code>å®šè¯­ä»å¥çš„å…³ç³»è¯éƒ½åšæˆåˆ†</code></strong></p></blockquote><blockquote><p><strong><code>å…³ç³»è¯ = å…ˆè¡Œè¯</code></strong></p></blockquote><h3 id="æ„æˆ"><a href="#æ„æˆ" class="headerlink" title="æ„æˆ"></a>æ„æˆ</h3><blockquote><p><code>[åè¯(çŸ­è¯­)] + å¼•å¯¼è¯ + åˆ†å¥</code></p></blockquote><blockquote><p>åè¯ &lt;&#x3D;&#x3D;&gt; å…ˆè¡Œè¯, å¼•å¯¼è¯ &lt;&#x3D;&#x3D;&gt; å…³ç³»è¯</p></blockquote><h2 id="å…³ç³»è¯-å¼•å¯¼è¯"><a href="#å…³ç³»è¯-å¼•å¯¼è¯" class="headerlink" title="å…³ç³»è¯(å¼•å¯¼è¯)"></a>å…³ç³»è¯(å¼•å¯¼è¯)</h2><p>å®šè¯­ä»å¥çš„å¼•å¯¼è¯æ˜¯æŒ‰ç…§å…ˆè¡Œè¯çš„ç§ç±»åˆ†çš„ç±», ä¸€ç§æŠŠå¼•å¯¼è¯åˆ†æˆ 5 ç±»</p><ul><li>å½“å…ˆè¡Œè¯æ˜¯äººçš„æ—¶å€™å¼•å¯¼è¯æœ‰: that who whom whose</li><li>å½“å…ˆè¡Œè¯æ˜¯ç‰©çš„æ—¶å€™å¼•å¯¼è¯æœ‰: that which whose</li><li>å½“å…ˆè¡Œè¯æ˜¯æ—¶é—´çš„æ—¶å€™å¼•å¯¼è¯æœ‰: that which when</li><li>å½“å…ˆè¡Œè¯æ˜¯åœ°ç‚¹çš„æ—¶å€™æœ‰: that which where</li><li>å½“å…ˆè¡Œè¯æ˜¯åŸå› çš„æ—¶å€™: that which why</li></ul><p>åˆ°åº•æ˜¯è°å†³å®šäº†å®šè¯­ä»å¥çš„å¼•å¯¼è¯ç”¨æ³•?</p><p><code>I will never forget the day when I met you</code></p><blockquote><p>è¿™é‡Œä¸ºä»€ä¹ˆé€‰ when ? ä¸é€‰ that?</p><p>å› ä¸º that æ˜¯ä¸€ä¸ªä»£è¯, ä»£è¯èƒ½ä½œä¸º ä¸»è¯­ , å®¾è¯­ å’Œ è¡¨è¯­</p><p>æ˜æ˜¾ä¸Šé¢çš„ä»å¥ I met you çš„ä¸»è¯­ å®¾è¯­ è¡¨è¯­ éƒ½ä¸ç¼ºæˆåˆ†, æ‰€ä»¥ä¸èƒ½ç”¨ ä»£è¯ that </p><p>æ‰€ä»¥åªèƒ½é€‰æ‹© when , å› ä¸º when æ˜¯ å‰¯è¯ ä¸” å‰é¢çš„ the day è¡¨ç¤ºæ—¶é—´</p><p>å‰¯è¯ä¸èƒ½åš ä¸»è¯­, è°“è¯­, å®¾è¯­</p></blockquote><p><code>I will never forget the day that(which) we spent</code></p><blockquote><p>æ­£å¸¸äººçœ‹åˆ°å‰é¢çš„ the day ç¬¬ä¸€æ—¶é—´ä¸€èˆ¬éƒ½ä»¥ä¸ºè¿™é‡Œå¡«å†™ when ä½† when æ˜¯ä¸ªå‰¯è¯, ä»å¥ spent è¿‡å»åˆ†è¯åšè°“è¯­, è¡¨ç¤ºâ€èŠ±è´¹â€, å…·ä½“ç”¨å°½äº†ä»€ä¹ˆä¸çŸ¥é“, æ˜æ˜¾ç¼ºå°‘å®¾è¯­, åªèƒ½ç”¨ that æˆ–è€… which</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">You had better have some reason why you are late.</span><br><span class="line"></span><br><span class="line">You had better have some reason that/which sounds perfect.</span><br></pre></td></tr></table></figure><h3 id="åˆ°åº•æ˜¯ä»€ä¹ˆå†³å®šäº†å…³ç³»è¯ç”¨å“ªä¸€ä¸ª"><a href="#åˆ°åº•æ˜¯ä»€ä¹ˆå†³å®šäº†å…³ç³»è¯ç”¨å“ªä¸€ä¸ª" class="headerlink" title="åˆ°åº•æ˜¯ä»€ä¹ˆå†³å®šäº†å…³ç³»è¯ç”¨å“ªä¸€ä¸ª?"></a>åˆ°åº•æ˜¯ä»€ä¹ˆå†³å®šäº†å…³ç³»è¯ç”¨å“ªä¸€ä¸ª?</h3><p>æˆ‘ä»¬å†æ‹¿è¿™ä¸¤å¥åˆ¤æ–­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">I will never forget the day that(which) we spent</span><br><span class="line"></span><br><span class="line">I will never forget the day when I met you</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä¸Šé¢ä¸€å¥, å†™ that å´ä¸å†™ when ?</p><p>æˆ‘ä»¬å‘ç°<strong>ä»å¥å…¶å®ç¼ºå°‘æˆåˆ†</strong>, <code>spent(èŠ±è´¹)</code> ä»€ä¹ˆ? ç¼ºå°‘ å®¾è¯­</p><p><strong>é‚£ä¹ˆæˆ‘ä»¬å°±ä¸èƒ½é€‰ç”¨ when åšå…³ç³»è¯(è¿™é‡Œå«å…³ç³»å‰¯è¯)äº†</strong> </p><p>æ‰€ä»¥å®Œæ•´çš„ä¸¤å¥è¯åº”è¯¥æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">I will never forget the day.</span><br><span class="line">We spent the day.</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ the day è¡¨ç¤ºäº‹ç‰©, ç»å¯¹å¯ä»¥ç”¨ which , æ²¡æœ‰ç‰¹æ®Šæƒ…å†µè¿˜å¯ä»¥ç”¨ that</p><blockquote><p>æ€»ç»“: </p><ol><li>æ ¹æ®ä»å¥åˆ¤æ–­æ˜¯å¦ç¼ºå°‘æˆåˆ†</li><li>ä»ä¸»å¹²ä¸­æ‰¾å…ˆè¡Œè¯(ä¸€èˆ¬å’Œå…³ç³»è¯ç´§è´´åœ¨ä¸€èµ·, å½“ç„¶è¿˜æœ‰ç‰¹æ®Šæƒ…å†µ)</li><li>æ‰¾åˆ°å¯¹åº”çš„ å…ˆè¡Œè¯ å°†å…¶ä»£æ›¿æˆ å…³ç³»è¯</li><li>å°†å…³ç³»è¯æ”¾åœ¨ä»å¥å¥é¦–</li></ol></blockquote><p>é‚£ä¹ˆå¯¹äºä¸‹é¢é‚£å¥è¯å‘¢?  I will never forget the day when I met you</p><p>ä¸ºä»€ä¹ˆä¸‹é¢é‚£å¥è¯åˆå¯ä»¥ç”¨ when </p><p>æŒ‰ç…§ä¸Šé¢æ€»ç»“çš„æ–¹å¼çœ‹çœ‹</p><ol><li><p>ä»å¥ä¸ç¼ºå°‘æˆåˆ†, æ‰€ä»¥è¿™é‡Œéœ€è¦ç”¨ å…³ç³»å‰¯è¯ when where why</p></li><li><p>ä»ä¸»å¥ä¸­æ‰¾åè¯, ä»ä¸»å¥æœ«å°¾å¼€å§‹æ‰¾åè¯, æ‰¾åˆ°ä¸€ä¸ªåè¯ä»£æ›¿æ”¾å…¥ä»å¥çœ‹çœ‹æ˜¯å¦ç¬¦åˆ</p></li><li><p>the day æ˜¯æ—¶é—´, åˆåªèƒ½ç”¨ å…³ç³»å‰¯è¯, æ‰€ä»¥åªèƒ½ç”¨ when</p></li></ol><blockquote><p>æ³¨æ„: æˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€ç‚¹, å®šè¯­ä»å¥çš„å…ˆè¡Œè¯ä¸€èˆ¬æ˜¯æ¯”è¾ƒå®½æ³›çš„, æœ‰ç‚¹åƒåŒä½è¯­ä»å¥è¢«ä¿®é¥°åè¯çš„å¦ä¸€ç§è§£é‡Šä¸€æ ·, åŒä½è¯­ä»å¥æœ‰æŠ½è±¡åè¯, è€Œå®šè¯­ä»å¥çš„å…ˆè¡Œè¯ä¹Ÿå·®ä¸å¤šç±»ä¼¼æŠ½è±¡åè¯</p></blockquote><p>è¿˜æœ‰æ›´å¤šçš„ä¾‹å­</p><p>He is the man who loves me. åšä¸»è¯­,  who&#x2F;that</p><p>He is the man who&#x2F;whom I love. å¯ä»¥åšå®¾è¯­çš„ who&#x2F;whom</p><p>He is the man whose father is wealthy. å…ˆè¡Œè¯æ˜¯åè¯ äºº, æ‰€ä»¥ who whom whose, ç„¶å ä»å¥ä¸ç¼ºå°‘æˆåˆ†, åªèƒ½æ˜¯ whose</p><h2 id="å…³ç³»è¯æŒ‰ç…§æœ¬èº«çš„è¯æ€§åˆ†ç±»"><a href="#å…³ç³»è¯æŒ‰ç…§æœ¬èº«çš„è¯æ€§åˆ†ç±»" class="headerlink" title="å…³ç³»è¯æŒ‰ç…§æœ¬èº«çš„è¯æ€§åˆ†ç±»"></a>å…³ç³»è¯æŒ‰ç…§æœ¬èº«çš„è¯æ€§åˆ†ç±»</h2><ul><li>ä»£è¯(åœ¨ä»å¥ä¸­ä¸€å®šè¦å……å½“ä¸»è¯­æˆ–è€…å®¾è¯­çš„æˆåˆ†): who whom that which</li><li>å‰¯è¯(åœ¨ä»å¥ä¸­è¡¥å……å½“ä»»ä½•ä¸»å¹²æˆåˆ†): where when why</li><li>å½¢å®¹è¯(åœ¨ä»å¥ä¸­ä¿®é¥°ç¦»ä»–æœ€è¿‘çš„åè¯): whose</li></ul><p>æˆ‘å–œæ¬¢å±‹é¡¶æ˜¯åœ†çš„æˆ¿å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I love the house whose roofs are round.</span><br></pre></td></tr></table></figure><p>é‚£ä¸ªè€äººåœ¨å¥¹å„¿å­åˆ°è¾¾çš„é‚£å¤©å»ä¸–äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The old lady died on that day when her son arrived.</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åº”è¯¥å°Šé‡é‚£äº›åšæŒæ¢¦æƒ³çš„ç©·å­©å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">We should respect those children who stick to their dreams.</span><br></pre></td></tr></table></figure><p>å¥¹ä»æ¥éƒ½å–œæ¬¢çˆ¶æ¯æœ‰é’±çš„ç”·ç”Ÿ.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">She love the man whose parents are rich.</span><br><span class="line"></span><br><span class="line">Boys whose parents are rich never fail to fascinate her.</span><br></pre></td></tr></table></figure><p>æ¯äº²å‡ºç”Ÿçš„é‚£ä¸ªå°åŸé•‡è¿™ä¹ˆå¤šå¹´æ¥ä¸€ç›´æ˜¯æˆ‘å‘å¾€çš„åœ°æ–¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The town where my mother was born has always been an attraction for me over the years.</span><br></pre></td></tr></table></figure><h2 id="å®šè¯­ä»å¥çš„ç‰¹æ®Šç”¨æ³•"><a href="#å®šè¯­ä»å¥çš„ç‰¹æ®Šç”¨æ³•" class="headerlink" title="å®šè¯­ä»å¥çš„ç‰¹æ®Šç”¨æ³•"></a>å®šè¯­ä»å¥çš„ç‰¹æ®Šç”¨æ³•</h2><blockquote><p>å®šè¯­ä»å¥å…³ç³»è¯åšä»å¥å®¾è¯­æ—¶å¯ä»¥çœç•¥</p></blockquote><h3 id="å¦‚ä½•åˆ¤æ–­æ˜¯å¦çœç•¥äº†å…³ç³»è¯"><a href="#å¦‚ä½•åˆ¤æ–­æ˜¯å¦çœç•¥äº†å…³ç³»è¯" class="headerlink" title="å¦‚ä½•åˆ¤æ–­æ˜¯å¦çœç•¥äº†å…³ç³»è¯"></a>å¦‚ä½•åˆ¤æ–­æ˜¯å¦çœç•¥äº†å…³ç³»è¯</h3><blockquote><p>æˆ‘ä»¬å¯ä»¥ç”¨ è°“è¯­ åˆ¤æ–­, å¦‚æœä¸¤ä¸ªåŠ¨è¯éƒ½èƒ½å¤Ÿåšè°“è¯­, ä¸€èˆ¬å°±æœ‰ä¸€ä¸ªè°“è¯­æ˜¯ä»å¥çš„</p><p>å› ä¸ºä¸€ä¸ªè°“è¯­èƒ½å¤Ÿæè¿°ä¸€ä»¶äº‹æƒ…</p></blockquote><blockquote><p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ¤æ–­å¦‚æœä¸¤ä¸ª åè¯ è¿ç»­åœ¨ä¸€èµ·, ä¹Ÿå¯èƒ½æ˜¯çœç•¥äº† å…³ç³»è¯</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The potential evolution of today&#x27;s technology, and its social consequences, is dazzlingly complicated, and it&#x27;s perhaps best left to science-fiction writers and futurologists to explore the many possibilities we can envisage.</span><br></pre></td></tr></table></figure><p>çœ‹ä¸Šé¢çš„<code>possibilities we</code> è¿™ç§ä¸¤ä¸ªåè¯è¿ç»­åœ¨ä¸€èµ·çš„, ä¸€èˆ¬æƒ…å†µä¸‹è¢«è®¤ä¸ºçœç•¥äº†<code>that</code></p><h2 id="é™åˆ¶å’Œéé™åˆ¶å®šè¯­ä»å¥"><a href="#é™åˆ¶å’Œéé™åˆ¶å®šè¯­ä»å¥" class="headerlink" title="é™åˆ¶å’Œéé™åˆ¶å®šè¯­ä»å¥"></a>é™åˆ¶å’Œéé™åˆ¶å®šè¯­ä»å¥</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">He will call his friend who is working in London.</span><br><span class="line">He will call his mother, who is working in London.</span><br></pre></td></tr></table></figure><p>çœ‹ä¸Šé¢ä¸¤å¥è¯, åŒºåˆ«å°±åœ¨äº: </p><ol><li>æœ‹å‹æœ‰å¾ˆå¤šä¸ª, å¿…é¡»é™å®šä¸ºæŸä¸ª, æˆ–è€…æŸäº›, åé¢çš„ä»å¥åšäº†<code>é™å®šåŠŸèƒ½</code></li><li>å¦ˆåªæœ‰ä¸€ä¸ª(æ­£å¸¸æƒ…å†µ), æ‰€ä»¥æ ¹æœ¬ä¸éœ€è¦åé¢çš„ä»å¥é™å®š, åé¢çš„ä»å¥é¡¶å¤šåšäº†<code>è¡¥å……åŠŸèƒ½</code></li></ol><h3 id="å†³å®šå› ç´ "><a href="#å†³å®šå› ç´ " class="headerlink" title="å†³å®šå› ç´ "></a>å†³å®šå› ç´ </h3><blockquote><p>åè¯(å…ˆè¡Œè¯)èŒƒå›´æ˜ç¡®äº†, æ‰€ä»¥ä¸éœ€è¦é™å®š, åŠ ä¸Šäº† é€—å· </p></blockquote><ul><li><p>é™åˆ¶æ€§å®šè¯­ä»å¥å’Œå…ˆè¡Œè¯å…³ç³»ç´§å¯†, åˆ é™¤ä»å¥æ„æ€è¡¨ç¤ºä¸å®Œæ•´, éé™åˆ¶åä¹‹</p></li><li><p>é™åˆ¶æ€§å®šè¯­ä»å¥å‰é¢ä¸èƒ½æœ‰é€—å·, éé™åˆ¶åä¹‹</p></li><li><p>é™åˆ¶æ€§å®šè¯­ä»å¥å¯ä»¥ç”¨ that , éé™åˆ¶åä¹‹</p></li><li><p>é™åˆ¶æ€§å®šè¯­ä»å¥ä½œä¸ºå®¾è¯­å¯ä»¥çœç•¥ which&#x2F;that , éé™åˆ¶åä¹‹</p></li><li><p>é™åˆ¶æ€§å®šè¯­ä»å¥ä¸èƒ½æŒ‡å‰é¢ä¸€å¥è¯, éé™åˆ¶åä¹‹, å¯ä»¥ç¿»è¯‘æˆâ€å®ƒâ€¦â€</p></li><li><p>é™åˆ¶æ€§å®šè¯­ä»å¥ç¿»è¯‘æˆ â€œâ€¦çš„â€, éé™åˆ¶å®šè¯­ä»å¥è¡¨ç¤ºä¸¤ä¸ªç‹¬ç«‹çš„å¥å­</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Jane Eyre, whom I have learned a lot from, is a persistent lady.</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæ²¡è¿™ä¸ªé€—å·, è¿™ä¸ª whom è¿˜å¯ä»¥ç”¨ that</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">He said he had climbed up the top of the Everest, which I suspect very much.</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„ which æŒ‡çš„æ˜¯å‰é¢çš„ä¸€æ•´å¥è¯ <code>He said he had climbed up the top of the Everest</code></p></blockquote><p>ç¿»è¯‘æˆä¸¤ä¸ªç‹¬ç«‹çš„å¥å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Edison, whose inventions have been over 2,000ï¼Œis a famous scientist.</span><br></pre></td></tr></table></figure><p>ç¿»è¯‘æˆ â€œè¿™; å®ƒ; é‚£â€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The picture is fairly thought provoking, which intends to convey to us this message.</span><br></pre></td></tr></table></figure><h3 id="éé™åˆ¶å…³ç³»è¯ä¿®é¥°ä¸€ä¸ªå¥å­"><a href="#éé™åˆ¶å…³ç³»è¯ä¿®é¥°ä¸€ä¸ªå¥å­" class="headerlink" title="éé™åˆ¶å…³ç³»è¯ä¿®é¥°ä¸€ä¸ªå¥å­"></a>éé™åˆ¶å…³ç³»è¯ä¿®é¥°ä¸€ä¸ªå¥å­</h3><p>åªæœ‰ä¸¤ä¸ªå…³ç³»è¯æ‰èƒ½å¯åŠ¨ä¸€ä¸ªä»å¥ <code>as</code> å’Œ <code>which</code></p><p>A few generative rules are then sufficient to unfold the entire fundamental structure of a language, which is why children can learn it So quickly. </p><h2 id="ä»‹è¯å’Œå…³ç³»ä»£è¯å¼•å¯¼çš„å®šè¯­ä»å¥"><a href="#ä»‹è¯å’Œå…³ç³»ä»£è¯å¼•å¯¼çš„å®šè¯­ä»å¥" class="headerlink" title="ä»‹è¯å’Œå…³ç³»ä»£è¯å¼•å¯¼çš„å®šè¯­ä»å¥"></a>ä»‹è¯å’Œå…³ç³»ä»£è¯å¼•å¯¼çš„å®šè¯­ä»å¥</h2><h3 id="1-ä¸¤ç§å¸¸è§ç”¨æ³•"><a href="#1-ä¸¤ç§å¸¸è§ç”¨æ³•" class="headerlink" title="1.ä¸¤ç§å¸¸è§ç”¨æ³•"></a>1.ä¸¤ç§å¸¸è§ç”¨æ³•</h3><p>1)å…³ç³»å‰¯è¯åœ¨å®šè¯­ä»å¥ä¸­ä½œçŠ¶è¯­æ—¶,å¯ä»¥ç”¨â€œä»‹è¯+å…³ç³»ä»£è¯â€ä»£æ›¿å…³ç³»å‰¯è¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">This is the city where I have lived for 20 years.</span><br><span class="line">= This is the city in which I have lived for 20 years. </span><br></pre></td></tr></table></figure><p>åŸå¥ <code>This is the city where I have lived for 20 years.</code> è¿™å¥è¯å…¶å®çœç•¥äº†ä¸€ä¸ªä»‹è¯</p><p><code>This is the city where I have lived in for 20 years.</code> å› ä¸º <code>lived</code> æ˜¯ä¸åŠç‰©åŠ¨è¯, <code>lived in</code> å¿…é¡»è¦ä¸€ä¸ªä»‹è¯, ç‰¹åˆ«æ˜¯æ¢æˆ <code>which</code>ä¹‹å</p><p>2)å®šè¯­ä»å¥ä¸­çš„è°“è¯­ä¸ºâ€åŠ¨è¯+ä»‹è¯â€å¹¶ä¸”å…ˆè¡Œè¯åœ¨ä»å¥ä¸­ä½œå®¾è¯­æ—¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is a subject about which we might argue for a long while.</span><br></pre></td></tr></table></figure><blockquote><p>argue aboutâ€¦ æ˜¯æ‰€è°“çš„å›ºå®šæ­é…, è€Œåœ¨ä¸Šé¢çš„å®šè¯­ä»å¥ä¸­ about è¢«æå‰äº†</p><p>ä»å¥åº”è¯¥æ˜¯è¿™æ ·: we might argue about which for a long while</p></blockquote><h3 id="2-â€ä»‹è¯-å…³ç³»ä»£è¯â€-ä¸­ä»£è¯çš„é€‰æ‹©"><a href="#2-â€ä»‹è¯-å…³ç³»ä»£è¯â€-ä¸­ä»£è¯çš„é€‰æ‹©" class="headerlink" title="2.â€ä»‹è¯+å…³ç³»ä»£è¯â€ ä¸­ä»£è¯çš„é€‰æ‹©"></a>2.â€ä»‹è¯+å…³ç³»ä»£è¯â€ ä¸­ä»£è¯çš„é€‰æ‹©</h3><p>1)ä¿®é¥°äººæ—¶ï¼Œåªèƒ½ç”¨whom</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">He is the student with whom my teacher talked.</span><br></pre></td></tr></table></figure><blockquote><p>è®°ä½, æœ‰ä»‹è¯çš„æ—¶å€™ ä¸èƒ½ä½¿ç”¨ <code>that</code> </p><p>ä¸Šé¢çš„ <code>whom</code> å¥½åƒä¹Ÿå¯ä»¥ç”¨ <code>who</code> (æŸä½è€ƒç ”è€å¸ˆè¯´çš„), ä¸è¿‡æ—¢ç„¶åšäº†ä»å¥çš„å®¾è¯­, é‚£ä¹ˆæœ€å¥½è¿˜æ˜¯ä½¿ç”¨ <code>whom</code></p></blockquote><p>2)ä¿®é¥°ç‰©æ—¶ï¼Œåªèƒ½ç”¨which</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is the hotel at which Mr. Jason likes to stay.</span><br></pre></td></tr></table></figure><ol start="3"><li>whoseå¯ä»¥ç”¨of which&#x2F;whomæ›¿æ¢</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mr. Liu criticized the students whose/of whom homework hasn&#x27;t been handed in.</span><br><span class="line"></span><br><span class="line">We live in a house whose/of which windows open to the south. </span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸æ˜¯å±è¯ä¹ˆ? whose æœ¬æ¥å°±ç¿»è¯‘ è°çš„, of whom</p></blockquote><ol start="4"><li>the sameâ€¦ aså’Œthe sameâ€¦ thatå¼•å¯¼çš„å®šè¯­ä»å¥</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mr. Darcy is the same man as I love.</span><br><span class="line">Mr. Darcy is the same man that I love.</span><br></pre></td></tr></table></figure><blockquote><p>as åƒ, that æ˜¯</p></blockquote><p>the sameâ€¦ as :æ‰€å¼•å¯¼çš„ä»å¥å†…å®¹ä¸å…ˆè¡Œè¯åŒç±»è€Œä¸åŒç‰©,ç¿»è¯‘æˆâ€åƒâ€¦â€¦ä¸€æ ·çš„â€</p><p>the sameâ€¦ that :æ‰€å¼•å¯¼çš„ä»å¥å†…å®¹ä¸å…ˆè¡Œè¯åŒç±»ä¸”åŒç‰©,ç¿»è¯‘æˆâ€œæ­£æ˜¯â€¦â€¦â€</p><h2 id="aså’Œwhichå¼•å¯¼çš„éé™åˆ¶æ€§å®šè¯­ä»å¥"><a href="#aså’Œwhichå¼•å¯¼çš„éé™åˆ¶æ€§å®šè¯­ä»å¥" class="headerlink" title="aså’Œwhichå¼•å¯¼çš„éé™åˆ¶æ€§å®šè¯­ä»å¥"></a>aså’Œwhichå¼•å¯¼çš„éé™åˆ¶æ€§å®šè¯­ä»å¥</h2><h3 id="1-aså¼•å¯¼çš„ä»å¥å¯ä½äºå‰ã€ä¸­ã€åï¼Œç¿»è¯‘æˆâ€œæ­£å¦‚â€-whichåªèƒ½æ”¾åœ¨æ‰€ä¿®é¥°çš„å¥å­çš„åé¢"><a href="#1-aså¼•å¯¼çš„ä»å¥å¯ä½äºå‰ã€ä¸­ã€åï¼Œç¿»è¯‘æˆâ€œæ­£å¦‚â€-whichåªèƒ½æ”¾åœ¨æ‰€ä¿®é¥°çš„å¥å­çš„åé¢" class="headerlink" title="1)aså¼•å¯¼çš„ä»å¥å¯ä½äºå‰ã€ä¸­ã€åï¼Œç¿»è¯‘æˆâ€œæ­£å¦‚â€; whichåªèƒ½æ”¾åœ¨æ‰€ä¿®é¥°çš„å¥å­çš„åé¢"></a>1)aså¼•å¯¼çš„ä»å¥å¯ä½äºå‰ã€ä¸­ã€åï¼Œç¿»è¯‘æˆâ€œæ­£å¦‚â€; whichåªèƒ½æ”¾åœ¨æ‰€ä¿®é¥°çš„å¥å­çš„åé¢</h3><blockquote><p><strong><code>as å’Œ which çš„ç”¨æ³•éƒ½æ˜¯ä¸€æ ·çš„, è€Œ which åªèƒ½æ”¾åœ¨å¥æœ«, as èƒ½å¤Ÿæ”¾åœ¨ä»»ä½•ä½ç½®</code></strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">As is known to us all, man struggles upwards and water flows downwards.</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„ as å°±æ˜¯åé¢çš„ man struggles upwards and water flows downwards.è¿™å¥è¯</p><p>man struggles upwards and water flows downwards, as is known to us all.</p><p>man, as is known to us all struggles upwards and water flows downwards.</p><p>è¿™äº›å˜åŒ–éƒ½æ˜¯å¯ä»¥çš„</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Man struggles upwards and water flows downwards, which is known to us all.</span><br></pre></td></tr></table></figure><h3 id="2-ç´§è·Ÿasåçš„å¾€å¾€æ˜¯beåŠ¨è¯-è€Œwhichåå¯ä»¥è·Ÿä»»ä¸€ç±»å‹çš„åŠ¨è¯"><a href="#2-ç´§è·Ÿasåçš„å¾€å¾€æ˜¯beåŠ¨è¯-è€Œwhichåå¯ä»¥è·Ÿä»»ä¸€ç±»å‹çš„åŠ¨è¯" class="headerlink" title="2)ç´§è·Ÿasåçš„å¾€å¾€æ˜¯beåŠ¨è¯;è€Œwhichåå¯ä»¥è·Ÿä»»ä¸€ç±»å‹çš„åŠ¨è¯"></a>2)ç´§è·Ÿasåçš„å¾€å¾€æ˜¯beåŠ¨è¯;è€Œwhichåå¯ä»¥è·Ÿä»»ä¸€ç±»å‹çš„åŠ¨è¯</h3><ul><li>As is known to the United States, Mark Twain is a great writer.</li><li>He changed his mind, which made me very angry.</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">## å¼•å¯¼è¯whichå’Œthatçš„åŒºåˆ«</span><br><span class="line"></span><br><span class="line">è‡ªå·±åšç¬”è®°</span><br><span class="line"></span><br><span class="line">## å¼•å¯¼è¯whoå’Œthatçš„åŒºåˆ«</span><br><span class="line"></span><br><span class="line">è‡ªå·±åšç¬”è®°</span><br></pre></td></tr></table></figure><h2 id="åŒºåˆ†å®šè¯­ä»å¥å’ŒåŒä½è¯­ä»å¥"><a href="#åŒºåˆ†å®šè¯­ä»å¥å’ŒåŒä½è¯­ä»å¥" class="headerlink" title="åŒºåˆ†å®šè¯­ä»å¥å’ŒåŒä½è¯­ä»å¥"></a>åŒºåˆ†å®šè¯­ä»å¥å’ŒåŒä½è¯­ä»å¥</h2><ol><li>å®šè¯­ä»å¥æ˜¯ä¿®é¥°<code>which</code>, åŒä½è¯­ä»å¥æ˜¯è§£é‡Š<code>what</code></li><li>åŒä½è¯­ä»å¥è·Ÿåœ¨æŠ½è±¡åè¯ä¹‹å, å®šè¯­ä»å¥åé¢å¯ä»¥è·Ÿç€æŠ½è±¡å’Œä¸æŠ½è±¡</li><li>å®šè¯­ä»å¥çš„å…³ç³»è¯åšæˆåˆ†, åŒä½è¯­ä»å¥çš„å¼•å¯¼è¯ä¸åšæˆåˆ†</li><li>å®šè¯­ä»å¥æœ‰9ä¸ªå…ˆè¡Œè¯, åŒä½è¯­ä»å¥ä¸€èˆ¬åªæœ‰ that , å¶å°”æœ‰åˆ«çš„(å½“ä½ åœ¨è§£é‡Šä¸€ä¸ªåè¯çš„æ—¶å€™ä¸€èˆ¬éƒ½æ˜¯é™ˆè¿°å¥, æ‰€ä»¥ç»å¤§å¤šæ•°éƒ½æ˜¯ that), å¶å°”ä¼šè§åˆ° whether</li></ol><h2 id="å®šè¯­ä»å¥çš„è‡³éš¾ç‚¹-x3D-x3D-gt-æ‰¾å…ˆè¡Œè¯"><a href="#å®šè¯­ä»å¥çš„è‡³éš¾ç‚¹-x3D-x3D-gt-æ‰¾å…ˆè¡Œè¯" class="headerlink" title="å®šè¯­ä»å¥çš„è‡³éš¾ç‚¹ &#x3D;&#x3D;&gt; æ‰¾å…ˆè¡Œè¯"></a>å®šè¯­ä»å¥çš„è‡³éš¾ç‚¹ &#x3D;&#x3D;&gt; æ‰¾å…ˆè¡Œè¯</h2><p>The words used by the speacker may stir up unfavorable reactions in the listener which interface with his comprehension; hence, the transmission-reception system breaks down.</p><ol><li><p>å…ˆè¡Œè¯å’Œå…³ç³»è¯ ç›¸è¿</p><p>When someone abandons you, he is the one who should get loss because for him, he loses someone who loves him but for you, you lose someone who does not love you.</p></li><li><p>å®šè¯­ä»å¥çš„å…ˆè¡Œè¯æ˜¯ä»–å‰é¢çš„å‡ ä¸ªåè¯</p><p>For workers it can mean an end to the security, benefits and sense of importance that came from being a loyal employee.</p></li><li><p>å®šè¯­ä»å¥å…ˆè¡Œè¯æ˜¯å‰é¢ä¸€ä¸ªä»å¥(è€Œä¸”æ˜¯éé™åˆ¶æ€§å®šè¯­ä»å¥æ‰æœ‰)</p><p>The Greeks assumed that the structure of language had some connection with the process of thought, which took root in Europe C long before people realized how diverse languages could be.</p></li><li><p>å®šè¯­ä»å¥å…ˆè¡Œè¯å¯èƒ½æ˜¯å‰é¢ä¸€æ•´ä¸ªå¥å­</p><p>My husband enjoys talking with other young ladies, which really gets me go mad.</p></li><li><p>å…ˆè¡Œè¯è¢«ä¸€å¨ä¸œè¥¿éš”å¼€äº†</p><p>As a linguist, he acknowledges that all varieties of human language, including non-<br>standard ones like Black English, can be powerfully expressive â€“ there exists no<br>language or dialect in the world that cannot convey complex ideas.</p></li></ol><h1 id="è‹±æ±‰å·®å¼‚çš„å¯¹æ¯”"><a href="#è‹±æ±‰å·®å¼‚çš„å¯¹æ¯”" class="headerlink" title="è‹±æ±‰å·®å¼‚çš„å¯¹æ¯”"></a>è‹±æ±‰å·®å¼‚çš„å¯¹æ¯”</h1><ol><li>æ±‰è¯­æ„åˆ, è‹±è¯­å½¢åˆ<ol><li>å¥å­ç»“æ„, æ±‰è¯­åŸºæœ¬æ²¡æœ‰, è‹±è¯­å¿…é¡»è¦æœ‰</li><li>é€»è¾‘å…³ç³»è¯</li></ol></li><li>æ±‰è¯­å¤šä¸»åŠ¨, è‹±è¯­å¤šè¢«åŠ¨</li><li>æ±‰è¯­å¤šçŸ­å¥, è‹±è¯­å¤šé•¿å¥<ol><li>ç‹¬ç«‹ä¸»æ ¼&#x2F;éè°“è¯­åŠ¨è¯</li><li>å¹¶åˆ—å¥(è¿è¯)</li><li>ä¸»ä»å¤åˆå¥</li></ol></li></ol><h1 id="é•¿éš¾å¥åˆ†æ"><a href="#é•¿éš¾å¥åˆ†æ" class="headerlink" title="é•¿éš¾å¥åˆ†æ"></a>é•¿éš¾å¥åˆ†æ</h1><p>èƒ½å¤Ÿæ‰¾åˆ°å®šè¯­ä»å¥, ç„¶åæŠŠä»–ä»¬ç¿»è¯‘å‡ºæ¥</p><h2 id="å¦‚ä½•æ‰¾å®šè¯­"><a href="#å¦‚ä½•æ‰¾å®šè¯­" class="headerlink" title="å¦‚ä½•æ‰¾å®šè¯­?"></a>å¦‚ä½•æ‰¾å®šè¯­?</h2><p>æ‰¾å®šè¯­çš„å…³é”®å°±æ˜¯æ‰¾åè¯, åªè¦åè¯åæœ‰ä¸€å¨ä¸œè¥¿. åªè¦ä»–ä»¬ä¸æ˜¯åŠ¨è¯, å°±æš‚å®šä¸ºä¿®é¥°è¿™ä¸ªåè¯çš„å®šè¯­æˆåˆ†</p><blockquote><p>å¾ˆå¤šäººä¼šè¯´é‚£å®¾è¡¥å‘¢? å…¶å® å®¾è¡¥ ä¸ä¹Ÿä¿®é¥°è¿™ä¸ªåè¯çš„æˆåˆ†ä¹ˆ? åªä¸è¿‡ä¸æ˜¯å®šè¯­ </p></blockquote><p>ä½†åè¯åé¢è¿˜å¯ä»¥æ˜¯:</p><ol><li>å®šè¯­</li><li>åŒä½è¯­</li><li>è°“è¯­åŠ¨è¯</li><li>æ’å…¥è¯­(æ’å…¥è¯­å‰åæœ‰é€—å·)</li><li>çŠ¶è¯­</li></ol><h3 id="å®šè¯­ä»å¥ä»å“ªå¼€å§‹åˆ°å“ªç»“æŸ"><a href="#å®šè¯­ä»å¥ä»å“ªå¼€å§‹åˆ°å“ªç»“æŸ" class="headerlink" title="å®šè¯­ä»å¥ä»å“ªå¼€å§‹åˆ°å“ªç»“æŸ"></a>å®šè¯­ä»å¥ä»å“ªå¼€å§‹åˆ°å“ªç»“æŸ</h3><blockquote><p><strong>å®šè¯­ä»<code>åè¯</code>åå¼€å§‹é€šå¸¸åˆ°ä¸»å¥çš„è°“è¯­åŠ¨è¯ä¹‹å‰ç»“æŸ</strong></p><p><strong>å¦‚æœä»å¥åœ¨ä¸»å¥çš„è°“è¯­åŠ¨è¯ä¹‹å, åˆ™å®šè¯­å°±ä»åè¯åå¼€å§‹é€šå¸¸åˆ°(å¯èƒ½æœ‰çŠ¶è¯­æˆ–è€…è¿è¯)å¥æœ«ç»“æŸ</strong></p></blockquote><blockquote><p>æ³¨æ„: æ¯ä¸€ä¸ªå°å®šè¯­éƒ½æ˜¯åˆ°ä¸‹ä¸€ä¸ªåè¯ç»“æŸ, ä½†æ˜¯éœ€è¦æ³¨æ„æ˜¯ä¸æ˜¯å›ºå®šæ­é…</p></blockquote><blockquote><p>æ³¨æ„: å¦‚æœå®šè¯­åœ¨ä¸»å¥çš„è°“è¯­åŠ¨è¯ä¹‹å, å®šè¯­ä»åè¯åå¼€å§‹é€šå¸¸åˆ°å¥æœ«ç»“æŸ, ä½†æ˜¯å¦‚æœå®šè¯­åæœ‰è¿è¯çš„è¯, å®šè¯­ä¸å†åˆ°å¥æœ«ç»“æŸ, è€Œæ˜¯åˆ°è¿è¯ä¹‹å‰ç»“æŸ</p></blockquote><h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><ol><li><p>Astrophysicists working with ground-based detectors at the South Pole and balloon-borne instruments are closing in on such structures and may report their findings soon.</p></li><li><p><code>Astrophysicists</code> å¤©ä½“ç‰©ç†å­¦å®¶</p></li><li><p><code>ground-based detectors</code> è·¯åŸºæ¢æµ‹å™¨</p></li><li><p><code>balloon-borne</code> æ°”çƒè¿è½½çš„</p></li><li><p><code>are closing in on</code> æ­£åœ¨é€¼è¿‘çš„</p></li></ol><p><code>Astrophysicists</code> æ˜¯ä¸€ä¸ªåè¯, è¯´æ˜åé¢å¯èƒ½æ˜¯å®šè¯­, æ ¹æ®å‰é¢ç»™çš„å®šä¹‰, çœ‹åˆ°åé¢ä¸»å¹²çš„è°“è¯­ <code>are closing in on</code> , é‚£ä¹ˆè¿™ä¸­é—´éƒ½æ˜¯å®šè¯­(å½“ç„¶è¿˜æœ‰å¯èƒ½æ˜¯çŠ¶è¯­)</p><p><code>working with ground-based detectors at the South Pole and balloon-borne instruments</code> è¿™ä¸­é—´éƒ½æ˜¯å®šè¯­</p><p><code>working</code> æ˜¯åŠ¨åè¯, ä¸€èˆ¬åšå®šè¯­</p><p>è¿˜æœ‰å°å®šè¯­ â€œ<code>at the South Pole</code>â€œ åœ¨å—æçš„</p><p>ç¿»è¯‘ä¸‹ â€œå¤©ä½“ç‰©ç†å­¦å®¶ä»¥åœ¨å—æçš„åœ°åŸºæ¢æµ‹å™¨å’Œæ°”çƒè¿è½½å™¨ä¸ºå·¥ä½œæ‰‹æ®µâ€</p><p>åé¢çš„ and å†³å®šäº†ä¸¤ä¸ªå¥å­, åé¢çš„ <code>may report their findings soon</code> ç¼ºå°‘äº†å‰é¢çš„ä¸»è¯­, <code>report</code> æ˜¯åé¢ä¸€å¥çš„è°“è¯­, å’Œ <code>are closing in on</code>å¯¹åº”, æ‰€ä»¥<code>are closing in on</code> çš„ä¸»è¯­å°±æ˜¯ <code>report</code> çš„ä¸»è¯­, <code>Astrophysicists </code></p><p>ç¿»è¯‘æˆ â€œå¤©ä½“ç‰©ç†å­¦å®¶ä»¥åœ¨å—æçš„åœ°åŸºæ¢æµ‹å™¨å’Œæ°”çƒè¿è½½å™¨ä¸ºå·¥ä½œæ‰‹æ®µæ­£åœ¨é€¼è¿‘è¿™ç§ç»“æ„, å¹¶ä¸”ä»–ä»¬æˆ–è®¸èƒ½å¤Ÿé©¬ä¸Šæäº¤ä»–ä»¬çš„å‘ç°â€</p><ol start="2"><li>The second half of the 20th century saw a collection of geniuses, warriors, entrepreneurs and visionaries labor to create a fabulous machine that could<br>function as a typewriter and printing press, studio and theatre, paintbrush and gallery, piano and radio, the mail as well as the mail carrier.</li></ol><p>è°“è¯­æ˜¯ saw , é‚£ä¹ˆå‰é¢éƒ½è®¤ä¸ºæ˜¯ä¸»è¯­, åé¢éƒ½è®¤ä¸ºæ˜¯å®¾è¯­(saw åŠç‰©åŠ¨è¯, åé¢åªèƒ½æ˜¯å®¾è¯­)</p><p>geniuses å¤©æ‰, warriors å‹‡å£«, entrepreneurs ä¼ä¸šå®¶, visionaries labor æœ‰è§è¯†çš„åŠ³å·¥? , fabulous æå¥½çš„</p><p>ç¿»è¯‘æˆ â€œäºŒåä¸–çºªä¸‹åŠä¸ªä¸­å¶çœ‹è§äº†ä¸€ç¾¤å¤©æ‰, æœ‰å¿—ä¹‹å£«, ä¼ä¸šå®¶å’Œæœ‰è¿œè§çš„äººåˆ›é€ äº†ä¸€å°ç¥å™¨çš„æœºå™¨, è¿™å°æœºå™¨èƒ½å¤Ÿä½œä¸ºæ‰“å­—æœºå’Œå°åˆ·æœº, æ¼”æ’­å®¤å’Œå‰§é™¢, ç”»ç¬”å’Œç”»å»Š, æ„Ÿæƒ…å’Œæ”¶éŸ³æœº, é‚®ä»¶ä»¥åŠå‘é€é‚®ä»¶â€</p><p>After six months of arguing(å®šè¯­) and final 16 hours of hot parliamentary debates(å®šè¯­), Australiaâ€™s Northern Territory became(è°“è¯­) the first legal authority in the world to allow doctors to take the lives of incurably ill patients who wish to die.</p><p>became è°“è¯­</p><p>ä¸»å¹²ç¿»è¯‘ â€œæ¾³å¤§åˆ©äºšåŒ—éƒ¨ æˆä¸º ç¬¬ä¸€ä¸ªåˆæ³•æœºæ„â€</p><p>çŠ¶è¯­: After six months of arguing(å®šè¯­) and final 16 hours of hot parliamentary debates(å®šè¯­)</p><p>ä¸»è¯­: Australiaâ€™s Northern Territory</p><p>è°“è¯­: became</p><p>è¡¨è¯­: the first legal authority</p><p>å®šè¯­ä¸€: in the world   å…¨ä¸–ç•Œçš„ the first legal authority</p><p>å®šè¯­äºŒ: to allow doctors to take the lives å…è®¸åŒ»ç”Ÿå¸¦èµ°(ç»“æŸ)ç”Ÿå‘½</p><blockquote><p>allow sb to do sth</p></blockquote><p>å®šè¯­ä¸‰: of incurably ill patients </p><p>å®šè¯­ä»å¥å››:  who wish to die</p><p>ç¿»è¯‘æˆ â€œç»è¿‡å…­ä¸ªæœˆçš„è®¨è®ºå’Œå›½ä¼š16ä¸ªå°æ—¶æ¿€çƒˆçš„è®¨è®º, æ¾³å¤§åˆ©äºšåŒ—éƒ¨æˆä¸ºå…¨ä¸–ç•Œç¬¬ä¸€ä¸ªå…è®¸åŒ»ç”Ÿå¸¦èµ°å¸Œæœ›æ­»äº¡çš„ç»ç—‡ç—…äººç”Ÿå‘½çš„åˆæ³•æœºæ„â€</p><p>Whether to use tests, other kinds of information, or both in a particular situation depends, therefore, upon the evidence from experience concerning comparative validity and upon such factors as costs and availability.</p><p>è°“è¯­: depends</p><p>ä¸»è¯­: Whether to use tests, other kinds of information, or both in a particular situation</p><p>å®¾è¯­: upon the evidence from experience concerning comparative validity and upon such factors as costs and availability.</p><blockquote><p>å°±è¿™ä¹ˆç®€å•çš„è®¤ä¸ºå°±å¥½, ç­‰ä¼šå„¿æ‹†å¼€, ä¸€ä¸ªä¸€ä¸ªçœ‹</p></blockquote><p>æ’å…¥è¯­: , therefore, çŠ¶è¯­åšæ’å…¥è¯­, å¯ä»¥ç›´æ¥æåˆ°å¥å­å‰é¢</p><blockquote><p>çŠ¶è¯­ä¸€èˆ¬ä¿®é¥°çš„éƒ½æ˜¯åŠ¨è¯, è€ŒåŠ¨è¯ä¸€èˆ¬æ˜¯è¯´çš„ä¸€ä»¶äº‹, æ‰€ä»¥çŠ¶è¯­ä¹Ÿå¯ä»¥å½“ä½œä¿®é¥°ä¸€ä»¶äº‹(ä¸€å¥è¯), åªè¦ç¿»è¯‘å, æ‰¾åˆ°æ°å½“çš„ä½ç½®æ’å…¥çŠ¶è¯­çš„ç¿»è¯‘ä¾¿å¯</p></blockquote><p>Whether to use tests, other kinds of information, or both in a particular situation</p><p>çœ‹ä»‹è¯, to or(å…ˆå½“ä½œä»‹è¯) in</p><p>çœ‹å¥å­èƒ½å¤Ÿæ˜æ˜¾çš„çœ‹åˆ° to do xxx, yyy, or zzz è¿™ç§å½¢å¼çš„ä¸»è¯­</p><p>æ‰€ä»¥ or æ˜¯ è¿è¯ å¯èƒ½æœ‰çœç•¥éƒ¨åˆ† <code>Whether to use tests, to use other kinds of information, or to use both</code></p><p>in a particular situation ç¿»è¯‘æˆ: åœ¨ç‰¹å®šçš„æƒ…å†µä¸‹ æ˜æ˜¾æ˜¯<code>çŠ¶è¯­</code></p><blockquote><p>ä¸èƒ½ç¿»è¯‘æˆä»€ä¹ˆä»€ä¹ˆçš„<code>åè¯</code>, æˆ–è€…åšäº†<code>é™åˆ¶</code>æŸä¸ª<code>åè¯</code>åŠŸèƒ½çš„, éƒ½æ˜¯å®šè¯­, ä¸€èˆ¬ä¿®é¥°æ•´ä¸ªå¥å­</p></blockquote><p>ç¿»è¯‘: åœ¨ç‰¹å®šçš„æƒ…å†µä¸‹, æ˜¯å¦ä½¿ç”¨æµ‹è¯•, è¿˜æ˜¯ä½¿ç”¨å…¶ä»–ç§ç±»çš„ä¿¡æ¯, åˆæˆ–è€…æ˜¯ä¸¤è€…éƒ½ä½¿ç”¨ (ä¸»è¯­ç¿»è¯‘å®Œæ¯•)</p><p>æŠŠ åŠ¨è¯å¸¦ä¸Š</p><p>depends upon the evidence from experience concerning comparative validity and upon such factors as costs and availability.</p><p>depends upon ä¾èµ–äº</p><p>æ‰¾ä»‹è¯å’Œè¿è¯:  and  as</p><p>æ³¨æ„ and æ˜¯è¿è¯, æ˜æ˜¾æœ‰çœç•¥ : <code>(depends) and upon</code></p><blockquote><p>è®°ä½, <strong><code>å¦‚æœä¸€ä¸ªåè¯æ„æ€æ¯”è¾ƒå®½æ³›, ä¸€èˆ¬éƒ½ä¼šæœ‰å®šè¯­, ç”¨äºé™å®šåè¯</code></strong>, æ¯”å¦‚ä¸Šé¢çš„ <code>factors n. å› ç´ </code>, å“ªç§å› ç´ ? <code>evidence n. è¯æ˜;æ ¹æ®</code> ä»€ä¹ˆæ ·çš„è¯æ˜? <code>experience n. ç»éªŒ;ç»å†</code> ä»€ä¹ˆæ ·çš„ç»éªŒ?</p></blockquote><p>å®¾è¯­æ•´ä½“æ˜¯ depends upon xxx and depends upon yyy as n1 and n2</p><p>ç¿»è¯‘æˆ: â€œå–å†³äºæ¥è‡ªå…³äºç›¸å¯¹ç»éªŒçš„è¯æ˜å’Œå–å†³äºæˆæœ¬å’Œå¯ç”¨æ€§çš„å› ç´ â€</p><p>æ•´ä½“ç¿»è¯‘: åœ¨ç‰¹å®šçš„æƒ…å†µä¸‹, æ˜¯å¦ä½¿ç”¨æµ‹è¯•, è¿˜æ˜¯ä½¿ç”¨å…¶ä»–ç§ç±»çš„ä¿¡æ¯, åˆæˆ–è€…æ˜¯ä¸¤è€…éƒ½ä½¿ç”¨å–å†³äºæ¥è‡ªå…³äºç›¸å¯¹ç»éªŒçš„è¯æ˜å’Œå–å†³äºæˆæœ¬å’Œå¯ç”¨æ€§çš„å› ç´ </p><blockquote><p>æ‰¾å®šè¯­çš„å…³é”®åœ¨äºæ‰¾åè¯, åªè¦æ‰¾åˆ°çš„è¿™ä¸€å¨ä¸œè¥¿ä¸æ˜¯åŠ¨è¯, å°±æš‚å®šä¸ºå®šè¯­, å®šè¯­ä»åè¯åå¼€å§‹åˆ°ä¸»å¥è°“è¯­åŠ¨è¯ç»“æŸ, åˆæˆ–è€…å®šè¯­åœ¨ä¸»å¥çš„è°“è¯­åŠ¨è¯ä¹‹å, å¦‚æœåœ¨è°“è¯­åŠ¨è¯ä¹‹å, åˆ™å®šè¯­ä»åè¯å¼€å§‹åˆ°å¥æœ«, ä½†æ˜¯æœ‰è¿è¯çš„æ—¶å€™åˆ°è¿è¯ä¹‹å‰ç»“æŸ</p><p>ä¸€ä¸ªå¤§å®šè¯­ä¸­æœ‰å¾ˆå¤šå°å®šè¯­, æ¯ä¸ªå°å®šè¯­éƒ½åˆ°åè¯ä¹‹åç»“æŸ, ä¸€èˆ¬ç¿»è¯‘éƒ½è¦ä»åå¾€å‰ç¿»è¯‘, ä½†æ˜¯éœ€è¦æ³¨æ„å›ºå®šæ­é…, é‚£è¦æ€ä¹ˆåˆ¤æ–­å‘¢? ç¿»è¯‘å®Œçœ‹çœ‹æ˜¯è¿˜æ˜¯ä¸æ˜¯å°å®šè¯­çš„åè¯åç»“æŸ? å¦‚æœç¿»è¯‘ä¸é€šç•…, é‚£å°±å¯èƒ½æœ‰å›ºå®šæ­é…</p></blockquote><p>å¤–è¡¨çœ‹èµ·æ¥éå¸¸é‚‹é¢çš„ä»–å…¶å®å†…å¿ƒå¾ˆé«˜å°š</p><p>He who looks rather slovenly is really noble in nature.</p><p>åŠŸå¤«æ˜¯ä¸­å›½æ­¦æœ¯çš„ä¿—ç§°. ä¸­å›½æ­¦æœ¯çš„èµ·æºå¯ä»¥è¿½æº¯åˆ°èŒä½çš„éœ€è¦, ç‹©çŒæ´»åŠ¨ä»¥åŠå¤ä»£ä¸­å›½çš„å†›äº‹è®­ç»ƒ.</p><p>Kung Fu is the common name of Chinese martial arts which can be traced back to self-defense needs, hunting activities and millitary training in ancient China.</p><p>äººä»¬è¿˜ä¼šåœ¨é—¨ä¸Šç²˜è´´å¯¹è”(couplets) å¯¹è”çš„ä¸»é¢˜æœ‰å¥åº·, å‘è´¢å’Œå¥½è¿.</p><p>Doors will be decorated with couplets whose topics are involved in health, weather and good luck.</p><p>ç»§çˆ¶ç»å¸¸åœ¨å‡æœŸé‡Œå¸¦å¥¹å‡ºå›½æ—…æ¸¸, è¿™ä½¿å¥¹æ„Ÿåˆ°åœ¨åŒå­¦é¢å‰å¾ˆéª„å‚².</p><p>Her stepfather often takes her to travel abroad during the vaction, which makes her feel proud in front of her classmates.</p><blockquote><p>æ³¨æ„: ä¸Šé¢çš„ which çš„éé™åˆ¶å®šè¯­ä»å¥, which æŒ‡å‰é¢ä¸€å¥è¯</p></blockquote><p>å‰ªçº¸(paper cutting) æ˜¯ä¸­å›½æœ€ä¸ºæµè¡Œçš„ä¼ ç»Ÿæ°‘é—´è‰ºæœ¯å½¢å¼ä¹‹ä¸€. ä¸­å›½å‰ªçº¸æœ‰ä¸€åƒäº”ç™¾å¤šå¹´çš„å†å², åœ¨æ˜æœå’Œæ¸…æœæœŸé—´(the Ming and Qing Dynastices)ç‰¹åˆ«æµè¡Œ.</p><p>Paper cutting is one of the most popular arts in China which has a 1500-year history and was quite famous in the Ming and Qing dynamices.</p><p>é‚£äº›å…¨åŠ›ä»¥èµ´å»å®ç°æ¢¦æƒ³çš„äºº, å³ä½¿æœ€ç»ˆæ²¡æœ‰æˆåŠŸä¹Ÿä¸ä¼šæ„Ÿåˆ°é—æ†¾, è¿™å¾ˆé‡è¦.</p><p>Those sparing no efforts to realize their dreams will never feel regretful even if they fail finally, which is quite significant.</p><p>é‚£äº›è¯¾å ‚ä¸Šä¸é›†ä¸­ç²¾åŠ›, åˆå¸Œæœ›é€šè¿‡è€ƒè¯•çš„å­¦ç”Ÿ, å¸¸å¸¸å‘ç°ç»“æœå¹¶ä¸èƒ½ä»¤äººæ»¡æ„.</p><p>Those who fail to concentrate in class but hope to pass the examination often find that the consequence is unsatisfactory.</p><p>é•¿æ±Ÿæµç»å¤šç§ä¸åŒçš„ç”Ÿæ€ç³»ç»Ÿ, æ˜¯è¯¸å¤šæ¿’å±ç‰©ç§çš„æ –æ¯åœ°, çŒæº‰äº†ä¸­å›½äº”åˆ†ä¹‹ä¸€çš„åœŸåœ°.</p><p>The Yangzi River flowing through different ecological systems is the habitat of plentiful endangered animals, irrigating one fifth of Chinaâ€™s lang.</p>]]></content>
      
      
      <categories>
          
          <category> è‹±è¯­ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒä½è¯­ä»å¥ </tag>
            
            <tag> å½¢å®¹è¯ </tag>
            
            <tag> å®šè¯­ </tag>
            
            <tag> å®šè¯­ä»å¥ </tag>
            
            <tag> å…³ç³»è¯ </tag>
            
            <tag> å…³ç³»ä»£è¯ </tag>
            
            <tag> éé™åˆ¶å…³ç³»è¯ </tag>
            
            <tag> é™åˆ¶æ€§å®šè¯­ä»å¥ </tag>
            
            <tag> éé™åˆ¶æ€§å®šè¯­ä»å¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>03åè¯æ€§ä»å¥(å……å½“ä¸»å¹²æˆåˆ†çš„ä»å¥)</title>
      <link href="/2022/11/25/06%E8%8B%B1%E8%AF%AD/03%E5%90%8D%E8%AF%8D%E6%80%A7%E4%BB%8E%E5%8F%A5/"/>
      <url>/2022/11/25/06%E8%8B%B1%E8%AF%AD/03%E5%90%8D%E8%AF%8D%E6%80%A7%E4%BB%8E%E5%8F%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="â˜…åè¯æ€§ä»å¥-ä¸»è¯­-å®¾è¯­-è¡¨è¯­-åŒä½è¯­ä»å¥"><a href="#â˜…åè¯æ€§ä»å¥-ä¸»è¯­-å®¾è¯­-è¡¨è¯­-åŒä½è¯­ä»å¥" class="headerlink" title="â˜…åè¯æ€§ä»å¥(ä¸»è¯­, å®¾è¯­, è¡¨è¯­, åŒä½è¯­ä»å¥):"></a>â˜…åè¯æ€§ä»å¥(<code>ä¸»è¯­, å®¾è¯­, è¡¨è¯­, åŒä½è¯­ä»å¥</code>):</h1><h2 id="â˜…åè¯-çŸ­è¯­-èƒ½åšä»€ä¹ˆæˆåˆ†"><a href="#â˜…åè¯-çŸ­è¯­-èƒ½åšä»€ä¹ˆæˆåˆ†" class="headerlink" title="â˜…åè¯(çŸ­è¯­)èƒ½åšä»€ä¹ˆæˆåˆ†?"></a>â˜…åè¯(çŸ­è¯­)èƒ½åšä»€ä¹ˆæˆåˆ†?</h2><h3 id="â˜…ä¸»è¯­"><a href="#â˜…ä¸»è¯­" class="headerlink" title="â˜…ä¸»è¯­"></a>â˜…ä¸»è¯­</h3><p><code>The movie is encouraging.</code></p><h3 id="â˜…å®¾è¯­"><a href="#â˜…å®¾è¯­" class="headerlink" title="â˜…å®¾è¯­"></a>â˜…å®¾è¯­</h3><p><code>I appreciate his mother.</code></p><h3 id="â˜…è¡¨è¯­"><a href="#â˜…è¡¨è¯­" class="headerlink" title="â˜…è¡¨è¯­"></a>â˜…è¡¨è¯­</h3><p><code>Gump is a real man.</code></p><h3 id="â˜…åŒä½è¯­"><a href="#â˜…åŒä½è¯­" class="headerlink" title="â˜…åŒä½è¯­"></a>â˜…åŒä½è¯­</h3><p><code>I enjoy the part,the end.</code></p><h4 id="â˜…åŒä½è¯­å°±æ˜¯ç”¨æ¥è§£é‡Šä¸€ä¸ªåè¯çš„æˆåˆ†-å¯ä»¥åœ¨åè¯ååŠ ä¸Šå¦ä¸€ä¸ªåè¯ä½œä¸ºä»–çš„åŒä½è¯­-ä½†å‰åéœ€è¦ç”¨é€—å·éš”å¼€"><a href="#â˜…åŒä½è¯­å°±æ˜¯ç”¨æ¥è§£é‡Šä¸€ä¸ªåè¯çš„æˆåˆ†-å¯ä»¥åœ¨åè¯ååŠ ä¸Šå¦ä¸€ä¸ªåè¯ä½œä¸ºä»–çš„åŒä½è¯­-ä½†å‰åéœ€è¦ç”¨é€—å·éš”å¼€" class="headerlink" title="â˜…åŒä½è¯­å°±æ˜¯ç”¨æ¥è§£é‡Šä¸€ä¸ªåè¯çš„æˆåˆ†, å¯ä»¥åœ¨åè¯ååŠ ä¸Šå¦ä¸€ä¸ªåè¯ä½œä¸ºä»–çš„åŒä½è¯­, ä½†å‰åéœ€è¦ç”¨é€—å·éš”å¼€"></a>â˜…<strong>åŒä½è¯­å°±æ˜¯ç”¨æ¥è§£é‡Šä¸€ä¸ªåè¯çš„æˆåˆ†, å¯ä»¥åœ¨åè¯ååŠ ä¸Šå¦ä¸€ä¸ªåè¯ä½œä¸ºä»–çš„åŒä½è¯­, ä½†å‰åéœ€è¦ç”¨é€—å·éš”å¼€</strong></h4><p><code>English, a worldwide language, is playing a key role in out communication with others</code></p><ul><li>æ±¡æŸ“è¶Šæ¥è¶Šä¸¥é‡äº†</li></ul><p><code>Pollution, a universal issue throughout the world, become increasingly serious.</code></p><ul><li>æˆ‘ä»¬åº”è¯¥æ”¯æŒå›½è´§</li></ul><p><code>We, Chinese customers, should support our domestic products.</code></p><blockquote><h4 id="â˜…ç”¨ä¸€ä¸ªåè¯è§£é‡Šå¦ä¸€ä¸ªåè¯-è®°ä½è¿™é‡Œæ˜¯åŒä½è¯­ä¸æ˜¯åŒä½è¯­ä»å¥"><a href="#â˜…ç”¨ä¸€ä¸ªåè¯è§£é‡Šå¦ä¸€ä¸ªåè¯-è®°ä½è¿™é‡Œæ˜¯åŒä½è¯­ä¸æ˜¯åŒä½è¯­ä»å¥" class="headerlink" title="â˜…ç”¨ä¸€ä¸ªåè¯è§£é‡Šå¦ä¸€ä¸ªåè¯, è®°ä½è¿™é‡Œæ˜¯åŒä½è¯­ä¸æ˜¯åŒä½è¯­ä»å¥"></a>â˜…ç”¨ä¸€ä¸ªåè¯è§£é‡Šå¦ä¸€ä¸ªåè¯, è®°ä½è¿™é‡Œæ˜¯åŒä½è¯­ä¸æ˜¯åŒä½è¯­ä»å¥</h4></blockquote><h3 id="â˜…ä»€ä¹ˆæ˜¯ä»å¥"><a href="#â˜…ä»€ä¹ˆæ˜¯ä»å¥" class="headerlink" title="â˜…ä»€ä¹ˆæ˜¯ä»å¥?"></a>â˜…ä»€ä¹ˆæ˜¯ä»å¥?</h3><blockquote><h4 id="â˜…è¿æ¥è¯-åˆ†å¥-è¿æ¥è¯-x2F-å…³ç³»è¯-x2F-ä»å±è¿è¯-ä¸»è¯­-è°“è¯­"><a href="#â˜…è¿æ¥è¯-åˆ†å¥-è¿æ¥è¯-x2F-å…³ç³»è¯-x2F-ä»å±è¿è¯-ä¸»è¯­-è°“è¯­" class="headerlink" title="â˜…è¿æ¥è¯ + åˆ†å¥(è¿æ¥è¯&#x2F;å…³ç³»è¯&#x2F;ä»å±è¿è¯ + ä¸»è¯­ + è°“è¯­)"></a>â˜…<code>è¿æ¥è¯</code> + åˆ†å¥(è¿æ¥è¯&#x2F;å…³ç³»è¯&#x2F;ä»å±è¿è¯ + ä¸»è¯­ + è°“è¯­)</h4></blockquote><h2 id="â˜…æ˜¯ä»€ä¹ˆåè¯æ€§ä»å¥"><a href="#â˜…æ˜¯ä»€ä¹ˆåè¯æ€§ä»å¥" class="headerlink" title="â˜…æ˜¯ä»€ä¹ˆåè¯æ€§ä»å¥?"></a>â˜…æ˜¯ä»€ä¹ˆåè¯æ€§ä»å¥?</h2><p><strong><code>åœ¨å¥å­ä¸­ç›¸å½“äºåè¯æ€§è´¨çš„ä»å¥å«åè¯æ€§ä»å¥</code></strong></p><ol><li><p><code>What I saw repeatedly is encouraging.</code> ä¸»è¯­ä»å¥</p></li><li><p><code>I appreciate what his mother said.</code> å®¾è¯­ä»å¥</p></li><li><p><code>Gump is who we should learn from.</code> è¡¨è¯­ä»å¥</p></li><li><p><del><code>I enjoy the part that a feather is flying in the sky.</code> å®šè¯­ä»å¥ï¼ˆæ˜¯å½¢å®¹è¯æ€§ä»å¥ï¼‰</del></p></li></ol><p>â˜…<code>åè¯åœ¨å¥å­ä¸­èƒ½å¤Ÿå……å½“ä»€ä¹ˆæˆåˆ†, ä»å¥åœ¨å¥å­ä¸­å°±ä¹Ÿèƒ½å……å½“ä»€ä¹ˆæˆåˆ†, è¿™å°±æ˜¯åè¯æ€§ä»å¥, åè¯æ€§ä»å¥ä¸€å…±åŒ…æ‹¬4ç§: 1. ä¸»è¯­ä»å¥; 2. å®¾è¯­ä»å¥; 3. è¡¨è¯­ä»å¥; 4. åŒä½è¯­ä»å¥</code></p><p>è€Œ <code>ä»å¥ = è¿æ¥è¯ + å¥å­</code></p><blockquote><p><strong><code>åè¯æ€§ä»å¥å¯ä»¥çœ‹æˆåè¯, åè¯èƒ½åšä»€ä¹ˆ, åè¯æ€§ä»å¥ä¹Ÿèƒ½åšä»€ä¹ˆ</code></strong></p></blockquote><h2 id="â˜…åè¯æ€§ä»å¥çš„è¿æ¥è¯"><a href="#â˜…åè¯æ€§ä»å¥çš„è¿æ¥è¯" class="headerlink" title="â˜…åè¯æ€§ä»å¥çš„è¿æ¥è¯"></a>â˜…åè¯æ€§ä»å¥çš„è¿æ¥è¯</h2><p>è¿æ¥è¯çš„åŠŸèƒ½æœ‰ä¸‰ï¼š</p><ol><li><p>è¿æ¥</p></li><li><p>è¿æ¥ + ä»£è¯</p></li><li><p>è¿æ¥ + å‰¯è¯</p></li></ol><p>è¿æ¥è¯ï¼šthatï¼Œwhetherï¼Œifï¼Œas ifï¼Œas though ï¼ˆä¸å……å½“æˆåˆ†ï¼‰</p><p>è¿æ¥ä»£è¯ï¼šwhoï¼Œwhomï¼Œwhatï¼Œwhichï¼Œwhose ï¼ˆå……å½“ï¼šä¸»å®¾è¡¨å®šï¼‰</p><p>è¿æ¥å‰¯è¯ï¼šwhenï¼Œwhereï¼Œwhyï¼Œhowï¼ˆå……å½“çŠ¶è¯­ï¼‰</p><blockquote><p>å¯¹æ¯”å®šè¯­ä»å¥ï¼š</p><p>å…³ç³»ä»£è¯ï¼šwhoï¼Œwhomï¼Œwhichï¼Œthatï¼Œwhoseï¼Œasï¼ˆå……å½“ï¼šä¸»å®¾è¡¨å®šï¼‰</p><p>å…³ç³»å‰¯è¯ï¼šwhenï¼Œwhereï¼Œwhyï¼ˆå……å½“çŠ¶è¯­ï¼‰</p></blockquote><h3 id="æ€ä¹ˆåˆ¤æ–­è¦ä½¿ç”¨å“ªä¸ªè¿æ¥è¯ï¼Ÿ"><a href="#æ€ä¹ˆåˆ¤æ–­è¦ä½¿ç”¨å“ªä¸ªè¿æ¥è¯ï¼Ÿ" class="headerlink" title="æ€ä¹ˆåˆ¤æ–­è¦ä½¿ç”¨å“ªä¸ªè¿æ¥è¯ï¼Ÿ"></a>æ€ä¹ˆåˆ¤æ–­è¦ä½¿ç”¨å“ªä¸ªè¿æ¥è¯ï¼Ÿ</h3><p>æ ¹æ®ä»å¥ç¼ºå°‘ä»€ä¹ˆå»åˆ¤æ–­ä½¿ç”¨ä»€ä¹ˆï¼Œæˆ–è€…å‡è®¾ä»å¥ä¿®æ”¹æˆç–‘é—®å¥ï¼Œä½ è¦ç”¨ä»€ä¹ˆè¿æ¥è¯ï¼Ÿè‡ªç„¶å°±çŸ¥é“éœ€è¦ä»€ä¹ˆè¿æ¥è¯</p><p>æ¯”å¦‚ï¼šæˆ‘çŸ¥é“ä½ æ˜¨å¤©ä¹°äº†ä»€ä¹ˆã€‚</p><p><code>I know you buy yesterday what</code></p><p><code>what</code>æå‰åˆ°ä»å¥å‰é¢</p><p><code>I know what you buy yesterday.</code></p><h2 id="æ€ä¹ˆå†™ä¸ªåè¯æ€§ä»å¥ï¼Ÿ"><a href="#æ€ä¹ˆå†™ä¸ªåè¯æ€§ä»å¥ï¼Ÿ" class="headerlink" title="æ€ä¹ˆå†™ä¸ªåè¯æ€§ä»å¥ï¼Ÿ"></a>æ€ä¹ˆå†™ä¸ªåè¯æ€§ä»å¥ï¼Ÿ</h2><ol><li><p>é™ˆè¿°å¥</p><p>ã€ä¸»å¥ã€‘+ã€that(æ— è¯ä¹‰)ã€‘+ã€é™ˆè¿°å¥çš„ä»å¥ã€‘</p></li><li><p>ä¸€èˆ¬ç–‘é—®å¥</p><p>ã€ä¸»å¥ã€‘+ã€whether&#x2F;ifã€‘+ã€å˜æˆé™ˆè¿°å¥çš„ä¸€èˆ¬ç–‘é—®å¥ã€‘</p></li><li><p>ç‰¹æ®Šç–‘é—®å¥</p><p>ã€ä¸»å¥ã€‘+ã€å˜æˆé™ˆè¿°å¥çš„ç‰¹æ®Šç–‘é—®å¥ã€‘ï¼ˆè¿è¯è‡ªå¸¦ï¼‰</p></li></ol><p>åè¯æ€§çš„è¿æ¥è¯æ˜¯æŒ‰ç…§ä»å¥çš„ç±»å‹åˆ†çš„ç±», ä¸€å…±æŠŠè¿æ¥è¯åˆ†ä¸ºä¸‰ç±»</p><ol><li><h4 id="â˜…-å½“ä»å¥æ˜¯é™ˆè¿°å¥æ—¶-å¯ä»¥ä½¿ç”¨-that-å¹¶ä¸”-that-æ²¡æœ‰ä»»ä½•æ„æ€"><a href="#â˜…-å½“ä»å¥æ˜¯é™ˆè¿°å¥æ—¶-å¯ä»¥ä½¿ç”¨-that-å¹¶ä¸”-that-æ²¡æœ‰ä»»ä½•æ„æ€" class="headerlink" title="â˜…**å½“ä»å¥æ˜¯é™ˆè¿°å¥æ—¶, å¯ä»¥ä½¿ç”¨ that , å¹¶ä¸” that æ²¡æœ‰ä»»ä½•æ„æ€**"></a>â˜…**<code>å½“ä»å¥æ˜¯é™ˆè¿°å¥æ—¶, å¯ä»¥ä½¿ç”¨ that , å¹¶ä¸” that æ²¡æœ‰ä»»ä½•æ„æ€</code>**</h4></li><li><h4 id="â˜…-whether-å½“ä»å¥æ˜¯ä¸€èˆ¬ç–‘é—®å¥æ—¶-è¡¥å……å½“ä»»ä½•æˆåˆ†-ä½†æ„æ€æ˜¯-quot-æ˜¯å¦-quot"><a href="#â˜…-whether-å½“ä»å¥æ˜¯ä¸€èˆ¬ç–‘é—®å¥æ—¶-è¡¥å……å½“ä»»ä½•æˆåˆ†-ä½†æ„æ€æ˜¯-quot-æ˜¯å¦-quot" class="headerlink" title="â˜…**whether å½“ä»å¥æ˜¯ä¸€èˆ¬ç–‘é—®å¥æ—¶, è¡¥å……å½“ä»»ä½•æˆåˆ†, ä½†æ„æ€æ˜¯ &quot;æ˜¯å¦&quot;**"></a>â˜…**<code>whether å½“ä»å¥æ˜¯ä¸€èˆ¬ç–‘é—®å¥æ—¶, è¡¥å……å½“ä»»ä½•æˆåˆ†, ä½†æ„æ€æ˜¯ &quot;æ˜¯å¦&quot;</code>**</h4></li><li><h4 id="â˜…-æ‰€æœ‰çš„ç‰¹æ®Šç–‘é—®å¥-å¼€å¤´çš„é‚£ä¸ªè¯å°±æ˜¯è¿æ¥è¯"><a href="#â˜…-æ‰€æœ‰çš„ç‰¹æ®Šç–‘é—®å¥-å¼€å¤´çš„é‚£ä¸ªè¯å°±æ˜¯è¿æ¥è¯" class="headerlink" title="â˜…**æ‰€æœ‰çš„ç‰¹æ®Šç–‘é—®å¥: å¼€å¤´çš„é‚£ä¸ªè¯å°±æ˜¯è¿æ¥è¯**"></a>â˜…**<code>æ‰€æœ‰çš„ç‰¹æ®Šç–‘é—®å¥: å¼€å¤´çš„é‚£ä¸ªè¯å°±æ˜¯è¿æ¥è¯</code>**</h4></li><li><h4 id="â˜…-å¹¶ä¸”è‹±è¯­ä¸­æ‰€æœ‰ä»å¥ä¸€å®šéƒ½æ˜¯é™ˆè¿°å¥-ä¹Ÿå°±æ˜¯-è¿æ¥è¯-ä¸»è¯­-è°“è¯­-çš„å½¢å¼"><a href="#â˜…-å¹¶ä¸”è‹±è¯­ä¸­æ‰€æœ‰ä»å¥ä¸€å®šéƒ½æ˜¯é™ˆè¿°å¥-ä¹Ÿå°±æ˜¯-è¿æ¥è¯-ä¸»è¯­-è°“è¯­-çš„å½¢å¼" class="headerlink" title="â˜…**å¹¶ä¸”è‹±è¯­ä¸­æ‰€æœ‰ä»å¥ä¸€å®šéƒ½æ˜¯é™ˆè¿°å¥, ä¹Ÿå°±æ˜¯ [è¿æ¥è¯ + ä¸»è¯­ + è°“è¯­] çš„å½¢å¼**"></a>â˜…**<code>å¹¶ä¸”è‹±è¯­ä¸­æ‰€æœ‰ä»å¥ä¸€å®šéƒ½æ˜¯é™ˆè¿°å¥, ä¹Ÿå°±æ˜¯ [è¿æ¥è¯ + ä¸»è¯­ + è°“è¯­] çš„å½¢å¼</code>**</h4></li></ol><blockquote><p> å¦‚æœä¸€èˆ¬ç–‘é—®å¥ä¿®é¥°çš„æ˜¯å®¾è¯­, åˆ™å¯ä»¥ç”¨ <code>if</code> , å…¶ä»–æ—¶å€™ä¸èƒ½ç”¨, å¦‚æœç»“å°¾ç”± <code>or not</code> ä¹Ÿä¸èƒ½ç”¨ <code>if</code>ï¼Œæœ‰ä»‹è¯ä¹Ÿä¸èƒ½ç”¨ <code>if</code></p></blockquote><h3 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><ul><li>æˆ‘æƒ³çŸ¥é“äººä¸ºä»€ä¹ˆç”Ÿæ´»åœ¨åœ°çƒä¸Š</li></ul><p><code>I wonder why human beings live on the earth (å®¾è¯­ä»å¥)</code></p><ul><li>å¥¹æˆåŠŸçš„æ‰¾åˆ°äº†ä¸ªæœ‹å‹, è¿™ä½¿æˆ‘å¾ˆå¼€å¿ƒ</li></ul><p><code>That she succeeded in finding a friend makes me happy(ä¸»è¯­ä»å¥)</code></p><ul><li>æœ‰ä¸€å¤©ä½ ä¼šå‘ç°, äº‹ä¸š, äº²æƒ…, å‹æƒ…éƒ½æ¯”çˆ±æƒ…é‡è¦</li></ul><p><code>Someday, you will find that careers, kinship and friendship are more important than love itself.(å®¾è¯­ä»å¥)</code></p><ul><li><p>ä»–ä»¬ç¦»å¼€å®¶ä¹¡å»è¥¿è—çš„åŸå› æ˜¯ä¸€ä¸ªè°œå›¢.</p><p><code>That they left their hometown for Tibet is a mystery.(ä¸»è¯­ä»å¥)</code></p></li><li><p>æˆ‘æ­£åœ¨æ€è€ƒæˆ‘æ˜¯å¦å’Œå¥³æœ‹å‹åˆ†æ‰‹</p></li></ul><p><code>I am reflecting whether I should separate with my girlfriend.(å®¾è¯­ä»å¥)</code></p><ul><li>æ˜¨å¤©æ˜¯ä¸€ä¸ªå†å², æ˜å¤©æ˜¯ä¸€ä¸ªè°œ, ä½†æ˜¯ä»Šå¤©æ˜¯ä¸€ä¸ªç¤¼ç‰©, è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒå«åšâ€presentâ€</li></ul><p><code>Yesterday is history. tomorrow is a mystery. but today is gift. That is why it&#39;s called the present. (è¡¨è¯­ä»å¥)</code></p><blockquote><p>â˜…ä¸»è¯­ä»å¥ç»å¸¸è¢«æ”¹æˆ <code>It is</code> å½¢å¼, <code>It makes me happy that she succeeded in finding a friend.</code></p></blockquote><p>å¥³äººæ€»æ˜¯å¯¹çš„æ˜¯ä¸€ä¸ªå¸¸è¯†ã€‚</p><p><code>That ladies tend to be right is common knowledge. </code>(å±, åº”è¯¥æ˜¯å¥³äººæ€»è®¤ä¸ºè‡ªå·±æ˜¯å¯¹çš„)</p><p>è¯»ä¹¦çš„ç›®çš„æ˜¯æ¶¤è¡æˆ‘ä»¬çš„çµé­‚ï¼Œè¿™æ˜¯æ¯åº¸ç½®ç–‘çš„ã€‚</p><p><code>That reading is to purify our minds is beyond dispute.</code></p><h3 id="â˜…-ä¸»è¯­ä»å¥å¸¸è§è¡¨è¾¾-ä¸€ä¸€-itæ–¹å¼æ”¹é€ ä¸»è¯­ä»å¥"><a href="#â˜…-ä¸»è¯­ä»å¥å¸¸è§è¡¨è¾¾-ä¸€ä¸€-itæ–¹å¼æ”¹é€ ä¸»è¯­ä»å¥" class="headerlink" title="â˜… ä¸»è¯­ä»å¥å¸¸è§è¡¨è¾¾ ä¸€ä¸€ itæ–¹å¼æ”¹é€ ä¸»è¯­ä»å¥"></a>â˜… ä¸»è¯­ä»å¥å¸¸è§è¡¨è¾¾ ä¸€ä¸€ <code>it</code>æ–¹å¼æ”¹é€ ä¸»è¯­ä»å¥</h3><p><code>It is common knowledge that...</code> æ˜¾è€Œæ˜“è§, ä¼—æ‰€å‘¨çŸ¥<br><code>It is my belief that...</code>æˆ‘è®¤ä¸º<br><code>It is self-evident that...</code> æ˜¾è€Œæ˜“è§, ä¼—æ‰€å‘¨çŸ¥<br><code>It has been found that...</code>  æ˜¾è€Œæ˜“è§, ä¼—æ‰€å‘¨çŸ¥<br><code>It is beyond dispute that... ...</code>   æ˜¾è€Œæ˜“è§, ä¼—æ‰€å‘¨çŸ¥<br><code>It is universally acknowledged that...</code> æ˜¾è€Œæ˜“è§, ä¼—æ‰€å‘¨çŸ¥<br><code>It has been widely accepted that...</code>æ˜¾è€Œæ˜“è§, ä¼—æ‰€å‘¨çŸ¥<br><code>It is generally agreed that...</code> æ˜¾è€Œæ˜“è§, ä¼—æ‰€å‘¨çŸ¥</p><blockquote><p>æœ¬å¥å‹å¯ä»¥å†™åœ¨ä½œæ–‡ä¸­ä»»ä½•ä¸€å¥è¯çš„å‰é¢</p></blockquote><p>ç§¯æçš„å¿ƒæ€å¯¹äºæˆåŠŸè‡³å…³é‡è¦,è¿™æ˜¯ä¸€ä¸ªå¸¸è¯†ã€‚</p><p><code>It is common knowledge that a positive attitude plays a key role in our success.</code></p><blockquote><p><code>plays a key role in + sth</code> åœ¨ä»€ä¹ˆä¸­æ‰®æ¼”é‡è¦è§’è‰²</p></blockquote><p>æˆ‘è®¤ä¸ºå…»å® ç‰©è¿™ä¸ªè¯é¢˜ç°åœ¨åº”è¯¥å¼•èµ·äººä»¬çš„å…³æ³¨äº†ã€‚</p><p><code>It is my belief that the issue about raising pets should be brought into the limelight under modern conditions.</code></p><h1 id="æ€ä¹ˆåˆ¤æ–­æ˜¯åè¯æ€§ä»å¥"><a href="#æ€ä¹ˆåˆ¤æ–­æ˜¯åè¯æ€§ä»å¥" class="headerlink" title="æ€ä¹ˆåˆ¤æ–­æ˜¯åè¯æ€§ä»å¥?"></a>æ€ä¹ˆåˆ¤æ–­æ˜¯åè¯æ€§ä»å¥?</h1><p><strong><code>åˆ¤æ–­ä¸»å¹²æ˜¯å¦ç¼ºå°‘åè¯æˆåˆ†ï¼Œç„¶åå†åˆ¤æ–­ä»å¥æ˜¯å¦ä»£æ›¿äº†ä¸»å¹²çš„æˆåˆ†ï¼Œä»£æ›¿äº†å“ªä¸ªæˆåˆ†å°±å«ä»€ä¹ˆä»å¥</code></strong></p><h2 id="â˜…å¦‚ä½•è¯†åˆ«ä¸»è¯­ä»å¥"><a href="#â˜…å¦‚ä½•è¯†åˆ«ä¸»è¯­ä»å¥" class="headerlink" title="â˜…å¦‚ä½•è¯†åˆ«ä¸»è¯­ä»å¥?"></a>â˜…å¦‚ä½•è¯†åˆ«ä¸»è¯­ä»å¥?</h2><p>â˜…**<code>åªè¦è§åˆ°æœ‰è¿æ¥è¯æ”¾åœ¨å¥é¦–, å¹¶ä¸”ä»å¥ä¹‹åæ²¡æœ‰è¢«é€—å·éš”å¼€, å°±ä¸€å®šæ˜¯ä¸»è¯­ä»å¥, ä¸»è¯­ä»å¥ä»å¥é¦–å¼€å§‹åˆ°ä¸»å¥çš„è°“è¯­åŠ¨è¯ä¹‹å‰ç»“æŸ, é™¤æ­¤ä»¥å¤–è§åˆ° it ... that é€šå¸¸ä¹Ÿæ˜¯ä¸»è¯­ä»å¥, ä¸»è¯­ä»å¥ä»thatå¼€å§‹åˆ°å¥æœ«ç»“æŸ, it åšäº†å½¢å¼ä¸»è¯­</code>**</p><blockquote><h4 id="â˜…-çŠ¶è¯­ä»å¥æ”¾åœ¨å¥é¦–ä¸€èˆ¬åé¢éƒ½æœ‰é€—å·"><a href="#â˜…-çŠ¶è¯­ä»å¥æ”¾åœ¨å¥é¦–ä¸€èˆ¬åé¢éƒ½æœ‰é€—å·" class="headerlink" title="â˜…**çŠ¶è¯­ä»å¥æ”¾åœ¨å¥é¦–ä¸€èˆ¬åé¢éƒ½æœ‰é€—å·**"></a>â˜…**<code>çŠ¶è¯­ä»å¥æ”¾åœ¨å¥é¦–ä¸€èˆ¬åé¢éƒ½æœ‰é€—å·</code>**</h4></blockquote><blockquote><h4 id="â˜…å¼ºè°ƒå¥å‹ä¹Ÿæ˜¯-it-that-ä½†æ˜¯åç»­ä¼šå­¦åˆ°è¯†åˆ«å¼ºè°ƒå¥å‹çš„æ–¹å¼"><a href="#â˜…å¼ºè°ƒå¥å‹ä¹Ÿæ˜¯-it-that-ä½†æ˜¯åç»­ä¼šå­¦åˆ°è¯†åˆ«å¼ºè°ƒå¥å‹çš„æ–¹å¼" class="headerlink" title="â˜…å¼ºè°ƒå¥å‹ä¹Ÿæ˜¯ it ... that , ä½†æ˜¯åç»­ä¼šå­¦åˆ°è¯†åˆ«å¼ºè°ƒå¥å‹çš„æ–¹å¼"></a><strong><code>â˜…å¼ºè°ƒå¥å‹ä¹Ÿæ˜¯ it ... that , ä½†æ˜¯åç»­ä¼šå­¦åˆ°è¯†åˆ«å¼ºè°ƒå¥å‹çš„æ–¹å¼</code></strong></h4></blockquote><blockquote><p>â˜…**<code>åŒä½è¯­ä»å¥æ˜¯è§£é‡Šåè¯ï¼Œå®šè¯­ä»å¥æ˜¯ä¿®é¥°ã€é™åˆ¶åè¯ã€‚ä¸¤è€…è¿æ¥è¯ä¸åŒï¼Œä¸”thatå¼•å¯¼åŒä½è¯­ä»å¥æ—¶ï¼Œä¸å……å½“å¥å­æˆåˆ†ï¼Œè€Œå¼•å¯¼å®šè¯­æ—¶ï¼Œè¦ä¹ˆå……å½“å®šè¯­ä»å¥çš„ä¸»è¯­ï¼Œè¦ä¹ˆå……å½“å®šè¯­ä»å¥çš„å®¾è¯­</code>**</p></blockquote><p><code>That the plates are moving is now beyond dispute.</code> æ¿å—æ­£åœ¨ç§»åŠ¨æ˜¯æ¯‹åº¸ç½®ç–‘çš„</p><blockquote><p>å•è¯æ€ä¹ˆç¿»è¯‘, å¿…é¡»è¦æœ‰è¯­å¢ƒ, å¦åˆ™ä¸Šé¢çš„ <code>plates</code>å•çº¯æŒ‰ç…§æ„æ€å¯èƒ½è¢«ç¿»è¯‘æˆç›˜å­æ­£åœ¨ç§»åŠ¨</p></blockquote><p><code>Whether the Government should increase the financing of pure science at the expense of technology or vice versa often depends on the issue of which is seen as the driving force.</code></p><p>æ‰¾è°“è¯­<code>depends on</code></p><p>å‰é¢çš„ä¸€æ®µå…¨éƒ½ç®—æ˜¯ä¸»è¯­(é™¤äº† <code>often</code>)</p><p>æ”¿åºœæ˜¯åº”è¯¥ä»¥ç‰ºç‰²æŠ€æœ¯ä¸ºä»£ä»·å¢åŠ å¯¹çº¯ç§‘å­¦çš„æŠ•å…¥æˆ–è€…ä»¥ç‰ºç‰²çº¯ç§‘å­¦ä¸ºä»£ä»·å¢åŠ æŠ€æœ¯æŠ•å…¥ç»å¸¸å–å†³äºå“ªä¸€ä¸ªè¢«è§†ä¸ºæ˜¯é©±åŠ¨åŠ›çš„é—®é¢˜</p><p><code>How well the predications will be validated by later performance depends upon the amount, reliability, and appropriateness of the information used and on the skill and wisdom with which it is interpreted.</code></p><ol><li><strong><code>â˜…æ‰¾åˆ°ä¸€å¥è¯ä¸­çš„æ‰€æœ‰æˆåˆ†</code></strong></li><li>â˜…**<code>ç¿»è¯‘å„ä¸ªæˆåˆ†</code>**</li><li>â˜…**<code>ç”¨ä¸­å›½äººçš„æ–¹å¼ç»„åˆç¿»è¯‘å‡ºæ¥</code>**</li></ol><p>æ‰¾åˆ°è°“è¯­<code>depends upon</code>ç¿»è¯‘æˆ<code>å–å†³äº</code>, æ‰€ä»¥å‰é¢çš„å¥å­éƒ½çœ‹ä½œæ˜¯ä¸»è¯­â€<code>How well the predications will be validated by later performance</code>â€œ</p><p>ç¿»è¯‘æˆ &#x3D;&#x3D;&gt; é¢„è¨€å°†ä¼šè¢«ä»¥åçš„è¡¨ç°å¤šå¥½çš„éªŒè¯å‡ºæ¥å– &#x3D;&#x3D;&gt; A</p><p>A è¿™å–å†³äºæ‰€ä½¿ç”¨æ¶ˆæ¯çš„æ•°é‡, å¯é æ€§å’Œé€‚å½“æ€§ and è§£é‡Šå®ƒçš„æŠ€å·§å’Œæ™ºæ…§</p><blockquote><p>ç¿»è¯‘èƒ½åŠ›è¿˜æ˜¯ä¸å¤Ÿå•Š, ä¸Šé¢çš„å¥å­ä¸­, æœ€åçš„ <code>which it is interpreted</code> æ˜¯ä»€ä¹ˆè¯­? æˆ‘åˆ¤æ–­é”™è¯¯äº†, ä»¥ä¸ºæ˜¯çŠ¶è¯­ä»å¥(è¿˜æ˜¯å¯¹çŸ¥è¯†ç‚¹è¿ç”¨ä¸å¤ªç†Ÿæ‚‰). </p><p>è¿™é‡Œå…·ä½“åˆ†æä¸‹ä¸Šé¢çš„é‚£å¥è¯çš„æˆåˆ†, æ—¢ç„¶å‰é¢æ˜¯ä¸ªå¹¶åˆ—å¥<code>and</code>, é‚£ä¹ˆè‡³å°‘ä¿è¯å‰é¢çš„å¥å­æ˜¯å®Œæ•´çš„, è¯´æ˜ä¸»å¹²æ˜¯å®Œæ•´çš„, é‚£ä¹ˆåªèƒ½åœ¨åŒä½è¯­ä»å¥, å®šè¯­ä»å¥å’ŒçŠ¶è¯­ä»å¥ä¸­é€‰æ‹©</p><p>åŒä½è¯­ä»å¥çš„è¯ä¸€èˆ¬æ˜¯ä»¥<code>that</code> åšè¿æ¥è¯, ä½†è¿™é‡Œä¸æ˜¯, è€Œä¸”åœ¨è¿æ¥è¯ä¸­åŒä½è¯­çš„è¿æ¥è¯å…¶å®ä¸é‡è¦, å¯ä»¥åˆ é™¤æ‰, ä¸å½±å“åŒä½è¯­è‡ªå·±(ä¸è¿‡è¿™é‡Œå…¶å®ä¹Ÿä¸å½±å“)</p><p>çŠ¶è¯­ä»å¥, æš‚ä¸”ä¸è°ˆ</p><p>è€Œè¿™é‡Œæ˜¯å®šè¯­ä»å¥, with which it is interpretedæ•´ä¸ªå¥å­éƒ½ä¿®é¥°çš„å‰é¢çš„on the skill and wisdom, <code>it is interpreted with which</code>, è¯´å¾—é€š, é‚£ä¹ˆä»–çš„<strong>å…ˆè¡Œè¯</strong>æ˜¯<code>the skill and wisdom</code>, å°±å˜æˆäº†<code>it is interpreted with the skill and wisdom</code>, â€œä½¿ç”¨æŠ€å·§å’ŒæŒ‡æŒ¥è§£é‡Šå®ƒçš„â€</p></blockquote><blockquote><p>ä¸Šé¢çš„ <code>it is interpreted</code>è¿˜æœ‰ä¸ªå‘, å°±æ˜¯ <code>it</code>, å®ƒæœ‰ä¸ªåŸåˆ™å°±æ˜¯å¾€å‰é¢æ‰¾, æ‰¾åˆ°ç¬¦åˆä»–çš„åè¯(å› ä¸ºä»–æ˜¯ä»£è¯), ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„æ˜¯<code>the skill and wisdom</code>ä½†æ˜æ˜¾ä¸æ˜¯, <code>which</code>å·²ç»æŒ‡å‘å®ƒ, åš<code>it is interpreted with the skill and wisdom</code>æ•´ä¸ªè¯­å¥ä¸­çš„çŠ¶è¯­äº†, æ‰€ä»¥è¿˜å¾—å¾€å‰æ‰¾, æœ€ç»ˆæ‰¾åˆ°<code>the information</code>, æ‰€ä»¥æ•´å¥çš„ç¿»è¯‘å˜æˆâ€ä½¿ç”¨æŠ€å·§å’Œæ™ºæ…§æ¥è§£é‡Šæ¶ˆæ¯â€</p></blockquote><p>æ˜æ˜¾çœç•¥äº†</p><p>æ‰¾çœç•¥äº†å•¥? <code>[ä»‹è¯ + åè¯ + å®šè¯­]</code> åœ¨å‰é¢æ‰¾æ‰¾</p><p>&#96;&#96;How well the predications will be validated by later performance depends upon the amount, reliability, and appropriateness of the information used&#96;</p><p>æ‰¾åˆ°äº† <code>upon the amount, reliability, and appropriateness of the information used</code></p><blockquote><p>è¿™é‡Œæœ‰ä¸‰ä¸ªåè¯, æ˜æ˜¾ä¸å¯¹, å˜æˆä¸€ä¸ªæ‰€ä»¥æ˜¯ <code>[ä»‹è¯ + åè¯ + å®šè¯­]</code></p></blockquote><p>çœç•¥äº† è°“è¯­ <code>depends</code>, æ‰€ä»¥ç¿»è¯‘è‡ªç„¶å°±å‡ºæ¥äº†</p><p><code>How well the predications will be validated by later performance depends upon the amount, reliability, and appropriateness of the information used and depends on the skill and wisdom with which it is interpreted.</code></p><p>é¢„æµ‹å°†ä¼šå¤šå¤§ç¨‹åº¦ä¸Šè¢«åé¢çš„è¡¨ç°æ‰€éªŒè¯å–å†³äºä½¿ç”¨è¿™äº›ä¿¡æ¯çš„æ•°é‡ã€å¯é æ€§å’Œé€‚å½“æ€§ï¼Œå¹¶ä¸”è¿˜å–å†³äºè§£é‡Šä¿¡æ¯çš„æŠ€å·§å’Œæ™ºæ…§ã€‚</p><p><code>These libraries are optional on most of the systems and if the feature they add is desired, corresponding libraries need to be installed before running configure</code></p><p>æ‰¾åˆ°è°“è¯­: <code>are</code> , ä¸»è¯­: <code>These libraries</code>, è¡¨è¯­æ˜¯<code>optional</code> çš„ä¸»ç³»è¡¨ç»“æ„ è¿™æ˜¯ä¸»å¹²</p><p><code>on most of the systems</code> åœ¨å¤šæ•°çš„ç³»ç»Ÿä¸Š</p><p><code>and if the feature they add is desired, corresponding libraries need to be installed before running configure</code> </p><p>æ‰¾æ‰€æœ‰å¯èƒ½çš„è°“è¯­</p><p>add is need </p><p><code>add</code>çš„è¯, å‰é¢çš„æ˜¯<code>if å’Œ they</code> åé¢æ˜¯å¦ä¸€ä¸ªåŠ¨è¯, è¯´æ˜æ˜¯ä»å¥ï¼ˆifæŠµæ¶ˆäº†addåŠ¨è¯ï¼‰, è¿™é‡Œå¤§æ¦‚ç‡æ˜¯å®šè¯­ä»å¥, ç”¨äºä¿®é¥°å…ˆè¡Œè¯ <code>the feature</code></p><p>ç¿»è¯‘æˆå¦‚æœä»–ä»¬æ·»åŠ çš„ç‰¹æ€§</p><p><code>is</code> ä¹Ÿæ˜¯ä¸ªè°“è¯­, çœ‹å¥å­åˆ†æè¿˜æ˜¯ä»å¥çš„, å‰é¢æ˜¯å¦ä¸€ä¸ªä»å¥, è¿™é‡Œæˆ‘è§‰å¾—æ˜¯ å®šè¯­ä»å¥ , æŠŠå‰é¢çš„ <code>that</code> ä¹Ÿæ”¾è¿™ä¸€å¥ä¸­äº†, å˜æˆäº† <code>that is</code></p><p>ä»å¥çš„è°“è¯­æ˜¯ : <code>need</code> , ä¸»è¯­å°±æ˜¯ <code>the feature</code>, å®¾è¯­æ˜¯<code>to be installed</code>è¿™é‡Œæ˜¯åŠ¨è¯ä¸å®šå¼åšå®¾è¯­(éè°“è¯­åŠ¨è¯çš„è¢«åŠ¨å½¢æ€)</p><p>æ•´å¥çš„ç¿»è¯‘æ˜¯</p><p>if the feature need to be installed before running configure</p><p>å¦‚æœè¿™äº›ç‰¹æ€§éœ€è¦è¢«å®‰è£…, è¿™åœ¨è¿™ä¹‹å‰éœ€è¦è¿è¡Œ<code>configure</code></p><p><code>that is desired, corresponding libraries</code> è¿™å¥è¯åº”è¯¥æ˜¯åŒä½è¯­</p><p>ç”¨äºè§£é‡Š <code>the feature</code>, è¯‘ä¸º: â€œéœ€è¦å¹¶ä¸”ç¬¦åˆçš„åº“â€</p><p><code>They add</code> åšçŠ¶è¯­</p><p>It is generally agreed that a person of high intelligence is one who can grasp ideas readily, make distinctions, reason logically, and make use of verbal and mathematical symbols in solving problems.</p><ol><li>is è°“è¯­</li><li>è¿™æ˜¯ä¸€ä¸ª it åšå½¢å¼ä½œäºçš„ ä» that å¼€å§‹åˆ°ç»“å°¾çš„ä¸»è¯­ä»å¥ç»“æ„</li><li>ä»å¥å†…éƒ¨çš„ è°“è¯­ æ˜¯ is, ä¸»è¯­æ˜¯ a person , è¡¨è¯­æ˜¯ one ä¸»ç³»è¡¨ç»“æ„</li><li>ä»å¥å†…éƒ¨æœ‰å‡ ä¸ªéƒ¨åˆ† grasp ideas readily, make distinctions, reason logically, and make use of verbal and mathematical symbols in solving problems</li></ol><p>ä¼—æ‰€å‘¨çŸ¥çš„, ä¸€ä¸ªé«˜æ™ºå•†çš„äººæ˜¯ä¸€ä¸ªèƒ½å¤Ÿè½»æ˜“æŠ“ä½çµæ„Ÿçš„, èƒ½å¤Ÿåˆ†è¾¨äº‹ç‰©, èƒ½å¤Ÿåˆ¤æ–­é€»è¾‘çš„å’Œèƒ½å¤Ÿç”¨è¯­è¨€å’Œæ•°å­¦ç¬¦å·è§£å†³é—®é¢˜çš„äºº</p><p>For example, it has long been known that total sleep deprivation is 100 percent fatal to rats, yet, upon examination of the dead bodies, the animals look completely normal.</p><ol><li>æ‰¾è°“è¯­</li><li>has long been know , it å¼•å¯¼çš„ä¸»è¯­ä»å¥, è¡¨ç¤ºå¾ˆé•¿æ—¶é—´å·²ç»çŸ¥é“</li><li>is, ä»å¥çš„ç³»åŠ¨è¯, è¡¨ç¤ºç™¾åˆ†ç™¾å‰¥å¤ºç¡çœ , å®Œå…¨å‰¥å¤ºç¡çœ å¯¹äºè€é¼ æ¥è¯´éå¸¸è‡´å‘½</li><li>look, ç³»åŠ¨è¯, åŠ¨ç‰©çœ‹èµ·æ¥å®Œå…¨æ­£å¸¸</li></ol><p>æ•´ä½“ç¿»è¯‘ä¸‹: æ¯”å¦‚è¯´, å¾ˆé•¿æ—¶é—´å‰æˆ‘ä»¬å°±çŸ¥é“, å®Œå…¨å‰¥å¤ºç¡çœ å¯¹äºè€é¼ æ¥è¯´æ˜¯éå¸¸è‡´å‘½çš„, ç„¶è€Œæ ¹æ®å°¸ä½“çš„æ£€æŸ¥, è¿™äº›åŠ¨ç‰©çœ‹èµ·æ¥å®Œå…¨æ­£å¸¸</p><p>It has long been known that a taxi firm called AAAA cars has a big advantage over Zodiac cars when customers thumb through their phone directories.</p><ol><li>æ‰¾è°“è¯­</li><li>called , ä½†ä¸æ˜¯, å› ä¸ºåé¢è¿˜æœ‰ä¸ª has, ä¸€ä¸ªå¥å­ä¸­ç»å¯¹ä¸èƒ½æœ‰ä¸¤ä¸ªåŠ¨è¯, æ‰€ä»¥ called åº”è¯¥è¿˜æœ‰åˆ«çš„ç¿»è¯‘, è¿™é‡Œåªèƒ½æ˜¯è¿‡å»åˆ†è¯, ç¿»è¯‘æˆ ç§°ä½œ</li><li>has, æœ‰, hasåªæœ‰ä¸€ä¸ªè¯æ€§, å°±æ˜¯åŠ¨è¯, è€Œ has å‰é¢é™¤äº† that å°±æ²¡æœ‰è¿æ¥è¯äº†, æ‰€ä»¥å¯¹äºä»å¥æ¥è¯´ has æ˜¯è°“è¯­</li><li>thumb through, ç¿»é˜…</li></ol><p>å‘¨æ‰€å‘¨çŸ¥, å½“ç”¨æˆ·æ»‘åŠ¨æ‰‹æœºé€šè®¯å½•çš„æ—¶å€™, ä¸€å®¶å‡ºç§Ÿè½¦å…¬å¸åå­—å«AAAAçš„è½¦æ¯”åå­—å«Zodiacçš„è½¦çš„æ‹¥æœ‰å·¨å¤§çš„ä¼˜åŠ¿.</p><p>Furthermore, it is obvious that the strength of a countryâ€™s economy is directly bound up with the efficiency of its agriculture and industry, and that this in turn rests upon the efforts of scientists and technologists of all kinds.</p><ol><li>è°“è¯­</li><li>is, ä¸»ç³»è¡¨ç»“æ„, è¡¨ç¤ºæ˜¾è€Œæ˜“è§</li><li>is, ä»å¥çš„è°“è¯­, ä»å¥å·¦è¾¹æ˜¯â€ä¸€ä¸ªå›½å®¶çš„ç»æµå®åŠ›â€, å³è¾¹æ˜¯â€ç›´æ¥ç»‘å®šä»–çš„å†œä¸šå’Œå·¥ä¸šçš„æ•ˆç‡â€</li><li>rests upon, ä¾èµ–äº è°“è¯­, è¿™åè¿‡æ¥ ä¸º ä¸»è¯­</li></ol><p>æ­¤å¤–, æ˜¾è€Œæ˜“è§çš„, ä¸€ä¸ªå›½å®¶çš„ç»æµå®åŠ›ç›´æ¥ç»‘å®šäºå†œä¸šå’Œå·¥ä¸šçš„æ•ˆç‡, è€Œåè¿‡æ¥ä¾èµ–äºå…¨ä½“ç§‘å­¦å®¶å’ŒæŠ€æœ¯ä¸“å®¶çš„åŠªåŠ›.</p><h2 id="â˜…å¦‚æœè¯†åˆ«å®¾è¯­ä»å¥"><a href="#â˜…å¦‚æœè¯†åˆ«å®¾è¯­ä»å¥" class="headerlink" title="â˜…å¦‚æœè¯†åˆ«å®¾è¯­ä»å¥"></a>â˜…å¦‚æœè¯†åˆ«å®¾è¯­ä»å¥</h2><blockquote><p>åªè¦å®ä¹‰åŠ¨è¯çš„åé¢æœ‰ä¸ªè¿æ¥è¯, å°±æš‚å®šä¸ºå®¾è¯­ä»å¥(è¿˜æœ‰å¯èƒ½æ˜¯çŠ¶è¯­ä»å¥å“¦)</p></blockquote><blockquote><p><code>that</code> çš„å¼•å¯¼å®¾è¯­ä»å¥ä¸­ <code>that</code> å¯ä»¥çœç•¥, ä½†æ˜¯ä½ æœ€å¥½ä¸è¦çœç•¥, å› ä¸ºçœç•¥é€šå¸¸åœ¨ä¸æ­£å¼çš„åœºåˆ</p></blockquote><blockquote><p><code>if</code> åªèƒ½å¼•å¯¼å®¾è¯­ä»å¥, ç¿»è¯‘æˆ â€œæ˜¯å¦â€, ä½†<code>whether</code>å¯ä»¥å¼•å¯¼æ‰€æœ‰çš„ä»å¥, åˆ«çš„æ—¶å€™éƒ½ç¿»è¯‘æˆâ€å¦‚æœâ€</p></blockquote><p>0</p><h3 id="ä»‹å®¾å½¢å¼"><a href="#ä»‹å®¾å½¢å¼" class="headerlink" title="ä»‹å®¾å½¢å¼"></a>ä»‹å®¾å½¢å¼</h3><p><code>This and other similar cases raise the question of whether there is still a line between the court and politics.</code></p><p>è¿™é‡Œçš„è°“è¯­æ˜¯ <code>raise</code> , è€Œåé¢ <code>of</code> å¼•å¯¼æ˜¯ä¸€ä¸ªä»‹å®¾ç»“æ„, åšçŸ­è¯­</p><p>ä»‹å®¾ç»“æ„ä¸€èˆ¬æ˜¯ <code>ä»‹è¯ + åè¯</code> åšä»‹è¯çŸ­è¯­å½¢å¼,  è€Œä¸Šé¢æ˜¯ <code>ä»‹è¯ + å®¾è¯­ä»å¥</code></p><h3 id="å¦ç±»çš„ä»‹å®¾ç»“æ„"><a href="#å¦ç±»çš„ä»‹å®¾ç»“æ„" class="headerlink" title="å¦ç±»çš„ä»‹å®¾ç»“æ„"></a>å¦ç±»çš„ä»‹å®¾ç»“æ„</h3><p>åœ¨ä¸»ç³»è¡¨åé¢æ·»åŠ å®¾è¯­ç»“æ„çš„å½¢å¼, è¿™ç§æœ‰äººè¯´æ˜¯åœ¨å‰é¢çš„å½¢å®¹è¯åé¢æœ‰ä¸€ä¸ªä»‹è¯, å½“æ—¶è¢«çœç•¥äº†</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">he felt certain that he never could have succeeded with mathematics</span><br></pre></td></tr></table></figure><h3 id="ä¸»è°“åŒå®¾ç»“æ„"><a href="#ä¸»è°“åŒå®¾ç»“æ„" class="headerlink" title="ä¸»è°“åŒå®¾ç»“æ„"></a>ä¸»è°“åŒå®¾ç»“æ„</h3><p><code>tell sb sth</code> æ˜æ˜¾çš„ä¸»è°“åŒå®¾ç»“æ„</p><p>å‰é¢ä¸€ä¸ªæ˜¯äºº, åé¢ä¸€ä¸ªæ˜¯ç‰©</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">users could tell advertisers that they did <span class="keyword">not</span> want to be followed.</span><br></pre></td></tr></table></figure><p>è€Œç‰©æˆä¸ºäº†ä¸€ä¸ªå¥å­</p><h3 id="éè°“è¯­åŠ¨è¯ä¹‹åçš„ç»“æ„"><a href="#éè°“è¯­åŠ¨è¯ä¹‹åçš„ç»“æ„" class="headerlink" title="éè°“è¯­åŠ¨è¯ä¹‹åçš„ç»“æ„"></a>éè°“è¯­åŠ¨è¯ä¹‹åçš„ç»“æ„</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You might even be tempted to assume that humanity has little future to look forward to.</span><br></pre></td></tr></table></figure><p><code>to assume + å®¾è¯­ä»å¥</code></p><h3 id="it-å½¢å¼å®¾è¯­"><a href="#it-å½¢å¼å®¾è¯­" class="headerlink" title="it å½¢å¼å®¾è¯­"></a>it å½¢å¼å®¾è¯­</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">That kind of activity makes it less likely that the court&#x27;s decisions will be accepted as impartial judgments.</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><blockquote><p>å…¶å®æ ¹æœ¬æ²¡å¿…è¦ä¸¾ä¾‹å®¾è¯­ä»å¥èƒ½å¤Ÿåšä»€ä¹ˆ, åªè¦çŸ¥é“å®¾è¯­èƒ½æ”¾åœ¨é‚£ä¸ªåœ°æ–¹æˆ–è€…å……å½“ç±»ä¼¼å®¾è¯­çš„æˆåˆ†çš„åè¯éƒ½å¯ä»¥æ”¾, æ²¡ä»€ä¹ˆåŒºåˆ«çš„, å®¾è¯­ä»å¥å°±æ˜¯ä¸€ä¸ªå¥å­å……å½“äº†åè¯, ä½œä¸ºäº†å®¾è¯­</p></blockquote><h4 id="â˜…å¦‚æœåŒºåˆ«åŠ¨è¯-ed-æ˜¯è¿‡å»å¼è¿˜æ˜¯è¿‡å»åˆ†è¯åšå®šè¯­"><a href="#â˜…å¦‚æœåŒºåˆ«åŠ¨è¯-ed-æ˜¯è¿‡å»å¼è¿˜æ˜¯è¿‡å»åˆ†è¯åšå®šè¯­" class="headerlink" title="â˜…å¦‚æœåŒºåˆ«åŠ¨è¯+ed æ˜¯è¿‡å»å¼è¿˜æ˜¯è¿‡å»åˆ†è¯åšå®šè¯­?"></a>â˜…å¦‚æœåŒºåˆ«åŠ¨è¯+ed æ˜¯è¿‡å»å¼è¿˜æ˜¯è¿‡å»åˆ†è¯åšå®šè¯­?</h4><blockquote><p> åªéœ€è¦åˆ¤æ–­è¿™ä¸ªç–‘ä¼¼åŠ¨è¯çš„è¯å’Œå‰é¢çš„ä¸»è¯­æ˜¯ä»€ä¹ˆå…³ç³»? å¦‚æœæ˜¯<strong>è¢«åŠ¨å…³ç³», åˆ™æ˜¯è¿‡å»åˆ†è¯</strong>, å¦‚æœæ˜¯<strong>ä¸»åŠ¨å…³ç³»åˆ™æ˜¯åŠ¨è¯</strong></p><p> å½“ç„¶è¿˜æœ‰åœ¨è°“è¯­å‰é¢åŠ ä¸Š <code>be</code>, <strong>åˆ¤å®šä¸»è¯­å’Œè°“è¯­ä¹‹é—´æ˜¯ä¸æ˜¯è¢«åŠ¨è¯­æ€, å¦‚æœæ˜¯è¢«åŠ¨è¯­æ€, åˆæœ‰æ²¡æœ‰<code>be</code> è¡¥å……æˆä¸ºå®Œæ•´çš„ è°“è¯­, é‚£ä¹ˆå°±æ˜¯è¿‡å»åˆ†è¯, å¦‚æœä¸æ˜¯ è¢«åŠ¨è¯­æ€, åˆ™æ˜¯è°“è¯­</strong></p></blockquote><p><code>I bought a dog.</code> æ˜æ˜¾æ˜¯ä¸»åŠ¨ä¹°, æ‰€ä»¥æ˜¯è°“è¯­åŠ¨è¯</p><p><code>a dog bought ...</code> . æ˜æ˜¾æ˜¯è¢«åŠ¨, è¿™åªç‹—ä¸å¯èƒ½å‘å‡ºä¹°è¿™ä¸ªåŠ¨ä½œ, æ‰€ä»¥æ˜¯è¿‡å»åˆ†è¯</p><p>This alone demonstrates that the television business is not an easy world to survive in. A fact underlined by statistics shows that out of eighty European television networks no less than 50% took a loss in 1989.</p><p>ä¸»å¹²: <code>This alone demonstrates that ...</code> ä¸»è°“å®¾</p><p>ä»å¥: <code>the television business is ...</code> ä¸»ç³»è¡¨</p><p>ä¸»å¹²: <code>A fact underlined by statistics shows ...</code> ä¸»è°“å®¾</p><p>ä»å¥: <code>out of eighty European television networks no less than 50% took ...</code> ä¸»è°“å®¾</p><p>è¿™å•ç‹¬è¯æ˜äº†ç”µè§†è¡Œä¸šä¸æ˜¯ä¸€ä¸ªå®¹æ˜“ç”Ÿå­˜çš„ä¸–ç•Œ, æ®ç»Ÿè®¡çš„äº‹å®æ˜¾ç¤º, åœ¨1989å¹´, 80ä¸ªæ¬§æ´²ç”µè§†ç½‘ç»œä¸å°‘äºç™¾åˆ†ä¹‹50çš„ç”µè§†å°éƒ½åœ¨äºæŸ</p><p>He believes that this very difficulty may have had the compensating advantage of forcing him to think long and intently about every sentence, and thus enabling him to detect errors in reasoning and in his own observations.</p><p>ä»–è®¤ä¸ºï¼Œè¿™ç§å›°éš¾å¯èƒ½å…·æœ‰è¡¥å¿æ€§çš„ä¼˜åŠ¿ï¼Œè¿«ä½¿ä»–å¯¹æ¯ä¸€å¥è¯è¿›è¡Œé•¿æ—¶é—´çš„æ€è€ƒï¼Œä»è€Œä½¿ä»–èƒ½å¤Ÿå‘ç°æ¨ç†å’Œè‡ªå·±è§‚å¯Ÿä¸­çš„é”™è¯¯</p><blockquote><p>ä¸€ä¸ªä»å¥åšäº†å®¾è¯­, å¦‚æœä¸»å¹²çš„è°“è¯­æ˜¯å®ä¹‰åŠ¨è¯, è€Œä¸”æ­¤åˆ»ä¸»å¹²åˆšå¥½ç¼ºå°‘å®¾è¯­çš„éƒ¨åˆ†, é‚£ä¹ˆè¯¥ä»å¥å¾ˆå¯èƒ½æ˜¯å®¾è¯­ä»å¥</p></blockquote><h2 id="â˜…å¦‚ä½•è¯†åˆ«è¡¨è¯­ä»å¥"><a href="#â˜…å¦‚ä½•è¯†åˆ«è¡¨è¯­ä»å¥" class="headerlink" title="â˜…å¦‚ä½•è¯†åˆ«è¡¨è¯­ä»å¥"></a>â˜…å¦‚ä½•è¯†åˆ«è¡¨è¯­ä»å¥</h2><blockquote><p>ç³»åŠ¨è¯æœ‰ä¸€ä¸ªè¿æ¥è¯, é€šå¸¸éƒ½æ˜¯è¡¨è¯­ä»å¥</p></blockquote><p>A report consistently brought(è¿‡å»åˆ†è¯åšå®šè¯­) back by visitors to the US is how friendly, courteous, and helpful most Americans were to them.</p><p>Galileoâ€™s greatest glory was that in 1609 he was  the first person to turn the newly invented telescope on the heavens to prove that the planets revolve around the sun rather than around the Earth.</p><p>Women are much too preoccupied by family. Once the marriage begins to disintegrate, they are lost. That is where their unhappiness spring from and that is why most divorced mothers regard themselves as victims.</p><blockquote><p>ä¸€ä¸ªä»å¥åšäº†è¡¨è¯­</p></blockquote><h2 id="â˜…å¦‚ä½•è¯†åˆ«åŒä½è¯­ä»å¥"><a href="#â˜…å¦‚ä½•è¯†åˆ«åŒä½è¯­ä»å¥" class="headerlink" title="â˜…å¦‚ä½•è¯†åˆ«åŒä½è¯­ä»å¥"></a>â˜…å¦‚ä½•è¯†åˆ«åŒä½è¯­ä»å¥</h2><blockquote><p>åªè¦åè¯ä¹‹åæœ‰ä¸ªè¿æ¥è¯å°±æš‚å®šä¸ºåŒä½è¯­ä»å¥(æ›´å¯èƒ½æ˜¯å®šè¯­ä»å¥)ï¼Œä½†æ˜¯åŒä½è¯­è¿˜æ˜¯å®šè¯­éƒ½ä¸å½±å“æˆ‘ä»¬ç¿»è¯‘</p></blockquote><p><code>(çŠ¶è¯­, å‰é¢æœ‰ä¸ªä¸»è¯­å¿½ç•¥äº† Whorf )Being interested in the relationship of language and thought, Whorf developed the idea (åè¯ä¹‹ååŒä½è¯­ä»å¥)that the structure of language determines the structure of habitual thought in a society.</code></p><p><code>whorf</code> å¯¹è¯­è¨€å’Œæ€ç»´çš„è”ç³»æ„Ÿå…´è¶£ï¼Œä»–äº§ç”Ÿäº†ä¸€ç§è¯­è¨€æ–¹å¼å†³å®šäº†åœ¨ä¸€ä¸ªç¤¾ä¼šæƒ¯æ€§æ€ç»´æ–¹å¼çš„æƒ³æ³•</p><p><code>A century ago, Freud formulated his revolutionary  theory that dreams were the disguised shadows of our unconscious desires and fears. </code></p><p><code>But the idea that the journalist must understand the law more profoundly than an ordinary citizen rests on an understanding of the established conventions and special responsibilities of the news media. </code></p><p><code>Evidence came up that specific speech sounds are recognized by babies as young as 6 months old. </code></p><blockquote><p>åŒä½è¯­ä»å¥çš„è¿æ¥è¯å¥½åƒå¯ä»¥å»æ‰, ä¸åœ¨åŒä½è¯­ä»å¥ä¸­åšä»»ä½•æˆåˆ†, ä½†å®šè¯­ä»å¥ä¸è¡Œ, å®šè¯­ä»å¥çš„è¿æ¥è¯åšä»å¥çš„æˆåˆ†</p></blockquote><h4 id="å¦‚ä½•è¯†åˆ«åŒä½è¯­"><a href="#å¦‚ä½•è¯†åˆ«åŒä½è¯­" class="headerlink" title="å¦‚ä½•è¯†åˆ«åŒä½è¯­?"></a>å¦‚ä½•è¯†åˆ«åŒä½è¯­?</h4><blockquote><p>åè¯ + è¿æ¥è¯ + å¥å­ &#x3D;&#x3D;&gt; åŒä½è¯­ä»å¥</p></blockquote><h3 id="æŠ½è±¡åè¯å’ŒåŒä½è¯­ä»å¥"><a href="#æŠ½è±¡åè¯å’ŒåŒä½è¯­ä»å¥" class="headerlink" title="æŠ½è±¡åè¯å’ŒåŒä½è¯­ä»å¥"></a>æŠ½è±¡åè¯å’ŒåŒä½è¯­ä»å¥</h3><blockquote><p>å¦‚æœå¥å­ä¸­æœ‰<code>æŠ½è±¡åè¯</code>, åº”è¯¥ç¬¬ä¸€æ—¶é—´æƒ³åˆ°<code>åŒä½è¯­ä»å¥</code>, æ¯”å¦‚ <code>idea</code>, <code>fact</code>, <code>belief</code>, problem, <code>information</code>, <code>conclusion</code>, <code>decision</code>, news, <code>though</code>, <code>explaination</code>ç­‰ <code>An idea came to her that she could solve the problem in another way.</code></p></blockquote><p>â˜…ä»–å·²ç»æ‰¾åˆ°äº†å¥³æœ‹å‹è¿™ä»¶äº‹æƒ…ä½¿å®¶äººå¾ˆå¼€å¿ƒã€‚</p><p><code>The matter makes his families rejoiced.</code></p><blockquote><p>â˜…**<code>åŒä½è¯­ä»å¥çš„è¯, å°±æŠŠå¯¹æŸä¸ªåè¯çš„è§£é‡Šæ”¾åœ¨åè¯ä¹‹å</code>**</p></blockquote><p><code>The matter that he has found a girlfriend makes his families rejoiced.</code></p><blockquote><p>â˜…**<code>ä½†åŒæ—¶åŒä½è¯­å¯ä»¥æ”¾åœ¨å¥æœ«, ä½†ä¸æ¨è</code>**</p></blockquote><p><code>The matter makes his families rejoiced that he has found a girlfriend.</code></p><p>æ²¡æœ‰äººä¼šæ— ç¼˜æ— æ•…å°±å˜å¾—ä¼˜ç§€, è¿™ä¸ªäº‹å®æ€»æ˜¯è¢«å¾ˆå¤šäººå¿½ç•¥.</p><p><code>The truth is ignored by a sea of individuals.</code></p><p><code>The truth that nobody can become remarkable without endeavors is ignored by a sea of individuals.</code></p><p><code>The truth is ignored by a sea of individuals that nobody can become remarkable without endeavors.</code></p><p>æ²¡æœ‰ä»€ä¹ˆèƒ½å¤Ÿæ©ç›–å¥¹æ­£åœ¨å˜è€è¿™ä¸ªäº‹å®</p><p><code>The truth that she is getting old can&#39;t covered up. (è¢«åŠ¨?)</code></p><p><code>Nothing can hide the fact that she is getting old. </code></p><p>ç§‘å­¦å®¶å·²ç»å¾—å‡ºç»“è®º: åœ°çƒä¸Šçš„æ¸©åº¦å°†ä¼šè¶Šæ¥è¶Šé«˜</p><p><code>The scientists have come to a conclusion that the temperature on the earth will(has) become higher and higher.</code></p><blockquote><h4 id="è¿™é‡Œéœ€è¦æ³¨æ„-ä¸ç”¨-came-å› ä¸ºå‰é¢çš„-have-è¡¨ç¤ºå·²ç»å®Œæˆ-ä¸€èˆ¬éƒ½æ˜¯-have-done-ä½¿ç”¨è¿‡å»åˆ†è¯-have-åé¢çš„åŠ¨è¯ä¸€èˆ¬éƒ½æ˜¯è¿‡å»åˆ†è¯-è€Œ-come-çš„è¿‡å»å¼-æ˜¯-came-è¿‡å»åˆ†è¯æ˜¯-come-å’ŒåŸå‹ä¸€æ ·"><a href="#è¿™é‡Œéœ€è¦æ³¨æ„-ä¸ç”¨-came-å› ä¸ºå‰é¢çš„-have-è¡¨ç¤ºå·²ç»å®Œæˆ-ä¸€èˆ¬éƒ½æ˜¯-have-done-ä½¿ç”¨è¿‡å»åˆ†è¯-have-åé¢çš„åŠ¨è¯ä¸€èˆ¬éƒ½æ˜¯è¿‡å»åˆ†è¯-è€Œ-come-çš„è¿‡å»å¼-æ˜¯-came-è¿‡å»åˆ†è¯æ˜¯-come-å’ŒåŸå‹ä¸€æ ·" class="headerlink" title="è¿™é‡Œéœ€è¦æ³¨æ„, ä¸ç”¨ came , å› ä¸ºå‰é¢çš„ have è¡¨ç¤ºå·²ç»å®Œæˆ, ä¸€èˆ¬éƒ½æ˜¯ have done ä½¿ç”¨è¿‡å»åˆ†è¯, have åé¢çš„åŠ¨è¯ä¸€èˆ¬éƒ½æ˜¯è¿‡å»åˆ†è¯, è€Œ come çš„è¿‡å»å¼ æ˜¯ came  è¿‡å»åˆ†è¯æ˜¯ come , å’ŒåŸå‹ä¸€æ ·"></a>è¿™é‡Œéœ€è¦æ³¨æ„, ä¸ç”¨ <code>came</code> , å› ä¸ºå‰é¢çš„ <code>have</code> è¡¨ç¤ºå·²ç»å®Œæˆ, ä¸€èˆ¬éƒ½æ˜¯ <code>have done</code> ä½¿ç”¨è¿‡å»åˆ†è¯, <code>have</code> åé¢çš„åŠ¨è¯ä¸€èˆ¬éƒ½æ˜¯è¿‡å»åˆ†è¯, è€Œ <code>come</code> çš„è¿‡å»å¼ æ˜¯ <code>came</code>  è¿‡å»åˆ†è¯æ˜¯ <code>come</code> , å’ŒåŸå‹ä¸€æ ·</h4></blockquote><p>ç©¿è‡ªå·±çš„é‹ä¸ä»…æ–¹ä¾¿, è€Œä¸”ç¡®ä¿äº†ä¸€ç‚¹, ä¸ç”¨å»ç®¡åˆ«äººçš„æ„Ÿå—</p><p><code>Wearing my own shoes is not only convenient but also ensures a point that feelings of others can be ignored.</code></p><blockquote><p><strong><code>åŒä½è¯­ä»å¥è¿æ¥è¯åªèƒ½æ˜¯that?</code></strong></p></blockquote><h4 id="å¦‚ä½•åŒºåˆ†åŒä½è¯­ä»å¥å’Œå®šè¯­ä»å¥"><a href="#å¦‚ä½•åŒºåˆ†åŒä½è¯­ä»å¥å’Œå®šè¯­ä»å¥" class="headerlink" title="å¦‚ä½•åŒºåˆ†åŒä½è¯­ä»å¥å’Œå®šè¯­ä»å¥?"></a>å¦‚ä½•åŒºåˆ†åŒä½è¯­ä»å¥å’Œå®šè¯­ä»å¥?</h4><ol><li><p>åˆ¤æ–­ä¿®é¥°çš„åè¯æ˜¯ä¸æ˜¯æŠ½è±¡åè¯</p></li><li><p><strong>åˆ¤æ–­è¿æ¥è¯åˆ é™¤åæ˜¯å¦è¿˜æ˜¯å®Œæ•´çš„å¥å­</strong></p><blockquote><p>ä¸€èˆ¬å®šè¯­ä»å¥ä½¿ç”¨ that ä¿®é¥°çš„è¯, ä»–ä¼šåœ¨ä»å¥ä¸­å……å½“æˆåˆ†</p></blockquote></li></ol><blockquote><p>åŒä½è¯­ä»å¥é€šå¸¸ä½¿ç”¨ <code>that</code> åšè¿æ¥è¯, æ­¤æ—¶å¦‚æœæ˜¯å®šè¯­ä»å¥çš„ <code>that</code> ä¸€èˆ¬éƒ½ä¼šæŒ‡å‘ä¸€ä¸ªäººæˆ–è€…ç‰©, åšä»å¥çš„ä¸»è¯­æˆ–è€…å®¾è¯­æˆåˆ†, åˆ é™¤æ‰ <code>that</code> å¯¹äºåŒä½è¯­æ¥è¯´ä»å¥ä¸€èˆ¬ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜, ä½†æ˜¯å¦‚æœæ˜¯å®šè¯­ä»å¥çš„<code>that</code>è¢«åˆ é™¤, ä»å¥å°±ä¼šç¼ºå°‘åˆ†æˆ</p></blockquote><h2 id="å¦‚ä½•æ–­å®šä¸€ä¸ªä»å¥å·²ç»ç»“æŸ-ï¼ˆå¤šä¸ªè°“è¯­æ‰¾ä¸»å¹²ï¼‰"><a href="#å¦‚ä½•æ–­å®šä¸€ä¸ªä»å¥å·²ç»ç»“æŸ-ï¼ˆå¤šä¸ªè°“è¯­æ‰¾ä¸»å¹²ï¼‰" class="headerlink" title="å¦‚ä½•æ–­å®šä¸€ä¸ªä»å¥å·²ç»ç»“æŸ?ï¼ˆå¤šä¸ªè°“è¯­æ‰¾ä¸»å¹²ï¼‰"></a>å¦‚ä½•æ–­å®šä¸€ä¸ªä»å¥å·²ç»ç»“æŸ?ï¼ˆå¤šä¸ªè°“è¯­æ‰¾ä¸»å¹²ï¼‰</h2><blockquote><p>ä»»ä½•å¥å­, ä¸è®ºæ˜¯ä»å¥è¿˜æ˜¯ä¸»å¹², éƒ½ä¼šæœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„è°“è¯­, è€Œä»å¥çš„å¼€å§‹ä¸€èˆ¬æ˜¯è¿æ¥è¯, ä½†å¦‚æœæ˜¯å®¾è¯­ä»å¥è¿æ¥è¯ <code>that</code> å¯èƒ½è¢«çœç•¥äº†, è€Œä¸€ä¸ªå¥å­çš„è°“è¯­æ˜¯å¥å­çš„æ ¸å¿ƒ, ä¸€èˆ¬æƒ…å†µä¸‹, éƒ½æ˜¯ä¸»è°“å®¾ç»“æ„, æ‰€ä»¥æˆ‘ä»¬è¦åˆ¤æ–­ä»å¥çš„å¼€å¤´å’Œèµ·å§‹ä½ç½®å…¶å®å¾ˆç®€å•</p><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸¤ä¸ªè°“è¯­ä¹‹é—´çš„ä½ç½®åˆ¤æ–­å‡ºå…·ä½“å“ªäº›æ˜¯ä¸»å¹², å“ªäº›æ˜¯ä»å¥</p><ol><li><p>å¦‚æœä»å¥ä»‹äº<code>ä¸»è¯­</code>å’Œ<code>è°“è¯­</code>ä¹‹é—´</p><p>æ¯”å¦‚: <code>ä¸» è¿æ¥è¯ä¸»è°“å®¾ è°“å®¾</code>æˆ–è€…<code>ä¸»è¿æ¥è¯ä¸»ç³»è¡¨è°“å®¾</code>  æˆ‘ä»¬éƒ½èƒ½<strong>æ‰¾åˆ°ä»‹äºä¸¤ä¸ªè°“è¯­ä¹‹é—´çš„éƒ¨åˆ†, ä¸€èˆ¬éƒ½æ˜¯ä»å¥çš„éƒ¨åˆ†</strong></p></li><li><p>å¦‚æœä»å¥åœ¨ä¸»å¹²è°“è¯­ä¹‹å</p><p>æ¯”å¦‚åšå®¾è¯­çš„æƒ…å†µ <code>ä¸»è°“(è¿æ¥è¯)ä¸»è°“å®¾</code>, è¿™ç§æƒ…å†µå¯èƒ½çœç•¥äº†è¿æ¥è¯, ä½†æˆ‘ä»¬è¿˜æ˜¯èƒ½å¤Ÿæ‰¾åˆ°ä¸¤ä¸ªè°“è¯­</p><p>å¦‚æœæ˜¯<code>ä¸»è°“å®¾ è¿æ¥è¯ ä¸»è°“å®¾</code>è¿™ç§æƒ…å†µ, å°±èƒ½æ‰¾åˆ°è¿æ¥è¯</p></li><li><p>å¦‚æœä»å¥ä½œä¸ºä¸»è¯­çš„è¯</p><p>ä»å¥ä½œä¸ºä¸»è¯­<code>è¿æ¥è¯ ä¸»è¯­ + è°“è¯­ + å®¾è¯­ + è°“è¯­ + å®¾è¯­</code> è¿™ç§æƒ…å†µæ›´åŠ å¥½è¯†åˆ«äº†</p></li></ol></blockquote><blockquote><p><strong>æ€»ç»“: ä¸»è¦çœ‹è¿è¯ï¼Œæœ‰è¿è¯çš„ä¸æ˜¯ä¸»å¹²ã€‚æ²¡è¿è¯çœ‹ä¿©è°“è¯­ï¼Œä¸€èˆ¬éƒ½æ˜¯å‰ä¸€ä¸ªè°“è¯­æ˜¯ä¸»å¹²ï¼Œä¿©è°“è¯­ä¹‹é—´çš„éƒ¨åˆ†è¦ä¹ˆæ˜¯ä»å¥çš„ä¸»è¯­ï¼Œè¦ä¹ˆæ˜¯ä»å¥çš„å®¾è¯­ï¼ˆè¡¨è¯­ï¼‰ï¼Œåæ­£éƒ½ä¸æ˜¯ä¸»å¹²çš„ä¸»è°“</strong></p></blockquote><h2 id="åè¯æ€§ä»å¥æ€»ç»“"><a href="#åè¯æ€§ä»å¥æ€»ç»“" class="headerlink" title="åè¯æ€§ä»å¥æ€»ç»“"></a>åè¯æ€§ä»å¥æ€»ç»“</h2><blockquote><p><strong><code>åè¯æ€§ä»å¥å°±æ˜¯ä¸»å¹²ç¼ºå°‘æˆåˆ†éœ€è¦ä»å¥åšæˆåˆ†çš„ä¸€ç³»åˆ—å¥å­</code></strong></p></blockquote><blockquote><p>åè¯æ€§ä»å¥çš„è¿æ¥è¯é€šå¸¸æ ¹æ®ä»å¥çš„ç±»å‹åšé€‰æ‹©</p><ul><li>é™ˆè¿°å¥ &#x3D;&#x3D;&gt; <code>[that] + [é™ˆè¿°å¥]</code></li><li>ä¸€èˆ¬ç–‘é—®å¥ &#x3D;&#x3D;&gt; <code>[if/whether å¦‚æœæ˜¯ å®¾è¯­ä»å¥å¯ç”¨ if , ç»“å°¾å³ or not ä¸èƒ½ç”¨ if] + [æ”¹æˆé™ˆè¿°å¥]</code></li><li>ç‰¹æ®Šç–‘é—®å¥ &#x3D;&#x3D;&gt; <code>[ç‰¹æ®Šç–‘é—®è¯(ç–‘é—®å¥çš„ç–‘é—®è¯)] + [æ”¹æˆé™ˆè¿°å¥]</code></li></ul></blockquote><h3 id="æ»¡åˆ†å¥å‹"><a href="#æ»¡åˆ†å¥å‹" class="headerlink" title="æ»¡åˆ†å¥å‹"></a>æ»¡åˆ†å¥å‹</h3><ul><li><p>it åšå½¢å¼ä¸»è¯­çš„ä¸»è¯­ä»å¥</p></li><li><p>åŒä½è¯­ä»å¥</p></li></ul><h3 id="å¦‚ä½•è¯†åˆ«ä¸»è¯­ä»å¥"><a href="#å¦‚ä½•è¯†åˆ«ä¸»è¯­ä»å¥" class="headerlink" title="å¦‚ä½•è¯†åˆ«ä¸»è¯­ä»å¥?"></a>å¦‚ä½•è¯†åˆ«ä¸»è¯­ä»å¥?</h3><blockquote><p>è¿æ¥è¯ + ä»å¥ + è°“è¯­ + å…¶ä»–æˆåˆ† è¿æ¥è¯åœ¨ç¬¬ä¸€ä¸ªä½ç½® &#x3D;&#x3D;&gt; ä¸»è¯­ä»å¥</p></blockquote><blockquote><p>it â€¦ that â€¦  &#x3D;&#x3D;&gt; ä¸»è¯­ä»å¥</p></blockquote><h3 id="å¦‚ä½•è¯†åˆ«å®¾è¯­ä»å¥"><a href="#å¦‚ä½•è¯†åˆ«å®¾è¯­ä»å¥" class="headerlink" title="å¦‚ä½•è¯†åˆ«å®¾è¯­ä»å¥?"></a>å¦‚ä½•è¯†åˆ«å®¾è¯­ä»å¥?</h3><blockquote><p>å®ä¹‰åŠ¨è¯ + è¿æ¥è¯ + å¥å­ &#x3D;&#x3D;&gt; å®¾è¯­ä»å¥(ä½†ä¹Ÿå¯èƒ½æ˜¯çŠ¶è¯­ä»å¥)</p></blockquote><h3 id="å¦‚ä½•è¯†åˆ«è¡¨è¯­ä»å¥"><a href="#å¦‚ä½•è¯†åˆ«è¡¨è¯­ä»å¥" class="headerlink" title="å¦‚ä½•è¯†åˆ«è¡¨è¯­ä»å¥?"></a>å¦‚ä½•è¯†åˆ«è¡¨è¯­ä»å¥?</h3><blockquote><p>ç³»åŠ¨è¯ + è¿æ¥è¯ + å¥å­ &#x3D;&#x3D;&gt; è¡¨è¯­ä»å¥</p></blockquote><h3 id="å¦‚ä½•è¯†åˆ«åŒä½è¯­ä»å¥"><a href="#å¦‚ä½•è¯†åˆ«åŒä½è¯­ä»å¥" class="headerlink" title="å¦‚ä½•è¯†åˆ«åŒä½è¯­ä»å¥?"></a>å¦‚ä½•è¯†åˆ«åŒä½è¯­ä»å¥?</h3><ol><li><p>ä¿®é¥°çš„å…ˆè¡Œè¯æ˜¯ä¸æ˜¯æŠ½è±¡åè¯</p><blockquote><p>å¦‚æœæ˜¯æŠ½è±¡åè¯, ä¸€èˆ¬è®¤ä¸ºæ˜¯åŒä½è¯­ä»å¥</p></blockquote></li><li><p>åˆ¤æ–­è¿æ¥è¯æ˜¯å¦åšä»å¥æˆåˆ†</p><blockquote><p>ä¸€èˆ¬å®šè¯­ä»å¥çš„<code>that</code>è¿æ¥è¯åšä»å¥çš„æˆåˆ†, è€ŒåŒä½è¯­çš„è¿æ¥è¯ä¸åšæˆåˆ†</p></blockquote></li><li><p>åŒä½è¯­ä»å¥ä¸€èˆ¬æ˜¯è§£é‡Š, è€Œå®šè¯­ä»å¥ä¸€èˆ¬æ˜¯ä¿®é¥°</p><blockquote><p>ä¸€ä¸ªæ˜¯åŒçº§, å¦ä¸€ä¸ªæ˜¯é™å®š</p></blockquote></li></ol><h2 id="è¯¾åç»ƒä¹ "><a href="#è¯¾åç»ƒä¹ " class="headerlink" title="è¯¾åç»ƒä¹ "></a>è¯¾åç»ƒä¹ </h2><p>æˆåŠŸå±äºå…¨åŠ›ä»¥èµ´çš„äººå·²ä¸ºæ— æ•°ä¸ªäº‹å®æ‰€è¯æ˜ã€‚(ä¸»è¯­ä»å¥)</p><p>é—®é¢˜çš„å…³é”®æ˜¯è°åº”è¯¥ä¸ºé“å¾·çš„æ²¦ä¸§è´Ÿè´£ã€‚(è¡¨è¯­ä»å¥)</p><p>ç»è¿‡å¾ˆå¤šå¤©çš„æ€è€ƒ,æˆ‘å¾—å‡ºä¸€ä¸ªç»“è®º,æˆåŠŸæ˜¯ä¸€ä»¶ç›¸å…³çš„äº‹æƒ…,å› ä¸ºå®ƒä¼šç»™ä½ å¸¦æ¥å¾ˆå¤šçš„äº²æˆšã€‚ (åŒä½è¯­ä»å¥)</p><p>å› æ­¤ï¼Œæ ¹æ®æˆ‘çš„åˆ†æ,æˆ‘å¼ºçƒˆåå¯¹é‚£äº›è®¤ä¸ºè€å¸ˆåº”è¯¥ä¸ºå­¦ç”Ÿçš„å­¦ä¹ è´Ÿå…¨è´£çš„çœ‹æ³•ã€‚ (åŒä½è¯­ä»å¥)</p>]]></content>
      
      
      <categories>
          
          <category> è‹±è¯­ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åè¯æ€§ä»å¥ </tag>
            
            <tag> æˆåˆ† </tag>
            
            <tag> ä¸»è¯­ä»å¥ </tag>
            
            <tag> å®¾è¯­ä»å¥ </tag>
            
            <tag> ä»‹å®¾ç»“æ„ </tag>
            
            <tag> ä¸»è°“åŒå®¾ç»“æ„ </tag>
            
            <tag> itå½¢å¼å®¾è¯­ </tag>
            
            <tag> è¡¨è¯­ä»å¥ </tag>
            
            <tag> åŒä½è¯­ä»å¥ </tag>
            
            <tag> è¿è¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02å¹¶åˆ—å¥</title>
      <link href="/2022/11/25/06%E8%8B%B1%E8%AF%AD/02%E5%B9%B6%E5%88%97%E5%8F%A5/"/>
      <url>/2022/11/25/06%E8%8B%B1%E8%AF%AD/02%E5%B9%B6%E5%88%97%E5%8F%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="æ‰¾å‡ºé•¿éš¾å¥ä¸»å¹²çš„ä¸‰ä¸ªæ­¥éª¤"><a href="#æ‰¾å‡ºé•¿éš¾å¥ä¸»å¹²çš„ä¸‰ä¸ªæ­¥éª¤" class="headerlink" title="æ‰¾å‡ºé•¿éš¾å¥ä¸»å¹²çš„ä¸‰ä¸ªæ­¥éª¤"></a>æ‰¾å‡ºé•¿éš¾å¥ä¸»å¹²çš„ä¸‰ä¸ªæ­¥éª¤</h1><ol><li>çœ‹æ ‡ç‚¹ç¬¦å·</li><li>çœ‹åŠ¨è¯</li><li>çœ‹å¼•å¯¼è¯</li></ol><h2 id="çœ‹æ ‡ç‚¹ç¬¦å·"><a href="#çœ‹æ ‡ç‚¹ç¬¦å·" class="headerlink" title="çœ‹æ ‡ç‚¹ç¬¦å·"></a>çœ‹æ ‡ç‚¹ç¬¦å·</h2><h3 id="çœ‹é€—å·"><a href="#çœ‹é€—å·" class="headerlink" title="çœ‹é€—å·"></a>çœ‹é€—å·</h3><p>åˆ¤æ–­éƒ½åœ¨å‰é¢å’Œé€—å·åé¢çš„éƒ¨åˆ†, çœ‹çœ‹, ä»‹è¯, ä»å¥å’Œéè°“è¯­åŠ¨è¯åœ¨å‰é¢è¿˜æ˜¯åé¢, å¦‚æœåœ¨å‰é¢ä¸»å¹²å°±åœ¨åé¢, å¦‚æœåœ¨åé¢, ä¸»å¹²å°±åœ¨å‰é¢</p><p><code>_ä»‹è¯ç­‰_, _ä¸»å¹²_</code></p><p><code>_ä¸»å¹²_, _ä»‹è¯ç­‰_</code></p><h3 id="çœ‹åˆ†å·"><a href="#çœ‹åˆ†å·" class="headerlink" title="çœ‹åˆ†å·"></a>çœ‹åˆ†å·</h3><p>åˆ†å·å‰åç›¸å½“äºä¸€ä¸ªå¹¶åˆ—è¿è¯ <code>and but or</code> è¿™ç§</p><p><code>_ä¸»å¹²_;_å¹¶åˆ—å¥_</code> ä¸»å¹²åœ¨å‰é¢, åˆ†å·åé¢æš‚æ—¶ä¸çœ‹</p><blockquote><p>è¿è¯ä¹‹åçš„éƒ¨åˆ†éƒ½æ˜¯å¹¶åˆ—å¥</p></blockquote><h3 id="å†’å·"><a href="#å†’å·" class="headerlink" title="å†’å·"></a>å†’å·</h3><p>è¡¥å……è¯´æ˜çš„ä½œç”¨, ç±»ä¼¼äºåŒä½è¯­</p><p><code>_ä¸»å¹²_:_åŒä½è¯­_</code></p><h3 id="ç ´æŠ˜å·"><a href="#ç ´æŠ˜å·" class="headerlink" title="ç ´æŠ˜å·"></a>ç ´æŠ˜å·</h3><p>ç±»ä¼¼åŒä½è¯­</p><h3 id="ä¸¤ä¸ªé€—å·ä¹‹é—´"><a href="#ä¸¤ä¸ªé€—å·ä¹‹é—´" class="headerlink" title="ä¸¤ä¸ªé€—å·ä¹‹é—´"></a>ä¸¤ä¸ªé€—å·ä¹‹é—´</h3><p>å¯èƒ½æ˜¯æ’å…¥è¯­</p><p><code>N,_æ’å…¥è¯­_,V</code></p><h1 id="ä¸»å¹²å…¬å¼"><a href="#ä¸»å¹²å…¬å¼" class="headerlink" title="ä¸»å¹²å…¬å¼"></a>ä¸»å¹²å…¬å¼</h1><blockquote><p><strong>è¿è¯(è¿è¯&#x2F;å…³ç³»è¯&#x2F;å¼•å¯¼è¯) : è°“è¯­åŠ¨è¯ &#x3D; n - 1 : n</strong></p><p>ä¹Ÿå°±æ˜¯è¯´è¿è¯æ€»æ¯”åŠ¨è¯å°‘ä¸€ä¸ª</p></blockquote><blockquote><p>éœ€è¦æ³¨æ„çœç•¥çš„æƒ…å†µ</p><ul><li>å®¾è¯­ä»å¥ that çœç•¥</li><li>å®šè¯­ä»å¥ that åšå®¾è¯­çš„æ—¶å€™, çœç•¥</li></ul></blockquote><blockquote><p>æ‰€ä»¥æœ‰çš„æ—¶å€™æ‰¾ä¸åˆ°ä¸»å¹²çš„è°“è¯­, å¯ä»¥è¯•ç€æ‰¾æ‰¾è¿è¯</p></blockquote><h1 id="æ±‰åŒ–è¿‡ç¨‹"><a href="#æ±‰åŒ–è¿‡ç¨‹" class="headerlink" title="æ±‰åŒ–è¿‡ç¨‹"></a>æ±‰åŒ–è¿‡ç¨‹</h1><h2 id="è¯­æ„å’Œè¯­å¢ƒ"><a href="#è¯­æ„å’Œè¯­å¢ƒ" class="headerlink" title="è¯­æ„å’Œè¯­å¢ƒ"></a>è¯­æ„å’Œè¯­å¢ƒ</h2><ul><li><p>è¯­å¢ƒæ¯”å•è¯çš„å¤§ä½“æ„æ€é‡è¦, å¦‚æœç¿»è¯‘ä¸é¡ºåˆ©, åˆ™å¯ä»¥åœ¨æ±‰è¯­ä¸­æ‰¾åˆ°åŒä¹‰è¯æˆ–è€…æ›´å®½æ³›çš„åŒä¹‰è¯</p></li><li><p>å¦‚æœå¥å­ç¿»è¯‘å‡ºæ¥å, å‘ç°å¥å­ä¸é€šé¡º, æˆ‘ä»¬å¯ä»¥å¢åŠ è¯è¯­</p></li><li><p>è¿˜æœ‰å‡è¯, æŒ‰ç…§å®Œæ•´æ€§åˆ¤æ–­å¢è¯, è¿˜æ˜¯å‡è¯</p></li></ul><h3 id="è¯­åº"><a href="#è¯­åº" class="headerlink" title="è¯­åº"></a>è¯­åº</h3><ol><li><p>ä¸»è°“å®¾è¯­åºä¸å˜, ä½†ä¿®é¥°æˆåˆ†è¯­åºä¸­è‹±æ–‡å­˜åœ¨å·®åˆ«</p></li><li><p>è‹±è¯­ä¸­ä¿®é¥°æ•´ä¸ªå¥å­çš„çŠ¶è¯­å¯èƒ½æ”¾åœ¨å‰é¢ä¹Ÿå¯èƒ½æ”¾åœ¨åé¢, ä½†æ±‰è¯­åªèƒ½æ”¾åœ¨æœ€å‰é¢</p></li><li><p>æ±‰è¯­ä¸­çš„å®šè¯­åªèƒ½æ”¾åœ¨ä¿®é¥°è¯çš„å‰é¢, è‹±è¯­ä¸­å¯èƒ½æ”¾åœ¨å‰é¢ä¹Ÿå¯èƒ½æ”¾åœ¨åé¢</p></li><li><p>è‹±è¯­ä¸­ä¿®é¥°è°“è¯­çš„çŠ¶è¯­ç®€å•çš„æ”¾åœ¨è°“è¯­å‰é¢, å¤æ‚çš„æ”¾åœ¨è°“è¯­åé¢, æ±‰è¯­ä¸­åªèƒ½æ”¾åœ¨è°“è¯­å‰é¢</p></li><li><p>è‹±è¯­ä¸­ä¿®é¥°å®¾è¯­çš„å®šè¯­å¯ä»¥æ”¾åœ¨å‰é¢(ç®€å•çš„), å¤æ‚çš„æ”¾åœ¨å®¾è¯­åé¢, è€Œæ±‰è¯­åªèƒ½æ”¾åœ¨å®¾è¯­å‰é¢</p></li></ol><blockquote><p>æ³¨æ„å¹¶åˆ—å¤„, é¡ºåºä¸å˜</p></blockquote><blockquote><p>è‹±è¯­å’Œæ±‰è¯­çš„åŸºæœ¬è¯­åºä¸€è‡´, è‹±æ±‰çš„ä¿®é¥°æˆåˆ†æ”¾ç½®çš„ä½ç½®å¯èƒ½ä¸ä¸€æ ·, å¦‚æœæˆåˆ†æ¯”è¾ƒç®€å•, åˆ™å¯èƒ½æ˜¯**<code>å€’å™</code>**</p></blockquote><blockquote><p>ä½†ä¿®é¥°æˆåˆ†çš„å€’å™ä¹Ÿä¸æ˜¯æ—¶å¸¸éƒ½æ˜¯è¿™ä¹ˆå›äº‹çš„, è¿˜æœ‰ä¸€éƒ¨åˆ†æ¯”è¾ƒå¤æ‚çš„éœ€è¦å¦å¤–ç¿»è¯‘, è¿™ç§å¤æ‚ç¨‹åº¦ä¸€èˆ¬ä½¿ç”¨ <code>6 8 åŸåˆ™</code>, å¦‚æœä¿®é¥°æˆåˆ†å•è¯åœ¨<code>6ä¸ªä»¥å†…</code>, åˆ™ä¸€èˆ¬éƒ½æ˜¯<code>å€’å™</code>, å¦‚æœä¿®é¥°æˆåˆ†çš„å•è¯åœ¨<code>8ä¸ªä»¥ä¸Š</code>, ä¸€èˆ¬ä¸éœ€è¦å€’å™, è¦å¦å¤–ç¿»è¯‘, å¦‚æœä¿®é¥°æˆåˆ†çš„å•è¯æ•°é‡åœ¨<code>6-8ä¸ª</code>ä¹‹é—´, åˆ™éœ€è¦æ ¹æ®è¯­æ„å’Œè¯­å¢ƒè‡ªè¡Œåˆ¤æ–­æ˜¯å¦å€’å™</p></blockquote><p><code>We will hew out of the mountain of despair a stone of hope</code></p><ul><li>è°“è¯­ <code>will hew</code></li><li><code>out of the mountain</code> å€’åºçœ‹å‰é¢, ä¿®é¥° <code>will hew</code> çŠ¶è¯­</li><li><code>of despair</code> å€’å™çœ‹å‰é¢, ä¿®é¥°çš„ <code>mountain</code> åè¯, å®šè¯­</li><li><code>of hope</code> å€’å™çœ‹å‰é¢, ä¿®é¥°çš„ <code>a stone</code>åè¯, å®šè¯­</li></ul><blockquote><p>åœ¨æ±‰è¯­ä¸­æ‰€æœ‰ä¿®é¥°æˆåˆ†éƒ½æ”¾åœ¨å‰é¢, ä¸»å¹²å’Œè‹±è¯­ä¸€è‡´</p></blockquote><p>ç¿»è¯‘æˆ: æˆ‘ä»¬ä»ç»æœ›çš„å±±ä¸ŠåŠˆä¸‹å¸Œæœ›çš„çŸ³å¤´</p><h3 id="å¹¶åˆ—å¤„é¡ºåºä¸å˜æ˜¯æ€ä¹ˆå›äº‹"><a href="#å¹¶åˆ—å¤„é¡ºåºä¸å˜æ˜¯æ€ä¹ˆå›äº‹" class="headerlink" title="å¹¶åˆ—å¤„é¡ºåºä¸å˜æ˜¯æ€ä¹ˆå›äº‹?"></a>å¹¶åˆ—å¤„é¡ºåºä¸å˜æ˜¯æ€ä¹ˆå›äº‹?</h3><p><code>N of a and b of c</code></p><p>éœ€è¦æ³¨æ„, <code>N</code> æ˜¯ä¸»ä½“, <code>a</code> å’Œ <code>b</code> ä¿®é¥°ç€ <code>N</code> , ä½† <code>c</code> åŒæ—¶ä¿®é¥°ç€ <code>a</code> å’Œ <code>b</code></p><p>ä»–çš„ä¿®é¥°æ˜¯  <code>c</code> ä¿®é¥° <code>a</code> ä¿®é¥° <code>N</code> , ç„¶åæ‰æ˜¯ <code>c</code> ä¿®é¥° <code>b</code> ä¿®é¥° <code>N</code></p><p>æŒ‰ç…§ä¸Šé¢çš„ä¿®é¥°æ–¹æ³•, æˆ‘ä»¬å¾—å‡º <code>c a N and c b N</code></p><p>è®¾ <code>a and b</code> ä¸º <code>y</code>, è®¾ <code>c</code> ä¸º <code>x</code></p><p>é‚£ä¹ˆå¯ä»¥å¾—å‡º <code>N of x of y</code></p><p>æ‹†è§£å¼€å°±æ˜¯ <code>c (a and b) N</code></p><p>åˆ†é…ä¸‹, å°±å˜æˆ  <code>(ca and cb) N</code></p><p>å†æ‹†å¼€ä¸å°±æ˜¯ <code>caN and cbN</code> äº†ä¹ˆ?</p><p><code>Of all the changes that have taken place in English-language newspapers during the past quarter-century, perhaps the most far-reaching has been the inexorable decline in the scope and seriousness of their arts coverage.</code></p><p>æˆ‘ä»¬æ¥åˆ†æä¸Šé¢è¿™æ®µè¯,</p><p>Of all the changes(ä»‹è¯çŸ­è¯­åšçŠ¶è¯­, æ²¡æ‰¾åˆ°ä¿®é¥°çš„åè¯åªèƒ½åšçŠ¶è¯­) that have taken place(å®šè¯­ä»å¥ä¿®é¥°å…ˆè¡Œè¯ changes) in English-language newspapers(åšçŠ¶è¯­) during the past quarter-century(åšçŠ¶è¯­, è¡¨ç¤ºæ—¶é—´), perhaps(å‰¯è¯, ä¹Ÿè®¸) the most far-reaching(ä¸»è¯­) has been(è°“è¯­) the inexorable decline(è¡¨è¯­) in the scope and seriousness(ä»‹è¯ä¿®é¥°åè¯åšå®šè¯­) of their arts coverage(ä¿®é¥°å‰é¢çš„ a and b, ç¿»è¯‘æˆ <code>caN</code>å’Œ<code>cbN</code>å…¶å®å¦‚æœç¿»è¯‘çš„é€šé¡ºä¹Ÿå¯ä»¥æ˜¯ <code>c a and b N</code>).</p><p>åœ¨è¿‡å»çš„25å¹´ä¹‹ä¸­, è‹±è¯­æŠ¥çº¸æ‰€å‘ç”Ÿ(å¸¦æ¥å˜å‘ç”Ÿ)çš„æ‰€æœ‰æ”¹å˜ä¹‹ä¸­ä¹Ÿè®¸å½±å“æ„ä¹‰æœ€æ·±è¿œçš„åœ°æ–¹æ˜¯åœ¨è‰ºæœ¯æŠ¥é“èŒƒå›´ä¸Šå’Œä¸¥è‚ƒæ€§ä¸Šä¸æ–­çš„å‡å¼±</p><p><code>In his book The Tipping Point, Malcolm Gladwell argues that social epidemics are driven in large part by the acting of a tiny minority of special individuals, often called influentials, who are unusually informed, persuasive, or well-connected.</code></p><ol><li><code>in his book</code> çŠ¶è¯­, <code>the T P</code> å¯¹äºå‰é¢æ¥è¯´æ˜¯åŒä½è¯­, æ•´ä½“ä¸Šçœ‹<code>in his book The Tipping Point</code>éƒ½æ˜¯çŠ¶è¯­</li><li><code>Malcolm Gladwell</code> ä¸»è¯­</li><li><code>argues </code>è°“è¯­</li><li><code>that social epidemics are driven ...</code> å®¾è¯­ä»å¥(åè¯æ€§ä»å¥)</li><li><code>, often called influentials,</code>åœ¨ä¸¤ä¸ªé€—å·ä¹‹é—´, å¯èƒ½æ˜¯<code>æ’å…¥è¯­</code>, åˆ¤æ–­ä¸‹<code>called</code>, åœ¨å‰é¢åŠ ä¸Š<code>be</code>åŠ¨è¯, è¡¨ç¤º è¢«åŠ¨è¯­æ€ çœ‹çœ‹æ•´ä½“æ„æ€æ˜¯å¦è¿˜æ˜¯ä¸€æ ·, â€œoften is called influentials, ç»å¸¸è¢«è®¤ä¸ºæœ‰å½±å“åŠ›â€, æ„æ€å’Œæ²¡åŠ <code>be</code>åŠ¨è¯ä¹‹å‰ä¸€æ¨¡ä¸€æ ·, æ‰€ä»¥è¿™é‡Œæ˜¯<code>è¿‡å»åˆ†è¯, è¡¨è¢«åŠ¨</code>, åŸºæœ¬åˆ¤æ–­æ˜¯æ’å…¥è¯­, é®ä½ä¸çœ‹ä¸å½±å“æ•´å¥çš„ç¿»è¯‘</li><li><code>who are unusually informed ...</code>å®šè¯­ä»å¥</li></ol><p>åœ¨ä»–çš„ä¹¦, MG è®¤ä¸ºç¤¾ä¼šæµè¡Œæ½®æµå¾ˆå¤§éƒ¨åˆ†å–å†³äºå°éƒ¨åˆ†ç‰¹æ®Šä¸ªä½“, å“ªäº›æœ‰å½±å“åŠ›çš„äºº, ä»–ä»¬éå¸¸çš„æœ‰å­¦è¯†, èƒ½ä½¿äººä¿¡æœ, æœ‰å¾ˆå¥½çš„å‡ºç”Ÿ</p><p>At the end of adolescence, however, the brain shuts down half of that capacity, preserving only those modes of thought that have seemed most valuable during the first decade or so of life.</p><ol><li>at the end of adolescence çŠ¶è¯­ ç¿»è¯‘æˆåœ¨ é’æ˜¥æœŸæœ«æœŸ</li><li>however çŠ¶è¯­ ç¿»è¯‘æˆ ç„¶è€Œ</li><li>shut down è°“è¯­, é‚£ä¹ˆåœ¨è°“è¯­å‰é¢çš„å°±æ˜¯ ä¸»è¯­  the brain ç¿»è¯‘æˆ å¤§è„‘, åé¢çš„å°±æ˜¯ å®¾è¯­ half , å†åé¢çš„ of that capacity åšåç½®å®šè¯­ half of that capacity ç¿»è¯‘æˆ ä¸€åŠçš„èƒ½åŠ›, æ•´ä½“ç¿»è¯‘æˆ â€œå¤§è„‘å…³é—­äº†ä¸€åŠçš„èƒ½åŠ›â€</li><li>preserving æ˜¯åŠ¨åè¯åšå®šè¯­, ç¿»è¯‘æˆ ä¿å­˜,  only åšçŠ¶è¯­ä¿®é¥° ä¿å­˜, ç¿»è¯‘æˆ ä»…ä»…ä¿å­˜</li><li>modes of thought ç¿»è¯‘æˆ æ€ç»´æ¨¡å¼</li><li>that åšåŠ¨åè¯å¼•å¯¼å®šè¯­çš„åç½®å®šè¯­, å…ˆè¡Œè¯æ˜¯ thought , that åšå…³ç³»è¯, åœ¨å®šè¯­ä»å¥ä¸­åš ä¸»è¯­</li><li>have seemed æ˜¯ å®šè¯­ä»å¥çš„ è°“è¯­ ç°åœ¨å®Œæˆå¼, ç¿»è¯‘æˆ â€œä¼¼ä¹â€ ä¸»ç³»è¡¨ç»“æ„</li><li>most valuable åšè¡¨è¯­, è¡¨ç¤º â€œæœ€æœ‰ä»·å€¼â€</li><li>during the first decade or so of life ä»‹è¯å¼•å¯¼çš„åšæ—¶é—´çŠ¶è¯­ä»å¥, ç¿»è¯‘æˆåœ¨ â€œåœ¨ç”Ÿå‘½æœ€åˆçš„åå¹´å·¦å³â€</li><li>æ•´ä½“ç¿»è¯‘æˆâ€ç„¶è€Œ, åœ¨é’æ˜¥æœŸæœ«æœŸ, å¤§è„‘å…³é—­äº†ä¸€åŠçš„èƒ½åŠ›, ä»…ä»…åªä¿ç•™äº†ä¸€ç§æ€ç»´æ¨¡å¼, è¿™ç§æ€ç»´æ¨¡å¼åœ¨ç”Ÿå‘½æœ€åˆçš„åå¹´å·¦å³æ˜¯æœ€æœ‰ä»·å€¼çš„â€</li><li>å‘ç°ä¸é€šé¡º, ä¸­å›½äººæœªå¿…çœ‹çš„æ‡‚, æ‰€ä»¥æ•´ç†æ•´ç† â€œç„¶è€Œ, åœ¨é’æ˜¥æœŸæœ«æœŸ, å¤§è„‘å…³é—­äº†ä¸€åŠçš„èƒ½åŠ›, ä»…ä»…åªä¿ç•™äº†ä¸€ç§å¤§çº¦åœ¨ç”Ÿå‘½æœ€åˆçš„åå¹´éå¸¸æœ‰ä»·å€¼çš„æ€ç»´æ¨¡å¼â€</li></ol><p>Progress in both area is undoubtedly(æ— ç–‘) necessary for the social(ç¤¾ä¼š), political(æ”¿æ²») and intellectual(æ™ºæ…§, ä½† æ–‡åŒ– æ›´ç¬¦åˆ, åªä¸è¿‡æ²¡æœ‰è¿™ä¸ªæ„æ€ç½¢äº†) development of these and all other societies(ç¤¾ä¼š); however, the conventional(å¸¸è§„çš„) view that education should be one of the very highest priorities for promoting rapid economic development in poor countries is wrong.</p><ol><li>æ‰¾åˆ°è¿è¯ <code>;</code>, å¥å­åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†</li><li>å‰ä¸€å¥çš„è°“è¯­æ˜¯, <code>is</code>, æ•´å¥æ˜¯ä¸€ä¸ª ä¸»ç³»è¡¨ ç»“æ„, è¡¨è¯­æ˜¯ necessary</li><li>æ‰€ä»¥ä¸»è¯­æ˜¯ Progress , ä¸»è¯­çš„å®šè¯­æ˜¯ in both area , è¡¨ç¤º â€œåœ¨è¿™ä¸¤ä¸ªé¢†åŸŸçš„è¿›åº¦â€</li><li>ä¸»å¹²ç¿»è¯‘æˆ â€œè¿›åº¦æ˜¯å¿…é¡»çš„â€</li><li><code>for the social, political and intellectual development</code> å¯¹äºç¤¾ä¼š, æ”¿æ²»å’Œæ–‡åŒ–çš„å‘å±•</li><li><code>of these and all other societies</code> è¿™äº›å’Œå…¶ä»–æ‰€æœ‰ç¤¾ä¼šçš„, ç®€ç§° å…¨ç¤¾ä¼šçš„</li><li>å‰é¢ä¸€å¥æ•´ä½“ç¿»è¯‘æˆ â€œå¯¹äºç¤¾ä¼š, æ”¿æ²»å’Œæ–‡åŒ–åœ¨å…¨ç¤¾ä¼šçš„å‘å±•åœ¨ä¸¤ä¸ªé¢†åŸŸçš„è¿›å±•æ— ç–‘æ˜¯å¿…é¡»çš„â€</li><li>åé¢ä¸€å¥çš„è°“è¯­æ˜¯ <code>is</code> , æ‰€ä»¥æ•´å¥æ˜¯ ä¸»ç³»è¡¨ ç»“æ„, ä¸»è¯­æ˜¯ <code>the conventional(å¸¸è§„çš„ adj) view</code> ç¿»è¯‘æˆå¸¸è§„çš„è§‚ç‚¹, è¡¨è¯­æ˜¯ <code>wrong</code> é”™è¯¯çš„, æ•´å¥ â€œè§‚ç‚¹æ˜¯é”™è¯¯çš„â€</li><li>ç°åœ¨ç¿»è¯‘ä¿®é¥°æˆåˆ†, <code>that education should be one of the very highest priorities for promoting rapid economic development in poor countries</code>æ˜¯ä»å¥</li><li>ä½†æ˜¯æˆ‘ä»¬ éœ€è¦åˆ¤æ–­æ˜¯ ä¸»è¯­ä»å¥(ä½†ä¸»è¯­å·²ç»æ˜¯<code>view</code>äº†)è¿˜æ˜¯å®šè¯­ä»å¥(ä½†å®šè¯­ä»å¥çš„ <code>that</code> ä¸€èˆ¬ä¿®é¥°ä¸»è¯­æˆ–è€…å®¾è¯­è¿™ç§æˆåˆ†, ä½†æ˜¯åœ¨ä»å¥ä¸­å¹¶ä¸ç¼ºå°‘), è¿˜æ˜¯åŒä½è¯­ä»å¥( <code>that</code> ä¸åšä»»ä½•æˆåˆ†, æ˜æ˜¾æ˜¯åŒä½è¯­ä»å¥)</li><li>åŒä½è¯­ä»å¥çš„ è°“è¯­æ˜¯ <code>should be</code> æ‰€ä»¥å‰é¢çš„ä¸»è¯­æ˜¯ <code>education</code> æ•™è‚², è¡¨è¯­æ˜¯ <code>one</code></li><li><code>of the very highest priorities</code> å®šè¯­, ç¿»è¯‘æˆâ€æœ€é«˜ä¼˜å…ˆçº§çš„â€</li><li><code>for promoting rapid economic development</code> åšçŠ¶è¯­, ç¿»è¯‘æˆâ€å¯¹äºä¿ƒè¿›å¿«é€Ÿçš„ç»æµå‘å±•â€</li><li><code>in poor countries</code> å¯ä»¥æ˜¯ å®šè¯­ ç¿»è¯‘æˆ â€œå¯¹äºå›°éš¾å›½å®¶ä¿ƒè¿›å¿«é€Ÿç»æµå‘å±•â€, å¯ä»¥åšæˆçŠ¶è¯­ â€œå¯¹äºåœ¨å›°éš¾å›½å®¶ä¿ƒè¿›å¿«é€Ÿçš„ç»æµå‘å±•â€</li><li>åé¢ä¸€æ•´å¥å¯ä»¥ç¿»è¯‘æˆ â€œç„¶è€Œ, æ•™è‚²â€</li></ol><p>ç¿»è¯‘ï¼šå¯¹äºè¿™äº›å›½å®¶å’Œæ‰€æœ‰å…¶ä»–çš„ç¤¾ä¼šã€æ”¿æ²»ä»¥åŠçŸ¥è¯†å‘å±•ï¼Œè¿™ä¸¤æ–¹é¢çš„è¿›æ­¥æ¯«æ— ç–‘é—®æ˜¯å¿…è¦çš„;ä½†æ˜¯ï¼Œæ•™è‚²åº”è¯¥æ˜¯ä¿ƒè¿›è´«ç©·å›½å®¶ç»æµè¿…é€Ÿå‘å±•çš„æœ€ä¼˜å…ˆè€ƒè™‘çš„äº‹æƒ…ä¹‹ä¸€ï¼Œè¿™æ ·çš„ä¼ ç»Ÿè§‚ç‚¹æ˜¯é”™è¯¯çš„ã€‚</p><p>however, the conventional view that education should be one of the very highest priorities for promoting rapid economic development in poor countries is wrong.</p><p>ç„¶è€Œï¼Œè®¤ä¸ºæ•™è‚²åº”è¯¥æ˜¯ä¿ƒè¿›è´«ç©·å›½å®¶ç»æµå¿«é€Ÿå‘å±•çš„æœ€ä¼˜å…ˆäº‹é¡¹ä¹‹ä¸€çš„ä¼ ç»Ÿè§‚ç‚¹æ˜¯é”™è¯¯çš„ã€‚</p><blockquote><p>that education should be one of the very highest priorities for promoting rapid economic development in poor countries</p><p>æ˜¯åŒä½è¯­</p><p>ä»</p><ul><li>that ä¸åšä»å¥çš„æˆåˆ†</li><li>view æ˜¯æŠ½è±¡åè¯</li></ul><p>åˆ¤æ–­å‡ºæ¥æ˜¯åŒä½è¯­ä»å¥</p></blockquote><p>It is difficult to the point of impossibility for the average reader under the age of forty to imagine a time when high-quality arts criticism could be found in most big-city newspapers. </p><p><code>criticism [&#39;kritisizam] n.æ‰¹è¯„ï¼Œè¯„è®º</code><br><code>critic [&#39;kritik] n.è¯„è®ºå®¶ï¼Œ æ‰¹è¯„å®¶</code></p><h4 id="it-å¼•å¯¼çš„ä¸»è¯­ä»å¥"><a href="#it-å¼•å¯¼çš„ä¸»è¯­ä»å¥" class="headerlink" title="it å¼•å¯¼çš„ä¸»è¯­ä»å¥"></a>it å¼•å¯¼çš„ä¸»è¯­ä»å¥</h4><p><code>to do sth</code> æˆ–è€… <code>ä¸»è¯­ä»å¥</code></p><h4 id="å½“å…³ç³»å‰¯è¯å¼•å¯¼å®šè¯­ä»å¥ä¸çŠ¶è¯­ä»å¥çš„åŒºåˆ«"><a href="#å½“å…³ç³»å‰¯è¯å¼•å¯¼å®šè¯­ä»å¥ä¸çŠ¶è¯­ä»å¥çš„åŒºåˆ«" class="headerlink" title="å½“å…³ç³»å‰¯è¯å¼•å¯¼å®šè¯­ä»å¥ä¸çŠ¶è¯­ä»å¥çš„åŒºåˆ«"></a>å½“å…³ç³»å‰¯è¯å¼•å¯¼å®šè¯­ä»å¥ä¸çŠ¶è¯­ä»å¥çš„åŒºåˆ«</h4><p>å…³ç³»å‰¯è¯å¾€å‰çœ‹, å¦‚æœåŒ¹é…çš„åè¯ä¸å…³ç³»å‰¯è¯åŒ¹é…(è¿‘ä¹‰è¯), ä¸€èˆ¬éƒ½æ˜¯å®šè¯­ä»å¥</p><blockquote><p>when &#x3D;&gt; time&#x2F;age â€¦</p><p>where &#x3D;&gt; place&#x2F;city â€¦</p><p>why &#x3D;&gt; reason&#x2F;cause â€¦</p></blockquote><p>It is difficult(å›°éš¾çš„) to the point(è§‚ç‚¹) of impossibility(ä¸å¯èƒ½çš„) for the average reader under the age of forty to imagine a time when high-quality arts criticism could be found in most big-city newspapers. </p><p>ç¿»è¯‘: </p><p>ä¸»è¯­æ˜¯ <code>is</code> , ä¸»ç³»è¡¨ç»“æ„ <code>it</code> åšå½¢å¼ä¸»è¯­, <code>difficult</code> åšè¡¨è¯­</p><p><code>it</code> åé¢æœ‰ä¸¤ç§å¯èƒ½</p><ul><li><code>to do sth</code></li><li>ä¸»è¯­ä»å¥</li></ul><blockquote><p>å¯ä»¥ç¡®å®šçš„æ˜¯åé¢ä¸€å®šæœ‰ä¸€ä¸ªåŠ¨è¯</p></blockquote><p>æ‰¾åˆ°å½¢å¼ä¸»è¯­å®é™…æŒ‡å‘çš„éƒ¨åˆ†æ˜¯<code>to imagine a time</code> æƒ³è±¡ä¸€ä¸ªæ—¶ä»£æ˜¯å¾ˆéš¾çš„</p><p>It is difficult to the point of impossibility for the average reader under the age of forty to imagine a time when high-quality arts criticism could be found in most big-city newspapers. </p><p><code>to the point of</code> åˆ°â€¦åœ°æ­¥</p><p>It(å½¢å¼ä¸»è¯­) is(è°“è¯­) difficult(è¡¨è¯­, å›°éš¾çš„) to the point of impossibility(åˆ°ä¸å¯èƒ½çš„åœ°æ­¥) for the average reader(çŠ¶è¯­) under the age(å®šè¯­) of forty(å®šè¯­) to imagine a time(æ—¶æœŸ) when high-quality(é«˜è´¨é‡) arts(è‰ºæœ¯) criticism(æ„è§) could be found in most big-city newspapers. </p><p>itæ—¢ç„¶æ˜¯å½¢å¼ä¸»è¯­, ç›´æ¥æŠŠçœŸæ­£çš„ä¸»è¯­æ‹¿å‡ºæ¥</p><p>æ‰€ä»¥å˜æˆ imagine a time is diffcult, æƒ³è±¡ä¸€ä¸ªæ—¶ä»£éå¸¸å›°éš¾</p><p>å¯¹äº40å²ä»¥ä¸‹çš„æ™®é€šè¯»è€…æ¥è¯´, å¾ˆéš¾æƒ³è±¡ä¸€ä¸ªæ—¶ä»£, è¿™ä¸ªæ—¶ä»£ä½ å¯ä»¥åœ¨å¤§åŸå¸‚çš„æŠ¥çº¸é‡Œæ‰¾åˆ°å„ç§é«˜è´¨é‡çš„è¯„è®º</p><p>The growth of specialization in the nineteenth century, with its consequent requirement of a longer, more complex training, implied greater problem for amateur participation in science.</p><p>19ä¸–çºªä¸“ä¸šçš„å‘å±•, éšä¹‹å¸¦æ¥é•¿æ—¶é—´çš„å’Œæ›´å¤æ‚çš„åŸ¹è®­éœ€æ±‚, è¿™æš—ç¤ºäº†ç»™è¿›å…¥ç§‘å­¦ç•Œçš„ä¸šä½™çˆ±å¥½è€…å¾ˆå¤§çš„å›°éš¾</p><h1 id="â˜…å¹¶åˆ—å¥"><a href="#â˜…å¹¶åˆ—å¥" class="headerlink" title="â˜…å¹¶åˆ—å¥"></a>â˜…å¹¶åˆ—å¥</h1><h2 id="â˜…ä»€ä¹ˆæ˜¯å¹¶åˆ—å¥"><a href="#â˜…ä»€ä¹ˆæ˜¯å¹¶åˆ—å¥" class="headerlink" title="â˜…ä»€ä¹ˆæ˜¯å¹¶åˆ—å¥?"></a>â˜…ä»€ä¹ˆæ˜¯å¹¶åˆ—å¥?</h2><h3 id="â˜…ç”¨è¿è¯è¿æ¥ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„å¥å­"><a href="#â˜…ç”¨è¿è¯è¿æ¥ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„å¥å­" class="headerlink" title="â˜…ç”¨è¿è¯è¿æ¥ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„å¥å­"></a>â˜…<code>ç”¨è¿è¯è¿æ¥ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„å¥å­</code></h3><h2 id="â˜…å¸¸è§çš„å¹¶åˆ—è¿è¯"><a href="#â˜…å¸¸è§çš„å¹¶åˆ—è¿è¯" class="headerlink" title="â˜…å¸¸è§çš„å¹¶åˆ—è¿è¯"></a>â˜…å¸¸è§çš„å¹¶åˆ—è¿è¯</h2><ul><li>â˜…å¹³è¡Œå…³ç³»</li></ul><p><code>and, not only...but also, both...and..., either ... or ... , neither ... nor ...</code></p><ul><li>â˜…è½¬æŠ˜</li></ul><p><code>but, while, yet, whereas</code></p><ul><li>â˜…é€‰æ‹©</li></ul><p><code>or, whether ... or ...</code></p><ul><li>â˜…å› æœå…³ç³»</li></ul><p><code>for, so</code></p><ul><li>é€’è¿›</li></ul><p>é€’è¿›æ²¡æœ‰è¿è¯, åªæœ‰å‰¯è¯æˆ–è€…ä»‹è¯çŸ­è¯­, æ¯”å¦‚: <code>then</code>, ä»–æ˜¯ä¸€ä¸ªå‰¯è¯</p><p>as well asâ€¦ ä»¥åŠâ€¦</p><p>rather thanâ€¦ è€Œéâ€¦</p><p>We as well as John like it. æˆ‘å’ŒJohnä¸€æ ·å–œæ¬¢å®ƒ</p><p>He is happy rather than sad. ä»–å¾ˆå¼€å¿ƒ, è€Œä¸æ˜¯ä¼¤å¿ƒ</p><p>He is interested in music rather than in paining. ä»–å¯¹éŸ³ä¹æœ‰å…´è¶£, è€Œä¸æ˜¯ç”»ç”»</p><p>He as well as I is interested in music.</p><p>He no less than I is interested in music.</p><p>He together with me is interested in music.</p><p>He along with me is interested in music.</p><p>ä»–å’Œæˆ‘éƒ½å¯¹éŸ³ä¹æœ‰å…´è¶£.</p><p>å…¶ä¸­ as well as å’Œ no less than è¿™äº›éƒ½æ˜¯ è¿è¯ è€Œ together with å’Œ along with åˆ™ä¸ºä»‹è¯, ä»‹è¯ä¸€èˆ¬å’Œåè¯åœ¨ä¸€èµ·è¢«ç§°ä¹‹ä¸º ä»‹å®¾ , æ‰€ä»¥ä»£è¯ I å˜æˆ me.</p><p>He rather than I is interested in music.</p><p>He, instead of me, is interested in music.</p><p>He, not I, is interested in music.</p><h3 id="é€»è¾‘å…³ç³»è¯è¿˜å¯ä»¥æ˜¯å‰¯è¯"><a href="#é€»è¾‘å…³ç³»è¯è¿˜å¯ä»¥æ˜¯å‰¯è¯" class="headerlink" title="é€»è¾‘å…³ç³»è¯è¿˜å¯ä»¥æ˜¯å‰¯è¯"></a>é€»è¾‘å…³ç³»è¯è¿˜å¯ä»¥æ˜¯å‰¯è¯</h3><ul><li>â˜…å¹³è¡Œ</li></ul><p>å‰¯è¯(<code>adv</code>): <code>similarly, equally, likewise, simultaneously</code></p><p>ä»‹è¯çŸ­è¯­(<code>prep</code>): <code>at the same time, in the meanwhile</code></p><ul><li>â˜…è½¬æŠ˜</li></ul><p>å‰¯è¯(<code>adv</code>): <code>however, nevertheless, nonetheless, conversely, contrarily, unfortunately, unexpectedly</code></p><p>ä»‹è¯çŸ­è¯­(<code>prep</code>): <code>on the contrary, in/by contrast</code></p><ul><li>â˜…é€‰æ‹©</li></ul><p><code>alternatively</code></p><ul><li>â˜…å› æœ</li></ul><p>å‰¯è¯: <code>therefore, thus, consequently</code></p><p>ä»‹è¯çŸ­è¯­: <code>as a result, as a consequence</code></p><ul><li>â˜…é€’è¿›</li></ul><p>å‰¯è¯: <code>besides, additionally, subsequently</code></p><p>ä»‹è¯çŸ­è¯­: <code>in addition</code></p><blockquote><p>â˜… <strong><code>è¿è¯å‰é¢æœ‰æ— é€—å·éƒ½å¯ä»¥, è€Œå…¶ä»–çš„é€»è¾‘å…³ç³»è¯å‰é¢è¦ä¹ˆç”¨å¥å· æ–­æˆä¸¤ä¸ªå¥å­, è¦ä¹ˆåŠ  è¿è¯ and, å¹¶ä¸” and æ²¡æœ‰æ„æ€</code></strong></p></blockquote><p>ä¾‹å­:</p><p>æœ‰æœ‹è‡ªè¿œæ–¹æ¥, ä¸äº¦ä¹ä¹</p><p><code>The friends come from afar so it is a joy for me.</code></p><p><code>â–²The friends coming form afar it is a joy for me.</code></p><blockquote><p>è¿è¯è¿æ¥çš„æ˜¯ä¸¤ä¸ªå¥å­, ä½†ç‹¬ç«‹ä¸»æ ¼çš„å¥å­åªèƒ½æœ‰ä¸€å¥è¯, æ‰€ä»¥æ ‡è®°â–²çš„é‚£å¥è¯ä¸èƒ½æœ‰è¿è¯</p></blockquote><p>éƒ½è¯´æˆ‘å¦‚æ°´ç™¾å˜, å¯çŸ¥æˆ‘æ¸…æ¾ˆä¸å˜.</p><p><code>I am said like water changeable, but my clarify remains the same.</code></p><p><code>I am said like water changeable, and on the contrary, my clarify remains the same.</code></p><p>å¾ˆå¤šäººéƒ½æƒ³ä¸åŠ³è€Œè·, ä¹Ÿè®¸ä»–ä»¬å¿½ç•¥äº†æ²¡æœ‰ç‰ºç‰²å°±æ²¡æœ‰å¥½çš„ç»“æœ</p><p><code>a sea of people desire to achieve what they want without any work, whereas they may just ignore that nothing good comes without sacrifice.</code></p><h2 id="å¹¶åˆ—å¥çš„å¼•ç”¨"><a href="#å¹¶åˆ—å¥çš„å¼•ç”¨" class="headerlink" title="å¹¶åˆ—å¥çš„å¼•ç”¨"></a>å¹¶åˆ—å¥çš„å¼•ç”¨</h2><h3 id="â˜…å†™ä½œ"><a href="#â˜…å†™ä½œ" class="headerlink" title="â˜…å†™ä½œ"></a>â˜…å†™ä½œ</h3><p>å†™ä½œçš„æ—¶å€™åªè¦ä¸Šä¸‹æ–‡ä¹‹é—´æœ‰é€»è¾‘å…³ç³», å°±ä¸€å®šè¦ç”¨é€»è¾‘å…³ç³»è¯, å› ä¸ºä»€ä¹ˆé€»è¾‘å…³ç³»è¯, å°±æ²¡æœ‰é€»è¾‘</p><p>æ¯è—¤è€æ ‘æ˜é¸¦, å°æ¡¥æµæ°´äººå®¶, å¤é“è¥¿é£ç˜¦é©¬, å¤•é˜³è¥¿ä¸‹, æ–­è‚ äººåœ¨å¤©æ¶¯</p><p><code>â˜…There, in the distance(çŠ¶è¯­åšæ’å…¥è¯­), are withered vines around an old tree, and a crowd of crows are sitting on it at dusk.</code></p><p><code>not far from it, there exists a small bridge with running water under it near a cottage.</code></p><p><code>Besides, A lean horse is walking on an ancient path in the west wind.</code></p><p><code>At the moment when the sun is setting, a heartbroken man is far from home.</code></p><p>å…»å® ç‰©çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆ?</p><ul><li><code>Pets can be injurious to their neighbors or strangers.</code></li><li><code>Pets usually make our home environment rather nasty.</code></li></ul><p>è¿æ¥åœ¨ä¸€èµ·</p><p><code>â˜…Pets can not only be injurious to their neighbors or strangers but also usually make our home environment rather nasty.</code></p><p>â˜…æ—¢ç„¶æ­£ç‰ˆå…‰ç›˜å¯¹äºå¤§å­¦ç”Ÿå¾ˆå®¹æ˜“å¾—åˆ°, é‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦æ”¯æŒæ­£ç‰ˆå‘¢?</p><p><code>â˜…Pirated discs are easy to be available for university students, and therefore why do we support the genuine ones?</code></p><h2 id="â˜…å¹¶åˆ—çœç•¥"><a href="#â˜…å¹¶åˆ—çœç•¥" class="headerlink" title="â˜…å¹¶åˆ—çœç•¥"></a>â˜…å¹¶åˆ—çœç•¥</h2><h3 id="â˜…å¹¶åˆ—å¥çš„çœç•¥åŸåˆ™"><a href="#â˜…å¹¶åˆ—å¥çš„çœç•¥åŸåˆ™" class="headerlink" title="â˜…å¹¶åˆ—å¥çš„çœç•¥åŸåˆ™"></a>â˜…å¹¶åˆ—å¥çš„çœç•¥åŸåˆ™</h3><ul><li><p>â˜…è¯æ€§å¯¹ç§°: å¹¶åˆ—è¿è¯å‰åçš„è¯æ€§, å•å¤æ•°, æ—¶æ€å’Œè¯­æ€è¦ä¸€è‡´</p><p><code>the little boy found a thief and he called the police at once.</code></p></li><li><p>â˜…å¯ä»¥çœç•¥çš„æˆåˆ†</p><ul><li>â˜…çœç•¥ä¸»è°“ <code>he is not only a nice teacher in class but also (he is) nice friends to his students in private</code></li><li>â˜…çœç•¥beåŠ¨è¯ <code>Failing hips can be replaced, clinical depression controlled, and cataracts removed in a 30-minute surgical procedure</code></li><li>â˜…çœç•¥ä¸»è¯­ <code>He is rice, but (He) leads a modest life</code></li><li>â˜…çœç•¥é‡å¤çš„æˆåˆ†: <code>Do you still remember all those years when scientists argued that smoking would kill us but the doubters insisted that we did not know (smoking would kill us) for sure.</code></li></ul></li></ul><h3 id="â˜…å¦‚ä½•æŸ¥æ‰¾çœç•¥çš„å†…å®¹"><a href="#â˜…å¦‚ä½•æŸ¥æ‰¾çœç•¥çš„å†…å®¹" class="headerlink" title="â˜…å¦‚ä½•æŸ¥æ‰¾çœç•¥çš„å†…å®¹?"></a>â˜…å¦‚ä½•æŸ¥æ‰¾çœç•¥çš„å†…å®¹?</h3><ol><li><h4 id="â˜…ä¸€å¥è¯åªè¦æœ‰çœç•¥-å°±ä¸€å®šä¼šçœç•¥åœ¨è¿è¯å-è€Œä¸æ˜¯åœ¨è¿è¯å‰-æ‰€ä»¥è¿è¯åé¢æœ‰çš„æˆåˆ†-è¿è¯å‰é¢å¯èƒ½ä¼šæœ‰-ä¹Ÿå¯èƒ½ä¸å…¨-æ‰€ä»¥è¿è¯å‰é¢æœ‰-è¿è¯åé¢æ²¡æœ‰çš„éƒ¨åˆ†ä¾¿æ˜¯çœç•¥çš„å†…å®¹"><a href="#â˜…ä¸€å¥è¯åªè¦æœ‰çœç•¥-å°±ä¸€å®šä¼šçœç•¥åœ¨è¿è¯å-è€Œä¸æ˜¯åœ¨è¿è¯å‰-æ‰€ä»¥è¿è¯åé¢æœ‰çš„æˆåˆ†-è¿è¯å‰é¢å¯èƒ½ä¼šæœ‰-ä¹Ÿå¯èƒ½ä¸å…¨-æ‰€ä»¥è¿è¯å‰é¢æœ‰-è¿è¯åé¢æ²¡æœ‰çš„éƒ¨åˆ†ä¾¿æ˜¯çœç•¥çš„å†…å®¹" class="headerlink" title="â˜…ä¸€å¥è¯åªè¦æœ‰çœç•¥, å°±ä¸€å®šä¼šçœç•¥åœ¨è¿è¯å, è€Œä¸æ˜¯åœ¨è¿è¯å‰, æ‰€ä»¥è¿è¯åé¢æœ‰çš„æˆåˆ†, è¿è¯å‰é¢å¯èƒ½ä¼šæœ‰(ä¹Ÿå¯èƒ½ä¸å…¨), æ‰€ä»¥è¿è¯å‰é¢æœ‰, è¿è¯åé¢æ²¡æœ‰çš„éƒ¨åˆ†ä¾¿æ˜¯çœç•¥çš„å†…å®¹"></a>â˜…ä¸€å¥è¯åªè¦æœ‰çœç•¥, å°±ä¸€å®šä¼šçœç•¥åœ¨è¿è¯å, è€Œä¸æ˜¯åœ¨è¿è¯å‰, æ‰€ä»¥è¿è¯åé¢æœ‰çš„æˆåˆ†, è¿è¯å‰é¢å¯èƒ½ä¼šæœ‰(ä¹Ÿå¯èƒ½ä¸å…¨), æ‰€ä»¥è¿è¯å‰é¢æœ‰, è¿è¯åé¢æ²¡æœ‰çš„éƒ¨åˆ†ä¾¿æ˜¯çœç•¥çš„å†…å®¹</h4></li></ol><p><code>I was beaten and you (was beaten) too</code> </p><h4 id="â˜…åˆ¤æ–­æ˜¯å¦çœç•¥çš„æ–¹æ³•"><a href="#â˜…åˆ¤æ–­æ˜¯å¦çœç•¥çš„æ–¹æ³•" class="headerlink" title="â˜…åˆ¤æ–­æ˜¯å¦çœç•¥çš„æ–¹æ³•:"></a>â˜…åˆ¤æ–­æ˜¯å¦çœç•¥çš„æ–¹æ³•:</h4><blockquote><p>â˜…<strong>ç›´æ¥ç¿»è¯‘, å¦‚æœç¿»è¯‘å‡ºæ¥å­˜åœ¨é—®é¢˜åˆ™è¡¨ç¤ºå¯èƒ½çœç•¥äº†æŸäº›æˆåˆ†, éœ€è¦æ‹¿ç€è¿è¯åé¢çš„æˆåˆ†å»è¿è¯å‰é¢æ‰¾å¯¹åº”é¡ºåºçš„æˆåˆ†, å°±èƒ½çŸ¥é“å°‘äº†ä»€ä¹ˆæˆåˆ†</strong></p></blockquote><blockquote><h3 id="â˜…-æ³¨æ„-è¿è¯åé¢å¥å­çš„éƒ¨åˆ†æˆåˆ†-è¿è¯å‰é¢å¯èƒ½æ²¡æœ‰-ä½†è‡³å°‘ä¼šæœ‰ä¸€ä¸ªèƒ½å¤Ÿåœ¨å‰å¥æ‰¾åˆ°-ä½†è¿è¯å‰é¢æ¯”è¿è¯åé¢å¤šçš„æˆåˆ†ç»å¯¹æ˜¯è¿è¯åé¢å¥å­ç¼ºå°‘çš„æˆåˆ†"><a href="#â˜…-æ³¨æ„-è¿è¯åé¢å¥å­çš„éƒ¨åˆ†æˆåˆ†-è¿è¯å‰é¢å¯èƒ½æ²¡æœ‰-ä½†è‡³å°‘ä¼šæœ‰ä¸€ä¸ªèƒ½å¤Ÿåœ¨å‰å¥æ‰¾åˆ°-ä½†è¿è¯å‰é¢æ¯”è¿è¯åé¢å¤šçš„æˆåˆ†ç»å¯¹æ˜¯è¿è¯åé¢å¥å­ç¼ºå°‘çš„æˆåˆ†" class="headerlink" title="â˜…**æ³¨æ„: è¿è¯åé¢å¥å­çš„éƒ¨åˆ†æˆåˆ†, è¿è¯å‰é¢å¯èƒ½æ²¡æœ‰(ä½†è‡³å°‘ä¼šæœ‰ä¸€ä¸ªèƒ½å¤Ÿåœ¨å‰å¥æ‰¾åˆ°), ä½†è¿è¯å‰é¢æ¯”è¿è¯åé¢å¤šçš„æˆåˆ†ç»å¯¹æ˜¯è¿è¯åé¢å¥å­ç¼ºå°‘çš„æˆåˆ†**"></a>â˜…**<code>æ³¨æ„: è¿è¯åé¢å¥å­çš„éƒ¨åˆ†æˆåˆ†, è¿è¯å‰é¢å¯èƒ½æ²¡æœ‰(ä½†è‡³å°‘ä¼šæœ‰ä¸€ä¸ªèƒ½å¤Ÿåœ¨å‰å¥æ‰¾åˆ°), ä½†è¿è¯å‰é¢æ¯”è¿è¯åé¢å¤šçš„æˆåˆ†ç»å¯¹æ˜¯è¿è¯åé¢å¥å­ç¼ºå°‘çš„æˆåˆ†</code>**</h3></blockquote><h4 id="â˜…Until-these-issue-are-resolved-a-technology-of-behavior-will-continue-to-be-rejected-and-with-it-possibly-the-only-way-to-solve-our-problem"><a href="#â˜…Until-these-issue-are-resolved-a-technology-of-behavior-will-continue-to-be-rejected-and-with-it-possibly-the-only-way-to-solve-our-problem" class="headerlink" title="â˜…Until these issue are resolved, a technology of behavior will continue to be rejected, and with it possibly the only way to solve our problem."></a>â˜…<code>Until these issue are resolved, a technology of behavior will continue to be rejected, and with it possibly the only way to solve our problem.</code></h4><ol><li><p>æ‰¾åˆ°è°“è¯­</p><p><code>are</code> ä¸æ˜¯, å› ä¸ºæœ‰ <code>until</code> , <code>will continue</code> æ˜¯<code>è°“è¯­</code>, è¿™æ˜¯ä¸€ä¸ªä»¥<code>a technology of behavior</code>ä¸º<code>ä¸»è¯­</code>, ä»¥ <code>will continue</code>ä¸º<code>è°“è¯­</code>çš„, <code>to be rejected</code>ä¸º<code>å®¾è¯­</code>çš„<code>ä¸»è°“å®¾ç»“æ„</code></p></li><li><p>æ‰¾è¿è¯</p><p>and </p></li><li><p>ç¿»è¯‘ä¸‹å¥å­æ˜¯å¦é€šé¡º</p><p>â€œç›´åˆ°è¿™ä¸ªé—®é¢˜è¢«è§£å†³ä¹‹å‰, è¡Œä¸ºæŠ€æœ¯å°†ä¼šç»§ç»­è¢«æ‹’ç», å¹¶ä¸”å’Œå®ƒä¸€èµ·å¯èƒ½æ˜¯å”¯ä¸€èƒ½å¤Ÿè§£å†³æˆ‘ä»¬é—®é¢˜çš„æ–¹å¼â€</p><p>æ˜æ˜¾å¥å­å¥½åƒå°‘äº†ä»€ä¹ˆ, ç¿»è¯‘ä¸é€šé¡º</p></li><li><p>æ‰¾åˆ°è¿è¯åé¢çš„æˆåˆ†</p><p>with it ä»‹è¯, possibly çŠ¶è¯­, the only way åè¯, to solve our problem å®šè¯­</p><p><code>[ä»‹è¯ + çŠ¶è¯­ + åè¯ + å®šè¯­]</code></p></li><li><p>åœ¨è¿æ¥å‰é¢çš„å¥å­ä¸­ä¸€å®šèƒ½æ‰¾åˆ°ç›¸åŒçš„</p><p><code>a technology</code> åè¯, <code>of behavior</code>å®šè¯­, <code>will continue</code>è°“è¯­, <code>to be rejected</code>å®¾è¯­</p><p><code>[åè¯ + å®šè¯­ + è°“è¯­ + å®¾è¯­]</code></p></li><li><p>â˜…ä¸¤ç›¸æ¯”è¾ƒ</p><p><code>[åè¯ + å®šè¯­ + è°“è¯­ + å®¾è¯­]</code></p><p><code>[ä»‹è¯ + çŠ¶è¯­ + åè¯ + å®šè¯­]</code></p><p>æ˜æ˜¾èƒ½å¤Ÿæ‰¾åˆ°çš„æ˜¯ <code>[åè¯ + å®šè¯­]</code> éƒ¨åˆ†, æ‰€ä»¥å‰é¢å¤šå‡ºæ¥çš„éƒ¨åˆ†æ˜¯  <code>[è°“è¯­ + å®šè¯­]</code> å¯¹åº”çš„å¥å­æ˜¯<code>will continue to be rejected</code></p><p>æŠŠå®ƒåŠ åˆ°è¿è¯ä¹‹åå¥å­çš„ç›¸åº”ä½ç½® <code>[ä»‹è¯ + çŠ¶è¯­ + åè¯ + å®šè¯­]</code> + <code>will continue to be rejected</code></p><p>å‰é¢è¯¥å¥å­æ˜¯åœ¨<code>å®šè¯­</code>ä¹‹å, åé¢è¿è¯ä¹Ÿæ˜¯è¦æ”¾åœ¨<code>å®šè¯­</code>ä¹‹å</p></li><li><p>ç¿»è¯‘</p><p>â€œç›´åˆ°è¿™ä¸ªé—®é¢˜è¢«è§£å†³ä¹‹å‰, è¡Œä¸ºæŠ€æœ¯å°†ä¼šç»§ç»­è¢«æ‹’ç», å¹¶ä¸”å’Œå®ƒä¸€èµ·å¯èƒ½æ˜¯å”¯ä¸€èƒ½å¤Ÿè§£å†³æˆ‘ä»¬é—®é¢˜çš„æ–¹å¼ä¹Ÿå°†ä¼šç»§ç»­è¢«æ‹’ç»â€</p></li></ol><h1 id="â˜…ä»£è¯æŒ‡ä»£ä»€ä¹ˆ"><a href="#â˜…ä»£è¯æŒ‡ä»£ä»€ä¹ˆ" class="headerlink" title="â˜…ä»£è¯æŒ‡ä»£ä»€ä¹ˆ?"></a>â˜…ä»£è¯æŒ‡ä»£ä»€ä¹ˆ?</h1><blockquote><h3 id="â˜…ä»£è¯æŒ‡ä»£çš„åˆ¤æ–­æ–¹æ³•-å°±è¿‘åŸåˆ™å’Œä¸€è‡´åŸåˆ™"><a href="#â˜…ä»£è¯æŒ‡ä»£çš„åˆ¤æ–­æ–¹æ³•-å°±è¿‘åŸåˆ™å’Œä¸€è‡´åŸåˆ™" class="headerlink" title="â˜…ä»£è¯æŒ‡ä»£çš„åˆ¤æ–­æ–¹æ³•: å°±è¿‘åŸåˆ™å’Œä¸€è‡´åŸåˆ™"></a>â˜…<code>ä»£è¯æŒ‡ä»£çš„åˆ¤æ–­æ–¹æ³•: å°±è¿‘åŸåˆ™å’Œä¸€è‡´åŸåˆ™</code></h3><p><code>å°±è¿‘åŸåˆ™å°±æ˜¯è·Ÿè°è¿‘å°±æ˜¯è°</code></p><p><code>ä¸€è‡´åŸåˆ™å°±æ˜¯è¯­æ³•ä¸Šçš„ä¸€è‡´å’Œæ„æ€ä¸Šçš„ä¸€è‡´(æ¯”å¦‚: it æ˜¯ç‰©, ä¸èƒ½æŒ‡ä»£äºº)</code></p><p><strong><code>ä¸»è¦ç”¨äºé•¿éš¾å¥åˆ¤æ–­ä»£è¯æŒ‡å‘çš„æ˜¯å‰é¢çš„é‚£ä¸ªæˆåˆ†</code></strong></p></blockquote><h2 id="â˜…é•¿éš¾å¥åˆ†æ"><a href="#â˜…é•¿éš¾å¥åˆ†æ" class="headerlink" title="â˜…é•¿éš¾å¥åˆ†æ"></a>â˜…é•¿éš¾å¥åˆ†æ</h2><h3 id="â˜…åˆ†æé•¿éš¾å¥çš„æ–¹æ³•"><a href="#â˜…åˆ†æé•¿éš¾å¥çš„æ–¹æ³•" class="headerlink" title="â˜…åˆ†æé•¿éš¾å¥çš„æ–¹æ³•"></a>â˜…åˆ†æé•¿éš¾å¥çš„æ–¹æ³•</h3><ol><li>â˜…æ‰¾è°“è¯­</li><li>â˜…æ‰¾è¿è¯</li><li>â˜…æ‰¾å®šè¯­</li><li>â˜…æ‰¾çŠ¶è¯­</li></ol><blockquote><p>â˜…å½“è¿è¯åœ¨è¿æ¥ä¸¤ä¸ªå•è¯çš„æ—¶å€™, è¿™ä¸ªè¿è¯å°±å½“ä½œæ²¡çœ‹åˆ°</p></blockquote><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>The <code>atoi()</code> function converts the initial portion of the string pointed to by <code>nptr</code> to int. The behavior is the same as <code>strtol(nptr, NULL, 10);</code> except(ä»‹è¯) that <code>atoi()</code> does not detect errors</p><blockquote><p>éšä¾¿æ‰¾åˆ°å¥å­åˆ†æåˆ†æ</p></blockquote><ol><li>æ‰¾è°“è¯­ converts, ä¸»å¹²ç¿»è¯‘æ˜¯ â€œatoi å‡½æ•°è½¬åŒ–å¤´éƒ¨â€</li><li><code>of the string pointed</code>å®šè¯­, å½“æ—¶å‘ç°ä¸€ä¸ªé—®é¢˜ <code>pointed</code> åŠ äº† <code>ed</code> å˜æˆåŠ¨è¯çš„ç”¨æ³•, è¿‡å»åˆ†è¯è¡¨ç¤ºè¿‡å»æˆ–è€…å®Œæˆ, è¿™é‡Œæœ‰ä¸ªçŸ­è¯­æ˜¯<code>point to</code> </li><li>æ‰€ä»¥ä¸Šé¢çš„åˆ†æ®µä¸ç®—åº”è¯¥æ˜¯<code>of the string pointed to by nptr</code> è¿™é‡Œæ˜¾è€Œæ˜“è§ <code>pointed to</code> æ˜¯è°“è¯­è¡¨ç¤ºè¢«åŠ¨, ä¸»è¯­æ˜¯ <code>the string</code> <code>by nptr</code> ç¿»è¯‘æˆè¢«è°, ä¸€èˆ¬è¢«åŠ¨è¯­å¥éƒ½æœ‰ç”¨åˆ° <code>by</code></li><li>è¿™é‡Œç¿»è¯‘æˆ â€œè¢«nptræŒ‡å‘çš„å­—ç¬¦ä¸²çš„å¼€å§‹çš„éƒ¨ä½â€, ç¿»è¯‘æˆéè¢«åŠ¨å½¢å¼ â€œnptræ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²å‰é¢éƒ¨åˆ†â€</li><li>å‰é¢ä¸€å¥è¯çš„ç¿»è¯‘æ˜¯â€atoiå‡½æ•°è½¬æ¢äº† nptr æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²å‰é¢éƒ¨åˆ†â€</li><li>åé¢éƒ¨åˆ† â€œThe behavior is the same as <code>strtol(nptr, NULL, 10);</code> except that <code>atoi()</code> does not detect errorsâ€</li><li>æœ‰ä¸€ä¸ªè¿è¯ that , æ‰€ä»¥æœ‰ä¸¤ä¸ªåŠ¨è¯, å…¶ä¸­ä¸€ä¸ªè°“è¯­</li><li>å‰é¢çš„åŠ¨è¯ is æ˜¯è°“è¯­, è¡¨ç¤º è¡Œä¸ºå’Œstrtolä¸€è‡´, åªæ˜¯atoiä¸ä¼šæŠ¥é”™</li></ol><p>â˜…Under modern conditions, this requires varying measures of centralized control and hence the help of specialized scientists such as economists and operational research experts.</p><ol><li>æ‰¾è°“è¯­ æ‰¾åˆ°æ˜¯ <code>requires</code> éœ€è¦çš„æ„æ€, æ˜¯è°“è¯­, <code>varying</code> ä¸æ˜¯åŠ¨è¯, <code>the help</code>å‰é¢æœ‰ä¸ª <code>the</code> ä¸æ˜¯åŠ¨è¯, <code>specialized </code>å‰é¢æœ‰ä¸ª <code>of</code> æ‰€ä»¥ä¹Ÿä¸æ˜¯åŠ¨è¯, åˆæ­¥åˆ¤æ–­è¿™å¥è¯æ²¡æœ‰ä»å¥</li><li>æ‰¾è¿è¯, å‘ç°æœ‰ä¸¤ä¸ª<code>and</code>, ä½†æ˜¯åé¢ä¸€ä¸ªè¿æ¥çš„æ˜¯ä¸¤ä¸ªåè¯, ç›´æ¥å¿½ç•¥, æ‰€ä»¥åªæœ‰å‰é¢çš„é‚£ä¸ª<code>and</code></li><li>åˆ¤æ–­<code>and</code> è¿è¯è¿æ¥çš„å¹¶åˆ—å¥æ˜¯å¦æœ‰æˆåˆ†ç¼ºå¤±?</li></ol><p>å›åˆ°åŸæ–‡ä¸­çœ‹çœ‹, <code>and hence the help of specialized scientists</code></p><p><code>the help</code> åè¯, <code>of specialized scientists</code>å®šè¯­, è¿™å¥è¯æ˜æ˜¾å°‘äº†<code>ä¸»è¯­</code>å’Œ<code>è°“è¯­</code></p><p>å¤§ä½“æ ¼å¼ä¼°è®¡æ˜¯<code>ä¸»è¯­ + è°“è¯­ + åè¯(å®¾è¯­) + å®šè¯­</code>å¾€å‰é¢æ‰¾æ‰¾, æœ‰æ²¡æœ‰ç±»ä¼¼çš„ç»“æ„</p><p>æ˜æ˜¾æ˜¯ <code>this requires varying measures of centralized control</code> æ‰€ä»¥è¿è¯åé¢çš„å¥å­å°‘äº† <code>this requires</code></p><p>ä¸»åŠ¨ç»™ä»–åŠ ä¸Šå»çœ‹çœ‹</p><p><code>and hence this requres the help of specialized scientists</code> ç¿»è¯‘æˆ â€œå› æ­¤, è¿™éœ€è¦ä¸“å®¶çš„å¸®åŠ©â€</p><p>å¸¦å…¥åˆ°æ•´å¥ä¸­ç¿»è¯‘çœ‹çœ‹</p><p>åœ¨ç°ä»£æ¡ä»¶ä¸‹, è¿™éœ€è¦å¤šç§é›†ä¸­æ§åˆ¶çš„æªæ–½, <code>å› æ­¤, è¿™éœ€è¦ä¸“å®¶çš„å¸®åŠ©</code>, æ¯”å¦‚ç»æµå­¦å®¶å’Œè¿ç­¹ä¸“å®¶</p><p>è¿™é‡Œçš„ <code>è¿™</code>çœç•¥æ‰å¥å­æ›´åŠ é¡ºç•…, é‚£å°±çœç•¥æ‰å§</p><p><strong>åœ¨ç°ä»£æ¡ä»¶ä¸‹, è¿™éœ€è¦å¤šç§é›†ä¸­æ§åˆ¶çš„æªæ–½, <code>å› æ­¤, éœ€è¦ä¸“å®¶çš„å¸®åŠ©</code>, æ¯”å¦‚ç»æµå­¦å®¶å’Œè¿ç­¹ä¸“å®¶</strong></p><blockquote><p><strong><code>â˜…åˆ¤æ–­è¿è¯åé¢çš„å¥å­ç¼ºå°‘ä»€ä¹ˆæˆåˆ†, å»è¿è¯å‰é¢æ‰¾, æ­£å¸¸æ‰¾è°“è¯­å°±è¡Œäº†, æ‰¾åˆ°ä¹‹åå†ç¿»è¯‘</code></strong></p><p><strong><code>â˜…å½“ç„¶å¦‚æœä¸Šé¢è¿™ç§æ–¹æ³•ä¸é€‚ç”¨äº†, è¿˜å¯ä»¥ç›´æ¥æŠŠæ„æ€ç¿»è¯‘å‡ºæ¥, çœ‹çœ‹æ„æ€æ˜¯å¦é€šç•…, å†æ¥æ‰¾ç¼ºå°‘äº†ä»€ä¹ˆ</code></strong></p></blockquote><p>â˜…<code>The data suggest, for example, that physically attractive individuals are more likely to be treated well by their parents, sought out as friends, and pursued romantically.</code></p><ol><li><p>æ‰¾è°“è¯­</p><p><code>suggest</code>æ˜¯è°“è¯­, åé¢çš„ <code>are</code> å‰é¢æœ‰ <code>that</code>, <code>to be treated</code>æ˜¯ä¸å®šå¼, <code>sought out</code> å’Œ <code>pursued</code> æ˜¯<strong>è¿‡å»åˆ†è¯</strong></p></li></ol><blockquote><p>â˜…**<code>çœ‹åˆ°åŠ¨è¯çš„è¿‡å»å½¢å¼, éœ€è¦æ³¨æ„, 1. å®ƒå¯èƒ½æ˜¯è°“è¯­; 2. å®ƒæ˜¯è¿‡å»åˆ†è¯, ä¸æ˜¯è°“è¯­</code>**</p><p><strong><code>è¿˜è®°å¾—åŠ¨è¯å˜æˆä¸æ˜¯åŠ¨è¯çš„æ–¹æ³•ä¹ˆ? 1. to do ä¸å®šå¼, è¡¨ç›®çš„; 2. do + ing åŠ¨åè¯, è¡¨ä¸»åŠ¨; 3. done(or + ed) è¿‡å»åˆ†è¯, è¡¨è¢«åŠ¨</code></strong></p><p>æ¯”å¦‚: <code>I bought a dog.</code> æˆ‘ä¹°äº†ä¸€æ¡ç‹—</p><p><code>I have a dog bought by you.</code> æˆ‘æœ‰ä¸€æ¡ç‹—, æ˜¯ä½ ä¹°çš„</p></blockquote><p>åˆ†æå‡ºæ¥, ä¸»è¯­æ˜¯ <code>the data</code>, è°“è¯­æ˜¯ <code>suggest</code>, å®¾è¯­æ˜¯ <code>that physically attractive individuals are...</code> è€Œ<code>for example</code>æ˜¯çŠ¶è¯­åšæ’å…¥è¯­å¥</p><p>ä¸»è°“å®¾, ä¸»è°“+å®¾è¯­ä»å¥çš„ç»“æ„</p><blockquote><h3 id="å‰¯è¯è¿™ä¸€è¾ˆå­åªèƒ½åšçŠ¶è¯­"><a href="#å‰¯è¯è¿™ä¸€è¾ˆå­åªèƒ½åšçŠ¶è¯­" class="headerlink" title="å‰¯è¯è¿™ä¸€è¾ˆå­åªèƒ½åšçŠ¶è¯­"></a><code>å‰¯è¯è¿™ä¸€è¾ˆå­åªèƒ½åšçŠ¶è¯­</code></h3></blockquote><ol start="2"><li>æ‰¾åˆ°è¿è¯</li></ol><p><code>and pursued romantically</code> çœ‹çš„å‡ºæ¥å®ƒä¸å®Œæ•´, å¯èƒ½ç¿»è¯‘å‡ºæ¥æœ‰é—®é¢˜</p><p>å…ˆå¤§ä½“ç¿»è¯‘çœ‹çœ‹, </p><p>æ ¹æ®æ•°æ®æ˜¾ç¤º, ä½“æ€æ¼‚äº®çš„äºº(é¢œå€¼é«˜çš„äºº)æ›´æœ‰å¯èƒ½è¢«çˆ¶æ¯æ›´å¥½çš„å¯¹å¾…, æ‰¾åˆ°æœ‹å‹å’Œå—åˆ°ä»–äººçš„è¿½æ±‚</p><p>è™½ç„¶æˆ‘çœ‹å¾—æ‡‚, ä½†æ˜æ˜¾æœ‰çœç•¥çš„éƒ¨åˆ†</p><p>åˆ†ææˆåˆ†: <code>pursued romantically</code> æ˜¯ <code>[è¿‡å»åˆ†è¯ + çŠ¶è¯­]</code>, ç¼ºå°‘<code>ä¸»è¯­å’Œè°“è¯­</code>å¾€å‰é¢æ‰¾æ‰¾</p><p>æ‰¾åˆ°äº† <code>sought out as friend</code> ä½†æ˜¯ä»–ä¹Ÿä¸å®Œæ•´, è¯´æ˜è¿˜åœ¨å‰é¢</p><p>å†æ‰¾ <code>treated well by their parents</code> ä¹Ÿç¬¦åˆ</p><p>è¿™æ¬¡èƒ½æ‰¾åˆ°äº† <code>physically attractive individuals are more likely to be</code> </p><p>åé¢çš„ä¸¤ä¸ªå¥å­ç¼ºå°‘äº†è¿™ä¸ª, ä¸è¿‡å¯ä»¥çœç•¥æ‰<code>physically attractive individuals</code></p><p>å¤šå‡ºæ¥çš„éƒ¨åˆ†æ˜¯ <code>are more likely to be</code></p><p>æŠŠä»–æ·»åŠ åˆ°åé¢ä¸¤ä¸ªå¹¶åˆ—å¥ä¸­: <code>are more likely to be sought out as friends, and are more likely to be pursued romantically.</code></p><p>ç°åœ¨ç¿»è¯‘å°±èƒ½å¤Ÿå®Œæ•´äº†</p><p>æ ¹æ®æ•°æ®æ˜¾ç¤º, ä½“æ€æ¼‚äº®çš„äºº(é¢œå€¼é«˜çš„äºº)æ›´æœ‰å¯èƒ½è¢«çˆ¶æ¯æ›´å¥½çš„å¯¹å¾…, æ›´æœ‰å¯èƒ½æ‰¾åˆ°æœ‹å‹å’Œæ›´æœ‰å¯èƒ½å—åˆ°ä»–äººçš„è¿½æ±‚</p><p><code>There is no agreement whether methodology refers to the concepts peculiar to historical work in general or to the research technique appropriate to the various branches of historical inquiry.</code></p><ol><li><p>æ‰¾åˆ°è°“è¯­, ç¡®å®šæ ¸å¿ƒ</p><p><code>is</code>, åé¢ä¸ç”¨çœ‹äº†(<code>There be</code>å¥å‹å…¶å®æ˜¯å€’è£…å¥å¼)</p></li><li><p>â˜…æ‰¾è¿è¯</p><p>â˜…<code>or</code>, å‘ç°æ˜¯<code>whether ... or ...</code> ç»„æˆçš„åŒä½è¯­ä»å¥</p><blockquote><p>â˜…ä¸ºä»€ä¹ˆè¯´æ˜¯åŒä½è¯­å‘¢? å› ä¸ºæ²¡æœ‰å…ˆè¡Œè¯, è€Œä¸”å®šä¹‰ä»å¥æ²¡æœ‰<code>whether</code>ä½œä¸ºå…³ç³»è¯çš„æƒ…å†µ</p><p>â˜…å¤ä¹ ä¸‹<code>å®šè¯­ä»å¥</code>çš„<code>å…³ç³»è¯</code>: äºº <code>who whom whose</code> ç‰© <code>that  which  as</code> è¿˜æœ‰çŠ¶è¯­ <code>when where why</code></p><p>æˆ‘è§‰å¾—åœ¨ç¿»è¯‘çš„è¿‡ç¨‹ä¸­, åŒºåˆ†æ˜¯å®šè¯­ä»å¥è¿˜æ˜¯åŒä½è¯­ä»å¥å…¶å®æ²¡ä»€ä¹ˆæ„ä¹‰</p></blockquote></li></ol><p>æ–¹æ³•è®ºæŒ‡çš„æ˜¯ä¸€èˆ¬å†å²å·¥ä½œæ‰€ç‰¹æœ‰çš„è§‚å¿µè¿˜æ˜¯æŒ‡çš„æ˜¯åˆé€‚äºå†å²è°ƒæŸ¥ä¸åŒåˆ†æ”¯çš„ç ”ç©¶æŠ€æœ¯, ç›®å‰æ²¡æœ‰è¾¾æˆä¸€è‡´</p><p>â˜…<code>As families move away from their stable community, their friends of many years, and their extended family relationships, the informal flow of information is cut off, and with it the confidence that information will be available when needed and will be trustworthy and reliable.</code></p><ol><li><p>æ‰¾è°“è¯­</p><p><code>is cut off</code></p></li><li><p>æ‰¾è¿è¯</p><ul><li><p><code>and their extended family relationships</code>: æ˜æ˜¾è¿™é‡Œæ˜¯ä¸‰ä¸ªç”¨ <code>and</code> è¿æ¥åœ¨ä¸€èµ·çš„åè¯, <code>their stable community</code>, <code>their friends of many years</code>, <code>their extended family relationships</code></p><p>æ‰€ä»¥ç¿»è¯‘éå¸¸ç®€å•, å°±æ˜¯ å®¶åº­æˆå‘˜ç¦»å¼€äº†ä»–ä»¬å¤šå¹´ç¨³å®šçš„ç¤¾åŒº, ç¦»å¼€äº†ä»–ä»¬å¤šå¹´çš„æœ‹å‹å’Œä»–ä»¬çš„è¿œæ–¹äº²æˆš</p></li><li><p><code>and with it the confidence + å®šè¯­</code>: åˆ†æçš„å‡ºæ¥ä¹Ÿæ˜¯è¢«çœç•¥äº†, <code>[ä»‹è¯ + åè¯ + å®šè¯­]</code>, åœ¨å‰é¢è‚¯å®šä¹Ÿèƒ½æ‰¾åˆ°ç›¸åº”çš„éƒ¨åˆ†, <code>the informal flow of information is cut off</code> <code>[åè¯ + å®šè¯­ + è°“è¯­]</code>, æ˜æ˜¾å‰é¢å¥å­æœ‰åé¢å¥å­æ²¡æœ‰çš„éƒ¨åˆ†æ˜¯ <code>è°“è¯­</code>, è¿™é‡Œåº”è¯¥æ˜¯è¿™æ ·<code>be trustworthy and reliable</code> + <code> is cut off</code></p></li><li><p><code>and will be trustworthy</code>: åœ¨è¿™å¥è¯ä¸­, é€šè¿‡ç¿»è¯‘ä¹Ÿèƒ½ç›´åˆ°æœ‰æˆåˆ†è¢«çœç•¥äº†, <code>[åŠ¨è¯ + åè¯]</code>, é‚£ä¹ˆåœ¨å‰é¢ä¹Ÿèƒ½æ‰¾å¾—åˆ°, <code>information will be available</code>, æ‰€ä»¥æ˜¯&#96;&#96;information and will be trustworthy&#96;</p></li><li><p>æœ€åä¸€ä¸ª <code>and</code>å…¶å®æ²¡ç”¨, å› ä¸ºä¸¤è¾¹éƒ½æ˜¯<code>åè¯</code></p></li><li><p>ç»¼åˆä¸‹ <code>As families move away from their stable community, move away from their friends of many years, and their extended family relationships, the informal flow of information is cut off, and with it the confidence that information will be available when needed and information  will be trustworthy and reliable is cut off.</code></p><p>ç¿»è¯‘ä¸‹: â€œç”±äºå®¶åº­æ¬ç¦»ä»–ä»¬ç¨³å®šçš„ç¤¾åŒº, ç¦»å¼€å¤šå¹´çš„æœ‹å‹å’Œä»–ä»¬çš„è¿œäº²è¿‘é‚», å¤±å»äº†è·å¾—å°é“æ¶ˆæ¯çš„æ¸ é“, å¯¼è‡´åœ¨éœ€è¦å°é“æ¶ˆæ¯æ—¶å¯¹æ¶ˆæ¯çš„å¯é æ€§äº§ç”Ÿè´¨ç–‘â€</p></li></ul></li></ol><p><code>In the American economy, the concept of private property embraces not only the ownership of productive resources but also certain rights, including the right to determine the price of a product or to make a free contract with another private individual.</code></p><p>åœ¨ç¾å›½çš„ç»æµä¸­, ç§æœ‰è´¢äº§çš„æ¦‚å¿µä¸ä»…åŒ…æ‹¬äº†ç”Ÿäº§èµ„æ–™çš„æ‰€æœ‰æƒ, è¿˜åŒ…æ‹¬äº†ä¸€äº›æƒåˆ©, åŒ…å«ä¸€äº›é€‚å½“çš„å†³å®šå•†å“ä»·æ ¼çš„æƒåˆ©è¿˜æœ‰å’Œä¸ªäººè‡ªç”±ç­¾è®¢å¥‘çº¦çš„æƒåˆ©</p><p>åœ¨è¿‡å»ä¸€åƒå¹´é‡Œ, ä¹Œé•‡çš„æ°´ç³»å’Œç”Ÿæ´»æ–¹å¼å¹¶æœªç»å†å¤šå°‘å˜åŒ–ï¼Œæ˜¯ä¸€åº§å±•ç°å¤æ–‡æ˜çš„åšç‰©é¦†ã€‚</p><p><code>In the past thousand years, the water system and the lifestyle in WuZhen have not undergone many changes. Therefore, it is the museum to show ancient civilization now.</code></p><p><code>As a result of this tradition, many young people continue to live with their parents after marriage. By  contrast, today, the tradition is changing. </code></p><p>ä¸¤å¥è¯</p><ol><li>ç¬¬ä¸€å¥, è°“è¯­æ˜¯ continue</li><li>ç¬¬äºŒå¥, è°“è¯­æ˜¯ is changing</li><li>æ•´ä½“ç¿»è¯‘: â€œç”±äºä¼ ç»Ÿè§‚å¿µ, è®¸å¤šå¹´è½»äººå©šåç»§ç»­å’Œä»–ä»¬çš„çˆ¶æ¯å±…ä½åœ¨ä¸€èµ·, ç›¸æ¯”è¾ƒä¸‹, ä»Šå¤©è¿™ç§ä¼ ç»Ÿè§‚å¿µæ­£åœ¨æ”¹å˜â€</li></ol><p><code>The fund is also used for purchasing music and painting facilities. As a consequence, nowadays the children in rural areas can have music and painting classes as well as children in coastal cities.</code></p><ol><li>æ€»å…±ä¸¤å¥è¯</li><li>is used è°“è¯­ </li><li>è¿™äº›èµ„é‡‘ä¹Ÿè¢«ç”¨äºè´­ä¹°éŸ³ä¹å’Œç»˜ç”»ææ–™â€¦</li><li>ç¬¬äºŒå¥è°“è¯­æ˜¯ can have</li><li>å› æ­¤, ç°åœ¨åœ¨å†œæ‘çš„å­©å­æœ‰å’Œæ²¿æµ·åŸå¸‚å­©å­ä¸€æ ·çš„éŸ³ä¹å’Œç»˜ç”»è¯¾ç¨‹</li><li>æ•´ä½“ç¿»è¯‘: â€œèµ„é‡‘åŒæ—¶è¢«åŒäºè´­ä¹°éŸ³ä¹å’Œç»˜ç”»ææ–™, å› æ­¤, ç°ä»Šå†œæ‘çš„å­©å­å¯ä»¥æœ‰å’Œæ²¿æµ·åŸå¸‚å­©å­ä¸€æ ·çš„éŸ³ä¹å’Œç»˜ç”»è¯¾ç¨‹â€</li></ol><p><code>More English books could be added because university students might improve themselves a lot in their future work if they can study English well.</code></p><ol><li><code>could be added</code> æ˜¯è°“è¯­</li><li>æ›´å¤šçš„ä¹¦åº”è¯¥è¢«åŠ å…¥(å°‘ä¸€ä¸ªä¸»è¯­, ä¸»åŠ¨å˜è¢«åŠ¨çš„é—®é¢˜)</li><li><code>because</code> å¼•å¯¼çš„åŸå› çŠ¶è¯­ä»å¥</li><li><code>if they can study English well</code>æ˜¯çŠ¶è¯­ä»å¥</li><li>æ•´ä½“çš„ç¿»è¯‘æ˜¯: â€œä½ ä»¬å¯ä»¥å¢åŠ æ›´å¤šçš„è‹±æ–‡ä¹¦ç±, å› ä¸ºå¦‚æœå¤§å­¦ç”Ÿèƒ½æŠŠè‹±è¯­å­¦çš„å¾ˆå¥½çš„è¯, ä»–ä»¬å°±å¯èƒ½åœ¨ä»Šåçš„å·¥ä½œä¸­æ›´å¥½çš„æå‡è‡ªå·±â€</li></ol><p><code>Chinese families attach great importance to their children&#39;s education. As a result, many parents argue that they should work hard to make sure that their kids get a better education. </code></p><p>çœ‹æ ‡ç‚¹ç¬¦å·, ä¸¤å¥è¯,</p><p><code>attach</code> æ˜¯è°“è¯­, <code>attach importance to</code> è®¤ä¸ºä»€ä¹ˆå¾ˆé‡è¦</p><p>ç¿»è¯‘ä¸‹å°±æ˜¯ ä¸­å›½çš„å®¶åº­è®¤ä¸ºå¯¹ä»–ä»¬å­©å­çš„æ•™è‚²å¾ˆé‡è¦, å› æ­¤â€¦</p><p>ç¬¬äºŒå¥ è°“è¯­æ˜¯<code>argue</code>, ç¿»è¯‘ä¸º è®¤ä¸º, åé¢æ˜¯ ä»å¥, æ˜æ˜¾æ˜¯å®¾è¯­ä»å¥, æ‰€ä»¥æ˜¯ ä¸»è°“å®¾ ç»“æ„</p><p>è®¸å¤šå®¶é•¿è®¤ä¸ºâ€¦</p><p> ä»å¥å¼•å¯¼è¯ <code>that</code>åšå®¾è¯­ä»å¥å¯ä»¥çœç•¥å“¦</p><p>ä»å¥è°“è¯­æ˜¯<code>should work hard to</code> éœ€è¦åŠªåŠ›å·¥ä½œ</p><p>ä»–ä»¬éœ€è¦åŠªåŠ›å·¥ä½œä»¥ç¡®ä¿â€¦</p><p>ä»å¥çš„ä»å¥ that åšå®¾è¯­ä»å¥å¼•å¯¼è¯</p><p>ä»–ä»¬çš„å­©å­è·å¾—æœ€å¥½çš„æ•™è‚²</p><p>æ•´ä½“ç¿»è¯‘:</p><p>ä¸­å›½å®¶åº­è®¤ä¸ºå­©å­çš„æ•™è‚²å¾ˆé‡è¦(ä¸­å›½å®¶åº­ååˆ†é‡è§†å­©å­çš„æ•™è‚²), å› æ­¤, è®¸å¤šå®¶é•¿è®¤ä¸ºä»–ä»¬éœ€è¦åŠªåŠ›å·¥ä½œä»¥ç¡®ä¿ä»–ä»¬çš„å­©å­å¾—åˆ°æ›´å¥½çš„æ•™è‚²</p>]]></content>
      
      
      <categories>
          
          <category> è‹±è¯­ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¹¶åˆ—å¥ </tag>
            
            <tag> çœ‹æ ‡ç‚¹ç¬¦å· </tag>
            
            <tag> çœ‹åˆ†å· </tag>
            
            <tag> å†’å· </tag>
            
            <tag> ç ´æŠ˜å· </tag>
            
            <tag> ä¸¤ä¸ªé€—å·ä¹‹é—´ </tag>
            
            <tag> ä¸»å¹²å…¬å¼ </tag>
            
            <tag> æ±‰åŒ–è¿‡ç¨‹ </tag>
            
            <tag> è¯­åº </tag>
            
            <tag> è¯­æ„ </tag>
            
            <tag> è¯­å¢ƒ </tag>
            
            <tag> å¹¶åˆ— </tag>
            
            <tag> å¹¶åˆ—çœç•¥ </tag>
            
            <tag> çœç•¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01è‹±è¯­åŸºç¡€</title>
      <link href="/2022/11/25/06%E8%8B%B1%E8%AF%AD/01%E8%8B%B1%E8%AF%AD%E5%9F%BA%E7%A1%80/"/>
      <url>/2022/11/25/06%E8%8B%B1%E8%AF%AD/01%E8%8B%B1%E8%AF%AD%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="â˜…è°“è¯­"><a href="#â˜…è°“è¯­" class="headerlink" title="â˜…è°“è¯­"></a>â˜…è°“è¯­</h1><h2 id="â˜…æ˜¯ä»€ä¹ˆ"><a href="#â˜…æ˜¯ä»€ä¹ˆ" class="headerlink" title="â˜…æ˜¯ä»€ä¹ˆ?"></a>â˜…æ˜¯ä»€ä¹ˆ?</h2><h3 id="â˜…åŠ¨è¯åªèƒ½åšè°“è¯­-è°“è¯­åªèƒ½æ˜¯åŠ¨è¯"><a href="#â˜…åŠ¨è¯åªèƒ½åšè°“è¯­-è°“è¯­åªèƒ½æ˜¯åŠ¨è¯" class="headerlink" title="â˜…åŠ¨è¯åªèƒ½åšè°“è¯­, è°“è¯­åªèƒ½æ˜¯åŠ¨è¯"></a>â˜…<strong>åŠ¨è¯åªèƒ½åšè°“è¯­, è°“è¯­åªèƒ½æ˜¯åŠ¨è¯</strong></h3><blockquote><p>â˜…ä½†æˆ‘è§‰å¾— <strong>è°“è¯­æ˜¯ä¸€ä¸ªå…·æœ‰æ—¶æ€è¯­æ€(æ—¶é—´ä¿¡æ¯å’ŒçŠ¶æ€ä¿¡æ¯)çš„åŠ¨è¯</strong>, è€Œä¸èƒ½ç®€ç®€å•å•çš„è®¤ä¸ºåŠ¨è¯å°±æ˜¯è°“è¯­</p></blockquote><h2 id="â˜…éœ€è¦æ³¨æ„ä»€ä¹ˆ"><a href="#â˜…éœ€è¦æ³¨æ„ä»€ä¹ˆ" class="headerlink" title="â˜…éœ€è¦æ³¨æ„ä»€ä¹ˆ?"></a>â˜…éœ€è¦æ³¨æ„ä»€ä¹ˆ?</h2><ol><li><h3 id="â˜…ä¸€å¥è¯ä¸­-åªèƒ½å­˜åœ¨ä¸€ä¸ªè°“è¯­-å…¶ä»–åŠ¨è¯åªèƒ½å˜æˆéè°“è¯­çš„åŠ¨è¯"><a href="#â˜…ä¸€å¥è¯ä¸­-åªèƒ½å­˜åœ¨ä¸€ä¸ªè°“è¯­-å…¶ä»–åŠ¨è¯åªèƒ½å˜æˆéè°“è¯­çš„åŠ¨è¯" class="headerlink" title="â˜…ä¸€å¥è¯ä¸­, åªèƒ½å­˜åœ¨ä¸€ä¸ªè°“è¯­, å…¶ä»–åŠ¨è¯åªèƒ½å˜æˆéè°“è¯­çš„åŠ¨è¯"></a>â˜…<strong>ä¸€å¥è¯ä¸­, åªèƒ½å­˜åœ¨ä¸€ä¸ªè°“è¯­</strong>, å…¶ä»–åŠ¨è¯åªèƒ½å˜æˆ<code>éè°“è¯­çš„åŠ¨è¯</code></h3></li><li><p>â˜…<strong>ä¸€å¥è¯ä¸­, åŠ¨è¯ç»å¯¹ä¸èƒ½å°‘</strong></p></li><li><p>â˜…<strong>ä¸€å¥è¯å½“ä¸­æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªæœ‰æ—¶æ€çš„å®ä¹‰åŠ¨è¯æˆ–è€…ç³»åŠ¨è¯çš„å­˜åœ¨, å¹¶ä¸”å……å½“è°“è¯­</strong></p></li></ol><h2 id="åŠ¨è¯åˆ†ä¸ºäº”å¤§ç±»å‹"><a href="#åŠ¨è¯åˆ†ä¸ºäº”å¤§ç±»å‹" class="headerlink" title="åŠ¨è¯åˆ†ä¸ºäº”å¤§ç±»å‹"></a>åŠ¨è¯åˆ†ä¸ºäº”å¤§ç±»å‹</h2><ol><li>å®Œå…¨ä¸åŠç‰©åŠ¨è¯</li><li>ä¸å®Œå…¨ä¸åŠç‰©åŠ¨è¯</li><li>å®Œå…¨åŠç‰©åŠ¨è¯</li><li>ä¸å®Œå…¨åŠç‰©åŠ¨è¯</li><li>æˆäºˆåŠ¨è¯</li></ol><h2 id="å¦‚ä½•åˆ¤æ–­å®Œå…¨ä¸åŠç‰©åŠ¨è¯"><a href="#å¦‚ä½•åˆ¤æ–­å®Œå…¨ä¸åŠç‰©åŠ¨è¯" class="headerlink" title="å¦‚ä½•åˆ¤æ–­å®Œå…¨ä¸åŠç‰©åŠ¨è¯?"></a>å¦‚ä½•åˆ¤æ–­å®Œå…¨ä¸åŠç‰©åŠ¨è¯?</h2><p>æˆ‘ ___ ä»–(ä¸»åŠ¨)</p><p>ä»–è¢«æˆ‘ ___ (è¢«åŠ¨)</p><p>æŠŠåŠ¨è¯å¸¦å…¥åˆ°ä¸Šé¢çš„ä¸¤å¥è¯ä¸­, å¦‚æœæ„æ€ç¬¦åˆ, åˆ™æ˜¯åŠç‰©, æ„æ€ä¸ç¬¦åˆåˆ™æ˜¯ä¸åŠç‰©</p><p>æ¯”å¦‚: </p><ol><li><p>kill</p><p>æˆ‘ kill ä»–;</p><p>ä»–è¢«æˆ‘ kill;</p><p>åŠç‰©</p></li><li><p>dance</p><p>æˆ‘ dance ä»–;</p><p>ä»–è¢«æˆ‘ dance;</p><p>ä¸ç¬¦åˆ, ä¸åŠç‰©</p></li><li><p>do</p><p>æˆ‘ do äº‹æƒ…;</p><p>äº‹æƒ…è¢«æˆ‘ do;</p><p>åŠç‰©åŠ¨è¯</p></li></ol><p>è¿˜æœ‰äº›åŠ¨è¯, æ—¢æ˜¯åŠç‰©åŠ¨è¯, åˆæ˜¯ä¸åŠç‰©åŠ¨è¯, å› ä¸ºä»–æœ‰å¤šä¸ªæ„æ€, æˆ‘ä»¬å¯ä»¥æŠŠä»–çš„æ¯ä¸ªæ„æ€å¸¦å…¥ä¸Šé¢çš„æ–¹æ³•</p><p>æ¯”å¦‚: </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sing vt. å”±(ä¸€é¦–æ­Œ)  vi. å”±æ­Œ</span><br><span class="line">run vt. ç»è¥(å·¥å‚)   vi. è·‘æ­¥</span><br><span class="line">study vt. ç ”ç©¶(é—®é¢˜) vi. è¯»ä¹¦</span><br><span class="line">kill vt.æ€(æŸäºº)     vi. æ€æˆ®</span><br></pre></td></tr></table></figure><blockquote><p>ä¸åŠç‰©åŠ¨è¯å•ç‹¬ä½¿ç”¨æ²¡æœ‰è¢«åŠ¨è¯­æ€, éœ€è¦åŠ ä¸Šä»‹è¯æ‰å¯ä»¥</p></blockquote><h2 id="å¦‚ä½•åˆ¤æ–­ä¸å®Œå…¨ä¸åŠç‰©åŠ¨è¯"><a href="#å¦‚ä½•åˆ¤æ–­ä¸å®Œå…¨ä¸åŠç‰©åŠ¨è¯" class="headerlink" title="å¦‚ä½•åˆ¤æ–­ä¸å®Œå…¨ä¸åŠç‰©åŠ¨è¯?"></a>å¦‚ä½•åˆ¤æ–­ä¸å®Œå…¨ä¸åŠç‰©åŠ¨è¯?</h2><blockquote><p>ç³»åŠ¨è¯?</p></blockquote><p>æˆ‘ ___ ä»– </p><p>ä»–è¢«æˆ‘ ___ </p><p>æ¯”å¦‚: </p><p>become</p><p>æˆ‘ æˆä¸º ä»–</p><p>ä»–è¢«æˆ‘ æˆä¸º</p><p>ç¬¬ä¸€å¥åˆä¹æƒ…ç†, ç¬¬äºŒå¥å°±ä¸è¡Œäº†, æ‰€ä»¥ä»–æ˜¯ä¸åŠç‰©åŠ¨è¯</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥</p><p>He become</p><p>He was become</p><p>ä½†æ˜¯åœ¨ä¸­æ–‡ä¸­, â€œä»–å˜æˆâ€å’Œ â€œä»–æ­£åœ¨å˜æˆâ€, æ˜æ˜¾æ„æ€ä¸å…¨, æ‰€ä»¥ä¸èƒ½ç›´æ¥ä½¿ç”¨, éœ€è¦åŠ ä¸Šè¡¥è¯­</p><blockquote><p>è¿™å°±æ˜¯ç³»åŠ¨è¯çš„åŸå› </p></blockquote><blockquote><p>åè¯åšè¡¨è¯­æ—¶ ç³»åŠ¨è¯ ç¿»è¯‘æˆ â€œæ˜¯â€, å½¢å®¹è¯åšè¡¨è¯­æ˜¯ ä¸ç¿»è¯‘, åœ°æ–¹å‰¯è¯åšè¡¨è¯­æ—¶ç¿»è¯‘æˆ â€œåœ¨â€</p></blockquote><h3 id="ä»€ä¹ˆæ˜¯ä¸å®Œå…¨ä¸åŠç‰©åŠ¨è¯"><a href="#ä»€ä¹ˆæ˜¯ä¸å®Œå…¨ä¸åŠç‰©åŠ¨è¯" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸å®Œå…¨ä¸åŠç‰©åŠ¨è¯?"></a>ä»€ä¹ˆæ˜¯ä¸å®Œå…¨ä¸åŠç‰©åŠ¨è¯?</h3><p>åŠ¨è¯æ„æ€ä¸å…¨, éœ€è¦æ·»åŠ  å½¢å®¹è¯, å‰¯è¯æˆ–è€…åè¯(å’Œåè¯ç›¸ä¼¼çš„è¯, ä»£è¯, åŠ¨åè¯, ä¸å®šå¼, åè¯æ€§ä»å¥, åè¯çŸ­è¯­ç­‰), ä»¥è¡¥å……å…¶æ„æ€çš„ä¸å…¨</p><h2 id="ä»€ä¹ˆæ˜¯ä¸å®Œå…¨åŠç‰©åŠ¨è¯"><a href="#ä»€ä¹ˆæ˜¯ä¸å®Œå…¨åŠç‰©åŠ¨è¯" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸å®Œå…¨åŠç‰©åŠ¨è¯?"></a>ä»€ä¹ˆæ˜¯ä¸å®Œå…¨åŠç‰©åŠ¨è¯?</h2><p>æœ‰ç‚¹æ„æ€, ä½†æ„æ€ä¸å…¨, éœ€è¦è¡¥å……</p><h2 id="æ³¨æ„åŠ¨è¯ä¹‹åçš„ä»‹è¯å¯èƒ½æ˜¯å›ºå®šæ­é…"><a href="#æ³¨æ„åŠ¨è¯ä¹‹åçš„ä»‹è¯å¯èƒ½æ˜¯å›ºå®šæ­é…" class="headerlink" title="æ³¨æ„åŠ¨è¯ä¹‹åçš„ä»‹è¯å¯èƒ½æ˜¯å›ºå®šæ­é…"></a>æ³¨æ„åŠ¨è¯ä¹‹åçš„ä»‹è¯å¯èƒ½æ˜¯å›ºå®šæ­é…</h2><blockquote><p>åŠ¨è¯ + ä»‹è¯ è¿™ç§å½¢å¼å¯èƒ½æ˜¯å›ºå®šæ­é…</p><p>å½“ç„¶è¿˜æ˜¯ åŠ¨è¯ + çŸ­è¯­ + ä»‹è¯ + çŸ­è¯­ è¿™ç§æƒ…å†µä¹Ÿå¯èƒ½æ˜¯å›ºå®šæ­é…</p></blockquote><h3 id="è¿™ç§æƒ…å†µè¦æ€ä¹ˆåˆ¤æ–­å®ƒåˆ°åº•æ˜¯ä¸æ˜¯å›ºå®šæ­é…å‘¢"><a href="#è¿™ç§æƒ…å†µè¦æ€ä¹ˆåˆ¤æ–­å®ƒåˆ°åº•æ˜¯ä¸æ˜¯å›ºå®šæ­é…å‘¢" class="headerlink" title="è¿™ç§æƒ…å†µè¦æ€ä¹ˆåˆ¤æ–­å®ƒåˆ°åº•æ˜¯ä¸æ˜¯å›ºå®šæ­é…å‘¢?"></a>è¿™ç§æƒ…å†µè¦æ€ä¹ˆåˆ¤æ–­å®ƒåˆ°åº•æ˜¯ä¸æ˜¯å›ºå®šæ­é…å‘¢?</h3><p>å¾ˆç®€å•ï¼Œ<strong>é¦–å…ˆåˆ¤æ–­ä»‹è¯å‰é¢çš„çŸ­è¯­æ˜¯å¦åå‘æŠ½è±¡ï¼Œç„¶åå†åˆ¤æ–­ä»‹è¯å‰é¢çš„çŸ­è¯­å’Œä»‹è¯åé¢çš„çŸ­è¯­æ˜¯å¦æœ‰å…³ç³»ï¼Œå¦‚æœæ²¡å…³ç³»ä¸€èˆ¬è¯¥ä»‹è¯å’Œåé¢çš„çŸ­è¯­ä¿®é¥°çš„åŠ¨è¯ï¼Œå¦åˆ™ä¿®é¥°çš„ä»‹è¯å‰é¢çš„éåŠ¨è¯éƒ¨åˆ†</strong></p><h3 id="é‚£ä»€ä¹ˆæ˜¯åå‘æŠ½è±¡å‘¢ï¼Ÿ"><a href="#é‚£ä»€ä¹ˆæ˜¯åå‘æŠ½è±¡å‘¢ï¼Ÿ" class="headerlink" title="é‚£ä»€ä¹ˆæ˜¯åå‘æŠ½è±¡å‘¢ï¼Ÿ"></a>é‚£ä»€ä¹ˆæ˜¯åå‘æŠ½è±¡å‘¢ï¼Ÿ</h3><p>å¾ˆç®€å•ï¼Œâ€œå°±æ˜¯é‚£ä¸ªå¥³äºº ä»‹è¯ ç©¿çº¢è‰²è¡£æœâ€ï¼Œè¿™é‡Œçš„é‚£ä¸ªå¥³äººå’Œä»‹è¯åé¢çš„å†…å®¹å­˜åœ¨å…³ç³»ï¼Œå¹¶ä¸”å¥³äººæ¯”è¾ƒæŠ½è±¡ï¼Œè¿˜ä¸å¤ªå…·ä½“ï¼Œå¯ä»¥æ˜¯ç©¿é«˜è·Ÿé‹çš„å¥³äººï¼Œå¯ä»¥æ˜¯ç«™åœ¨è½¦å­æ—è¾¹çš„å¥³äººæˆ–è€…è·‘çš„å¾ˆå¿«çš„å¥³äººç­‰ç­‰</p><h1 id="éè°“è¯­åŠ¨è¯"><a href="#éè°“è¯­åŠ¨è¯" class="headerlink" title="éè°“è¯­åŠ¨è¯"></a>éè°“è¯­åŠ¨è¯</h1><blockquote><p><strong><code>éè°“è¯­åŠ¨è¯åˆ˜æ™“è‰³è€å¸ˆè¯´ä»–ä¸æ˜¯åŠ¨è¯ï¼Œä½†æˆ‘è§‰å¾—ä¸èƒ½è¿™ä¹ˆè®¤ä¸ºï¼Œæˆ‘è®¤ä¸ºæ˜¯ä¸èƒ½ä½œè°“è¯­çš„åŠ¨è¯</code></strong></p></blockquote><h2 id="â˜…åŠ¨è¯å¦‚ä½•å˜æˆéè°“è¯­åŠ¨è¯çš„æ–¹æ³•"><a href="#â˜…åŠ¨è¯å¦‚ä½•å˜æˆéè°“è¯­åŠ¨è¯çš„æ–¹æ³•" class="headerlink" title="â˜…åŠ¨è¯å¦‚ä½•å˜æˆéè°“è¯­åŠ¨è¯çš„æ–¹æ³•?"></a>â˜…åŠ¨è¯å¦‚ä½•å˜æˆéè°“è¯­åŠ¨è¯çš„æ–¹æ³•?</h2><p>â€‹<strong>(1)â˜… <code>to + V</code> ä¸å®šå¼ è¡¨ç¤ºç›®çš„æˆ–è€…å°†æ¥<br>â€‹(2)â˜… <code>V + ed</code> è¡¨è¢«åŠ¨æˆ–å®Œæˆ<br>â€‹(3)â˜… <code>V + ing</code> ä¸»åŠ¨æˆ–è€…è¿›è¡Œ</strong></p><p><strong><code>â˜…å½“åŠ¨è¯ä¸å®šå¼(éè°“è¯­åŠ¨è¯)å……å½“ä¸»è¯­çš„æ—¶å€™, ä¸€èˆ¬å¯ä»¥å°†åŠ¨è¯ä¸å®šå¼æ”¾åˆ°å¥æœ«. åœ¨å‰é¢åŠ  it åšå½¢å¼ä¸»è¯­</code></strong></p><p>â˜…<strong>éè°“è¯­åŠ¨è¯é™¤äº†ä¸èƒ½åšè°“è¯­, å…¶ä»–æˆåˆ†éƒ½èƒ½åš, <code>ä¸»è¯­, å®¾è¯­ è¡¨è¯­ çŠ¶è¯­ å®šè¯­</code> çš†å¯</strong></p><p><strong><code>â˜…éè°“è¯­åŠ¨è¯æ˜¯ä¸€ç§åªæœ‰æ€æ²¡æœ‰æ—¶çš„æˆåˆ†, è€Œè°“è¯­æ˜¯æ—¶æ€å’ŒçŠ¶æ€éƒ½æœ‰çš„æˆåˆ†</code></strong></p><p><strong><code>â˜…éè°“è¯­åŠ¨è¯ä¸­çš„ doing å’Œ to do æ‰èƒ½åšåè¯, done ä¸èƒ½æ˜¯ç”¨ä½œåè¯</code></strong></p><p>â˜…**<code>çœ‹åˆ°åŠ¨è¯çš„è¿‡å»å½¢å¼, éœ€è¦æ³¨æ„, éè°“è¯­åŠ¨è¯å•ç‹¬å‡ºç°æ‰æ˜¯éè°“è¯­åŠ¨è¯, å¦åˆ™å¯èƒ½æ˜¯è°“è¯­</code>**</p><h2 id="åŠ¨è¯è¿‡å»å¼å¦‚ä½•åˆ¤æ–­åˆ°åº•æ˜¯è°“è¯­è¿˜æ˜¯éè°“è¯­ï¼Ÿ"><a href="#åŠ¨è¯è¿‡å»å¼å¦‚ä½•åˆ¤æ–­åˆ°åº•æ˜¯è°“è¯­è¿˜æ˜¯éè°“è¯­ï¼Ÿ" class="headerlink" title="åŠ¨è¯è¿‡å»å¼å¦‚ä½•åˆ¤æ–­åˆ°åº•æ˜¯è°“è¯­è¿˜æ˜¯éè°“è¯­ï¼Ÿ"></a><strong><code>åŠ¨è¯è¿‡å»å¼å¦‚ä½•åˆ¤æ–­åˆ°åº•æ˜¯è°“è¯­è¿˜æ˜¯éè°“è¯­ï¼Ÿ</code></strong></h2><blockquote><p><strong><code>å¾ˆç®€å•ï¼ŒåŠ ä¸Š beï¼Œåˆ¤æ–­åˆ¤æ–­æ•´ä¸ªå¥å­çš„ä¸»è¯­æ˜¯è¢«åŠ¨çš„è¿˜æ˜¯ä¸»åŠ¨çš„ï¼Ÿ</code></strong></p><p><strong><code>æ¯”å¦‚ï¼šnews papers å®ƒåªèƒ½è¢«ç™»æŠ¥ï¼Œå¦‚æœåŠ ä¸Š be åŠ¨è¯å˜æˆè¢«åŠ¨å½¢å¼ï¼Œåˆšåˆšå¥½è¡¨ç¤ºè¢«åŠ¨ï¼Œæ‰€ä»¥ä»–æ˜¯éè°“è¯­</code></strong></p><p><strong><code>æ¯”å¦‚ï¼šI loved you. æˆ‘çˆ±è¿‡ä½ ï¼Œæˆ‘æ˜¯ä¸»åŠ¨çˆ±ä½ çš„ï¼Œå¦‚æœåŠ ä¸Š be åŠ¨è¯åˆ™å˜æˆè¢«åŠ¨è¯­æ€ï¼Œæ˜æ˜¾ä¸ç¬¦åˆï¼Œæ‰€ä»¥å®ƒåªèƒ½æ˜¯è°“è¯­</code></strong></p></blockquote><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>æ¯”å¦‚ï¼šLast year the new established company participated in testing flying cars.</p><p>å‰é¢çš„ established å°±ä¸æ˜¯è°“è¯­ï¼Œparticipated æ‰æ˜¯ã€‚</p><h4 id="ä¸ºä»€ä¹ˆï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆï¼Ÿ"></a>ä¸ºä»€ä¹ˆï¼Ÿ</h4><p>å¾ˆç®€å•ï¼Œç”¨ä¸Šé¢çš„æ–¹å¼åˆ¤æ–­</p><p>é¦–å…ˆæœ‰ä¸¤ä¸ªåŠ¨è¯ï¼šestablished participated </p><p>established æ˜¯æˆç«‹çš„æ„æ€</p><p><code>participated</code> æ˜¯å‚ä¸çš„æ„æ€</p><p><code>established</code> è¡¨ç¤ºè¢«åŠ¨çš„è¯ï¼Œå°±æ„å‘³ç€ company å…¬å¸è¢«æˆç«‹ï¼Œå¯ä»¥ âˆš</p><p><code>participated</code> è¡¨ç¤ºè¢«å‚ä¸ï¼Œ<code>testing flying cars æµ‹è¯•é£è¡Œæ±½è½¦</code>ï¼Œèƒ½è¢«å‚ä¸ä¹ˆï¼Ÿä¸èƒ½ Ã—</p><p>æ‰€ä»¥ <code>participated</code> è¿™ä¸ªåŠ¨è¯ä¸èƒ½åšè¢«åŠ¨è¯­æ€ï¼Œ<code>established</code> å¯ä»¥åšè¢«åŠ¨è¯­æ€</p><p>æ˜æ˜¾ <code>established</code> æ˜¯è¢«åŠ¨éè°“è¯­ï¼Œ<code>participated</code> åªèƒ½åšä¸»åŠ¨ï¼Œè°“è¯­</p><h2 id="éè°“è¯­åŠ¨è¯çš„ä½œç”¨"><a href="#éè°“è¯­åŠ¨è¯çš„ä½œç”¨" class="headerlink" title="éè°“è¯­åŠ¨è¯çš„ä½œç”¨"></a>éè°“è¯­åŠ¨è¯çš„ä½œç”¨</h2><ol><li><strong>ç›¸å½“äºåè¯(æ³¨æ„ <code>done</code> ä¸èƒ½åšåè¯), åšä¸»&#x2F;å®¾&#x2F;è¡¨è¯­</strong></li><li><strong>ä¿®é¥°åè¯&#x2F;å¥å­, åšå®šè¯­&#x2F;çŠ¶è¯­(ä¿®é¥°ä¸€ä¸ªå¥å­æ˜¯çŠ¶è¯­, ä¿®é¥°ä¸€ä¸ªåè¯æ˜¯å®šè¯­)</strong></li></ol><h2 id="æ‰¾å‚ç…§ç‰©"><a href="#æ‰¾å‚ç…§ç‰©" class="headerlink" title="æ‰¾å‚ç…§ç‰©"></a>æ‰¾å‚ç…§ç‰©</h2><p>ä¸€ä¸ªåŠ¨ä½œåˆ°åº•æ˜¯ä¸»åŠ¨è¿˜æ˜¯è¢«åŠ¨è¿˜æ˜¯å°†æ¥, éœ€è¦æ‰¾åˆ°å¯¹åº”çš„å‚ç…§ç‰©æ‰è¡Œ, æ‰¾åˆ°å‚ç…§ç‰©æ‰ä¼šçŸ¥é“åˆ°åº•æ˜¯ä¸»åŠ¨è¿˜æ˜¯è¢«åŠ¨åˆæˆ–è€…æ˜¯å°†æ¥</p><p>ç”°é™è€å¸ˆç»™çš„æ–¹æ³•æ˜¯:</p><ol><li>éè°“è¯­åŠ¨è¯çš„ä½ç½®(å‰é¢æœ‰å°±è¿‘çš„è¯æŒ¨ç€æ¯”å¦‚: the done N, è‚¯å®šä¿®é¥° N äº†)</li><li>ä¸å¥å­ä¹‹é—´æ˜¯å¦ç”±é€—å·éš”å¼€, ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯ä¿®é¥°å¦ä¸€ä¸ªå¥å­çš„ä¸»è¯­, ä½†éœ€è¦æ»¡è¶³ç¬¦åˆé€»è¾‘, å¯èƒ½ä¸å‡†ç¡®</li><li>ä»£å…¥æ³•, éè°“è¯­åŠ¨è¯, è¦ä¹ˆä¿®é¥°å°±è¿‘çš„åè¯, è¦ä¹ˆä¿®é¥°é€—å·å¦ä¸€ä¸ªå¥å­ä¸­çš„ä¸»è¯­, ä¸¤ä¸ªéƒ½å¸¦å…¥è¯•è¯•, çœ‹çœ‹ç¬¦ä¸ç¬¦åˆé€»è¾‘å°±å¥½(è¿™ç§æœ€å‡†ç¡®)</li></ol><h2 id="ç‹¬ç«‹ä¸»æ ¼"><a href="#ç‹¬ç«‹ä¸»æ ¼" class="headerlink" title="ç‹¬ç«‹ä¸»æ ¼"></a>ç‹¬ç«‹ä¸»æ ¼</h2><ol><li>æœ‰ä¸¤ä¸ªä¸åŒçš„ä¸»è¯­</li><li>æœ‰ä¸¤ä¸ªè°“è¯­</li><li>é€‰ä¸€ä¸ªä¸é‡è¦çš„ä½œéè°“è¯­, å¦ä¸€ä¸ªä½œè°“è¯­</li><li>è®©éè°“è¯­é‚£å¥å˜æˆä¸»å¥çš„çŠ¶è¯­</li></ol><p>è¿™å°±æ˜¯<strong>ç‹¬ç«‹ä¸»æ ¼</strong></p><p>æ¯”å¦‚çŸ¥ä¹ä¸Šæœ‰äº‰è®®çš„ä¾‹å­:</p><p><code>I love you, you love me</code></p><p>è¿™å¥è¯æ˜¯é”™è¯¯çš„</p><p>æ‰€ä»¥, æˆ‘ä»¬éœ€è¦æŒ‘é€‰ä¸€ä¸ªåŠ¨è¯åšè°“è¯­</p><p><code>I loving you, you love me</code></p><p>çœ‹åˆ°äº†ä¹ˆ? ä¸¤ä¸ªåŠ¨è¯çš„å‘å‡ºè€…æ˜¯ä¸åŒçš„, ä¸€ä¸ªæ˜¯ <code>I</code> å¦ä¸€ä¸ªæ˜¯ <code>you</code></p><p>è¿™å°±æ˜¯ç‹¬ç«‹ä¸»æ ¼?</p><p>é¢, ç®—æ˜¯å§</p><p>ä¸»è¦é—®é¢˜æ˜¯ ç‹¬ç«‹ä¸»æ ¼çš„éƒ¨åˆ†<code>I loving you</code>, å¹¶æ²¡æœ‰å°½åˆ°ä¿®é¥°ä¸»è¯­çš„ä½œç”¨, çŸ¥ä¹ä¸Šå­˜åœ¨äº‰è®®çš„ä¸€éƒ¨åˆ†åŸå› ä¹Ÿåœ¨è¿™é‡Œ</p><p>æˆ‘çˆ±ä½ å’Œä½ çˆ±æˆ‘èƒ½æœ‰ä»€ä¹ˆå…³ç³»? </p><p>è¿˜æœ‰å¦ä¸€éƒ¨åˆ†çš„åŸå› æ˜¯ å¤–å›½äºº åŸºæœ¬ä¸ä¼šè¿™ä¹ˆç”¨</p><p>ä½†è¿™å¥è¯é€šä¿—æ˜“æ‡‚, åˆé€‚åƒæˆ‘è¿™æ ·çš„æ–°æ‰‹å§</p><blockquote><p>ç‹¬ç«‹ä¸»æ ¼åšçŠ¶è¯­ä¿®é¥°å¦ä¸€ä¸ªåŠ¨è¯</p></blockquote><p>ç›¸è¾ƒè€Œè¨€, æˆ‘æ›´å–œæ¬¢è¿™ä½å°å§å§(å¤§å§å§?)ä¸¾çš„ä¾‹å­:</p><p><code>I holding her handsï¼Œher face turned red. </code></p><p>å› ä¸ºæˆ‘æŠ“èµ·äº†å¥¹çš„æ‰‹, å¯¼è‡´å¥¹çš„è„¸çº¢äº†</p><p>è‡³å°‘æœ‰é€»è¾‘å…³ç³»</p><p>å½“ç„¶å¦‚æœä¸ä½¿ç”¨ç‹¬ç«‹ä¸»æ ¼çš„æ–¹å¼æˆ‘ä»¬è¿˜å¯ä»¥ç”¨è¿è¯è¿æ¥ä¸¤ä¸ªå¥å­</p><p>æ¯”å¦‚<code>Her face turned red, as I holding her hands</code></p><p>ä½†è¿™å¥è¯æ˜¯é”™è¯¯çš„, å¦‚æœä½œä¸ºä»å¥, é‚£ä¹ˆä»å¥çš„åŸºæœ¬æˆåˆ†ä¹Ÿè¦æ»¡è¶³äº”å¤§åŸºæœ¬å¥å‹</p><p><code>I holding her hands</code> è¿™å¥è¯çš„åŠ¨è¯æ˜¯ç°åœ¨åŠ¨åè¯å½¢å¼ï¼Œæ²¡åŠæ³•åšè°“è¯­ï¼Œä¸” as å¼•å¯¼çš„çŠ¶è¯­ä»å¥ä¹Ÿä¸ç¬¦åˆ</p><p><code>Her face turned red, as I am holding her hands.</code> è¿™æ ·æ‰å¯¹</p><p>å½“æˆ‘æŠ“ä½å¥¹çš„æ‰‹æ—¶ï¼Œå¥¹è„¸çº¢äº†ã€‚</p><blockquote><p>å‰é¢è¯´è¿‡, ä¸€ä¸ªè°“è¯­éœ€è¦åŒæ—¶æ»¡è¶³æ—¶æ€å’Œè¯­æ€, é€šä¿—ç‚¹è®²å°±æ˜¯åŒæ—¶æ»¡è¶³æ—¶é—´å’Œä»»åŠ¡çš„è¿›åº¦</p><p>æ—¶é—´æ˜¯:</p><ul><li><code>è¿‡å»</code></li><li><code>ç°åœ¨</code></li><li><code>å°†æ¥</code></li><li><code>è¿‡å»çš„å°†æ¥</code></li></ul><p>ä»»åŠ¡è¿›åº¦æ˜¯:</p><ul><li><code>ä¸€èˆ¬</code></li><li><code>è¿›è¡Œ</code></li><li><code>å®Œæˆ</code></li><li><code>å®Œæˆè¿›è¡Œ</code></li></ul></blockquote><blockquote><p>éè°“è¯­åŠ¨è¯ä¸èƒ½åŒæ—¶æ»¡è¶³, ä»–åªèƒ½è¡¨ç¤ºåŠ¨è¯çš„ è¢«åŠ¨, ä¸»åŠ¨å’Œç›®çš„, æˆ–è€…ä»»åŠ¡çš„å®Œæˆåº¦, to do: ä¸æ¸…æ¥šä»€ä¹ˆæ—¶å€™å®Œæˆ,å°†æ¥; doing: ä»»åŠ¡æ­£åœ¨è¿›è¡Œ; done: ä»»åŠ¡å·²ç»å®Œæˆ</p><p>ä¸èƒ½å¤Ÿè¡¨è¾¾å¼æ—¶é—´è¿™ä¸ªæ¦‚å¿µ</p><p>ä¹Ÿå°±æ˜¯è¯´éè°“è¯­åŠ¨è¯æ˜¯æ®‹ç¼ºçš„</p></blockquote><h3 id="ä¼´éšçŠ¶è¯­"><a href="#ä¼´éšçŠ¶è¯­" class="headerlink" title="ä¼´éšçŠ¶è¯­"></a>ä¼´éšçŠ¶è¯­</h3><p>å¦‚æœä¸¤ä¸ªåŠ¨è¯çš„å‘å‡ºè€…éƒ½æ˜¯ä¸»è¯­, é‚£ä¹ˆæˆ‘ä»¬å®šä¹‰è¿™ç§æƒ…å†µå«<code>ä¼´éšçŠ¶è¯­</code></p><p>æ¯”å¦‚: <code>I entered the roomï¼Œ followed by the little dog. </code></p><p>ç¿»è¯‘æˆ: â€œæˆ‘è¿›å…¥äº†æˆ¿é—´, åé¢è·Ÿç€å°ç‹—â€</p><p>è¿™é‡Œåé¢çš„ <code>followed</code> åŠ¨è¯çš„ä¸»è¯­è¢«å¿½ç•¥äº†, å› ä¸ºä¸»è¯­å‡ºç°äº†é‡å¤, æ‰€ä»¥åˆ é™¤æ‰, æ‰€ä»¥ <code>I</code> æ˜¯åé¢ä¸€å¥çš„ä¸»è¯­</p><p>å®Œæ•´çš„å¥å­æ˜¯: </p><p><code>I entryed the room, I followed by the little dog</code></p><p>æˆ‘è¿›å…¥äº†æˆ¿é—´. æˆ‘è¢«ç‹—è·Ÿç€, è¿™é‡Œçš„ <code>followed</code> æ˜¯è¢«åŠ¨</p><p>è¿™é‡Œå¤´ <code>entry</code> å’Œ <code>follow</code> åŠ¨è¯çš„å‘å‡ºè€…æ˜¯æˆ‘</p><p>å‚è€ƒ: <a href="https://www.jianshu.com/p/279c80e0dc46">è‹±è¯­å…±å­¦ç¤¾Tiara: ç‹¬ç«‹ä¸»æ ¼ï¼Œå…¶å®ä¸€ç‚¹éƒ½ä¸éš¾ - ç®€ä¹¦ (jianshu.com)</a></p><h2 id="ä¾‹å­-1"><a href="#ä¾‹å­-1" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p><code>I bought a dog.</code> æˆ‘ä¹°äº†ä¸€æ¡ç‹—, è¿™æ˜¯è°“è¯­</p><p><code>I have a dog bought by you.</code> æˆ‘æœ‰ä¸€æ¡ç‹—, æ˜¯ä½ ä¹°çš„ è¿™ä¸ªä¸æ˜¯è°“è¯­, have æ‰æ˜¯è°“è¯­, bought æ˜¯è¿‡å»åˆ†è¯</p><p>éœ€è¦æ³¨æ„:</p><blockquote><p><code>I came into the woods, seeing many brids.</code></p><p>è¿™å¥è¯çš„ç¿»è¯‘æ˜¯â€æˆ‘èµ°è¿›æ ‘æ—, çœ‹è§äº†å¾ˆå¤šé¸Ÿâ€ è¿™é‡Œç”¨<code>seeing</code> è¡¨ç¤ºä¸€è¾¹èµ°è¿›æ ‘æ—, ä¸€è¾¹çœ‹è§å¾ˆå¤šé¸Ÿ</p><p>å¦‚æœæ˜¯èµ°è¿›æ ‘æ—ä¹‹å, çœ‹è§äº†ä¸€ç¾¤é¸Ÿçš„è¯, éœ€è¦ç”¨ <code>to see</code> è¡¨ç¤ºå°†æ¥</p></blockquote><blockquote><p>éè°“è¯­åŠ¨è¯çš„æ—¶å€™çœ‹çš„æ˜¯ä¸»å¹²è°“è¯­çš„æ—¶æ€, å¦‚æœå‘ç”Ÿåœ¨ä¸»å¹²è°“è¯­æ—¶é—´ä¹‹å‰å·²ç»å®Œæˆ, åˆ™ç”¨ <code>done</code> , å¦‚æœæ˜¯ä¸»å¹²è°“è¯­åŒæ—¶, åˆ™ç”¨ <code>doing</code> , å¦‚æœæ˜¯ä¸»å¹²è°“è¯­åŠ¨è¯æ—¶é—´ä¹‹å, ç”¨ <code>to be</code> è¡¨ç¤ºå°†æ¥</p></blockquote><h2 id="â˜…å¥å­ä¸­æ²¡æœ‰åŠ¨è¯æ—¶æ€ä¹ˆåŠ"><a href="#â˜…å¥å­ä¸­æ²¡æœ‰åŠ¨è¯æ—¶æ€ä¹ˆåŠ" class="headerlink" title="â˜…å¥å­ä¸­æ²¡æœ‰åŠ¨è¯æ—¶æ€ä¹ˆåŠ?"></a>â˜…å¥å­ä¸­æ²¡æœ‰åŠ¨è¯æ—¶æ€ä¹ˆåŠ?</h2><h3 id="â˜…å½“ä¸€å¥è¯ä¸­æ²¡æœ‰åŠ¨è¯-å´éœ€è¦åŠ¨è¯çš„æ—¶å€™-æ°¸è¿œéƒ½åŠ ä¸Š-be-åŠ¨è¯-å¹¶ä¸”-be-åŠ¨è¯æ²¡æœ‰ä»»ä½•æ„æ€-å®ƒä»…ä»…æ˜¯å……å½“è°“è¯­éƒ¨åˆ†"><a href="#â˜…å½“ä¸€å¥è¯ä¸­æ²¡æœ‰åŠ¨è¯-å´éœ€è¦åŠ¨è¯çš„æ—¶å€™-æ°¸è¿œéƒ½åŠ ä¸Š-be-åŠ¨è¯-å¹¶ä¸”-be-åŠ¨è¯æ²¡æœ‰ä»»ä½•æ„æ€-å®ƒä»…ä»…æ˜¯å……å½“è°“è¯­éƒ¨åˆ†" class="headerlink" title="â˜…å½“ä¸€å¥è¯ä¸­æ²¡æœ‰åŠ¨è¯, å´éœ€è¦åŠ¨è¯çš„æ—¶å€™, æ°¸è¿œéƒ½åŠ ä¸Š be åŠ¨è¯, å¹¶ä¸” be åŠ¨è¯æ²¡æœ‰ä»»ä½•æ„æ€, å®ƒä»…ä»…æ˜¯å……å½“è°“è¯­éƒ¨åˆ†"></a>â˜…<strong>å½“ä¸€å¥è¯ä¸­æ²¡æœ‰åŠ¨è¯, å´éœ€è¦åŠ¨è¯çš„æ—¶å€™, æ°¸è¿œéƒ½åŠ ä¸Š <code>be</code> åŠ¨è¯, å¹¶ä¸” <code>be</code> åŠ¨è¯æ²¡æœ‰ä»»ä½•æ„æ€, å®ƒä»…ä»…æ˜¯å……å½“è°“è¯­éƒ¨åˆ†</strong></h3><h2 id="æ€ä¹ˆç¿»è¯‘ä¸€ä¸ªå¥å­"><a href="#æ€ä¹ˆç¿»è¯‘ä¸€ä¸ªå¥å­" class="headerlink" title="æ€ä¹ˆç¿»è¯‘ä¸€ä¸ªå¥å­?"></a>æ€ä¹ˆç¿»è¯‘ä¸€ä¸ªå¥å­?</h2><p><strong>ç¿»è¯‘æœ€å¥½å…ˆæ‰¾è°“è¯­, ç„¶åå°±èƒ½ç¡®å®šå‰é¢çš„ä¸ç®¡å¤šå°‘ä¸ªå•è¯éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ä¸»è¯­</strong>, åé¢çš„çœ‹æƒ…å†µåˆ¤æ–­</p><p>åˆ¤æ–­æ˜¯ <code>å®¾è¯­</code> è¿˜æ˜¯ <code>å®¾è¯­ + å®¾è¯­</code> è¿˜æ˜¯ <code>å®¾è¯­ + å®¾è¡¥</code> çš„ç®€å•æƒ…å†µ, å¦‚æœä¸æ˜¯åˆ™å¯èƒ½æ˜¯</p><ul><li>å®¾è¯­ä»å¥: <strong>ä¸€ä¸ªå¥å­ä»£æ›¿å®¾è¯­</strong></li><li>å½¢å®¹è¯æ€§ä»å¥(å®šè¯­ä»å¥): <strong>ä¸€ä¸ªå¥å­åšäº†å½¢å®¹è¯, ä¿®é¥°å¦ä¸€ä¸ªå¥å­</strong></li><li>å‰¯è¯æ€§ä»å¥(çŠ¶è¯­ä»å¥): <strong>ä¸€ä¸ªå¥å­åšäº†çŠ¶è¯­, ä¿®é¥°å¦ä¸€ä¸ªå¥å­</strong></li></ul><p>ç¿»è¯‘è¿˜å¯ä»¥åˆ†ä¸ºä¸¤ç§é¡ºåº</p><ul><li>ä¸»å¹²æ˜¯ä»å‰åˆ°åç¿»è¯‘</li><li>ä¿®é¥°åè¯éƒ¨åˆ†ï¼Œä¸€èˆ¬æ˜¯ä»åå¾€å‰çœ‹</li><li>ä¿®é¥°åŠ¨è¯ï¼Œä¸€èˆ¬éœ€è¦æ”¾åœ¨<ul><li>å¥é¦–</li><li>åŠ¨è¯å‰ä¸€ä¸ªä½ç½®</li><li>å¥æœ«</li><li>åŠ¨è¯åé¢çš„å›ºå®šæ­é…</li></ul></li></ul><blockquote><p><strong>åˆé€‚æ–°æ‰‹</strong></p></blockquote><h2 id="ä¾‹å­-2"><a href="#ä¾‹å­-2" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p><strong>What he does is important</strong>.   </p><ul><li>æ‰¾è°“è¯­</li></ul><p>æ ¹æ®å‰é¢çš„å®šä¹‰çœ‹, æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªè°“è¯­éœ€è¦æ—¶æ€å’Œè¯­æ€</p><p>é‚£ä¹ˆèƒ½æ‰¾åˆ°ç¬¦åˆçš„åªæœ‰ : <code>does</code> å’Œ <code>is</code></p><p>ä½† å¾ˆæ˜æ˜¾, <code>does</code> å‰é¢æœ‰ä¸€ä¸ª å¼•å¯¼è¯ <code>What</code>, ä¸æ˜¯<code>è°“è¯­</code> , è¯´æ˜æ˜¯<strong>åè¯æ€§ä»å¥</strong></p><blockquote><p>â˜… è¿™é‡Œ<strong>åˆ¤æ–­ä¸»å¹²æ˜¯å¦å®Œæ•´æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯åè¯æ€§ä»å¥</strong>çš„, æ˜æ˜¾ä¸Šé¢ä¸¤ä¸ªåŠ¨è¯éƒ½æ²¡æœ‰å®Œæ•´çš„å¥å­ç¼ºå°‘æˆåˆ†, åªèƒ½è¯´æ˜æ˜¯åè¯æ€§ä»å¥, ä¸€ä¸ªå¥å­åšäº†å¦ä¸€ä¸ªå¥å­çš„æˆåˆ†</p></blockquote><p>æ‰€ä»¥ä¸Šé¢åªæœ‰ <code>is</code> æ˜¯è°“è¯­</p><p>é‚£ä¹ˆ <code>is</code> å‰é¢çš„å¥å­å°±æ˜¯ ä¸»è¯­ <code>What he does</code></p><blockquote><p>å¯ä»¥æŠŠ<code>What he does</code>çœ‹æˆä¸€ä¸ªå•è¯ <code>A</code>, é‚£ä¹ˆå¥å­å°±å˜æˆ <code>A is important.</code> </p></blockquote><p>ç¿»è¯‘æˆ ä»–åšä»€ä¹ˆå¾ˆé‡è¦</p><h2 id="åŠ¨è¯çš„åˆ†ç±»"><a href="#åŠ¨è¯çš„åˆ†ç±»" class="headerlink" title="åŠ¨è¯çš„åˆ†ç±»"></a>åŠ¨è¯çš„åˆ†ç±»</h2><ol><li>â˜…<code>å®ä¹‰åŠ¨è¯</code>: æœ‰å®é™…æ„ä¹‰çš„åŠ¨è¯, åˆ†åŠç‰©åŠ¨è¯å’Œä¸åŠç‰©åŠ¨è¯</li><li>â˜…<code>åŠç‰©åŠ¨è¯</code>: åé¢å¿…é¡»è¦å®¾è¯­, å¹¶ä¸”æ˜¯ç›´æ¥è·Ÿä¸Šå®¾è¯­</li><li>â˜…<code>ä¸åŠç‰©åŠ¨è¯:</code> åé¢å¯ä»¥ä¸æ¥å®¾è¯­, å¦‚æœè¦åŠ ä¸Šä¸œè¥¿, å¿…é¡»åŠ ä¸Š ä»‹è¯ </li><li>â˜…<strong>è¡¨è¾¾è¯´è¯äººä¸»è§‚æ€åº¦çš„è¯, å«æƒ…æ€åŠ¨è¯, ä¸èƒ½å•ç‹¬ä½œä¸ºè°“è¯­</strong></li><li>â˜…æƒ…æ€åŠ¨è¯åšç°åœ¨å’Œå°†æ¥</li><li>â˜…<code>must</code> çš„åä¹‰è¯æ˜¯ <code>can&#39;t</code></li><li>â˜…<code>must have done</code> ä¸€å®šåšè¿‡æŸäº‹( <code>have done</code> å®Œæˆäº†, åŠ ä¸Š <code>must</code> , ä¸€å®š å®Œæˆäº†)<br><code>needn&#39;t have done</code> (<code>have done</code> å®Œæˆäº†, <code>needn&#39;t</code> ä¸éœ€è¦ , ä¸éœ€è¦åšæˆæŸäº‹ä½†å·²ç»å®Œæˆäº†)<br><code>could have done</code>(æœ¬èƒ½åšæŸäº‹ä½†æ²¡åš, é—æ†¾)<br><code>should have done</code> æœ¬åº”è¯¥åšæŸäº‹</li><li>â˜…åŠ©åŠ¨è¯<br>(1)â˜… <strong>å¸®åŠ©è°“è¯­æ„æˆæ—¶æ€, è¢«åŠ¨è¯­æ€, ç–‘é—®, å¦å®šçš„è¯å°±æ˜¯åŠ©åŠ¨è¯</strong></li></ol><h1 id="â˜…ä¸»è¯­"><a href="#â˜…ä¸»è¯­" class="headerlink" title="â˜…ä¸»è¯­"></a>â˜…ä¸»è¯­</h1><h2 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ?"></a>æ˜¯ä»€ä¹ˆ?</h2><p><strong><code>åŠ¨ä½œçš„å‘å‡ºè€…æˆ–è€…æè¿°çš„ä¸»ä½“</code></strong></p><h2 id="â˜…ä»€ä¹ˆè¯æ€§å¯ä»¥ä½œä¸ºä¸»è¯­"><a href="#â˜…ä»€ä¹ˆè¯æ€§å¯ä»¥ä½œä¸ºä¸»è¯­" class="headerlink" title="â˜…ä»€ä¹ˆè¯æ€§å¯ä»¥ä½œä¸ºä¸»è¯­?"></a>â˜…ä»€ä¹ˆè¯æ€§å¯ä»¥ä½œä¸ºä¸»è¯­?</h2><h3 id="â˜…-åè¯-ä»£è¯-éè°“è¯­åŠ¨è¯-ä»å¥-å¼•å¯¼è¯-å¥å­-è¡¨è·ç¦»çš„åœ°æ–¹å‰¯è¯çŸ­è¯­ä½œä¸»è¯­-å¯ä»¥å……å½“ä¸»è¯­"><a href="#â˜…-åè¯-ä»£è¯-éè°“è¯­åŠ¨è¯-ä»å¥-å¼•å¯¼è¯-å¥å­-è¡¨è·ç¦»çš„åœ°æ–¹å‰¯è¯çŸ­è¯­ä½œä¸»è¯­-å¯ä»¥å……å½“ä¸»è¯­" class="headerlink" title="â˜…**åè¯, ä»£è¯, éè°“è¯­åŠ¨è¯, ä»å¥(å¼•å¯¼è¯ + å¥å­), è¡¨è·ç¦»çš„åœ°æ–¹å‰¯è¯çŸ­è¯­ä½œä¸»è¯­ å¯ä»¥å……å½“ä¸»è¯­**"></a>â˜…**<code>åè¯</code>, <code>ä»£è¯</code>, <code>éè°“è¯­åŠ¨è¯</code>, <code>ä»å¥(å¼•å¯¼è¯ + å¥å­)</code>, <code>è¡¨è·ç¦»çš„åœ°æ–¹å‰¯è¯çŸ­è¯­ä½œä¸»è¯­</code> å¯ä»¥å……å½“ä¸»è¯­**</h3><p><code>From Shanghai to Beijing is about 1000 kilometers.</code></p><p>è¿˜å¯ä»¥å†™æˆ</p><p><code>It is about 1000 kilometers from Shanghai to Beijing.</code></p><h2 id="ç¿»è¯‘ä¾‹å­"><a href="#ç¿»è¯‘ä¾‹å­" class="headerlink" title="ç¿»è¯‘ä¾‹å­"></a>ç¿»è¯‘ä¾‹å­</h2><p><strong>â˜…Strong and handsome is his character.</strong></p><p>â˜…å¥å­é”™è¯¯(<code>Strong</code>å’Œ<code>handsome</code>éƒ½æ˜¯å½¢å®¹è¯, ä¸èƒ½ç›´æ¥ä½œä¸ºä¸»è¯­), éœ€è¦æ”¹å†™æˆåè¯</p><p><code>Strength(n.) and handsomeness(n.) are his charcter. </code>  </p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ›´æ”¹æˆæ›´ç®€å•çš„æ–¹å¼  </p><blockquote><p>â˜…<strong>å½“ä¸€ä¸ªå¥å­ä¸­éœ€è¦åŠ¨è¯, å´æ²¡ç”¨åŠ¨è¯çš„æ—¶å€™éœ€è¦åŠ ä¸Š <code>be</code> åŠ¨è¯</strong> </p></blockquote><p><code>Be strong and be handsome is his charcter.</code> ä½†æ˜¯è¿™é‡Œå·²ç»æœ‰ è°“è¯­ <code>is</code> äº†, éœ€è¦æŠŠä¸¤ä¸ª <code>be</code> åŠ¨è¯æ”¹æˆä¸æ˜¯åŠ¨è¯, è€Œ è¿™é‡Œæ˜¯ä¸»åŠ¨çš„, æ‰€ä»¥å¯ä»¥æ”¹æˆ</p><p>â˜…<code>Being strong and being handsome is his charcter.</code></p><blockquote><h4 id="â˜…å¦‚æœæ˜¯éè°“è¯­åŠ¨è¯åšä¸»è¯­æ—¶-ä¸€èˆ¬éƒ½æ˜¯å•æ•°å½¢å¼-æ‰€ä»¥ä½¿ç”¨-is-è€Œä¸æ˜¯-are"><a href="#â˜…å¦‚æœæ˜¯éè°“è¯­åŠ¨è¯åšä¸»è¯­æ—¶-ä¸€èˆ¬éƒ½æ˜¯å•æ•°å½¢å¼-æ‰€ä»¥ä½¿ç”¨-is-è€Œä¸æ˜¯-are" class="headerlink" title="â˜…å¦‚æœæ˜¯éè°“è¯­åŠ¨è¯åšä¸»è¯­æ—¶, ä¸€èˆ¬éƒ½æ˜¯å•æ•°å½¢å¼, æ‰€ä»¥ä½¿ç”¨ is è€Œä¸æ˜¯ are"></a>â˜…<strong>å¦‚æœæ˜¯éè°“è¯­åŠ¨è¯åšä¸»è¯­æ—¶, ä¸€èˆ¬éƒ½æ˜¯å•æ•°å½¢å¼, æ‰€ä»¥ä½¿ç”¨ <code>is</code> è€Œä¸æ˜¯ <code>are</code></strong></h4></blockquote><blockquote><p>ä¸»è¯­ä¸èƒ½ç¼ºå¤±, ä½†æ˜¯å¯ä»¥çœç•¥, ä½†è¿˜æ˜¯å­˜åœ¨ä¸»è¯­</p></blockquote><h2 id="â˜…å¦‚æœä¸­æ–‡è½¬æ¢æˆè‹±æ–‡æ—¶æ²¡æœ‰ä¸»è¯­æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¤„ç†-å››ç§æ–¹å¼"><a href="#â˜…å¦‚æœä¸­æ–‡è½¬æ¢æˆè‹±æ–‡æ—¶æ²¡æœ‰ä¸»è¯­æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¤„ç†-å››ç§æ–¹å¼" class="headerlink" title="â˜…å¦‚æœä¸­æ–‡è½¬æ¢æˆè‹±æ–‡æ—¶æ²¡æœ‰ä¸»è¯­æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¤„ç†(å››ç§æ–¹å¼)"></a>â˜…å¦‚æœä¸­æ–‡è½¬æ¢æˆè‹±æ–‡æ—¶æ²¡æœ‰ä¸»è¯­æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¤„ç†(å››ç§æ–¹å¼)</h2><h3 id="â˜…åŠ -it-ä½œä¸ºä¸»è¯­-å¿…é¡»å’Œç©ºæ°”-æ¸©åº¦-æ—¶é—´æœ‰å…³ç³»"><a href="#â˜…åŠ -it-ä½œä¸ºä¸»è¯­-å¿…é¡»å’Œç©ºæ°”-æ¸©åº¦-æ—¶é—´æœ‰å…³ç³»" class="headerlink" title="â˜…åŠ  it ä½œä¸ºä¸»è¯­, å¿…é¡»å’Œç©ºæ°” æ¸©åº¦ æ—¶é—´æœ‰å…³ç³»"></a>â˜…åŠ  <code>it</code> ä½œä¸º<code>ä¸»è¯­, å¿…é¡»å’Œç©ºæ°” æ¸©åº¦ æ—¶é—´</code>æœ‰å…³ç³»</h3><p>eg: é‡åº†çš„æ°”æ¸©å¾ˆä½</p><p><code>It is humid in ChongQing.</code></p><p>eg: é›¨ä¸€ç›´ä¸‹: </p><p><code>It keeps raining.</code></p><blockquote><p>ä¸€èˆ¬æƒ…å†µä¸‹ <code>it</code> ä½œå½¢å¼ä¸»è¯­æ˜¯æœ‰</p><ul><li><code>to do sth</code></li><li>ä¸»è¯­ä»å¥</li></ul></blockquote><h3 id="â˜…There-be-å¥å‹-ä½†ä¸€å¥è¯æ²¡æœ‰ä¸»è¯­å¹¶ä¸”å¬åˆ°äº†-â€œæœ‰â€-çš„æ—¶å€™å°±å¯ä»¥ç”¨-There-be-å¥å‹"><a href="#â˜…There-be-å¥å‹-ä½†ä¸€å¥è¯æ²¡æœ‰ä¸»è¯­å¹¶ä¸”å¬åˆ°äº†-â€œæœ‰â€-çš„æ—¶å€™å°±å¯ä»¥ç”¨-There-be-å¥å‹" class="headerlink" title="â˜…There be å¥å‹, ä½†ä¸€å¥è¯æ²¡æœ‰ä¸»è¯­å¹¶ä¸”å¬åˆ°äº† â€œæœ‰â€ çš„æ—¶å€™å°±å¯ä»¥ç”¨ There be å¥å‹"></a><code>â˜…There be</code> å¥å‹, ä½†ä¸€å¥è¯æ²¡æœ‰ä¸»è¯­å¹¶ä¸”å¬åˆ°äº† â€œæœ‰â€ çš„æ—¶å€™å°±å¯ä»¥ç”¨ <code>There be</code> å¥å‹</h3><p>eg: æœ‰å¾ˆå¤šäººå–œæ¬¢æˆ‘</p><p><code>There are(exist) a crowd of people adoring me.</code></p><p>eg: æœ‰å¾ˆå¤šåŸå› è§£é‡Šæˆ‘çš„è§‚ç‚¹</p><p><code>There are numberous factors accounting for my perspective.</code></p><h3 id="â˜…ä¸»åŠ¨å˜è¢«åŠ¨"><a href="#â˜…ä¸»åŠ¨å˜è¢«åŠ¨" class="headerlink" title="â˜…ä¸»åŠ¨å˜è¢«åŠ¨"></a>â˜…ä¸»åŠ¨å˜è¢«åŠ¨</h3><ul><li><strong>å½“ä¸€å¥è¯æ²¡æœ‰ä¸»è¯­, æˆ–è€…äººç§°ä»£è¯åšä¸»è¯­çš„æ—¶å€™, éƒ½å¯ä»¥è€ƒè™‘å†™æˆè¢«åŠ¨</strong></li></ul><p>eg: å¿…é¡»æŒ‡å‡ºåšæŒæ—¶æˆåŠŸçš„å¿…å¤‡å› ç´ </p><p><code>Perseverance must be pointed out to be an indispensable factor in out success.</code></p><p>eg: è¶Šæ¥è¶Šå¤šçš„äººè®¤ä¸ºç¯å¢ƒæ±¡æŸ“å¾ˆä¸¥é‡</p><p><code>pollution is realized severe by an increasing number of people.</code></p><h4 id="è¢«åŠ¨ç¿»è¯‘é—®é¢˜"><a href="#è¢«åŠ¨ç¿»è¯‘é—®é¢˜" class="headerlink" title="è¢«åŠ¨ç¿»è¯‘é—®é¢˜"></a>è¢«åŠ¨ç¿»è¯‘é—®é¢˜</h4><ul><li>ä¸»å®¾é¢ å€’, ä¹Ÿå°±æ˜¯å°†è¢«åŠ¨è¯­å¥çš„ä¸»è¯­å˜æˆå®¾è¯­, æŠŠå®¾è¯­å˜æˆä¸»è¯­(å¦‚æœå‡ºç°æ— ä¸»è¯­çš„æƒ…å†µ, å¢åŠ ä¸€äº›æ³›æŒ‡ä¸»è¯­)</li><li>ç”±ä¸€äº›å…¶ä»–è¯ä»£æ›¿: ç”±â€¦æ‰€&#x2F;ä¸ºâ€¦æ‰€&#x2F;ç”±â€¦æ¥</li></ul><p>æˆ‘çš„æ–¹å¼ï¼š</p><ul><li><strong>åŠ¨è¯ + ä¸»è¯­ + â€œæ˜¯â€ + åç»­</strong></li><li><strong>byéƒ¨åˆ† + åŠ¨è¯ + åç»­</strong></li><li><strong>ä¸»è¯­å’Œå®¾è¯­é¢ å€’è¿‡æ¥</strong></li></ul><h3 id="â˜…åŠ äººç§°ä»£è¯"><a href="#â˜…åŠ äººç§°ä»£è¯" class="headerlink" title="â˜…åŠ äººç§°ä»£è¯"></a>â˜…åŠ äººç§°ä»£è¯</h3><p>eg: ä¸Šå­¦</p><p><code>We/You/I go to school.</code></p><h4 id="â˜…ä»¥ä¸‹å‡ ç§æƒ…å†µæ²¡æœ‰è¢«åŠ¨åªèƒ½ç”¨äººç§°ä»£è¯"><a href="#â˜…ä»¥ä¸‹å‡ ç§æƒ…å†µæ²¡æœ‰è¢«åŠ¨åªèƒ½ç”¨äººç§°ä»£è¯" class="headerlink" title="â˜…ä»¥ä¸‹å‡ ç§æƒ…å†µæ²¡æœ‰è¢«åŠ¨åªèƒ½ç”¨äººç§°ä»£è¯"></a>â˜…ä»¥ä¸‹å‡ ç§æƒ…å†µæ²¡æœ‰è¢«åŠ¨åªèƒ½ç”¨äººç§°ä»£è¯</h4><p><strong>1) ç³»åŠ¨è¯æ²¡æœ‰è¢«åŠ¨</strong></p><p><strong>2) ä¸åŠç‰©åŠ¨è¯æ²¡æœ‰è¢«åŠ¨(å¦‚æœåŠ¨è¯åé¢è·Ÿç€ä»‹è¯, è¯¥åŠ¨è¯ä¸€èˆ¬æ²¡æœ‰è¢«åŠ¨å½¢æ€)</strong></p><p><strong>3) have ç¿»è¯‘æˆæœ‰çš„æ„æ€æ—¶, æ²¡æœ‰è¢«åŠ¨</strong></p><h1 id="â˜…å®¾è¯­"><a href="#â˜…å®¾è¯­" class="headerlink" title="â˜…å®¾è¯­"></a>â˜…å®¾è¯­</h1><h2 id="æ˜¯ä»€ä¹ˆ-1"><a href="#æ˜¯ä»€ä¹ˆ-1" class="headerlink" title="æ˜¯ä»€ä¹ˆ?"></a>æ˜¯ä»€ä¹ˆ?</h2><blockquote><p> è¢«åŠ¨è¿‡ä½œç”¨æˆ–è€…è¢«ä»‹ç»çš„ä¸»ä½“</p></blockquote><h2 id="â˜…ä»€ä¹ˆè¯æ€§å¯ä»¥ä½œä¸ºå®¾è¯­"><a href="#â˜…ä»€ä¹ˆè¯æ€§å¯ä»¥ä½œä¸ºå®¾è¯­" class="headerlink" title="â˜…ä»€ä¹ˆè¯æ€§å¯ä»¥ä½œä¸ºå®¾è¯­?"></a>â˜…ä»€ä¹ˆè¯æ€§å¯ä»¥ä½œä¸ºå®¾è¯­?</h2><h3 id="â˜…-åè¯-ä»£è¯-éè°“è¯­åŠ¨è¯-ä»å¥-è¿™é‡Œä¸»è¯­çš„æˆåˆ†å’Œå®¾è¯­ä¸€è‡´-å› ä¸ºä¸»è¯­å’Œå®¾è¯­å¯ä»¥äº’æ¢"><a href="#â˜…-åè¯-ä»£è¯-éè°“è¯­åŠ¨è¯-ä»å¥-è¿™é‡Œä¸»è¯­çš„æˆåˆ†å’Œå®¾è¯­ä¸€è‡´-å› ä¸ºä¸»è¯­å’Œå®¾è¯­å¯ä»¥äº’æ¢" class="headerlink" title="â˜…**åè¯, ä»£è¯, éè°“è¯­åŠ¨è¯, ä»å¥  è¿™é‡Œä¸»è¯­çš„æˆåˆ†å’Œå®¾è¯­ä¸€è‡´, å› ä¸ºä¸»è¯­å’Œå®¾è¯­å¯ä»¥äº’æ¢**"></a>â˜…**<code>åè¯</code>, <code>ä»£è¯</code>, <code>éè°“è¯­åŠ¨è¯</code>, <code>ä»å¥</code>  è¿™é‡Œä¸»è¯­çš„æˆåˆ†å’Œå®¾è¯­ä¸€è‡´, å› ä¸ºä¸»è¯­å’Œå®¾è¯­å¯ä»¥äº’æ¢**</h3><blockquote><p>å¯æ•°åè¯ä¸èƒ½å•ç‹¬ä½¿ç”¨, è¦ä¹ˆå˜æˆ <code>The</code>  è¦ä¹ˆå˜æˆ <code>a</code> è¦ä¹ˆå˜æˆ å¤è‹å½¢å¼<code>Women tend to love.</code></p></blockquote><h1 id="è¡¥è¯­"><a href="#è¡¥è¯­" class="headerlink" title="è¡¥è¯­"></a>è¡¥è¯­</h1><blockquote><p>è¡¥å……è¯´æ˜ä¸»è¯­å’Œå®¾è¯­çš„å†…å®¹</p></blockquote><p>è¡¨è¯­æ˜¯ è¡¥å……è¯´æ˜ä¸»è¯­</p><p>å®¾è¡¥: è¡¥å……è¯´æ˜å®¾è¯­</p><h2 id="ä»€ä¹ˆæ˜¯è¡¥å……è¯´æ˜"><a href="#ä»€ä¹ˆæ˜¯è¡¥å……è¯´æ˜" class="headerlink" title="ä»€ä¹ˆæ˜¯è¡¥å……è¯´æ˜?"></a>ä»€ä¹ˆæ˜¯è¡¥å……è¯´æ˜?</h2><p><code>The soup is too hot.</code><br><code>The dress looks pretty.</code><br><code>He become a teacher.</code><br><code>I find the dress pretty.</code><br><code>His college training made him a teacher.</code></p><p>è¦ä¹ˆåšä¿®é¥°(add), è¦ä¹ˆåšèµ‹å€¼</p><p>ä¸»ä½“.add(æ¼‚äº®) <code>She looks beautiful.</code></p><p>ä¸»ä½“ &#x3D; è€å¸ˆ <code>he become a teacher</code></p><h2 id="ä¿®é¥°æˆåˆ†"><a href="#ä¿®é¥°æˆåˆ†" class="headerlink" title="ä¿®é¥°æˆåˆ†"></a>ä¿®é¥°æˆåˆ†</h2><h3 id="å®šè¯­"><a href="#å®šè¯­" class="headerlink" title="å®šè¯­"></a>å®šè¯­</h3><p>åˆ¤æ–­æ˜¯ä¸æ˜¯å®šè¯­, éœ€è¦æ³¨æ„</p><p>å®šè¯­å¯èƒ½åœ¨å‰é¢ å‰ç½®å®šè¯­, è¿˜å¯èƒ½åœ¨åé¢, å«åç½®å®šè¯­</p><h3 id="çŠ¶è¯­"><a href="#çŠ¶è¯­" class="headerlink" title="çŠ¶è¯­"></a>çŠ¶è¯­</h3><p><code>We will hew out of the mountain of despair a stone of hope.</code></p><p><code>out of the mountain</code> ä¿®é¥°å‰é¢çš„<code>will hew</code>åŠ¨è¯, åšçŠ¶è¯­</p><p><code>of despair</code> ä¿®é¥°å‰é¢çš„<code>mountain</code>åè¯, åšå®šè¯­</p><p><code>of hope </code>ä¿®é¥°å‰é¢çš„<code>a stone</code>åè¯, åšå®šè¯­</p><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p><code>I ate an apple in the kitchen.</code> (æŒ‰ç…§è¯­ä¹‰ä¸Šåˆ¤æ–­åº”è¯¥æ˜¯åšçŠ¶è¯­), ä½†ä¹Ÿå¯èƒ½åšå®šè¯­?</p><p><code>I ate the apple in the kitchen.</code> æŒ‰ç…§è¯­ä¹‰ä¸Šæ˜¯ å®šè¯­, ä½†ä¹Ÿå¯èƒ½æ˜¯ çŠ¶è¯­?</p><p>ç¿»è¯‘æˆï¼šæˆ‘åƒäº†ä¸ªåœ¨å¨æˆ¿çš„è‹¹æœï¼ˆå®šè¯­ï¼‰ or æˆ‘åœ¨å¨æˆ¿åƒäº†ä¸ªè‹¹æœï¼ˆçŠ¶è¯­ï¼‰</p><blockquote><p>éƒ½è®¤ä¸ºæ˜¯çŠ¶è¯­å§ï¼Œå¦‚æœéœ€è¦è®¤å®šæ˜¯å®šè¯­çš„è¯ï¼Œå¯ä»¥è¿™ä¹ˆå†™ <code>I ate an apple that was in the kitchen</code></p></blockquote><h3 id="å¦‚æœéœ€è¦åˆ¤æ–­æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­"><a href="#å¦‚æœéœ€è¦åˆ¤æ–­æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­" class="headerlink" title="å¦‚æœéœ€è¦åˆ¤æ–­æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­?"></a>å¦‚æœéœ€è¦åˆ¤æ–­æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­?</h3><blockquote><p>åªéœ€è¦åˆ¤æ–­æ˜¯ä¿®é¥°ä»€ä¹ˆçš„</p><p>å®šè¯­ä¸€èˆ¬éƒ½æ˜¯ <code>xxxçš„</code>, ä¸€èˆ¬å‰é¢æ˜¯ä¸€ä¸ªåè¯æˆ–è€…åè¯æ€§è´¨çš„å¥å­ä¹‹ç±»</p><p>è€ŒçŠ¶è¯­, æ¯”è¾ƒçµæ´», æ‰€ä»¥åˆ¤æ–­ä¸æ˜¯ <code>ä»€ä¹ˆä»€ä¹ˆçš„</code> è¿™ç§<code>å®šè¯­</code>, é‚£ä¹ˆ<code>éƒ½è®¤ä¸ºæ˜¯çŠ¶è¯­</code> ä¿®é¥°çš„åŠ¨è¯</p><p><strong>å¦‚æœå®åœ¨ä¸çŸ¥é“æ˜¯å®šè¯­è¿˜æ˜¯çŠ¶è¯­ï¼Œé‚£ä¹ˆéƒ½è®¤ä¸ºæ˜¯çŠ¶è¯­å§ï¼Œä¸è¡Œå†è®¤ä¸ºæ˜¯å®šè¯­</strong></p></blockquote><h2 id="å¤æ‚çš„ä¿®é¥°æˆåˆ†"><a href="#å¤æ‚çš„ä¿®é¥°æˆåˆ†" class="headerlink" title="å¤æ‚çš„ä¿®é¥°æˆåˆ†"></a>å¤æ‚çš„ä¿®é¥°æˆåˆ†</h2><h3 id="ä»‹è¯çŸ­è¯­"><a href="#ä»‹è¯çŸ­è¯­" class="headerlink" title="ä»‹è¯çŸ­è¯­"></a>ä»‹è¯çŸ­è¯­</h3><p>ä»‹è¯æœ‰ä¸‰ä¸ªè¦ç‚¹:</p><ol><li>ä¸èƒ½å•ç‹¬ä½¿ç”¨</li><li>åé¢å¯ä»¥æ¥ä¸Š<ol><li>åè¯</li><li>ä»£è¯</li><li>doing</li></ol></li><li><code>ä»‹è¯ + åè¯/ä»£è¯/çŸ­è¯­</code> ä»‹è¯çŸ­è¯­, ä»‹å®¾ç»“æ„, é€šå¸¸éƒ½æ˜¯è¡¥å……è¯´æ˜çš„ä½œç”¨</li></ol><blockquote><p>ä»–æ˜¯å¥å­çš„éæ ¸å¿ƒç»“æ„</p></blockquote><blockquote><p>ä»‹è¯åˆ°ç¦»ä»–æœ€è¿œçš„é‚£ä¸ªåè¯æ‰æ˜¯<code>ä»‹è¯çŸ­è¯­</code></p></blockquote><h4 id="è¡¨ç¤ºæ—¶é—´çš„ä»‹è¯"><a href="#è¡¨ç¤ºæ—¶é—´çš„ä»‹è¯" class="headerlink" title="è¡¨ç¤ºæ—¶é—´çš„ä»‹è¯"></a>è¡¨ç¤ºæ—¶é—´çš„ä»‹è¯</h4><table><thead><tr><th align="center">ä»‹è¯</th><th align="center">è¡¨è¾¾å«ä¹‰</th></tr></thead><tbody><tr><td align="center">at&#x2F;on&#x2F;in</td><td align="center">åœ¨â€¦æ—¶é—´ç‚¹&#x2F;æ—¶é—´ä¸Š&#x2F;æ—¶é—´å†…</td></tr><tr><td align="center">before&#x2F;after</td><td align="center">åœ¨â€¦æ—¶é—´ä¹‹å‰&#x2F;ä¹‹å</td></tr><tr><td align="center">from&#x2F;since</td><td align="center">è‡ªä»â€¦æ—¶é—´</td></tr><tr><td align="center">by, until</td><td align="center">æˆªæ­¢åˆ°(ç›´åˆ°) â€¦ æ—¶é—´</td></tr><tr><td align="center">for</td><td align="center">æŒç»­â€¦æ—¶é—´</td></tr><tr><td align="center">during</td><td align="center">åœ¨â€¦æœŸé—´</td></tr></tbody></table><h4 id="è¡¨ç¤ºåœ°ç‚¹æˆ–è€…èŒƒå›´çš„ä»‹è¯"><a href="#è¡¨ç¤ºåœ°ç‚¹æˆ–è€…èŒƒå›´çš„ä»‹è¯" class="headerlink" title="è¡¨ç¤ºåœ°ç‚¹æˆ–è€…èŒƒå›´çš„ä»‹è¯"></a>è¡¨ç¤ºåœ°ç‚¹æˆ–è€…èŒƒå›´çš„ä»‹è¯</h4><table><thead><tr><th align="center">ä»‹è¯</th><th align="center">è¡¨è¾¾å«ä¹‰</th></tr></thead><tbody><tr><td align="center">at&#x2F;in</td><td align="center">åœ¨â€¦åœ°ç‚¹&#x2F;åœ¨â€¦é‡Œé¢</td></tr><tr><td align="center">on, above, over&#x2F;under, below</td><td align="center">åœ¨â€¦ä¸Šé¢&#x2F;ä¸‹é¢</td></tr><tr><td align="center">in front of &#x2F; behind</td><td align="center">åœ¨â€¦ä¹‹å‰&#x2F;ä¹‹å</td></tr><tr><td align="center">near, by, beside</td><td align="center">åœ¨â€¦æ—è¾¹</td></tr><tr><td align="center">between, among</td><td align="center">åœ¨â€¦ä¹‹é—´</td></tr><tr><td align="center">around</td><td align="center">åœ¨â€¦å‘¨å›´</td></tr><tr><td align="center">into&#x2F;out of</td><td align="center">è¿›å…¥â€¦é‡Œé¢&#x2F;ä»â€¦å‡ºå»</td></tr><tr><td align="center">onto&#x2F;off</td><td align="center">åˆ°â€¦ä¸Šé¢&#x2F;è„±ç¦»â€¦</td></tr><tr><td align="center">across, though&#x2F;past</td><td align="center">ç©¿è¿‡â€¦&#x2F;ç»è¿‡â€¦</td></tr><tr><td align="center">along</td><td align="center">æ²¿ç€</td></tr><tr><td align="center">from&#x2F;to</td><td align="center">æ¥è‡ªâ€¦&#x2F;æœç€â€¦</td></tr></tbody></table><h4 id="å…¶ä»–ç”¨æ³•"><a href="#å…¶ä»–ç”¨æ³•" class="headerlink" title="å…¶ä»–ç”¨æ³•"></a>å…¶ä»–ç”¨æ³•</h4><table><thead><tr><th align="center">ä»‹è¯</th><th align="center">è¡¨è¾¾å«ä¹‰</th></tr></thead><tbody><tr><td align="center">of</td><td align="center">A of B (B çš„ A)</td></tr><tr><td align="center">about</td><td align="center">å…³äºâ€¦</td></tr><tr><td align="center">with&#x2F;without</td><td align="center">ä¼´éšç€æœ‰â€¦&#x2F;æ²¡æœ‰â€¦</td></tr><tr><td align="center">for</td><td align="center">ä¸ºäº†â€¦(è¡¨ç¤ºç›®çš„)&#x2F;å› ä¸ºâ€¦(è¡¨ç¤ºåŸå› )&#x2F;å¯¹äºâ€¦(è¡¨ç¤ºå¯¹è±¡)</td></tr><tr><td align="center">by</td><td align="center">é€šè¿‡â€¦æ–¹å¼æˆ–è€…æ–¹æ³•&#x2F;è¢«â€¦åš(è¢«åŠ¨è¯­æ€ + by + åŠ¨ä½œå‘å‡ºè€…)&#x2F;ç›¸å·®äº†â€¦(è¡¨ç¤ºå˜åŒ–çš„å·®é¢)</td></tr><tr><td align="center">as</td><td align="center">ä½œä¸º&#x2F;åƒâ€¦ä¸€æ ·&#x2F;å¦‚åŒâ€¦</td></tr><tr><td align="center">like</td><td align="center">åƒâ€¦ä¸€æ ·</td></tr><tr><td align="center">despite</td><td align="center">å°½ç®¡â€¦</td></tr></tbody></table><h3 id="ä»å¥"><a href="#ä»å¥" class="headerlink" title="ä»å¥"></a>ä»å¥</h3><p>æœ‰<code>å¼•å¯¼è¯/å…³ç³»è¯ + å¥å­</code> åé¢å¿…é¡»æœ‰ä¸ªå®Œæ•´çš„å¥å­, <code>å¼•å¯¼è¯/å…³ç³»è¯</code>æœ‰æ—¶å€™ä¼šåšä»å¥çš„æˆåˆ†</p><h3 id="ä¸å®šå¼"><a href="#ä¸å®šå¼" class="headerlink" title="ä¸å®šå¼"></a>ä¸å®šå¼</h3><p><code>to do sth</code></p><h3 id="åˆ†è¯"><a href="#åˆ†è¯" class="headerlink" title="åˆ†è¯"></a>åˆ†è¯</h3><p><code>doing sth</code></p><p><code>done sth</code></p><blockquote><p>å®šè¯­ä¸€èˆ¬è·Ÿç€åè¯æ€§è´¨çš„è¯æˆ–è€…å¥å­é™„è¿‘, å¦‚æœå‘ç°ä¸€ä¸ªçŸ­è¯­æ‰¾ä¸åˆ°åè¯ä¿®é¥°, åˆ™å¤§æ¦‚ç‡æ˜¯çŠ¶è¯­</p></blockquote><h3 id="ä»‹è¯çŸ­è¯­å¦‚æœä¸æ˜¯åœ¨ä¿®é¥°ä¸€ä¸ªåè¯-é‚£ä¹ˆå°±æ˜¯çŠ¶è¯­"><a href="#ä»‹è¯çŸ­è¯­å¦‚æœä¸æ˜¯åœ¨ä¿®é¥°ä¸€ä¸ªåè¯-é‚£ä¹ˆå°±æ˜¯çŠ¶è¯­" class="headerlink" title="ä»‹è¯çŸ­è¯­å¦‚æœä¸æ˜¯åœ¨ä¿®é¥°ä¸€ä¸ªåè¯, é‚£ä¹ˆå°±æ˜¯çŠ¶è¯­"></a><code>ä»‹è¯çŸ­è¯­å¦‚æœä¸æ˜¯åœ¨ä¿®é¥°ä¸€ä¸ªåè¯, é‚£ä¹ˆå°±æ˜¯çŠ¶è¯­</code></h3><h1 id="â˜…è¡¨è¯­"><a href="#â˜…è¡¨è¯­" class="headerlink" title="â˜…è¡¨è¯­"></a><code>â˜…</code>è¡¨è¯­</h1><h2 id="â˜…æ˜¯ä»€ä¹ˆ-1"><a href="#â˜…æ˜¯ä»€ä¹ˆ-1" class="headerlink" title="â˜…æ˜¯ä»€ä¹ˆ?"></a>â˜…æ˜¯ä»€ä¹ˆ?</h2><blockquote><p>ä¸€å¥è¯: è¡¥å……è¯´æ˜ä¸»è¯­</p></blockquote><p>â˜…<strong>ç³»åŠ¨è¯: ç³»åŠ¨è¯å°±æ˜¯èµ‹äºˆä¸»è¯­åŠŸèƒ½çš„åŠ¨è¯, æ‰€æœ‰çš„ç³»åŠ¨è¯éƒ½èƒ½ç”¨ be æ¥ä»£æ›¿, æ‰€ä»¥å¾ˆå¥½åŒºåˆ†</strong></p><p>â˜…<strong>æ‰€ä»¥è¡¨è¯­å°±æ˜¯åœ¨ç³»åŠ¨è¯ä¹‹åçš„æˆåˆ†, æŠŠè¡¨è¯­çš„åŠŸèƒ½èµ‹å€¼ç»™ä¸»è¯­</strong></p><blockquote><h3 id="â˜…ç±»ä¼¼äº-int-a-10-è¿™é‡Œçš„-a-å°±æ˜¯ä¸»è¯­-10å°±æ˜¯è¡¨è¯­-å°±æ˜¯ç³»åŠ¨è¯-è¡¨ç¤ºèµ‹å€¼"><a href="#â˜…ç±»ä¼¼äº-int-a-10-è¿™é‡Œçš„-a-å°±æ˜¯ä¸»è¯­-10å°±æ˜¯è¡¨è¯­-å°±æ˜¯ç³»åŠ¨è¯-è¡¨ç¤ºèµ‹å€¼" class="headerlink" title="â˜…ç±»ä¼¼äº int a = 10 è¿™é‡Œçš„ a å°±æ˜¯ä¸»è¯­, 10å°±æ˜¯è¡¨è¯­, =å°±æ˜¯ç³»åŠ¨è¯, è¡¨ç¤ºèµ‹å€¼"></a>â˜…ç±»ä¼¼äº <code>int a = 10</code> è¿™é‡Œçš„ <code>a</code> å°±æ˜¯<code>ä¸»è¯­</code>, <code>10</code>å°±æ˜¯<code>è¡¨è¯­</code>, <code>=</code>å°±æ˜¯<code>ç³»åŠ¨è¯</code>, è¡¨ç¤º<code>èµ‹å€¼</code></h3></blockquote><p>â˜…<strong>ç³»åŠ¨è¯å¼•å¯¼çš„æ˜¯ <code>ä¸»è¯­è¡¥è¶³è¯­</code>, å‰é¢æˆ‘ä»¬çš„ ä¸»è°“å®¾ å®¾è¡¥, è¿™é‡Œæ˜¯<code>å®¾è¯­è¡¥è¶³è¯­</code>, è€Œä¸»ç³»è¡¨çš„è¡¨è¯­å…¶å®æ˜¯ä¸»è¯­è¡¥è¶³è¯­</strong></p><blockquote><p>â˜…<strong>æˆ‘ä»¬åŒºåˆ†ä¸»è°“å®¾å®¾å’Œä¸»è°“å®¾å®¾è¡¥çš„æ—¶å€™å¯ä»¥åœ¨ å®¾è¯­å’Œåé¢çš„æˆåˆ†ä¸­é—´åŠ ä¸Š <code>be</code> åŠ¨è¯, å¦‚æœæˆç«‹åˆ™æ˜¯ä¸»è°“å®¾å®¾è¡¥</strong></p></blockquote><h2 id="â˜…ä»€ä¹ˆè¯å¯ä»¥åšè¡¨è¯­"><a href="#â˜…ä»€ä¹ˆè¯å¯ä»¥åšè¡¨è¯­" class="headerlink" title="â˜…ä»€ä¹ˆè¯å¯ä»¥åšè¡¨è¯­?"></a>â˜…ä»€ä¹ˆè¯å¯ä»¥åšè¡¨è¯­?</h2><h3 id="â˜…-åè¯-ä»£è¯-éè°“è¯­åŠ¨è¯-ä»å¥-å½¢å®¹è¯-ä»‹è¯çŸ­è¯­-çŠ¶è¯­"><a href="#â˜…-åè¯-ä»£è¯-éè°“è¯­åŠ¨è¯-ä»å¥-å½¢å®¹è¯-ä»‹è¯çŸ­è¯­-çŠ¶è¯­" class="headerlink" title="â˜…**åè¯, ä»£è¯, éè°“è¯­åŠ¨è¯, ä»å¥, å½¢å®¹è¯, ä»‹è¯çŸ­è¯­(çŠ¶è¯­)**"></a>â˜…**<code>åè¯</code>, <code>ä»£è¯</code>, <code>éè°“è¯­åŠ¨è¯</code>, <code>ä»å¥</code>, <code>å½¢å®¹è¯</code>, <code>ä»‹è¯çŸ­è¯­(çŠ¶è¯­)</code>**</h3><blockquote><p>ä¸»ç³»è¡¨å¯ä»¥å˜æˆ è¡¨ç³»ä¸», å€’è£…, è¡¨ç¤ºå¼ºè°ƒ</p></blockquote><h3 id="is"><a href="#is" class="headerlink" title="is"></a>is</h3><blockquote><p>åè¯åšè¡¨è¯­æ—¶ ç³»åŠ¨è¯ ç¿»è¯‘æˆ â€œæ˜¯â€, å½¢å®¹è¯åšè¡¨è¯­æ˜¯ ä¸ç¿»è¯‘, åœ°æ–¹å‰¯è¯åšè¡¨è¯­æ—¶ç¿»è¯‘æˆ â€œåœ¨â€</p></blockquote><ol><li><p>åè¯</p><p>He is a great hero. (æ˜¯)</p><p>The trouble with me is that I lack money. (æ˜¯)</p></li><li><p>å½¢å®¹è¯</p><p>She is beautiful. (ä¸ç¿»è¯‘)</p><p>The book is of great value. (åšå½¢å®¹è¯æ€§è´¨çš„ä»‹è¯çŸ­è¯­ ä¸ç¿»è¯‘)</p></li><li><p>åœ°æ–¹å‰¯è¯</p><p>She is there. (åœ¨)</p><p>They are upstairs. (åœ¨)</p><p>She is in town. (å‰¯è¯çŸ­è¯­ åœ¨)</p></li></ol><h4 id="be-åŠ¨è¯ä¹‹åçš„ç°åœ¨åˆ†è¯æœ‰ä¸¤ç§æ„æ€"><a href="#be-åŠ¨è¯ä¹‹åçš„ç°åœ¨åˆ†è¯æœ‰ä¸¤ç§æ„æ€" class="headerlink" title="be åŠ¨è¯ä¹‹åçš„ç°åœ¨åˆ†è¯æœ‰ä¸¤ç§æ„æ€"></a>be åŠ¨è¯ä¹‹åçš„ç°åœ¨åˆ†è¯æœ‰ä¸¤ç§æ„æ€</h4><ul><li>ä½œ<strong>å½¢å®¹è¯çš„ç°åœ¨åˆ†è¯</strong>: è¡¨ç¤º â€œâ€¦çš„â€</li><li>ä½œ<strong>â€œè¿›è¡ŒçŠ¶æ€â€çš„ç°åœ¨åˆ†è¯</strong>: è¡¨ç¤º â€œæ­£åœ¨â€¦â€</li></ul><p>The girl is charming. è¿™å¥³å­©å¾ˆè¿·äºº. &#x3D;&#x3D;&gt; å¯ä»¥ç¿»è¯‘æˆ â€œcharmingâ€ è¿·äººçš„, å½¢å®¹è¯</p><p>The girl is singing. å¥³å­©æ­£åœ¨å”±æ­Œ &#x3D;&#x3D;&gt; ç¿»è¯‘æˆâ€æ­£åœ¨â€¦â€, singingåšå®Œå…¨ä¸åŠç‰©åŠ¨è¯, ç¿»è¯‘æˆ â€œæ­£åœ¨åšâ€</p><p><strong><code>æ€»ç»“: ç¿»è¯‘æˆ ä»€ä¹ˆçš„, ä¸»ç³»è¡¨, ç¿»è¯‘æˆ æ­£åœ¨... è¿›è¡Œæ—¶åˆ†è¯å½¢å¼</code></strong></p><p>The girl is bathing. å¥³å­©æ­£åœ¨æ´—æ¾¡ (è¿›è¡Œæ—¶åˆ†è¯å½¢å¼)</p><h4 id="beåŠ¨è¯ä¹‹åçš„è¿‡å»åˆ†è¯ä¹Ÿæœ‰ä¸¤ç§è¯æ€§"><a href="#beåŠ¨è¯ä¹‹åçš„è¿‡å»åˆ†è¯ä¹Ÿæœ‰ä¸¤ç§è¯æ€§" class="headerlink" title="beåŠ¨è¯ä¹‹åçš„è¿‡å»åˆ†è¯ä¹Ÿæœ‰ä¸¤ç§è¯æ€§"></a>beåŠ¨è¯ä¹‹åçš„è¿‡å»åˆ†è¯ä¹Ÿæœ‰ä¸¤ç§è¯æ€§</h4><ul><li>åš<strong>å½¢å®¹è¯æ–¹å¼</strong> â€œæ„Ÿåˆ°â€¦çš„â€</li><li><strong>åŠç‰©åŠ¨è¯è¢«åŠ¨è¯­æ€</strong>: â€œè¢«â€¦â€</li></ul><p>The man is tried. è¿™äººå¾ˆç´¯ (ç¿»è¯‘: æ„Ÿåˆ°ç´¯)</p><p>The man was killed. è¿™ç”·äººè¢«æ€äº†(ç¿»è¯‘: è¢«)</p><blockquote><p>åˆ¤æ–­ä¸‹æ˜¯å¦æœ‰è¢«åŠ¨çš„æ„æ€, å¦‚æœä¸æ˜¯é‚£ä¹ˆå°±ç¿»è¯‘æˆ â€œæ„Ÿåˆ°â€¦â€</p></blockquote><h4 id="ç°åœ¨åˆ†è¯å’ŒåŠ¨åè¯"><a href="#ç°åœ¨åˆ†è¯å’ŒåŠ¨åè¯" class="headerlink" title="ç°åœ¨åˆ†è¯å’ŒåŠ¨åè¯"></a>ç°åœ¨åˆ†è¯å’ŒåŠ¨åè¯</h4><p>He is washing the car. (ç°åœ¨åˆ†è¯)</p><blockquote><p>è°“è¯­æ˜¯ is washing , ä¸»è°“å®¾ç»“æ„, ç¿»è¯‘: â€œä»–æ­£åœ¨æ´—è½¦â€</p></blockquote><p>His job is washing cars. (åŠ¨åè¯)</p><blockquote><p>è°“è¯­æ˜¯ is ,  ç¿»è¯‘: â€œä»–çš„å·¥ä½œæ˜¯æ´—è½¦â€</p></blockquote><p>å¾ˆå¤šæ—¶å€™è¿™ç§å¾ˆéš¾è¢«åŒºåˆ†å‡ºæ¥, åˆ°åº•æ˜¯åŠ¨åè¯è¿˜æ˜¯ç°åœ¨åˆ†è¯, å…¶å®éå¸¸ç®€å•</p><h5 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h5><p>æ–¹æ³•å°±åœ¨å‰é¢çš„ç¿»è¯‘</p><blockquote><p>ä½œ<strong>â€œè¿›è¡ŒçŠ¶æ€â€çš„ç°åœ¨åˆ†è¯</strong>: è¡¨ç¤º â€œæ­£åœ¨â€¦â€</p></blockquote><p><strong><code>æ¯”å¦‚ä¸Šé¢çš„ç¿»è¯‘: He is washing the car. åªè¦ç¿»è¯‘ä¸­æœ‰æ­£åœ¨çš„æ„æ€, é‚£ä¹ˆå°±æ˜¯ç°åœ¨åˆ†è¯</code></strong></p><p>His job is washing cars. è¿™é‡Œæ˜æ˜¾å°±ä¸èƒ½ç¿»è¯‘æˆ â€œæ­£åœ¨â€¦â€</p><h5 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h5><blockquote><p>å°† be åŠ¨è¯ä¹‹åçš„å®¾è¯­å’Œä¸»è¯­äº’æ¢, æ„æ€ä¸å˜, é‚£ä¹ˆå°±æ˜¯åŠ¨åè¯, ä¸èƒ½äº’æ¢å°±æ˜¯ç°åœ¨åˆ†è¯</p></blockquote><p>His job is washing cars.</p><p>å°†å…¶åè¿‡æ¥</p><p>Washing cars is his jobs.</p><blockquote><p>å› ä¸ºå¦‚æœæ˜¯åŠ¨åè¯çš„è¯, è°“è¯­åªæœ‰ is , åŠ¨åè¯åœ¨å¥å­ä¸­åšå®šè¯­, ä¿®é¥°å®¾è¯­</p></blockquote><h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><blockquote><p>ä¸¤ç§æ–¹æ³•éƒ½è¡Œ, å“ªä¸ªåˆé€‚ç”¨å“ªä¸ª</p></blockquote><h3 id="become-å˜æˆ"><a href="#become-å˜æˆ" class="headerlink" title="become(å˜æˆ)"></a>become(å˜æˆ)</h3><p>å¯ä»¥ç”¨: </p><ol><li>ä»»ä½•åè¯</li><li>å½¢å®¹è¯</li><li>å¯ä½œå½¢å®¹è¯ç”¨çš„<code>ç°åœ¨åˆ†è¯</code>å’Œ<code>è¿‡å»åˆ†è¯</code>(ç¿»è¯‘æˆ â€¦çš„)</li></ol><p>åšè¡¨è¯­</p><p>After failing, he became depressed. åœ¨å¤±è´¥ä¹‹å, ä»–å˜å¾—ä½æ²‰äº†</p><p>She is becoming more and more charming. å¥¹æ­£åœ¨å˜å¾—è¶Šæ¥è¶Šä»¤äººç€è¿·</p><p>Youâ€™ll become a good student if you study hard.  å¦‚æœä½ åŠªåŠ›å­¦ä¹ , ä½ å°†å˜æˆä¸€ä¸ªå¥½å­¦ç”Ÿ</p><h3 id="turn-å˜æˆ"><a href="#turn-å˜æˆ" class="headerlink" title="turn(å˜æˆ)"></a>turn(å˜æˆ)</h3><ol><li>ä¸é¢œè‰²å’Œæƒ…ç»ªæœ‰å…³</li><li>è¡¨ç¤ºè½¬ä¸š, é€šå¸¸ä¸åè¯è¿ç”¨, åšå½¢å®¹è¯çš„ä½œç”¨</li></ol><p>ç”¨å½¢å®¹è¯åšè¡¨è¯­, è€Œä¸”ä¸€èˆ¬ä¸é¢œè‰²å’Œæƒ…ç»ªæœ‰å…³, è¿˜å¯ä»¥ç”¨è¿‡è¡¨ç¤ºè½¬ä¸š, é€šå¸¸ä¸åè¯è¿ç”¨, åšå½¢å®¹è¯çš„ä½œç”¨</p><p>His face turned pale when he heard the news. (turned ç³»åŠ¨è¯; heard è¿‡å»åˆ†è¯)</p><p>å½“ä»–å¬åˆ°é‚£ä¸ªä¿¡æ¯æ—¶, ä»–çš„è„¸å˜çš„è‹ç™½.</p><p>The leaves turned yellow. å¶å­å˜é»„äº†</p><p>The leaves is turning yellow. å¶å­æ­£åœ¨å˜é»„</p><p>The leaves had been turned yellow. å¶å­å·²ç»å˜é»„äº†</p><p>His face turned red with anger when he saw Mary. å½“ä»–çœ‹åˆ°Mary, ä»–çš„è„¸ç”Ÿæ°”çš„éƒ½çº¢äº†</p><p>She turned beautiful. (é”™çš„)</p><p>She became beautiful. (å¯¹çš„)</p><blockquote><p>turned beautiful è¿™å…¶å®æ˜¯é”™çš„, turned åªèƒ½ç”¨äºä¿®é¥°é¢œè‰²æˆ–è€…æƒ…ç»ª</p></blockquote><p>turn è¿˜èƒ½åšè½¬ä¸šçš„æ„æ€, ä¸€èˆ¬ä¸åè¯è¿ç”¨, åšå½¢å®¹è¯ä½œç”¨</p><p>Mr. Johnson is a soldier-turned farmer. çº¦ç¿°å…ˆç”Ÿæ˜¯å†›äººä¸“ä¸šçš„å†œå¤«</p><p>soldier-turned å†›äººè½¬ä¸šçš„, ä½œå½¢å®¹è¯</p><h3 id="get-å˜æˆ"><a href="#get-å˜æˆ" class="headerlink" title="get(å˜æˆ)"></a>get(å˜æˆ)</h3><p>geté€šå¸¸ç”¨:</p><ol><li>ç”Ÿæ°”</li><li>æ¿€åŠ¨</li></ol><p>çš„å½¢å®¹è¯ä½œè¡¨è¯­, è‹¥ç”¨å…¶ä»–å½¢å®¹è¯, ä¸€èˆ¬ä½¿ç”¨ become</p><p>He got mad. ä»–ç”Ÿæ°”äº†</p><p>She got beautiful. (é”™)</p><p>She became beautiful. (å¯¹)</p><p>å¥¹å˜æ¼‚äº®äº†</p><p>Things have got good. (é”™)</p><p>Things have become good. (å¯¹)</p><p>äº‹æƒ…å˜å¥½äº†</p><blockquote><p>è‹¥ get ç”¨äºè¿›è¡Œæ—¶çš„ç»“æ„ä¸­, ä¹‹åå¯æ¥ä¸Šä»»ä½•å½¢å®¹è¯æ¯”è¾ƒçº§å½¢æ€ä½œè¡¨è¯­</p></blockquote><p>be getting more and more + ä»»ä½•å½¢å®¹è¯</p><p>She is getting more and more beautiful. å¥¹æ„ˆæ¥æ„ˆç¾ä¸½</p><blockquote><p>get + è¢«åŠ¨è¯­æ€: ç¿»è¯‘æˆ â€œè¢«â€</p></blockquote><p>He got killed in the accident. &#x3D; He was killed in the accident. (ä»–åœ¨è½¦ç¥¸ä¸­ä¸§ç”Ÿ)</p><h3 id="seem-ä¼¼ä¹-x3D-x3D-appear"><a href="#seem-ä¼¼ä¹-x3D-x3D-appear" class="headerlink" title="seem(ä¼¼ä¹) &#x3D;&#x3D; appear"></a>seem(ä¼¼ä¹) &#x3D;&#x3D; appear</h3><ul><li>seem ä¹‹åç”¨ <strong>ä¸å®šå¼çŸ­è¯­</strong> ä½œè¡¨è¯­</li></ul><p>He seems to know it. (å¯¹)</p><p>He seems knowing it. (é”™)</p><blockquote><p>åœ¨ seem to be adj&#x2F;n æ—¶. to be æ˜¯å¯ä»¥çœç•¥çš„</p></blockquote><p>He seems to be happy. &#x3D;&#x3D; He seems happy. ä»–ä¼¼ä¹å¾ˆå¿«ä¹</p><p>He seems to be a nice man. &#x3D;&#x3D; He seems a nice man. ä»–ä¼¼ä¹æ˜¯å¥½äºº</p><h3 id="æ„Ÿå®˜åŠ¨è¯"><a href="#æ„Ÿå®˜åŠ¨è¯" class="headerlink" title="æ„Ÿå®˜åŠ¨è¯"></a>æ„Ÿå®˜åŠ¨è¯</h3><blockquote><p>ç¿»è¯‘æˆ: â€¦èµ·æ¥</p></blockquote><table><thead><tr><th>ç³»åŠ¨è¯</th><th>æ„æ€</th><th>è¡¨è¯­</th></tr></thead><tbody><tr><td>look</td><td>çœ‹èµ·æ¥</td><td>å½¢å®¹è¯</td></tr><tr><td>sound</td><td>å¬èµ·æ¥</td><td>~</td></tr><tr><td>smell</td><td>é—»èµ·æ¥</td><td>~</td></tr><tr><td>taste</td><td>å°èµ·æ¥</td><td>~</td></tr><tr><td>feel</td><td>æ„Ÿè§‰èµ·æ¥; æ„Ÿåˆ°</td><td>~</td></tr></tbody></table><p>His idea sounds good. </p><p>The food smells good.</p><p>I feel tried now.</p><p>It looks interesting.</p><blockquote><p>æ„Ÿå®˜åŠ¨è¯ä¸èƒ½ç›´æ¥è·Ÿåè¯, éœ€è¦åŠ ä¸Š <code>ä»‹è¯</code>: <code>look + like + åè¯</code></p><p>ç¿»è¯‘æˆ <strong><code>&quot;...èµ·æ¥åƒ...&quot;</code></strong></p></blockquote><p>It sounds a good idea. (é”™)</p><p>It sounds like a good idea. (å¯¹)</p><p>The food tastes like fish. è¿™é£Ÿç‰©å°èµ·æ¥åƒé±¼è‚‰</p><blockquote><p><code>feel like + åè¯</code> æ„Ÿè§‰åƒâ€¦</p><p><code>feel like åŠ¨è¯</code> æƒ³è¦â€¦</p></blockquote><p>When Jane said to marry me, I felt like a newborn baby. å½“ç®€è¯´è¦å«ç»™æˆ‘, æˆ‘æ„Ÿè§‰å°±åƒä¸€ä¸ªæ–°ç”Ÿçš„å­©å­</p><blockquote><p>feel, taste, smell å¯ä½œå®Œå…¨åŠç‰©åŠ¨è¯</p><p><code>feel/taste/smell + åè¯</code></p></blockquote><p>The doctor felt my forehead and said I had a fever.</p><p>He smelled something burning. ä»–é—»åˆ°æœ‰ä¸œè¥¿çƒ§ç„¦äº†</p><blockquote><p>look ä¸ ä»‹è¯ è¿ç”¨, åŠç‰©</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">look into = investigate vt. è°ƒæŸ¥</span><br><span class="line">look over = examine vt. æ£€æŸ¥</span><br><span class="line">look at = watch vt.çœ‹</span><br></pre></td></tr></table></figure><p>He looked at me happily.</p><p>He look into the case carefully.</p><blockquote><p>å¦‚æœ look + ä»‹è¯ ä¸­é—´å¯ä»¥æ·»åŠ  å‰¯è¯ , ä½†æ˜¯ä¸èƒ½å¤Ÿæ·»åŠ  å½¢å®¹è¯</p></blockquote><p>He looked happy at me. (é”™)</p><p>He looked careful into the case. (é”™)</p><h2 id="ä¾‹å­-3"><a href="#ä¾‹å­-3" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><ul><li>â˜…<code>Do you love in Beijing?</code></li></ul><p>â˜…è¿™å¥è¯æ˜¯é”™è¯¯çš„, <code>love</code> æ˜¯<code>å®ä¹‰åŠ¨è¯, åŠç‰©çš„</code>, åé¢è·Ÿç€çš„æ˜¯<code>å®¾è¯­</code>, è€Œ<code>ä»‹è¯çŸ­è¯­(çŠ¶è¯­)</code>ä¸èƒ½åš<code>å®¾è¯­</code>, æ‰€ä»¥è¿™å¥è¯æ˜¯é”™è¯¯çš„</p><p>å®¾è¯­åªèƒ½æ˜¯ åè¯, ä»£è¯, ä»å¥å’Œéè°“è¯­åŠ¨è¯</p><p>æ‰€ä»¥ä»‹è¯çŸ­è¯­éœ€è¦å˜åŒ–æˆä¸Šé¢å¥å‹æˆ–è€…æˆåˆ†, ä½†æ˜¯ä»‹è¯çŸ­è¯­æ— æ³•å˜æˆåè¯</p><blockquote><p>å¦‚æœè¦å˜æˆåè¯, åªè¦å°†ä»‹è¯å»æ‰å°±è¡Œ, å› ä¸º<strong>ä»‹è¯çŸ­è¯­é€šå¸¸æ˜¯<code>ä»‹è¯ + åè¯</code>, åœ¨å¥å­ä¸­å……å½“çŠ¶è¯­çš„æˆåˆ†</strong>, æ‰€ä»¥åªè¦å»æ‰ä»‹è¯, å‰©ä¸‹çš„å°±æ˜¯åè¯äº†</p></blockquote><p>æ›´ä¸èƒ½å˜æˆä»£è¯(<strong>ä»£è¯åªèƒ½æŒ‡ä»£åè¯</strong>), ä»å¥çš„è¯, éœ€è¦<strong>å¼•å¯¼è¯</strong>, å˜å¾—æ›´åŠ å¤æ‚, ç›´æ¥å˜æˆ <strong>éè°“è¯­åŠ¨è¯</strong> ä¾¿å¯</p><p>â˜…è¦å˜æˆéè°“è¯­åŠ¨è¯çš„æ–¹æ³•æœ‰ä¸‰ç§,  è¿™é‡Œå¯ä»¥è€ƒè™‘ <code>ing</code> å’Œ <code>to</code> , è€Œ <code>ed</code> æ˜¯ä¸è¡Œçš„, ä¸ç¬¦åˆæ„æ€, <code>ed æ˜¯è¢«åŠ¨çš„</code>, ç„¶è€Œæ²¡æœ‰åŠ¨è¯ç»™æˆ‘ä»¬å˜æˆéè°“è¯­åŠ¨è¯, <code>åªèƒ½åŠ ä¸Šä¸‡èƒ½çš„ be åŠ¨è¯</code>, æ‰€ä»¥ä¸Šé¢çš„å¥å­å˜æˆ: </p><p><code>Do you love being in Beijing.</code></p><ul><li>è¿™ä¸¤å¤©å¿ƒé‡Œå¾ˆä¸çˆ½</li></ul><p><code>I feel unhappy these day</code></p><ul><li>å…¨çƒåœ¨å˜æš–</li></ul><p><code>It is becoming warm over the world</code></p><ul><li>å¦‚æœæœ‰æ¯…åŠ›, è¿Ÿæ—©ä¼šæˆåŠŸ</li></ul><p><code>If there exist perseverance in your mind, success will be achieved sooner or later.</code></p><ul><li>æœ‰æ„ä¹‰å°±æ˜¯å¥½å¥½æ´», å¥½å¥½æ´»å°±æ˜¯åšæœ‰æ„ä¹‰çš„äº‹æƒ…</li></ul><p><code>Being meaningful is to live happily and living happily is to do meaningful things.</code></p><ul><li>ç¬‘å¹¶ä¸æ„å‘³ç€å¿«ä¹</li></ul><p><code>Smiling doesn&#39;t mean real happiness.</code></p><ul><li>å«‰å¦’æœ¬èº«å°±æ˜¯ä¸€ç§ä»°æœ›</li></ul><p><code>Jealousy itself is a kind of worship.</code></p><h1 id="äº”å¤§ç®€å•åŸºæœ¬å¥å‹"><a href="#äº”å¤§ç®€å•åŸºæœ¬å¥å‹" class="headerlink" title="äº”å¤§ç®€å•åŸºæœ¬å¥å‹"></a>äº”å¤§ç®€å•åŸºæœ¬å¥å‹</h1><ol><li><p>ä¸»è°“</p><p>è°“è¯­ä¸€èˆ¬å°±èƒ½å¤Ÿæ»¡è¶³å¥å­çš„æ„æ€äº†, æ‰€ä»¥ä¸»è°“ç»“æ„, è‹±è¯­éœ€è¦è¯­å¢ƒå’Œè¯­æ„ç¬¦åˆè¦æ±‚</p></li><li><p>ä¸»è°“å®¾</p></li><li><p>ä¸»ç³»è¡¨(ä¸»è°“ä¸»è¡¥)</p><ol><li>ä¸€èˆ¬è¡¨è¯­åšä¸»è¯­çš„ä¿®é¥°, æˆ–è€…åšä¸»è¯­çš„ç­‰ä»·æ•ˆæœ, ç±»ä¼¼äºç¼–ç¨‹é‡Œé¢çš„ <code>addå‡½æ•°</code>å’Œèµ‹å€¼ç¬¦å·(<code>=</code>)</li><li>ä¸»ç³»è¡¨å¯ä»¥å˜æˆ è¡¨ç³»ä¸», å€’è£…, è¡¨ç¤ºå¼ºè°ƒ</li></ol></li><li><p>ä¸»è°“å®¾å®¾è¡¥</p><blockquote><p>åœ¨ å®¾è¯­ å’Œ å®¾è¡¥ä¹‹é—´åŠ ä¸Š be åŠ¨è¯ç„¶åç¿»è¯‘å‡ºæ¥, å¦‚æœè¿˜ç¬¦åˆåŸå…ˆå¥å­çš„æ„æ€é‚£ä¹ˆå°±æ˜¯ â€œä¸»è°“å®¾å®¾è¡¥â€, å¦‚æœä¸ç¬¦åˆåŸå…ˆå¥å­çš„æ„æ€, é‚£ä¹ˆå°±æ˜¯ â€œä¸»è°“å®¾å®¾â€</p></blockquote></li><li><p>ä¸»è°“å®¾å®¾</p><blockquote><p>å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ ä¸»è°“ äººå®¾ + ç‰©å®¾</p><p>ç±»ä¼¼äº: V sb sth, æ¯”å¦‚ give sb sth, æˆ–è€… make sb sth. ç­‰ç­‰</p><p>å‰é¢ä¸€ä¸ªå®¾è¯­æ˜¯äºº, åé¢ä¸€ä¸ªå®¾è¯­æ˜¯ç‰©</p></blockquote></li></ol><h1 id="å¦‚æœåŒºåˆ†ä¸»è°“åŒå®¾å’Œè°“è¯­å®¾å®¾è¡¥"><a href="#å¦‚æœåŒºåˆ†ä¸»è°“åŒå®¾å’Œè°“è¯­å®¾å®¾è¡¥" class="headerlink" title="å¦‚æœåŒºåˆ†ä¸»è°“åŒå®¾å’Œè°“è¯­å®¾å®¾è¡¥?"></a>å¦‚æœåŒºåˆ†ä¸»è°“åŒå®¾å’Œè°“è¯­å®¾å®¾è¡¥?</h1><blockquote><p>åœ¨å‰ä¸€ä¸ªå®¾è¯­åé¢åŠ ä¸Š be åŠ¨è¯</p><ul><li>å¦‚æœå¥å­çš„æ„æ€å’Œå‰é¢ä¸€è‡´, åˆ™æ˜¯å®¾è¡¥</li><li>å¦‚æœä¸ä¸€è‡´, åˆ™æ˜¯åŒå®¾</li></ul><p><code>I gave him a dog.</code>  &#x3D;&gt; <code>he is a dog</code> åŠ å…¥åˆ°è¯­å¥ä¸­, æ˜¯â€æˆ‘ç»™ä»–ä¸€æ¡ç‹—â€, å˜æˆäº†â€ä»–æ˜¯ä¸€æ¡ç‹—â€æ˜æ˜¾ä¸ç¬¦åˆè¯­ä¹‰ &#x3D;&gt; åŒå®¾</p><p><code>I called him a dog.</code> &#x3D;&gt; <code>he is a dog</code> â€œæˆ‘è¯´ä»–æ˜¯ä¸€æ¡ç‹—â€ â€œä»–æ˜¯ä¸€æ¡ç‹—â€ ç¬¦åˆå‰é¢å¥å­çš„è¯­ä¹‰, æ‰€ä»¥æ˜¯ &#x3D;&gt; å®¾è¡¥</p></blockquote><h1 id="å¦‚ä½•åŒºåˆ†æ˜¯è°“è¯­è¿˜æ˜¯è¿‡å»åˆ†è¯-doneå’Œdid"><a href="#å¦‚ä½•åŒºåˆ†æ˜¯è°“è¯­è¿˜æ˜¯è¿‡å»åˆ†è¯-doneå’Œdid" class="headerlink" title="å¦‚ä½•åŒºåˆ†æ˜¯è°“è¯­è¿˜æ˜¯è¿‡å»åˆ†è¯?(doneå’Œdid)"></a>å¦‚ä½•åŒºåˆ†æ˜¯è°“è¯­è¿˜æ˜¯è¿‡å»åˆ†è¯?(doneå’Œdid)</h1><blockquote><p>åœ¨ç–‘ä¼¼è°“è¯­åŠ¨è¯å‰é¢åŠ ä¸Š be, å˜æˆè¢«åŠ¨, å¦‚æœæ„æ€</p><ul><li>ç¬¦åˆ; è¯­æ€ è¯­ä¹‰éƒ½ä¸å˜, ä¸€å®šæ˜¯ä¸ªè¿‡å»åˆ†è¯çŸ­è¯­åšåç½®å®šè¯­</li><li>ä¸ç¬¦åˆ; å¦‚æœè¯­æ€å˜äº†æˆ–è€…æ„æ€æ‰­æ›²äº†, é‚£ä¸€å®šæ˜¯ è°“è¯­</li></ul><p><code>a paper published in Englang.</code></p><p>å˜æˆ: <code>a paper is publisted in Englang.</code></p><p>â€œè®ºæ–‡è¢«å‘å¸ƒâ€, è®ºæ–‡æœ¬èº«å°±æ˜¯è¢«äººå‘å¸ƒçš„, ç¬¦åˆæ„æ€, ä¸€å®šæ˜¯åšè¿‡å»åˆ†è¯, ä¸æ˜¯è°“è¯­</p></blockquote><blockquote><p>è¯´ç™½äº†,  done æœ¬èº«å°±æœ‰è¢«åŠ¨çš„æ„æ€, è€Œ did æœ¬èº«å°±æ˜¯ä¸»åŠ¨çš„æ„æ€</p><p>å¦‚æœåŠ ä¸Š be done è¢«åŠ¨è¯­æ€å®Œæ•´, æ‰€ä»¥æ„æ€ä¸å˜</p><p>å¦‚æœæ˜¯ did åŠ ä¸Š be , ä¸»åŠ¨å˜è¢«åŠ¨, è‡³å°‘è¯­æ€å˜äº†, æ„æ€ä¹Ÿå˜äº†</p></blockquote><blockquote><p>è¿™ç‚¹åœ¨å‰é¢å·²ç»è¯´è¿‡äº†</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> è‹±è¯­ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è°“è¯­ </tag>
            
            <tag> åŠ¨è¯ </tag>
            
            <tag> äº”å¤§å¥å‹ </tag>
            
            <tag> åŠç‰©å’Œä¸åŠç‰©åŠ¨è¯ </tag>
            
            <tag> éè°“è¯­åŠ¨è¯ </tag>
            
            <tag> ç‹¬ç«‹ä¸»æ ¼ </tag>
            
            <tag> ä¼´éšçŠ¶è¯­ </tag>
            
            <tag> æ²¡æœ‰åŠ¨è¯æ€ä¹ˆåŠ </tag>
            
            <tag> åŠ¨è¯çš„åˆ†ç±» </tag>
            
            <tag> ä¸»è¯­ </tag>
            
            <tag> itå½¢å¼ </tag>
            
            <tag> there beå½¢å¼ </tag>
            
            <tag> å®¾è¯­ </tag>
            
            <tag> è¡¥è¯­ </tag>
            
            <tag> ä¿®é¥°æˆåˆ† </tag>
            
            <tag> ä»‹è¯çŸ­è¯­ </tag>
            
            <tag> ä»å¥ </tag>
            
            <tag> ä¸å®šå¼ </tag>
            
            <tag> åˆ†è¯ </tag>
            
            <tag> è¡¨è¯­ </tag>
            
            <tag> beåŠ¨è¯ </tag>
            
            <tag> æ„Ÿå®˜åŠ¨è¯ </tag>
            
            <tag> ä¸»è°“å®¾ </tag>
            
            <tag> ä¸»è°“åŒå®¾ </tag>
            
            <tag> ä¸»è°“å®¾å®¾è¡¥ </tag>
            
            <tag> ä¸»ç³»è¡¨ </tag>
            
            <tag> ä¸»è°“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>17SpringSecurity-è®°ä½æˆ‘</title>
      <link href="/2022/11/25/02springcloud/17SpringSecurity-%E8%AE%B0%E4%BD%8F%E6%88%91/"/>
      <url>/2022/11/25/02springcloud/17SpringSecurity-%E8%AE%B0%E4%BD%8F%E6%88%91/</url>
      
        <content type="html"><![CDATA[<h1 id="RememberMe"><a href="#RememberMe" class="headerlink" title="RememberMe"></a>RememberMe</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h3 id="æ˜¯ä»€ä¹ˆ-ä¸ºä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ-ä¸ºä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ?(ä¸ºä»€ä¹ˆ?)"></a>æ˜¯ä»€ä¹ˆ?(ä¸ºä»€ä¹ˆ?)</h3><p><strong>Remember Me</strong> å³è®°ä½æˆ‘ï¼Œå¸¸ç”¨äº Web åº”ç”¨çš„ç™»å½•é¡µç›®çš„æ˜¯è®©ç”¨æˆ·é€‰æ‹©æ˜¯å¦è®°ä½ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€‚å½“ç”¨æˆ·é€‰æ‹©äº† Remember Me é€‰é¡¹ï¼Œåˆ™åœ¨æœ‰æ•ˆæœŸå†…è‹¥ç”¨æˆ·é‡æ–°è®¿é—®åŒä¸€ä¸ª Web åº”ç”¨ï¼Œé‚£ä¹ˆç”¨æˆ·å¯ä»¥ç›´æ¥ç™»å½•åˆ°ç³»ç»Ÿä¸­ï¼Œè€Œæ— éœ€é‡æ–°æ‰§è¡Œç™»å½•æ“ä½œã€‚</p><blockquote><p>Remember Meæ˜¯ä¸€ç§æœåŠ¡å™¨è¡Œä¸º, ç”±æœåŠ¡å™¨è®°å½•ä¿¡æ¯</p></blockquote><h3 id="æ€ä¹ˆåš-quick-start"><a href="#æ€ä¹ˆåš-quick-start" class="headerlink" title="æ€ä¹ˆåš?(quick start)"></a>æ€ä¹ˆåš?(quick start)</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RememberApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(RememberApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.factory.PasswordEncoderFactories;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.SecurityFilterChain;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> PasswordEncoderFactories.createDelegatingPasswordEncoder();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="keyword">return</span> httpSecurity</span><br><span class="line">.authorizeRequests()</span><br><span class="line">.anyRequest()</span><br><span class="line">.authenticated()</span><br><span class="line">.and()</span><br><span class="line">.formLogin()</span><br><span class="line">.permitAll()</span><br><span class="line">.and()</span><br><span class="line">.rememberMe()</span><br><span class="line">.key(<span class="string">&quot;zhazha&quot;</span>)</span><br><span class="line">.and()</span><br><span class="line">.csrf()</span><br><span class="line">.disable()</span><br><span class="line">.build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261001817.png" alt="image-20221126100118915"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261043010.png" alt="image-20221126104309912"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261117133.png" alt="image-20221126111717047"></p><p>ä»¥åç”¨æˆ·æ‹¿ç€å¦‚ä¸Šå›¾æ‰€ç¤ºçš„<code>remember-me</code>çš„å€¼è·ŸæœåŠ¡å™¨è¿›è¡Œç”¨æˆ·èº«ä»½æ ¡éªŒ</p><blockquote><p>å­˜åœ¨å®‰å…¨éšæ‚£</p></blockquote><h4 id="åº•å±‚éƒ½åšäº†ä»€ä¹ˆ"><a href="#åº•å±‚éƒ½åšäº†ä»€ä¹ˆ" class="headerlink" title="åº•å±‚éƒ½åšäº†ä»€ä¹ˆ?"></a>åº•å±‚éƒ½åšäº†ä»€ä¹ˆ?</h4><p>æˆ‘åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:</p><ol><li>remembermeæœåŠ¡åˆ›å»ºå’Œä¿å­˜cookieçš„è¿‡ç¨‹</li><li>è§¦å‘cookie remembermeæœºåˆ¶</li></ol><h5 id="åˆ›å»ºå’Œä¿å­˜çš„è¿‡ç¨‹"><a href="#åˆ›å»ºå’Œä¿å­˜çš„è¿‡ç¨‹" class="headerlink" title="åˆ›å»ºå’Œä¿å­˜çš„è¿‡ç¨‹"></a>åˆ›å»ºå’Œä¿å­˜çš„è¿‡ç¨‹</h5><p>ä»”ç»†åˆ†æè¿‡ç¨‹, å¯ä»¥å‘ç°, <code>rememberme</code> çš„å±æ€§åº”è¯¥ä¼šåœ¨<code>SpringSecurity</code>çš„ç™»å½•çš„è´¦æˆ·å’Œå¯†ç éªŒè¯é€šè¿‡ä¹‹åæ‰ä¼šé…ç½®çš„åŠŸèƒ½</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261712755.png" alt="image-20221126171218557"></p><p>ä½†æ˜¯åœ¨è¿™é‡Œæ²¡æœ‰å…³é”®çš„ä»£ç </p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261714060.png" alt="image-20221126171415965"></p><p>é‚£ä¹ˆå…³é”®ä»£ç å¯èƒ½åœ¨</p><ul><li>è¿™ä¸ªå‡½æ•°å†…éƒ¨</li><li>è¿™ä¸ªå‡½æ•°è¿”å›ä¹‹å</li></ul><p>ä¸ºäº†ç¡®å®šè¿™ä¸ªé—®é¢˜, æˆ‘ä»¬å›åˆ°å‰é¢æ€»ç»“çš„æµç¨‹</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211262004522.png" alt="image-20221126200406409"></p><p>é‚£å¼ æµç¨‹å›¾çš„å·¦ä¸‹è§’éƒ¨åˆ†, å°±èƒ½çœ‹åˆ°è¯¥åŠŸèƒ½</p><p>å¯ä»¥çœ‹åˆ°æŒæœ‰è¯¥å±æ€§çš„ç±»:</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261956167.png" alt="image-20221126195649073"></p><p>åœ¨è¿™ä¸ªç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter#successfulAuthentication</span><br></pre></td></tr></table></figure><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211262005060.png" alt="image-20221126200517948"></p><p>è¿›å…¥å‡½æ•°ä¹‹å, å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é…ç½®çš„Bean:</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211262012179.png" alt="image-20221126201228065"></p><p>ä¹Ÿå°±æ˜¯è¿™ä¸ªç±»:</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211262012035.png" alt="image-20221126201253840"></p><p><code>createNewToken</code>è¿™ä¸ªå‡½æ•°å°†å‰é¢æˆ‘ä»¬é…ç½®å¥½çš„æ•°æ®</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211262018241.png" alt="image-20221126201802150"></p><p>æ’å…¥åˆ°æ•°æ®åº“ä¸­</p><p><code>insert into persistent_logins (username, series, token, last_used) values(?,?,?,?)</code></p><p>æ¥ç€å°†å†…å®¹å­˜å‚¨åˆ°Cookieä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addCookie(persistentToken, request, response);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setCookie</span><span class="params">(String[] tokens, <span class="type">int</span> maxAge, HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">   <span class="comment">// (1)</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">cookieValue</span> <span class="operator">=</span> encodeCookie(tokens);</span><br><span class="line">   <span class="comment">// åˆ›å»º cookie</span></span><br><span class="line">   <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="built_in">this</span>.cookieName, cookieValue);</span><br><span class="line">   <span class="comment">// è®¾ç½®cookieç”Ÿå‘½å‘¨æœŸ, æŒ‰ç§’è®¡ç®—, é»˜è®¤è®¾ç½®1209600ç§’ä¹Ÿå°±æ˜¯ 15 å¤©</span></span><br><span class="line">   cookie.setMaxAge(maxAge);</span><br><span class="line">   <span class="comment">// è®¾ç½® cookieæœ‰æ•ˆçš„è·¯å¾„, è¿™é‡Œé»˜è®¤è®¾ç½®ä¸º &quot;/&quot; è¡¨ç¤º cookieå¯¹æ‰€æœ‰è·¯å¾„æœ‰æ•ˆ</span></span><br><span class="line">   cookie.setPath(getCookiePath(request));</span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.cookieDomain != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// è®¾ç½® cookie çš„åŸŸå, åœ¨ç‰¹å®šåŸŸåä¸‹æ‰èƒ½å¤Ÿè®¾ç½® cookie</span></span><br><span class="line">      <span class="comment">// é»˜è®¤æƒ…å†µä¸ºå½“å‰åŸŸå, è€ŒåŸŸåçš„è®¾ç½®æ™ºèƒ½è®¾ç½®å½“å‰åŸŸåæˆ–è€…å½“å‰åŸŸåçš„çˆ¶çº§åŸŸå</span></span><br><span class="line">      cookie.setDomain(<span class="built_in">this</span>.cookieDomain);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (maxAge &lt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// è®¾ç½®ä¸åŒçš„è§„èŒƒ</span></span><br><span class="line">      cookie.setVersion(<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   cookie.setSecure((<span class="built_in">this</span>.useSecureCookie != <span class="literal">null</span>) ? <span class="built_in">this</span>.useSecureCookie : request.isSecure());</span><br><span class="line">   <span class="comment">// ä¿è¯ cookie åœ¨ client ç«¯æ˜¯éšè—çš„, JavaScriptæ— æ³•è·å– cookieä¿¡æ¯, é˜²æ­¢xssæ”»å‡»</span></span><br><span class="line">   cookie.setHttpOnly(<span class="literal">true</span>);</span><br><span class="line">   <span class="comment">// cookie æ·»åŠ åˆ°å“åº”</span></span><br><span class="line">   response.addCookie(cookie);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(1)åœ¨è¿™é‡Œå°†ä¸¤ä¸ªå­—ç¬¦ä¸²æ•´åˆåœ¨ä¸€èµ·</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211262037887.png" alt="image-20221126203745786"></p><p>æ•´åˆæˆ: <code>dsXPNHvfIOuOG%2FiwlnSaCg%3D%3D:4oZ%2Bf0ExQi1lPwmkSW6N5A%3D%3D</code></p><p>æ¥ç€å€ŸåŠ©<code>Base64.getEncoder().encode</code>å‡½æ•°ç¼–ç æˆ: <code>ZHNYUE5IdmZJT3VPRyUyRml3bG5TYUNnJTNEJTNEOjRvWiUyQmYwRXhRaTFsUHdta1NXNk41QSUzRCUzRA</code></p><h5 id="è§¦å‘è¿‡ç¨‹"><a href="#è§¦å‘è¿‡ç¨‹" class="headerlink" title="è§¦å‘è¿‡ç¨‹"></a>è§¦å‘è¿‡ç¨‹</h5><ul><li>æµç¨‹</li></ul><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211271003798.png" alt="SpringSecurityè‡ªåŠ¨ç™»å½•è§¦å‘æºç åˆ†æ"></p><ul><li>æ‰¾åˆ°å…³é”®çš„è¿‡æ»¤å™¨</li></ul><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261610625.png" alt="image-20221126161049552"></p><p>é…ç½®äº†æ–°çš„ç±»<code>RememberMeConfigurer</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Configures Remember Me authentication. This typically involves the user checking a box when they enter their username and password that states to <span class="string">&quot;Remember Me&quot;</span>.</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç±»æ·»åŠ äº†ä¸€ä¸ªFilteråˆ° spring security chain</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261641816.png" alt="image-20221126164157737"></p><p>æ‰€ä»¥æ ¸å¿ƒä»£ç åœ¨è¿™é‡Œ<code>RememberMeAuthenticationFilter</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RememberMeAuthenticationFilter</span> <span class="variable">rememberMeFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RememberMeAuthenticationFilter</span>(</span><br><span class="line">      http.getSharedObject(AuthenticationManager.class), <span class="built_in">this</span>.rememberMeServices);</span><br></pre></td></tr></table></figure><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261647075.png" alt="image-20221126164713009"></p><p>è¿™ä¸¤ä¸ªå¯¹è±¡å¿…é¡»è¢«æŒ‡å®š, å¦åˆ™ä¼šæŠ¥é”™</p><h2 id="æŒä¹…åŒ–ä»¤ç‰Œ"><a href="#æŒä¹…åŒ–ä»¤ç‰Œ" class="headerlink" title="æŒä¹…åŒ–ä»¤ç‰Œ"></a>æŒä¹…åŒ–ä»¤ç‰Œ</h2><p>æŒä¹…åŒ–ä»¤ç‰Œè·Ÿæ•°æ®åº“ç›¸å…³, ä¸ä¼ ç»Ÿæ–¹å¼ç›¸æ¯”è¾ƒ, å¤šå‡ºäº†ä¸¤ä¸ª<code>key</code>: <code>series</code>å’Œ<code>token</code>.</p><p><code>series</code>çš„ä½œç”¨æœ‰ç‚¹åƒä¹è§‚é”çš„ <code>version</code>, æ¯æ¬¡åœ¨ç”¨æˆ·ä½¿ç”¨å¯†ç ç™»å½•æ—¶æ›´æ–°ä¸€ä¸ªæ–°çš„å€¼</p><p><code>token</code>çš„ä½œç”¨åœ¨æ¯æ¬¡æ›´æ–°<code>session</code>ä¼šè¯æ—¶é‡æ–°å‘å¸ƒä¸€ä¸ªæ–°çš„å€¼</p><p>ä¸‹å›¾æ˜¯è¿™ä¸¤ä¸ªå€¼çš„ç”±æ¥:</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211262009540.png" alt="image-20221126200952464"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211262009510.png" alt="image-20221126200905354"></p><blockquote><p>è¯´ç™½äº†, ä¸€ä¸ªåœ¨ä½¿ç”¨å¯†ç ç™»å½•æ—¶, ä¸€ä¸ªåœ¨ä¼šè¯<code>session</code>æ›´æ–°æ—¶</p></blockquote><h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><ol><li>æŒä¹…åŒ–ä»¤ç‰Œæ–¹æ¡ˆ é¿å…äº†æ•£åˆ—åŠ å¯†æ–¹æ¡ˆä¸­ï¼Œä¸€ä¸ªä»¤ç‰Œå¯ä»¥åŒæ—¶åœ¨å¤šç«¯ç™»å½•çš„é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºæ¯ä¸ª<code>session</code>ä¼šè¯éƒ½ä¼šå¼•å‘<code>token</code>çš„æ›´æ–°ï¼Œå³æ¯ä¸ª<code>token</code>ä»…æ”¯æŒå•å®ä¾‹ç™»å½•</li><li>æœåŠ¡å¯ä»¥æ›´å®¹æ˜“å‘ç°ç”¨æˆ·è´¦å·è¢«ç›—. <code>series</code>å’Œ<code>token</code>åœ¨æ¯æ¬¡è‡ªåŠ¨ç™»å½•æ—¶éƒ½éœ€è¦éªŒè¯, ç°åœ¨å‡è®¾ç”²çš„<code>series = 1, token = 1</code>, ä¹™æ‹¿èµ°äº†ç”²çš„è¿™ä¸¤ä¸ªå‚æ•°, ç™»å½•ä¹‹å <code>token</code> å°†ä¼šè¢«æ”¹å˜, å› ä¸ºä¼šè¯ä¸åŒäº†, æ­¤æ—¶ç”²å†æ‹¿ç€ <code>token = 1</code> å»è®¿é—®æ—¶, æœåŠ¡å™¨å°±ä¼šå‘ç°, ç”²çš„ <code>token</code>ä¸å¯¹, ç›´æ¥æé†’ç”²è´¦å·åœ¨åˆ«å¤„ç™»å½•</li></ol><h4 id="æ€ä¹ˆåš"><a href="#æ€ä¹ˆåš" class="headerlink" title="æ€ä¹ˆåš?"></a>æ€ä¹ˆåš?</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> JdbcTokenRepositoryImpl <span class="title function_">tokenRepository</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">JdbcTokenRepositoryImpl</span> <span class="variable">tokenRepository</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTokenRepositoryImpl</span>();</span><br><span class="line">    tokenRepository.setCreateTableOnStartup(<span class="literal">true</span>);</span><br><span class="line">    tokenRepository.setDataSource(dataSource);</span><br><span class="line">    <span class="keyword">return</span> tokenRepository;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> httpSecurity</span><br><span class="line">        .authorizeRequests()</span><br><span class="line">        .anyRequest()</span><br><span class="line">        .authenticated()</span><br><span class="line">        .and()</span><br><span class="line">        .formLogin()</span><br><span class="line">        .permitAll()</span><br><span class="line">        .and()</span><br><span class="line">        .rememberMe()</span><br><span class="line">        .tokenRepository(tokenRepository())</span><br><span class="line">        .and()</span><br><span class="line">        .csrf()</span><br><span class="line">        .disable()</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¼šæŠŠ <code>rememberMe</code>çš„æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“äº†</p><h4 id="åº•å±‚éƒ½åšäº†ä»€ä¹ˆ-1"><a href="#åº•å±‚éƒ½åšäº†ä»€ä¹ˆ-1" class="headerlink" title="åº•å±‚éƒ½åšäº†ä»€ä¹ˆ?"></a>åº•å±‚éƒ½åšäº†ä»€ä¹ˆ?</h4><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261557418.png" alt="image-20221126155756328"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261558302.png" alt="image-20221126155811220"></p><p>å¯¹<code>token</code>çš„ <code>curd</code></p><p>åˆ›å»ºäº†ä¸€å¼ è¡¨, <img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261602423.png" alt="image-20221126160246340"></p><p>åªè¦åœ¨ç™»å½•çš„æ—¶å€™, ç‚¹å‡»äº† rememberme å°±ä¼šåœ¨æ•°æ®åº“åˆ›å»º</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261603578.png" alt="image-20221126160339474"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211261606812.png" alt="image-20221126160652681"></p><h2 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h2>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¿‡æ»¤å™¨ </tag>
            
            <tag> è®¤è¯ </tag>
            
            <tag> ç™»å½• </tag>
            
            <tag> SpringSecurity </tag>
            
            <tag> æºç åˆ†æ </tag>
            
            <tag> è®°ä½æˆ‘ </tag>
            
            <tag> æŒä¹…åŒ–ä»¤ç‰Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>16SpringSecurity-JSONæ ¼å¼ç™»å½•</title>
      <link href="/2022/11/25/02springcloud/16SpringSecurity-JSON%E6%A0%BC%E5%BC%8F%E7%99%BB%E5%BD%95/"/>
      <url>/2022/11/25/02springcloud/16SpringSecurity-JSON%E6%A0%BC%E5%BC%8F%E7%99%BB%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringSecurityç³»åˆ—"><a href="#SpringSecurityç³»åˆ—" class="headerlink" title="SpringSecurityç³»åˆ—"></a><code>SpringSecurity</code>ç³»åˆ—</h1><h2 id="ä½¿ç”¨JSONæ ¼å¼ç™»å½•"><a href="#ä½¿ç”¨JSONæ ¼å¼ç™»å½•" class="headerlink" title="ä½¿ç”¨JSONæ ¼å¼ç™»å½•"></a>ä½¿ç”¨<code>JSON</code>æ ¼å¼ç™»å½•</h2><p>ä¸¤ç§æ–¹å¼: </p><ol><li>é‡å†™<code>UsernamePasswordAuthenticationFilter</code>è¿‡æ»¤å™¨</li><li>è‡ªå®šä¹‰ç™»å½•<code>controller rest</code></li></ol><h3 id="é‡å†™UsernamePasswordAuthenticationFilterè¿‡æ»¤å™¨"><a href="#é‡å†™UsernamePasswordAuthenticationFilterè¿‡æ»¤å™¨" class="headerlink" title="é‡å†™UsernamePasswordAuthenticationFilterè¿‡æ»¤å™¨"></a>é‡å†™<code>UsernamePasswordAuthenticationFilter</code>è¿‡æ»¤å™¨</h3><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p><code>JSON</code>æ ¼å¼ç™»å½•, å‰ç«¯è®¤è¯çš„ä¿¡æ¯è½¬å‘åˆ°åç«¯åä¸€å®šæ˜¯ä¸€ä¸ª<code>JSON</code>æ ¼å¼å­—ç¬¦ä¸², å­˜å‚¨åœ¨<code>request</code>è¯·æ±‚å†…, æˆ‘ä»¬åªè¦åœ¨<code>Spring Security</code>çš„è¿‡æ»¤å™¨é“¾ä¸­æ‰¾åˆ°æŠ“å–<code>request</code>è¯·æ±‚çš„è¿‡æ»¤å™¨ç±»çš„æ–¹æ³•é‡å†™æ‰å°±å¥½, æ¥ç€æ·»åŠ åˆ°<code>Spring Security</code>ä¸­</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211241851680.png" alt="image-20221124175929306"></p><h4 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><ol><li>ç»§æ‰¿<code>UsernamePasswordAuthenticationFilter</code></li><li>æ·»åŠ åˆ°Spring Security</li></ol><ul><li>ç»§æ‰¿</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginFilter</span> <span class="keyword">extends</span> <span class="title class_">UsernamePasswordAuthenticationFilter</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> ObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Authentication <span class="title function_">attemptAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="string">&quot;POST&quot;</span>.equals(request.getMethod())) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidateCodeException</span>(<span class="string">&quot;Authentication method not supported: &quot;</span> + request.getMethod());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‹¿åˆ° session éªŒè¯ç </span></span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"><span class="type">String</span> <span class="variable">verifyCode</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;verify_code&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (MediaType.APPLICATION_JSON_VALUE.equalsIgnoreCase(request.getContentType()) || MediaType.APPLICATION_JSON_UTF8_VALUE.equalsIgnoreCase(request.getContentType())) &#123;</span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºJSONç±»å‹è¯·æ±‚</span></span><br><span class="line">Map&lt;String, Object&gt; loginMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// è·å–requestä¸­çš„JSON</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">loginMap = objectMapper.readValue(request.getInputStream(), Map.class);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éªŒè¯ç éªŒè¯</span></span><br><span class="line"><span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> (String) loginMap.get(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">validCode(code, verifyCode);</span><br><span class="line"><span class="comment">// æ‹¿åˆ°ç”¨æˆ·å’Œå¯†ç </span></span><br><span class="line"><span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> (String) loginMap.get(getUsernameParameter());</span><br><span class="line">username = (username != <span class="literal">null</span>) ? username.trim() : <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> (String) loginMap.get(getPasswordParameter());</span><br><span class="line">password = (password != <span class="literal">null</span>) ? password : <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authRequest</span> <span class="operator">=</span> UsernamePasswordAuthenticationToken.unauthenticated(username,</span><br><span class="line">password);</span><br><span class="line">setDetails(request, authRequest);</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.getAuthenticationManager().authenticate(authRequest);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// éªŒè¯ç éªŒè¯</span></span><br><span class="line"><span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> (String) request.getAttribute(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">validCode(code, verifyCode);</span><br><span class="line"><span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> obtainUsername(request);</span><br><span class="line">username = (username != <span class="literal">null</span>) ? username.trim() : <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> obtainPassword(request);</span><br><span class="line">password = (password != <span class="literal">null</span>) ? password : <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authRequest</span> <span class="operator">=</span> UsernamePasswordAuthenticationToken.unauthenticated(username,</span><br><span class="line">password);</span><br><span class="line">setDetails(request, authRequest);</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.getAuthenticationManager().authenticate(authRequest);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">validCode</span><span class="params">(String code, String verifyCode)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (StringUtils.isBlank(verifyCode)) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidateCodeException</span>(<span class="string">&quot;è¯·é‡æ–°ç”³è¯·éªŒè¯ç !&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‹¿åˆ° request éªŒè¯ç </span></span><br><span class="line"><span class="keyword">if</span> (StringUtils.isBlank(code)) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidateCodeException</span>(<span class="string">&quot;éªŒè¯ç ä¸èƒ½ä¸ºç©º!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯¹æ¯”</span></span><br><span class="line"><span class="keyword">if</span> (!StringUtils.equalsIgnoreCase(verifyCode, code)) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidateCodeException</span>(<span class="string">&quot;éªŒè¯ç ä¸å¯¹!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ·»åŠ </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> ObjectMapper <span class="title function_">objectMapper</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> UserDetailsService <span class="title function_">userDetailsService</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MybatisUserDetailsService</span>();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> AuthenticationManager <span class="title function_">authenticationManager</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">DaoAuthenticationProvider</span> <span class="variable">daoAuthenticationProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DaoAuthenticationProvider</span>();</span><br><span class="line">      daoAuthenticationProvider.setUserDetailsService(userDetailsService());</span><br><span class="line">      <span class="comment">// è¿™é‡Œè¡¨ç¤ºå¦ä¸€ä¸ªæ•°æ®æº</span></span><br><span class="line"><span class="comment">//    daoAuthenticationProvider.setUserDetailsService(userDetailsService02());</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ProviderManager</span>(daoAuthenticationProvider);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> PasswordEncoderFactories.createDelegatingPasswordEncoder();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   LoginFilter <span class="title function_">loginFilter</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      <span class="type">LoginFilter</span> <span class="variable">loginFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoginFilter</span>();</span><br><span class="line">      loginFilter.setFilterProcessesUrl(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">      loginFilter.setUsernameParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">      loginFilter.setPasswordParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">      loginFilter.setAuthenticationManager(authenticationManager());</span><br><span class="line">      loginFilter.setAuthenticationSuccessHandler(<span class="keyword">new</span> <span class="title class_">MyAuthenticationSuccessHandler</span>());</span><br><span class="line">      loginFilter.setAuthenticationFailureHandler(<span class="keyword">new</span> <span class="title class_">MyAuthenticationFailureHandler</span>());</span><br><span class="line">      <span class="keyword">return</span> loginFilter;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      <span class="keyword">return</span> httpSecurity</span><br><span class="line">            .addFilterAt(loginFilter(), UsernamePasswordAuthenticationFilter.class)</span><br><span class="line">            .authorizeHttpRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/verify-code&quot;</span>).permitAll()</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .formLogin()</span><br><span class="line">            .defaultSuccessUrl(<span class="string">&quot;/hello&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            .logout()</span><br><span class="line">            .logoutUrl(<span class="string">&quot;/logout&quot;</span>)</span><br><span class="line">            .logoutSuccessUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">            .clearAuthentication(<span class="literal">true</span>)</span><br><span class="line">            .invalidateHttpSession(<span class="literal">true</span>)</span><br><span class="line">            .and()</span><br><span class="line">            .exceptionHandling().authenticationEntryPoint(<span class="keyword">new</span> <span class="title class_">MyAuthenticationEntryPoint</span>())</span><br><span class="line">            .and()</span><br><span class="line">            .build();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.AuthenticationEntryPoint;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æœªç™»å½•ä½†è®¿é—®éœ€è¦ç™»å½•çš„æ¥å£å¼‚å¸¸å›è°ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAuthenticationEntryPoint</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationEntryPoint</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException e)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        response.setContentType(MediaType.APPLICATION_JSON_VALUE);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        out.write(<span class="string">&quot;æ‚¨æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•ï¼&quot;</span>);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.BadCredentialsException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.LockedException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.AuthenticationFailureHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç™»å½•å¤±è´¥å›è°ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAuthenticationFailureHandler</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationFailureHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationFailure</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException e)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        response.setContentType(MediaType.APPLICATION_JSON_VALUE);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> LockedException) &#123;</span><br><span class="line">            msg = <span class="string">&quot;è´¦æˆ·è¢«é”å®šï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> BadCredentialsException) &#123;</span><br><span class="line">            msg = <span class="string">&quot;ç”¨æˆ·åæˆ–è€…å¯†ç è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        out.write(e.getMessage());</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.AuthenticationSuccessHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç™»å½•æˆåŠŸå›è°ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAuthenticationSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationSuccessHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">principal</span> <span class="operator">=</span> authentication.getPrincipal();</span><br><span class="line">        response.setContentType(MediaType.APPLICATION_JSON_VALUE);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        out.write(<span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(principal));</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšäº†ä¹‹å, é¦–é¡µæ‰“ä¸å¼€, åŸå› åœ¨è¿™é‡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> httpSecurity</span><br><span class="line">            .addFilterAt(loginFilter(), UsernamePasswordAuthenticationFilter.class)</span><br><span class="line">            .authorizeHttpRequests()</span><br></pre></td></tr></table></figure><p><code>addFilterAt</code>å‡½æ•°ä¸èƒ½æ”¾ç½®åœ¨å‰é¢, åœ¨è®¤è¯è¯·æ±‚åæ‰æœ‰ç™»å½•åŠŸèƒ½, ä»£ç æ”¹ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   <span class="keyword">return</span> httpSecurity</span><br><span class="line">         .authorizeHttpRequests()</span><br><span class="line">         .antMatchers(<span class="string">&quot;/verify-code&quot;</span>).permitAll()</span><br><span class="line">         .anyRequest()</span><br><span class="line">         .authenticated()</span><br><span class="line">         .and()</span><br><span class="line">         .formLogin()</span><br><span class="line">         .defaultSuccessUrl(<span class="string">&quot;/hello&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">         .permitAll()</span><br><span class="line">         .and()</span><br><span class="line">         .logout()</span><br><span class="line">         .logoutUrl(<span class="string">&quot;/logout&quot;</span>)</span><br><span class="line">         .logoutSuccessUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">         .clearAuthentication(<span class="literal">true</span>)</span><br><span class="line">         .invalidateHttpSession(<span class="literal">true</span>)</span><br><span class="line">         .and()</span><br><span class="line">         .csrf()</span><br><span class="line">         .disable()</span><br><span class="line">         .addFilterAt(loginFilter(), UsernamePasswordAuthenticationFilter.class) <span class="comment">// è¿™ä¸ªå¿…é¡»åœ¨åé¢, ä¸èƒ½æ”¾åœ¨å‰é¢, å¦åˆ™ä¼šå‡ºé”™</span></span><br><span class="line">         .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mybatis </tag>
            
            <tag> è¿‡æ»¤å™¨ </tag>
            
            <tag> JSON </tag>
            
            <tag> è®¤è¯ </tag>
            
            <tag> ç™»å½• </tag>
            
            <tag> SpringSecurity </tag>
            
            <tag> æºç åˆ†æ </tag>
            
            <tag> å›¾ç‰‡éªŒè¯ç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>15SpringSecurity-æ¶æ„å›¾</title>
      <link href="/2022/11/21/02springcloud/15SpringSecurity-%E6%9E%B6%E6%9E%84%E5%9B%BE/"/>
      <url>/2022/11/21/02springcloud/15SpringSecurity-%E6%9E%B6%E6%9E%84%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringSecurityæ¶æ„"><a href="#SpringSecurityæ¶æ„" class="headerlink" title="SpringSecurityæ¶æ„"></a><code>SpringSecurity</code>æ¶æ„</h1><p>å®˜æ–¹ç”¨å‡ å¼ å›¾ç‰‡å°±è¾ƒä¸ºç®€å•çš„æ˜¾ç¤ºäº†<code>SpringSecurity</code>çš„æ¶æ„</p><h2 id="ç¬¬ä¸€å¼ å›¾"><a href="#ç¬¬ä¸€å¼ å›¾" class="headerlink" title="ç¬¬ä¸€å¼ å›¾"></a>ç¬¬ä¸€å¼ å›¾</h2><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211210644201.png" alt="image-20221121064439555"></p><p>å¼€ç¯‡ç¬¬ä¸€å¥è¯ â€œ<code>SpringSecurity</code>æ”¯æŒåŸºäº<code>Servlet Filters</code>â€œ</p><p>ç¬¬äºŒå¥è¯è§£é‡Šäº†ä¸Šå›¾å›¾ç¤º</p><p>The client sends a request to the application, and the container creates a <code>FilterChain</code> which contains the <code>Filter</code>s and <code>Servlet</code> that should process the <code>HttpServletRequest</code> based on the path of the request URI.</p><p>éœ€è¦å…³æ³¨çš„æ˜¯ <code>based on the path of the request URI</code> <strong>è¿‡æ»¤å™¨æ ¹æ® request URIè·¯å¾„ æ‹¦æˆª</strong></p><p>é™¤æ­¤ä¹‹å¤–ä»–ä¹Ÿè¯´äº†é™¤<code>DispatcherServlet</code>å¤–çš„å…¶ä»–è¿‡æ»¤å™¨çš„åŠŸèƒ½:</p><ul><li>è¦ä¹ˆåˆ‡æ–­<code>Filter Chain</code>(è¿‡æ»¤å™¨é“¾), é€šå¸¸è¿™æ ·çš„<code>Filter</code>ä¼šæŠŠæ‰§è¡Œçš„ç»“æœå†™å…¥<code>HttpServletResponse</code></li><li>è¦ä¹ˆä¿®æ”¹å‡†å¤‡ä¼ é€’ç»™ä¸‹æ¸¸<code>Filter</code>çš„<code>HttpServletRequest</code>æˆ–è€…<code>HttpServletResponse</code></li></ul><p>ç„¶åç»™å‡ºäº†ä¸€ä¸ª<code>FilterChain</code>å·¥ä½œçš„æºç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> &#123;</span><br><span class="line"><span class="comment">// do something before the rest of the application</span></span><br><span class="line">    chain.doFilter(request, response); <span class="comment">// invoke the rest of the application</span></span><br><span class="line">    <span class="comment">// do something after the rest of the application</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹çš„, å°±æ˜¯ <code>doFilter</code>, ç›¸å½“äº <code>nextFilter</code></p><p>æœ€åå¼ºè°ƒäº† <strong>Filter ä¹‹é—´çš„ é¡ºåºå¾ˆé‡è¦</strong> è¿™ç‚¹è®°ä½äº†, è¦è€ƒ</p><h2 id="ç¬¬äºŒå¼ å›¾"><a href="#ç¬¬äºŒå¼ å›¾" class="headerlink" title="ç¬¬äºŒå¼ å›¾"></a>ç¬¬äºŒå¼ å›¾</h2><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211210704550.png" alt="image-20221121070407474"></p><p>å¯ä»¥çœ‹å‡ºæ¥<code>DelegatingFilterProxy</code> åŒ…è£…äº†ä¸€ä¸ª <code>Bean Filter</code>, è¿™ä¸ª <code>Bean Filter</code>æ˜¯ <code>Spring Bean</code>è·å–å‡ºæ¥çš„è¿‡æ»¤å™¨</p><p>è¿™å¼ å›¾ç‰‡ä¸»è¦å¼ºè°ƒ <code>DelegatingFilterProxy</code> , ä¸€ä¸ªåœ¨ <code>servlet</code> å’Œ <code>Spring</code> ä¹‹é—´ç‰µçº¿æ­æ¡¥çš„å®¶ä¼™, ä»–çš„æœ¬è´¨è¿˜æ˜¯ä¸€ä¸ª<code>Filter</code>è¿‡æ»¤å™¨</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211336508.png" alt="image-20221121133613411"></p><p>è„±ç¦»å®˜æ–¹æ–‡æ¡£, æˆ‘ä»¬æ¥ä»”ç»†çœ‹çœ‹è¿™ä¸ªè¿‡æ»¤å™¨</p><h3 id="åˆå§‹åŒ–è¿‡ç¨‹"><a href="#åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="åˆå§‹åŒ–è¿‡ç¨‹"></a>åˆå§‹åŒ–è¿‡ç¨‹</h3><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211322819.png" alt="image-20221121131225282"></p><p>ä»ä¸Šé¢é‚£å¼ å›¾ä¸­å¯ä»¥ç„å‡†å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å‡½æ•°</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211332455.png" alt="image-20221121133202331"></p><p>ä»<code>SpringMVC</code>ä¸Šä¸‹æ–‡ä¸­è·å– <code>Filter</code> </p><blockquote><p>è¿™ä¸å°±åˆšå¥½è¯ é‡Šäº†<code>DelegatingFilterProxy</code>çš„ä½œç”¨ä¹ˆ?</p></blockquote><p>å†è·Ÿ</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211335272.png" alt="image-20221121133511163"></p><p>ä¸æ˜¯åˆšå¥½é…åˆä¸Šäº†ä¹ˆ?</p><p>æˆ‘ä»¬æŸ¥æ‰¾è¿‡æ»¤å™¨æ¥å£å‡½æ•°<code>init</code></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211325430.png" alt="image-20221121132551324"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">   <span class="comment">// è¿™ä¸ªå‡½æ•°è°ƒç”¨çš„æ˜¯</span></span><br><span class="line">   initFilterBean();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211329227.png" alt="image-20221121132908140"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initFilterBean</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">   <span class="keyword">synchronized</span> (<span class="built_in">this</span>.delegateMonitor) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.delegate == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">if</span> (<span class="built_in">this</span>.targetBeanName == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.targetBeanName = getFilterName();</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// ç›´æ¥è·å– SpringMVC çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line">         <span class="type">WebApplicationContext</span> <span class="variable">wac</span> <span class="operator">=</span> findWebApplicationContext();</span><br><span class="line">         <span class="keyword">if</span> (wac != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å°†è·å–åˆ°çš„ Filter å­˜å‚¨åœ¨delegate</span></span><br><span class="line">            <span class="built_in">this</span>.delegate = initDelegate(wac);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸­çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ®targetBeanNameä»ä¸Šä¸‹æ–‡ä¸­è·å– Filter è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="keyword">protected</span> Filter <span class="title function_">initDelegate</span><span class="params">(WebApplicationContext wac)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">   <span class="comment">// è·å– spring å®¹å™¨ä¸­çš„ targetBeanName</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">targetBeanName</span> <span class="operator">=</span> getTargetBeanName();</span><br><span class="line">   <span class="comment">// ä»SpringMVCä¸­è·å–Filter</span></span><br><span class="line">   <span class="type">Filter</span> <span class="variable">delegate</span> <span class="operator">=</span> wac.getBean(targetBeanName, Filter.class);</span><br><span class="line">   <span class="keyword">if</span> (isTargetFilterLifecycle()) &#123;</span><br><span class="line">      delegate.init(getFilterConfig());</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// è¿”å› Filter</span></span><br><span class="line">   <span class="keyword">return</span> delegate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>targetBeanName</code>å±æ€§çš„å€¼å“ªæ¥çš„? çœ‹ä¸‹å›¾</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211320589.png" alt="image-20221121132040517"></p><p>ä»–æœ‰4ä¸ªæ„é€ å‡½æ•°, å…¶ä¸­ç¬¬ä¸‰ä¸ªæ„é€ ç±»æˆ‘æ‰¾åˆ°äº† Example ä»£ç </p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211322214.png" alt="image-20221121132201135"></p><p>ä¸€çœ‹å°±çŸ¥é“æ˜¯ <code>Shiro</code> æ¡†æ¶é…ç½®çš„<code>filter</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">DelegatingFilterProxy</span><span class="params">(String targetBeanName)</span> &#123;</span><br><span class="line">   <span class="built_in">this</span>(targetBeanName, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211345602.png" alt="image-20221121134528522"></p><h3 id="è°ƒç”¨Filterçš„è¿‡ç¨‹"><a href="#è°ƒç”¨Filterçš„è¿‡ç¨‹" class="headerlink" title="è°ƒç”¨Filterçš„è¿‡ç¨‹"></a>è°ƒç”¨Filterçš„è¿‡ç¨‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain filterChain)</span></span><br><span class="line">      <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å¦‚æœéœ€è¦, å¯ä»¥æ‡’åŠ è½½åˆå§‹åŒ– delegate</span></span><br><span class="line">   <span class="type">Filter</span> <span class="variable">delegateToUse</span> <span class="operator">=</span> <span class="built_in">this</span>.delegate;</span><br><span class="line">   <span class="keyword">if</span> (delegateToUse == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (<span class="built_in">this</span>.delegateMonitor) &#123;</span><br><span class="line">         delegateToUse = <span class="built_in">this</span>.delegate;</span><br><span class="line">         <span class="keyword">if</span> (delegateToUse == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">WebApplicationContext</span> <span class="variable">wac</span> <span class="operator">=</span> findWebApplicationContext();</span><br><span class="line">            <span class="keyword">if</span> (wac == <span class="literal">null</span>) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;No WebApplicationContext found: &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;no ContextLoaderListener or DispatcherServlet registered?&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            delegateToUse = initDelegate(wac);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="built_in">this</span>.delegate = delegateToUse;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// èµ°æˆ‘ä»¬è·å¾—çš„ DelegatingFilterProxy çš„ doFilter</span></span><br><span class="line">   invokeDelegate(delegateToUse, request, response, filterChain);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">invokeDelegate</span><span class="params">(</span></span><br><span class="line"><span class="params">      Filter delegate, ServletRequest request, ServletResponse response, FilterChain filterChain)</span></span><br><span class="line">      <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">   delegate.doFilter(request, response, filterChain);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p><code>DelegatingFilterProxy</code>çš„å¦ä¸€ä¸ªå¥½å¤„å°±æ˜¯å…è®¸å»¶è¿ŸæŸ¥æ‰¾<code>Filter Bean</code>å®ä¾‹</p><p>è¿™æ˜¯éå¸¸é‡è¦çš„, å› ä¸ºåœ¨å®¹å™¨å¯åŠ¨ä¹‹å‰, å®¹å™¨éœ€è¦æ³¨å†Œ<code>Filter</code>å®ä¾‹. ç„¶è€Œ, <code>Spring</code>é€šå¸¸ä½¿ç”¨<code>ContextLoaderListener</code>å»åŠ è½½æ²¡æœ‰å®Œæˆçš„<code>Spring Beans</code>, ç›´åˆ°æ³¨å†Œäº†éœ€è¦çš„<code>Filter</code>å®ä¾‹ä¹‹å.</p><h2 id="ç¬¬ä¸‰å¼ å›¾"><a href="#ç¬¬ä¸‰å¼ å›¾" class="headerlink" title="ç¬¬ä¸‰å¼ å›¾"></a>ç¬¬ä¸‰å¼ å›¾</h2><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211427142.png" alt="image-20221121142744068"></p><p>åœ¨<code>FilterChainProxy</code>ä¸­åŒ…å«<code>Spring Security</code>çš„<code>servlet</code>æ”¯æŒ.</p><p><code>FilterChainProxy</code>æ˜¯ä¸€ä¸ª<code>SpringSecurity</code>æä¾›çš„ç‰¹æ®Š<code>Filter</code>, <code>FilterChainProxy</code>å…è®¸é€šè¿‡<code>SecurityFilterChain</code>å§”æ‰˜ç»™å¤šä¸ª<code>Filter</code>å®ä¾‹. å› ä¸º<code>FilterChainProxy</code>æ˜¯ä¸€ä¸ªBeanå¯¹è±¡, å®ƒé€šå¸¸è¢«åŒ…è£…åœ¨<code>DelegatingFilterProxy</code>ä¸­</p><h2 id="ç¬¬å››å¼ å›¾"><a href="#ç¬¬å››å¼ å›¾" class="headerlink" title="ç¬¬å››å¼ å›¾"></a>ç¬¬å››å¼ å›¾</h2><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211442719.png" alt="image-20221121144257631"></p><p>é€šè¿‡<code>FilterChainProxy</code> ä½¿ç”¨<code>SecurityFilterChain</code> ä»¥æ˜ç¡®ä¸ºæ­¤<code>request</code>è°ƒç”¨å“ªäº›<code>Spring Security Filters</code></p><blockquote><p>æ„æ€å°±æ˜¯<code>SecurityFilterChain</code>ç›¸å½“äº<code>Filter</code>æ•°ç»„å’¯?</p></blockquote><p>åœ¨ <code>SecurityFilterChain</code>ä¸­çš„<code>Security Filters</code>é€šå¸¸æ˜¯ä¸€ä¸ª<code>Beans</code>, ä½†ä»–ä»¬è¢«æ³¨å†Œåœ¨<code>FilterChainProxy</code>è€Œä¸æ˜¯<code>DelegatingFilterProxy.</code></p><p><code>FilterChainProxy</code>æä¾›äº†ä¸€å †æ¯”è¾ƒå¥½çš„æ–¹å¼ä»¥ç›´æ¥æ³¨å†Œåˆ°<code>Servlet</code>å®¹å™¨æˆ–è€…<code>DelegatingFilterProxy</code></p><p>é¦–å…ˆ, <code>FilterChainProxy</code>ä¸ºæ‰€æœ‰ <code>Spring Security</code> çš„ <code>Servlet</code> æ”¯æŒæä¾›äº†ä¸€ä¸ªèµ·ç‚¹, å› ä¸ºè¿™ä¸ªåŸå› , å¦‚æœä½ æ­£åœ¨å°è¯•æ£€ä¿®<code>Spring Securityâ€™s Servlet</code>æ”¯æŒ, åœ¨<code>FilterChainProxy</code>ä¸­æ·»åŠ ä¸€ä¸ªè°ƒè¯•ç‚¹æ˜¯éå¸¸å¥½çš„å¼€å¯æ–¹å¼.</p><p>æ­¤å¤–, å½“è°ƒç”¨<code>SecurityFilterChain</code> æ—¶, <code>FilterChainProxy</code>æ˜ç¡®çš„æä¾›äº†æ›´å¤šçµæ´»çš„æ“ä½œ.</p><p>åœ¨<code>servlet</code>å®¹å™¨ä¸­, åªæ ¹æ®<code>URL</code>è°ƒç”¨è¿‡æ»¤å™¨, ç„¶è€Œ<code>FilterChainProxy</code>å¯ä»¥é€šè¿‡åˆ©ç”¨<code>RequestMatcher</code>æ¥å£åœ¨<code>HttpServletRequest</code>ä¸­æ ¹æ®ä»»ä½•æ–¹å¼ç¡®å®šè°ƒç”¨å…³ç³»</p><p>äº‹å®ä¸Š, <code>FilterChainProxy</code> å¯ä»¥è¢«ç”¨äºç¡®å®šä½¿ç”¨å“ªä¸€ä¸ª<code>SecurityFilterChain</code>. è¿™å…è®¸ä¸ºä½ çš„å¼•ç”¨çš„ä¸åŒç‰‡æ®µæä¾›å®Œå…¨éš”ç¦»çš„é…ç½®.</p><h2 id="ç¬¬äº”å¼ å›¾"><a href="#ç¬¬äº”å¼ å›¾" class="headerlink" title="ç¬¬äº”å¼ å›¾"></a>ç¬¬äº”å¼ å›¾</h2><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211652993.png" alt="image-20221121165232890"></p><p>åœ¨å¤šä¸ª<code>SecurityFilterChain</code>å—ä¸­, <code>FilterChainProxy</code>å†³å®šä½¿ç”¨å“ªä¸€ä¸ª<code>SecurityFilterChain</code>.</p><p>åªæœ‰ç¬¬ä¸€æ¬¡åŒ¹é…çš„<code>SecurityFilterChain</code>å°†æ¯”è°ƒç”¨. å¦‚æœè¯·æ±‚äº†<code>/api/messages/</code>çš„URL, é‚£ä¹ˆå®ƒå°†ä¼šåŒ¹é…<code>SecurityFilterChain0</code>çš„<code>/api/**</code>, æ‰€ä»¥å³ä¾¿å®ƒåŒ¹é…äº†<code>SecurityFilterChainn</code>, ä¹Ÿåªä¼šè°ƒç”¨<code>SecurityFilterChain0</code></p><p>å¦‚æœ<code>/message/</code>çš„URLè¢«è¯·æ±‚, ä»–å°†ä¸ä¼šåŒ¹é…<code>SecurityFilterChain0</code>çš„<code>/api/**</code>, æ‰€ä»¥<code>FilterChainProxy</code>å°†ä¼šç»§ç»­æŸ¥æ‰¾æ¯ä¸€ä¸ª<code>SecurityFilterChain</code>.</p><p>å‡è®¾åŒ¹é…çš„è¿‡ç¨‹ä¸­æ²¡æœ‰ç¬¦åˆçš„<code>SecurityFilterChain</code>, å°†ä¼šåŒ¹é…<code>/**</code>ä¹Ÿå°±æ˜¯<code>SecurityFilterChainn</code></p><p>æ³¨æ„, <code>SecurityFilterChain0</code>åªæœ‰ä¸‰ä¸ª<code>security</code>è¿‡æ»¤å™¨å¯¹è±¡è¢«é…ç½®, ç„¶è€Œ<code>SecurityFilterChainn</code>æœ‰å››ä¸ª<code>security</code>è¿‡æ»¤å™¨è¢«é…ç½®.</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211713843.png" alt="image-20221121171324744"></p><p>é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œæ¯ä¸ª <code>SecurityFilterChain</code> éƒ½å¯ä»¥æ˜¯å”¯ä¸€çš„å¹¶ä¸”æ˜¯éš”ç¦»é…ç½®çš„ã€‚äº‹å®ä¸Šï¼Œå¦‚æœåº”ç”¨ç¨‹åºå¸Œæœ› <code>Spring Security</code> å¿½ç•¥æŸäº›è¯·æ±‚ï¼Œåˆ™ <code>SecurityFilterChain</code> å¯èƒ½å…·æœ‰é›¶ä¸ªå®‰å…¨è¿‡æ»¤å™¨</p><h2 id="SpringSecurityå¼‚å¸¸å¤„ç†"><a href="#SpringSecurityå¼‚å¸¸å¤„ç†" class="headerlink" title="SpringSecurityå¼‚å¸¸å¤„ç†"></a><code>SpringSecurity</code>å¼‚å¸¸å¤„ç†</h2><p><code>ExceptionTranslationFilter</code>å…è®¸å°†<code>AccessDeniedException</code>å’Œ<code>AuthenticationException</code>å†™å…¥åˆ°HTTP å“åº”</p><p><code>ExceptionTranslationFilter</code>è¢«æ’å…¥åˆ°<code>FilterChainProxy</code>ä½œä¸º<code>Security Filters</code>çš„ä¸€éƒ¨åˆ†</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211211746679.png" alt="image-20221121174603578"></p><ul><li><p>é¦–å…ˆ, <code>ExceptionTranslationFilter</code>è°ƒç”¨äº†<code>FilterChain.doFilter(request, response)</code>å»è°ƒç”¨åº”ç”¨çš„<code>restful</code></p></li><li><p>å¦‚æœæ²¡æœ‰è®¤è¯ç”¨æˆ·, æˆ–è€…å®ƒæŠ›å‡ºäº†<code>AuthenticationException</code>åˆ™å¼€å§‹è®¤è¯</p><ul><li>å¦‚æœ<code>SecurityContextHolder</code>è¢«æ¸…ç©º</li><li>åœ¨<code>RequestCache</code>ä¿å­˜äº†<code>HttpServletRequest</code>, å½“ç”¨æˆ·è®¤è¯æˆåŠŸ, <code>RequestCache</code>è¢«ç”¨äºå»å›å¤æºè¯·æ±‚</li><li><code>AuthenticationEntryPoint</code>è¢«ç”¨äºä»å®¢æˆ·ç«¯è¯·æ±‚å‡­æ®, ä¾‹å¦‚å®ƒå¯èƒ½é‡å®šå‘åˆ°ç™»å½•é¡µé¢, æˆ–è€…å‘é€<code>WWW-Authenticate header</code></li></ul></li><li><p>å¦å¤–, å¦‚æœå®ƒæœ‰<code>AccessDeniedException</code>, åˆ™è®¿é—®æ‹’ç». è°ƒç”¨<code>AccessDeniedHandler</code>å»å¤„ç†è®¿é—®æ‹’ç»</p></li></ul><blockquote><p>å¦‚æœåº”ç”¨ç¨‹åºæœªæŠ›å‡º<code>AccessDeniedException</code> æˆ–è€… <code>AuthenticationException</code>, åˆ™<code>ExceptionTranslationFilter</code>ä¸ä¼šåšä»»ä½•äº‹æƒ…</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¿‡æ»¤å™¨ </tag>
            
            <tag> è®¤è¯ </tag>
            
            <tag> ç™»å½• </tag>
            
            <tag> è§’è‰² </tag>
            
            <tag> SpringSecurity </tag>
            
            <tag> æºç åˆ†æ </tag>
            
            <tag> å›¾ç‰‡éªŒè¯ç  </tag>
            
            <tag> å¤šæ•°æ®æº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>14SpringSecurity-å›¾ç‰‡è®¤è¯</title>
      <link href="/2022/11/20/02springcloud/14SpringSecurity-%E5%9B%BE%E7%89%87%E8%AE%A4%E8%AF%81/"/>
      <url>/2022/11/20/02springcloud/14SpringSecurity-%E5%9B%BE%E7%89%87%E8%AE%A4%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æºç åœ°å€: <a href="https://gitee.com/bangiao_admin/springcloud_study_parent">springcloud_study_parent: å¾®æœåŠ¡å­¦ä¹  (gitee.com)</a></p><h1 id="SpringSecurityè®¤è¯è¿‡ç¨‹"><a href="#SpringSecurityè®¤è¯è¿‡ç¨‹" class="headerlink" title="SpringSecurityè®¤è¯è¿‡ç¨‹"></a>SpringSecurityè®¤è¯è¿‡ç¨‹</h1><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211191324979.png" alt="SpringSecurityè®¤è¯æµç¨‹"></p><h2 id="ProviderManager"><a href="#ProviderManager" class="headerlink" title="ProviderManager"></a>ProviderManager</h2><p><code>ProviderManager</code>æ˜¯ <code>AuthenticationManager</code> çš„ä¸€ä¸ªé‡è¦å®ç°ç±»ã€‚åœ¨å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡ä¸€å¹…å›¾æ¥äº†è§£ä¸€ä¸‹<code>ProviderManager</code>å’Œ <code>AuthenticationProvider</code>ä¹‹é—´çš„å…³ç³»ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211182146884.png" alt="image-20221118214618721"></p><p>åœ¨<code>Spring Security</code> ä¸­ï¼Œç”±äºç³»ç»Ÿå¯èƒ½åŒæ—¶æ”¯æŒå¤šç§ä¸åŒçš„è®¤è¯æ–¹å¼ï¼Œä¾‹å¦‚åŒæ—¶æ”¯æŒ<strong>ç”¨æˆ·å&#x2F;å¯†ç è®¤è¯</strong>ã€<strong>RememberMeè®¤è¯</strong>ã€<strong>æ‰‹æœºå·ç åŠ¨æ€è®¤è¯ç­‰</strong>ï¼Œè€Œä¸åŒçš„è®¤è¯æ–¹å¼å¯¹åº”äº†ä¸åŒçš„<code>AuthenticationProvider</code>ï¼Œæ‰€ä»¥ä¸€ä¸ªå®Œæ•´çš„è®¤è¯æµç¨‹å¯èƒ½ç”±å¤šä¸ª<code>AuthenticationProvider</code> æ¥æä¾›ã€‚</p><p>å¤šä¸ª<code>AuthenticationProvider</code>å°†ç»„æˆä¸€ä¸ªåˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨å°†ç”±<code>ProviderManager</code> ä»£ç†ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨ <code>ProviderManager</code>ä¸­å­˜åœ¨ä¸€ä¸ª<code>AuthenticationProvider</code>åˆ—è¡¨ï¼Œåœ¨<code>ProviderManager</code>ä¸­éå†åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ª<code>AuthenticationProvider</code>å»æ‰§è¡Œèº«ä»½è®¤è¯ï¼Œæœ€ç»ˆå¾—åˆ°è®¤è¯ç»“æœã€‚</p><p><code>ProviderManager</code>æœ¬èº«ä¹Ÿå¯ä»¥å†é…ç½®ä¸€ä¸ª<code>AuthenticationManager</code>ä½œä¸º <code>parent</code>ï¼Œè¿™æ ·å½“<code>ProviderManager</code> è®¤è¯å¤±è´¥ä¹‹åï¼Œå°±å¯ä»¥è¿›å…¥åˆ° <code>parent</code> ä¸­å†æ¬¡è¿›è¡Œè®¤è¯ã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œ<code>ProviderManager</code> çš„ <code>parent</code>å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„ <code>AuthenticationManager</code>ï¼Œä½†æ˜¯é€šå¸¸éƒ½æ˜¯ç”±<code>ProviderManager</code>æ¥æ‰®æ¼”<code>parent</code>çš„è§’è‰²ï¼Œä¹Ÿå°±æ˜¯<code>ProviderManager</code>æ˜¯<code>ProviderManager</code> çš„ <code>parent</code>ã€‚</p><p><code>ProviderManager</code>æœ¬èº«ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªï¼Œå¤šä¸ª<code>ProviderManager</code>å…±ç”¨åŒä¸€ä¸ª<code>parent</code>ï¼Œå½“å­˜åœ¨å¤šä¸ªè¿‡æ»¤å™¨é“¾çš„æ—¶å€™éå¸¸æœ‰ç”¨ã€‚å½“å­˜åœ¨å¤šä¸ªè¿‡æ»¤å™¨é“¾æ—¶ï¼Œä¸åŒçš„è·¯å¾„å¯èƒ½å¯¹åº”ä¸åŒçš„è®¤è¯æ–¹å¼ï¼Œä½†æ˜¯ä¸åŒè·¯å¾„å¯èƒ½åˆä¼šåŒæ—¶å­˜åœ¨ä¸€äº›å…±æœ‰çš„è®¤è¯æ–¹å¼,è¿™äº›å…±æœ‰çš„è®¤è¯æ–¹å¼å¯ä»¥åœ¨<code>parent</code>ä¸­ç»Ÿä¸€å¤„ç†ã€‚</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211182151449.png" alt="image-20221118215136380"></p><h2 id="AbstractAuthenticationProcessingFilter"><a href="#AbstractAuthenticationProcessingFilter" class="headerlink" title="AbstractAuthenticationProcessingFilter"></a>AbstractAuthenticationProcessingFilter</h2><p>ä½œä¸º<code>Spring Security</code>è¿‡æ»¤å™¨é“¾ä¸­çš„ä¸€ç¯ï¼Œ<code>AbstractAuthenticationProcessingFilter</code>å¯ä»¥ç”¨æ¥å¤„ç†ä»»ä½•æäº¤ç»™å®ƒçš„èº«ä»½è®¤è¯ï¼Œä¸‹å›¾æè¿°äº†<code>AbstractAuthenticationProcessingFilter</code> çš„å·¥ä½œæµç¨‹ã€‚</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211182159366.png" alt="image-20221118215904270"></p><p><code>AbstractAuthenticationProcessingFilter</code>ä½œä¸ºä¸€ä¸ªæŠ½è±¡ç±»,å¦‚æœä½¿ç”¨ç”¨æˆ·å&#x2F;å¯†ç çš„æ–¹å¼ç™»å½•ï¼Œé‚£ä¹ˆå®ƒå¯¹åº”çš„å®ç°ç±»æ˜¯<code>UsernamePasswordAuthenticationFilter</code>ï¼Œæ„é€ å‡ºæ¥çš„<code>Authentication</code>å¯¹è±¡</p><p>åˆ™æ˜¯<code>UseramePasswordAuthenticationToken</code>ã€‚è‡³äº<code>AuthenticationManager</code>ï¼Œå‰é¢å·²ç»è¯´è¿‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å®ƒçš„å®ç°ç±»å°±æ˜¯<code>ProviderManager</code>ï¼Œè¿™é‡Œåœ¨ <code>ProviderManager</code> ä¸­è¿›è¡Œè®¤è¯ï¼Œè®¤è¯æˆåŠŸå°±ä¼šè¿›å…¥è®¤è¯æˆåŠŸçš„å›è°ƒï¼Œå¦åˆ™è¿›å…¥è®¤è¯å¤±è´¥çš„å›è°ƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¸Šé¢çš„æµç¨‹å›¾å†åšè¿›ä¸€æ­¥ç»†åŒ–ï¼Œå¦‚å›¾ä¸‹æ‰€ç¤ºã€‚</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211182200692.png" alt="image-20221118220020604"></p><ul><li>å½“ç”¨æˆ·æäº¤ç™»å½•è¯·æ±‚æ—¶ï¼Œ<code>UsernamePasswordAuthenticationFilter</code>ä¼šä»å½“å‰è¯·æ±‚<code>HttpServletRequest</code>ä¸­æå–å‡ºç™»å½•ç”¨æˆ·å&#x2F;å¯†ç ï¼Œç„¶ååˆ›å»ºå‡ºä¸€ä¸ª<code>UsernamePasswordAuthenticationToken</code>å¯¹è±¡ã€‚</li><li><code>UsernamePasswordAuthenticationToken</code>å¯¹è±¡å°†è¢«ä¼ å…¥<code>ProviderManager</code>ä¸­è¿›è¡Œå…·ä½“çš„è®¤è¯æ“ä½œã€‚</li><li>å¦‚æœè®¤è¯å¤±è´¥ï¼Œåˆ™<code>SecurityContextHolder</code>ä¸­ç›¸å…³ä¿¡æ¯å°†è¢«æ¸…é™¤ï¼Œç™»å½•å¤±è´¥å›è°ƒä¹Ÿä¼šè¢«è°ƒç”¨ã€‚</li><li>å¦‚æœè®¤è¯æˆåŠŸï¼Œåˆ™ä¼šè¿›è¡Œç™»å½•ä¿¡æ¯å­˜å‚¨ã€<code>Session</code>å¹¶å‘å¤„ç†ã€ç™»å½•æˆåŠŸäº‹ä»¶å‘å¸ƒä»¥åŠç™»å½•æˆåŠŸæ–¹æ³•å›è°ƒç­‰æ“ä½œã€‚</li></ul><blockquote><p>è¿‡ç¨‹å¤§å¤šéƒ½åœ¨å›¾ç‰‡æµç¨‹ä¸­, æ‰€ä»¥å°±ä¸è¯¦ç»†åˆ†æäº†</p></blockquote><blockquote><p>è‡³æ­¤ç™»å½•æµç¨‹å¤§è‡´åˆ†æå®Œæ¯•</p></blockquote><h1 id="é…ç½®å¤šæ•°æ®æº"><a href="#é…ç½®å¤šæ•°æ®æº" class="headerlink" title="é…ç½®å¤šæ•°æ®æº"></a>é…ç½®å¤šæ•°æ®æº</h1><h2 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ?"></a>æ˜¯ä»€ä¹ˆ?</h2><p>ä¸€ä¸ªç³»ç»Ÿçš„æ•°æ®æ¥è‡ªå¤šä¸ªæ•°æ®æº</p><blockquote><p>é€šä¿—ç‚¹è®²å°±æ˜¯, æŸ¥æ‰¾ç”¨æˆ·æ•°æ®æ—¶, å¦‚æœä¸€ä¸ªåº“ä¸­çš„userè¡¨æ²¡æœ‰æ‰¾åˆ°, é‚£ä¹ˆå°±åˆ°å¦ä¸€ä¸ªåº“ä¸­æŸ¥æ‰¾userè¡¨</p></blockquote><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>å¤šæ•°æ®æºæ€è·¯å°±æ˜¯å¾€ä¸‹å›¾çš„é‚£ä¸ªé›†åˆé‡ŒæŒ¤æ›´å¤šçš„<code>AuthenticationProvider</code>å¯¹è±¡</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211182231660.png" alt="image-20221118223143588"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211182234540.png" alt="image-20221118223428453"></p><blockquote><p>æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>new ProviderManager</code>çš„æ–¹å¼å°†æˆ‘ä»¬çš„å¤šæ•°æ®æºå¯¹è±¡é€šè¿‡å¯å˜å‚æ•°æ„é€ å‡½æ•°ä¼ é€’è¿›å»</p></blockquote><p>è€Œæˆ‘ä»¬çš„<code>UserDetailsService</code>å˜é‡å­˜å‚¨åœ¨è¿™é‡Œ:</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211182243679.png" alt="image-20221118224348581"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211182244579.png" alt="image-20221118224405531"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211182244076.png" alt="image-20221118224435027"></p><blockquote><p>è¿™æ„å‘³ç€, æˆ‘ä»¬ä¼ é€’ç»™ <code>ProviderManager</code> æ„é€ å‡½æ•°çš„å‚æ•°å¯¹è±¡æ—¶ <code>DaoAuthenticationProvider</code> å¯¹è±¡, è¯¥å¯¹è±¡éœ€è¦è°ƒç”¨ <code>setUserDetailsService</code> æ–¹æ³•å°†æˆ‘ä»¬è‡ªå®šä¹‰å®ç°çš„å¤šæ•°æ®æº <code>UserDetailsService</code>ä¼ é€’è¿›å»</p></blockquote><p>å¤§æ¦‚ä»£ç :</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211190911588.png" alt="image-20221119091131149"></p><p>è¿™æ ·åœ¨æ‰§è¡Œçš„æ—¶å€™, <code>ProviderManager</code> åœ¨<code>getProviders()</code>çš„æ—¶å€™å°±ä¼šæ‹¿åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸¤ä¸ª<code>UserDetailsService</code>, éƒ½ä¼šå»è°ƒç”¨<code>loadUserByUsername</code>å‡½æ•°</p><p>è€Œmybatis å¤šæ•°æ®æºæ€è·¯ä¹Ÿéå¸¸ç®€å•</p><p>å€ŸåŠ© <code>MapperScan</code> æ³¨è§£çš„<code>sqlSessionFactoryRef</code>å±æ€§å°±å¯ä»¥äº†</p><p>æˆ‘ä»¬çŸ¥é“ <code>mybatis</code> çš„æºç å’Œ<code>hibernate</code>å¾ˆåƒ, éƒ½æ˜¯å€ŸåŠ© <code>sessionFactory</code> å®šä¹‰æ‹¿å– <code>session</code>, è€Œ<code>Mybatis</code>æ‹¿å– <code>session</code>çš„ç±»å°±å«åš <code>SqlSessionFactory</code>, è€Œè¿™ä¸ªç±»éœ€è¦é…ç½® <code>DataSource</code>, ä¸åŒçš„<code>DataSource</code>å°±æœ‰ä¸åŒçš„æ•°æ®æº</p><p>æ‰€ä»¥æ€è·¯å°±å¾ˆç®€å•äº†</p><ol><li>åœ¨ <code>application.properties</code> ä¸­é…ç½®ä¸¤ä¸ª <code>DataSource</code></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################## ä¸»æ•°æ®æº ##################################</span></span><br><span class="line"><span class="attr">spring.datasource.primary.jdbc-url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/demo1?characterEncoding=utf-8&amp;serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="attr">spring.datasource.primary.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.primary.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.primary.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">########################## ç¬¬äºŒä¸ªæ•°æ®æº ###############################</span></span><br><span class="line"><span class="attr">spring.datasource.datasource2.jdbc-url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/demo2?characterEncoding=utf-8&amp;serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="attr">spring.datasource.datasource2.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.datasource2.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.datasource2.password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure><ol start="2"><li>æ¥ç€<code>MapperScan</code>æ‰«æä¸¤ä¸ªåŒ…</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(basePackages = &#123;&quot;com.wdbyte.mapper.primary&quot;&#125;, sqlSessionFactoryRef = &quot;sqlSessionFactory&quot;)</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(basePackages = &#123;&quot;com.wdbyte.mapper.datasource2&quot;&#125;, sqlSessionFactoryRef = &quot;sqlSessionFactory2&quot;)</span></span><br></pre></td></tr></table></figure><ol start="3"><li>é…ç½®ä¸¤ä¸ª<code>sqlSessionFactory</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name = &quot;dataSource&quot;)</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource.primary&quot;)</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean(name = &quot;sqlSessionFactory&quot;)</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactory</span><span class="params">(<span class="meta">@Qualifier(&quot;dataSource&quot;)</span> DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">SqlSessionFactoryBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">    bean.setDataSource(dataSource);</span><br><span class="line">    bean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(<span class="string">&quot;classpath:mapper/*.xml&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> bean.getObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name = &quot;dataSource2&quot;)</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource.datasource2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean(name = &quot;sqlSessionFactory2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactory</span><span class="params">(<span class="meta">@Qualifier(&quot;dataSource2&quot;)</span> DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">SqlSessionFactoryBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">    bean.setDataSource(dataSource);</span><br><span class="line">    bean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(<span class="string">&quot;classpath:mapper/*.xml&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> bean.getObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·, æˆ‘ä»¬è°ƒç”¨ä¸åŒåŒ…çš„<code>Mapper</code>æ¥å£, å°±æ„å‘³ç€ä¸åŒçš„<code>sqlSessionFactory</code>å’Œæ•°æ®æº</p><h1 id="æ·»åŠ ç™»å½•éªŒè¯ç "><a href="#æ·»åŠ ç™»å½•éªŒè¯ç " class="headerlink" title="æ·»åŠ ç™»å½•éªŒè¯ç "></a>æ·»åŠ ç™»å½•éªŒè¯ç </h1><h2 id="æ·»åŠ å›¾ç‰‡éªŒè¯ç çš„ç›®çš„æ˜¯ä»€ä¹ˆ"><a href="#æ·»åŠ å›¾ç‰‡éªŒè¯ç çš„ç›®çš„æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ·»åŠ å›¾ç‰‡éªŒè¯ç çš„ç›®çš„æ˜¯ä»€ä¹ˆ?"></a>æ·»åŠ å›¾ç‰‡éªŒè¯ç çš„ç›®çš„æ˜¯ä»€ä¹ˆ?</h2><p><strong>1ã€ä¸ºäº†é˜²æ­¢æœºå™¨å†’å……äººç±»åšæš´åŠ›ç ´è§£ï¼š</strong>æš´åŠ›ç ´è§£æƒ³æƒ³å°±ææ€–ï¼Œè¿™å…³ç³»æ¯ä¸ªç”¨æˆ·çš„ç½‘ç»œå®‰å…¨ï¼Œç°åœ¨å¾ˆå¤šç½‘ç«™ã€APPéƒ½ç»‘å®šç”¨æˆ·çš„é“¶è¡Œè´¦æˆ·ï¼Œæœ‰å¾ˆå¤šå†…å®¹è¿˜æ¶‰åŠåˆ°ä¸ªäººéšç§ï¼Œå¦‚æœè¢«ä¸æ³•åˆ†å­æš´åŠ›ç ´è§£ï¼Œé‚£æŸå¤±å¯å°±å¤§äº†ã€‚</p><p><strong>2ã€é˜²æ­¢å¤§è§„æ¨¡åœ¨çº¿æ³¨å†Œæ»¥ç”¨æœåŠ¡ï¼š</strong>å¾ˆå¤šæœºå‹è‚¯å®šéƒ½å¾ˆè®¨åŒé‚£äº›æ¶æ„æ³¨å†ŒçŒæ°´çš„ï¼Œæ»¡æ»¡ä¸€å±å…¨æ˜¯æ¶æ„è¯„è®ºå’Œå¹¿å‘Šï¼Œç¬é—´æ²¡æœ‰å¥½å¿ƒæƒ…ï¼›</p><p><strong>3ã€é˜²æ­¢æ»¥ç”¨åœ¨çº¿æ‰¹é‡åŒ–æ“ä½œï¼š</strong>æ¯”å¦‚åœ¨æŠ•ç¥¨çš„æ—¶å€™ï¼Œæœ‰äº›æ¶æ„åˆ·ç¥¨è½¯ä»¶å°±å¯ä»¥å®ç°æ‰¹é‡åŒ–æŠ•ç¥¨åŠŸèƒ½ï¼Œæƒ³æƒ³è‡ªå·±è¾›è‹¦æ‹‰ç¥¨ï¼Œäººå®¶ä¸€é”®å°±æå®šï¼Ÿ</p><p><strong>4ã€é˜²æ­¢è‡ªåŠ¨å‘å¸ƒï¼š</strong>æ¯”å¦‚æ—©äº›å¹´é»‘å®¢ä»¬å†™ä¸€ä¸²ä»£ç å°±è‚†æ— å¿Œæƒ®åœ°æœç½‘ç»œä¸Šå€¾å€’å¤§é‡çš„ã€æ— æ„ä¹‰çš„åƒµå°¸ä¿¡æ¯ï¼Œåƒåœ¾é‚®ä»¶ã€åƒåœ¾å¹¿å‘Šã€åƒåœ¾è¯„è®ºåˆ°å¤„ä¹±é£ã€‚æ±¡æŸ“äº†ç½‘ç»œç¯å¢ƒçš„åŒæ—¶ï¼Œæ›´æœ‰ç”šè€…è¢«å¹¿å‘Šè¯ˆéª—ã€‚</p><p><strong>5ã€é˜²æ­¢ä¿¡æ¯è¢«å¤§é‡é‡‡é›†èšåˆï¼š</strong>äº’è”ç½‘æ—¶ä»£ï¼Œæœ€æœ‰ä»·å€¼çš„å°±æ˜¯å†…å®¹ç”Ÿäº§ï¼Œç²¾å¿ƒåˆ›ä½œçš„åŸåˆ›æ–‡ç« ï¼Œä¸€ç§’è¢«çˆ¬å–ï¼Ÿè‚é¢¤å•Šã€‚</p><h2 id="æœ‰ä»€ä¹ˆæ–¹æ¡ˆ"><a href="#æœ‰ä»€ä¹ˆæ–¹æ¡ˆ" class="headerlink" title="æœ‰ä»€ä¹ˆæ–¹æ¡ˆ?"></a>æœ‰ä»€ä¹ˆæ–¹æ¡ˆ?</h2><p>SpringSecurityä¸‹å­˜åœ¨ä¸¤ç§æ–¹æ¡ˆ:</p><ul><li>åŸºäºè¿‡æ»¤å™¨</li><li>åŸºäºè®¤è¯Provider</li></ul><h2 id="æ·»åŠ å›¾ç‰‡éªŒè¯ç æ€è·¯"><a href="#æ·»åŠ å›¾ç‰‡éªŒè¯ç æ€è·¯" class="headerlink" title="æ·»åŠ å›¾ç‰‡éªŒè¯ç æ€è·¯"></a>æ·»åŠ å›¾ç‰‡éªŒè¯ç æ€è·¯</h2><p>æ€è·¯å¤§ä½“ä¸Šå¾ˆç®€å•</p><ol><li>æˆ‘ä»¬éœ€è¦éšæœºç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²</li><li>å°†å­—ç¬¦ä¸²ä¿å­˜åœ¨æŸä¸ªä»‹è´¨(session)ç”¨äºåç»­å’Œå®¢æˆ·è¾“å…¥çš„éªŒè¯ç è¿›è¡ŒåŒ¹é…</li><li>éšæœºçš„å­—ç¬¦ä¸²è½¬åŒ–æˆç‰¹å®šçš„å›¾ç‰‡</li><li>SpringMVCå“åº”å›¾ç‰‡ç±»å‹ç»™å‰ç«¯</li></ol><p>ä½¿ç”¨googleçš„å›¾ç‰‡éªŒè¯ç ç”Ÿæˆå·¥å…·:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.penggle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®å›¾ç‰‡æ ¼å¼æ ·å¼:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KaptchaConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DefaultKaptcha <span class="title function_">captchaProducer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        properties.put(<span class="string">&quot;kaptcha.border&quot;</span>, <span class="string">&quot;no&quot;</span>);</span><br><span class="line">        properties.put(<span class="string">&quot;kaptcha.textproducer.char.length&quot;</span>,<span class="string">&quot;4&quot;</span>);</span><br><span class="line">        properties.put(<span class="string">&quot;kaptcha.image.height&quot;</span>,<span class="string">&quot;50&quot;</span>);</span><br><span class="line">        properties.put(<span class="string">&quot;kaptcha.image.width&quot;</span>,<span class="string">&quot;150&quot;</span>);</span><br><span class="line">        properties.put(<span class="string">&quot;kaptcha.obscurificator.impl&quot;</span>,<span class="string">&quot;com.google.code.kaptcha.impl.ShadowGimpy&quot;</span>);</span><br><span class="line">        properties.put(<span class="string">&quot;kaptcha.textproducer.font.color&quot;</span>,<span class="string">&quot;black&quot;</span>);</span><br><span class="line">        properties.put(<span class="string">&quot;kaptcha.textproducer.font.size&quot;</span>,<span class="string">&quot;40&quot;</span>);</span><br><span class="line">        properties.put(<span class="string">&quot;kaptcha.noise.impl&quot;</span>,<span class="string">&quot;com.google.code.kaptcha.impl.NoNoise&quot;</span>);</span><br><span class="line">        <span class="comment">//properties.put(&quot;kaptcha.noise.impl&quot;,&quot;com.google.code.kaptcha.impl.DefaultNoise&quot;);</span></span><br><span class="line">        properties.put(<span class="string">&quot;kaptcha.textproducer.char.string&quot;</span>,<span class="string">&quot;acdefhkmnprtwxy2345678&quot;</span>);</span><br><span class="line">        <span class="type">DefaultKaptcha</span> <span class="variable">kaptcha</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultKaptcha</span>();</span><br><span class="line">        kaptcha.setConfig(<span class="keyword">new</span> <span class="title class_">Config</span>(properties));</span><br><span class="line">        <span class="keyword">return</span> kaptcha;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›¾ç‰‡è·¯å¾„:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VerifyCodeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DefaultKaptcha producer;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/verify-code&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getVerifyCode</span><span class="params">(HttpServletResponse response, HttpSession session)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="comment">// å“åº”ç±»å‹</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">       <span class="comment">// ç”ŸæˆéªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> producer.createText();</span><br><span class="line">       <span class="comment">// å­˜å‚¨éªŒè¯ç </span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;verify_code&quot;</span>, text);</span><br><span class="line">       <span class="comment">// éªŒè¯ç ç”Ÿæˆä¸ºå›¾ç‰‡</span></span><br><span class="line">        <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> producer.createImage(text);</span><br><span class="line">       <span class="comment">// å“åº”ç»™å‰ç«¯</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> response.getOutputStream()) &#123;</span><br><span class="line">            ImageIO.write(image, <span class="string">&quot;jpeg&quot;</span>, outputStream);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰ç«¯å›¾ç‰‡å…ƒç´ :</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;code&quot;</span> <span class="attr">id</span>=<span class="string">&quot;code&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/verify-code&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;éªŒè¯ç &quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="åŸºäºè¿‡æ»¤å™¨"><a href="#åŸºäºè¿‡æ»¤å™¨" class="headerlink" title="åŸºäºè¿‡æ»¤å™¨"></a>åŸºäºè¿‡æ»¤å™¨</h2><h3 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>è¦å¦‚ä½•æ•´åˆåˆ° SpringSecurity ä¸Šé¢è¿›è¡ŒéªŒè¯å‘¢?</p><p>éå¸¸ç®€å•, æ ¹æ®ä¸Šé¢æˆ‘ä»¬åˆ†æçš„æµç¨‹å›¾</p><p>å¯ä»¥å‘ç°å¦‚å›¾æ‰€ç¤ºçš„æµç¨‹æ¯”è¾ƒåˆé€‚æ·»åŠ æˆ‘ä»¬çš„éªŒè¯é€»è¾‘</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211191309926.png" alt="image-20221119130907349"></p><p>æˆ‘ä»¬è¦ç»§æ‰¿è¿™ä¸ª<code>UsernamePasswordAuthenticationFilter</code>ç±», ç»™ç»§æ‰¿çš„ç±»å®ç°éªŒè¯å›¾ç‰‡éªŒè¯ç çš„åŠŸèƒ½, ç„¶åå†å»è°ƒç”¨çˆ¶ç±»çš„<code>UsernamePasswordAuthenticationFilter</code>å°±è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VerifyCodeFilter</span> <span class="keyword">extends</span> <span class="title class_">UsernamePasswordAuthenticationFilter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Authentication <span class="title function_">attemptAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="comment">// éœ€è¦æ˜¯ POST è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">if</span> (!request.getMethod().equals(<span class="string">&quot;POST&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthenticationServiceException</span>(</span><br><span class="line">                    <span class="string">&quot;Authentication method not supported: &quot;</span> + request.getMethod());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å¾—è¯·æ±‚éªŒè¯ç å€¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="comment">// è·å¾— session ä¸­çš„ éªŒè¯ç å€¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sessionVerifyCode</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;verify_code&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(code))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthenticationServiceException</span>(<span class="string">&quot;éªŒè¯ç ä¸èƒ½ä¸ºç©º!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(sessionVerifyCode))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthenticationServiceException</span>(<span class="string">&quot;è¯·é‡æ–°ç”³è¯·éªŒè¯ç !&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!sessionVerifyCode.equalsIgnoreCase(code)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthenticationServiceException</span>(<span class="string">&quot;éªŒè¯ç é”™è¯¯!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éªŒè¯ç éªŒè¯æˆåŠŸï¼Œæ¸…é™¤ session ä¸­çš„éªŒè¯ç </span></span><br><span class="line">        session.removeAttribute(<span class="string">&quot;verify_code&quot;</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯ç éªŒè¯æˆåŠŸï¼Œèµ°åŸæœ¬çˆ¶ç±»è®¤è¯é€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.attemptAuthentication(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§å®ç°<code>UsernamePasswordAuthenticationFilter</code>çš„æ–¹æ³•æ¯”è¾ƒéº»çƒ¦, éœ€è¦å¾ˆå¤šé¢å¤–æ­¥éª¤</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211191532273.png" alt="image-20221119153232201"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211191532058.png" alt="image-20221119153257976"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211191533090.png" alt="image-20221119153314033"></p><p>ç‰¹åˆ«éº»çƒ¦</p><p>ä½†æ˜¯<code>UsernamePasswordAuthenticationFilter</code>æ˜¯å”¯ä¸€é€‰æ‹©ä¹ˆ?</p><h4 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h4><p>å…¶å®ä¸æ˜¯, æˆ‘ä»¬<strong>åªè¦ä¿è¯æˆ‘ä»¬è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨åœ¨<code>UsernamePasswordAuthenticationFilter</code>è¿‡æ»¤å™¨ä¹‹å‰æ‰§è¡Œ</strong>å°±è¡Œäº†</p><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li>å¯¼å…¥ä¾èµ–</li><li>è‡ªå®šä¹‰è¿‡æ»¤å™¨</li><li>æŠŠè¿‡æ»¤å™¨åŠ å…¥åˆ°Springå®¹å™¨</li><li>æŠŠè¿‡æ»¤å™¨æ”¾åœ¨<code>UsernamePasswordAuthenticationFilter</code>ä¹‹å‰æ‰§è¡Œ</li></ol><h4 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--éªŒè¯ç ç”Ÿæˆå™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.penggle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>è®°å¾—è¿™é‡Œéœ€è¦å¯¼å…¥<code>thymeleaf</code>, å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨JSONä½œä¸ºControllerå“åº”ç»“æœçš„è¯</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">mybatis-spring-security</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/spring_security?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">user</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="attr">thymeleaf:</span></span><br><span class="line">    <span class="attr">cache:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">html</span></span><br><span class="line">    <span class="attr">prefix:</span> <span class="string">classpath:/templates/</span></span><br><span class="line">    <span class="attr">suffix:</span> <span class="string">.html</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰è¿‡æ»¤å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ OncePerRequestFilter çš„æ–¹å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidateCodeFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// æ³¨æ„è¿™é‡Œæœ‰å®šæ­»çš„ä»£ç , ä¸åˆç†, ç”Ÿäº§ç¯å¢ƒéœ€è¦ä¼˜åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.startsWithIgnoreCase(<span class="string">&quot;/login&quot;</span>, request.getRequestURI()) &amp;&amp; StringUtils.startsWithIgnoreCase(request.getMethod(), <span class="string">&quot;post&quot;</span>)) &#123;</span><br><span class="line">            validateCode(request);</span><br><span class="line">        &#125;</span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">validateCode</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="comment">// è·å–ä¿å­˜åœ¨sessionä¸­çš„code</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">verifyCode</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;verify_code&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(verifyCode)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidateCodeException</span>(<span class="string">&quot;è¯·é‡æ–°ç”³è¯·éªŒè¯ç !&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ‹¿åˆ°å‰ç«¯çš„ code</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(code)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidateCodeException</span>(<span class="string">&quot;éªŒè¯ç ä¸èƒ½ä¸ºç©º!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¯¹æ¯”</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.equalsIgnoreCase(code, verifyCode)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthenticationServiceException</span>(<span class="string">&quot;éªŒè¯ç é”™è¯¯!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ é™¤æ‰ session ä¸­çš„ verify_code</span></span><br><span class="line">        session.removeAttribute(<span class="string">&quot;verify_code&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æŠŠè¿‡æ»¤å™¨åŠ å…¥åˆ°Springå®¹å™¨"><a href="#æŠŠè¿‡æ»¤å™¨åŠ å…¥åˆ°Springå®¹å™¨" class="headerlink" title="æŠŠè¿‡æ»¤å™¨åŠ å…¥åˆ°Springå®¹å™¨"></a>æŠŠè¿‡æ»¤å™¨åŠ å…¥åˆ°Springå®¹å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ValidateCodeFilter <span class="title function_">validateCodeFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ValidateCodeFilter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æŠŠè¿‡æ»¤å™¨æ”¾åœ¨UsernamePasswordAuthenticationFilterä¹‹å‰æ‰§è¡Œ"><a href="#æŠŠè¿‡æ»¤å™¨æ”¾åœ¨UsernamePasswordAuthenticationFilterä¹‹å‰æ‰§è¡Œ" class="headerlink" title="æŠŠè¿‡æ»¤å™¨æ”¾åœ¨UsernamePasswordAuthenticationFilterä¹‹å‰æ‰§è¡Œ"></a>æŠŠè¿‡æ»¤å™¨æ”¾åœ¨<code>UsernamePasswordAuthenticationFilter</code>ä¹‹å‰æ‰§è¡Œ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> httpSecurity</span><br><span class="line">            .addFilterBefore(validateCodeFilter(), UsernamePasswordAuthenticationFilter.class)</span><br><span class="line">            .authorizeHttpRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/verify-code&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/css/**&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/images/**&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/js/**&quot;</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line">            .anyRequest()</span><br><span class="line">            .authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .formLogin()</span><br><span class="line">            .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">            .defaultSuccessUrl(<span class="string">&quot;/index&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            .csrf()</span><br><span class="line">            .disable()</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ ¸å¿ƒä»£ç : <code>httpSecurity.addFilterBefore</code></p></blockquote><h2 id="åŸºäºè®¤è¯å™¨"><a href="#åŸºäºè®¤è¯å™¨" class="headerlink" title="åŸºäºè®¤è¯å™¨"></a>åŸºäºè®¤è¯å™¨</h2><h3 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><ol><li>æŸ¥æ‰¾ç›®æ ‡ç±»</li><li>ç»§æ‰¿ç›®æ ‡ç±»é‡å†™è°ƒç”¨æ•°æ®åº“ä¹‹å‰çš„æ–¹æ³•</li><li>å°†è‡ªå®šä¹‰çš„ç±»åŠ å…¥åˆ° SpringSecurity è°ƒç”¨æµç¨‹</li></ol><p>è¿˜æ˜¯å›åˆ°å¼€å¤´çš„é‚£å¼ å›¾ç‰‡</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211201249447.png" alt="image-20221120124955970"></p><p>æ ¸å¿ƒéªŒè¯ä»£ç çš„è¿‡ç¨‹åœ¨è¿™é‡Œ</p><p>ä¹Ÿå°±æ˜¯</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211201250658.png" alt="image-20221120125023550"></p><p>è¿™ä¸ªæŠ½è±¡ç±»çš„ä¸€ä¸ªæ–¹æ³•, ä½†å®é™…ä¸Šæ˜¯æ—è¾¹ç»§æ‰¿äº†è¯¥æŠ½è±¡æ–¹æ³•çš„ç±»åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­è°ƒç”¨äº†<code>additionalAuthenticationChecks</code>å‡½æ•°</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211201253387.png" alt="image-20221120125300264"></p><blockquote><p>ä¸ºä»€ä¹ˆè¦æ‰¾<code>retrieveUser</code>å‡½æ•°ä¹‹å‰çš„å‡½æ•°å‘¢? å› ä¸º<code>retrieveUser</code>è¿™ä¸ªå‡½æ•°æŸ¥è¯¢äº†æ•°æ®åº“, æ•°æ®åº“çš„èµ„æºæ˜¯æœ‰é™çš„, éªŒè¯ç çš„ä¸€ä¸ªä½œç”¨æ˜¯é˜²æ­¢æœºå™¨, å¤–æŒ‚ç­‰ç›´æ¥è®¿é—®æˆ‘ä»¬çš„æ•°æ®åº“</p></blockquote><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211201254955.png" alt="image-20221120125400797"></p><p>æœ€ç»ˆæˆ‘ä»¬æ‰¾åˆ°äº†ä¸Šé¢çš„æ–¹æ³•</p><h3 id="æ­¥éª¤-1"><a href="#æ­¥éª¤-1" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li>é‡å†™ç›®æ ‡ç±»å’Œæ–¹æ³•</li><li>æ·»åŠ åˆ°Spring Securityè°ƒç”¨æµç¨‹ä¸­</li></ol><h4 id="é‡å†™ç›®æ ‡ç±»å’Œæ–¹æ³•"><a href="#é‡å†™ç›®æ ‡ç±»å’Œæ–¹æ³•" class="headerlink" title="é‡å†™ç›®æ ‡ç±»å’Œæ–¹æ³•"></a>é‡å†™ç›®æ ‡ç±»å’Œæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VerifyCodeAuthenticationProvider</span> <span class="keyword">extends</span> <span class="title class_">DaoAuthenticationProvider</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Authentication <span class="title function_">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line"><span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> ((ServletRequestAttributes) Objects.requireNonNull(RequestContextHolder.getRequestAttributes())).getRequest();</span><br><span class="line"><span class="comment">// è·å¾—è¯·æ±‚éªŒè¯ç å€¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (StringUtils.isBlank(code)) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidateCodeException</span>(<span class="string">&quot;éªŒè¯ç ä¸èƒ½ä¸ºç©º!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è·å¾— session ä¸­çš„ éªŒè¯ç å€¼</span></span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line"><span class="type">String</span> <span class="variable">verifyCode</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;verify_code&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(StringUtils.isBlank(verifyCode))&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidateCodeException</span>(<span class="string">&quot;è¯·é‡æ–°ç”³è¯·éªŒè¯ç !&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (StringUtils.equalsIgnoreCase(code, verifyCode)) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidateCodeException</span>(<span class="string">&quot;éªŒè¯ç é”™è¯¯!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éªŒè¯ç éªŒè¯æˆåŠŸï¼Œæ¸…é™¤ session ä¸­çš„éªŒè¯ç </span></span><br><span class="line">session.removeAttribute(<span class="string">&quot;verify_code&quot;</span>);</span><br><span class="line"><span class="comment">// éªŒè¯ç éªŒè¯æˆåŠŸï¼Œèµ°åŸæœ¬çˆ¶ç±»è®¤è¯é€»è¾‘</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">super</span>.authenticate(authentication);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ åˆ°Spring-Securityè°ƒç”¨æµç¨‹ä¸­"><a href="#æ·»åŠ åˆ°Spring-Securityè°ƒç”¨æµç¨‹ä¸­" class="headerlink" title="æ·»åŠ åˆ°Spring Securityè°ƒç”¨æµç¨‹ä¸­"></a>æ·»åŠ åˆ°Spring Securityè°ƒç”¨æµç¨‹ä¸­</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="comment">// ç”±äºæˆ‘æ•°æ®åº“ä¸­æœ‰å¾ˆå¤šç§åŠ å¯†ç®—æ³•, æ‰€ä»¥ä½¿ç”¨äº†PasswordEncoderFactories</span></span><br><span class="line">      <span class="comment">// æ­£å¸¸æƒ…å†µåªéœ€è¦ return new BCryptPasswordEncoder() å¯†ç éªŒè¯å™¨</span></span><br><span class="line">      <span class="keyword">return</span> PasswordEncoderFactories.createDelegatingPasswordEncoder();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">protected</span> UserDetailsService <span class="title function_">userDetailsService</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="comment">// è¿™é‡Œä»æ•°æ®åº“ä¸­è·å– user è´¦æˆ·å’Œå¯†ç ç­‰</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MybatisUserDetailsService</span>();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   AuthenticationProvider <span class="title function_">verifyCodeAuthenticationProvider</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">VerifyCodeAuthenticationProvider</span> <span class="variable">provider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VerifyCodeAuthenticationProvider</span>();</span><br><span class="line">      <span class="comment">// provider éœ€è¦å¯†ç éªŒè¯</span></span><br><span class="line">      provider.setPasswordEncoder(passwordEncoder());</span><br><span class="line">      <span class="comment">// provider éœ€è¦ä»æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯çš„ç±»</span></span><br><span class="line">      provider.setUserDetailsService(userDetailsService());</span><br><span class="line">      <span class="keyword">return</span> provider;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> AuthenticationManager <span class="title function_">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      <span class="comment">// å°† provider æ·»åŠ åˆ° Manager</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ProviderManager</span>(verifyCodeAuthenticationProvider());</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      <span class="keyword">return</span> httpSecurity</span><br><span class="line">            .authorizeHttpRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/verify-code&quot;</span>, <span class="string">&quot;/css/**&quot;</span>, <span class="string">&quot;/images/**&quot;</span>, <span class="string">&quot;/js/**&quot;</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line">            .anyRequest()</span><br><span class="line">            .authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .formLogin()</span><br><span class="line">            .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">            .defaultSuccessUrl(<span class="string">&quot;/index&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            .csrf()</span><br><span class="line">            .disable()</span><br><span class="line">            .build();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ å›¾ç‰‡éªŒè¯ç ç« èŠ‚å‚è€ƒè‡ª: <a href="https://juejin.cn/post/7165499171556818981">https://juejin.cn/post/7165499171556818981</a></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211201551358.png" alt="image-20221120155137244"></p><p>æºç çœ‹è¿™ä¸¤ä¸ªéƒ¨åˆ†: <img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211201552248.png" alt="image-20221120155259071"></p></blockquote><p>è‡³æ­¤è®¤è¯æµç¨‹çš„åˆ†æå’Œç›¸å…³åŠŸèƒ½åŸºæœ¬å®Œæˆ</p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mybatis </tag>
            
            <tag> è¿‡æ»¤å™¨ </tag>
            
            <tag> JPA </tag>
            
            <tag> è®¤è¯ </tag>
            
            <tag> ç™»å½• </tag>
            
            <tag> è§’è‰² </tag>
            
            <tag> SpringSecurity </tag>
            
            <tag> æºç åˆ†æ </tag>
            
            <tag> å›¾ç‰‡éªŒè¯ç  </tag>
            
            <tag> å¤šæ•°æ®æº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>13SpringSecurity-å°†å¯†ç ä¿å­˜æ•°æ®åº“</title>
      <link href="/2022/11/18/02springcloud/13SpringSecurity-%E5%B0%86%E5%AF%86%E7%A0%81%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
      <url>/2022/11/18/02springcloud/13SpringSecurity-%E5%B0%86%E5%AF%86%E7%A0%81%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringSecurityè®¤è¯"><a href="#SpringSecurityè®¤è¯" class="headerlink" title="SpringSecurityè®¤è¯"></a>SpringSecurityè®¤è¯</h1><h2 id="ç”¨æˆ·æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“"><a href="#ç”¨æˆ·æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“" class="headerlink" title="ç”¨æˆ·æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“"></a>ç”¨æˆ·æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“</h2><p>åœ¨å®é™…å¼€å‘ä¸­, æˆ‘ä»¬å¯¹ç”¨æˆ·çš„crudå¿…é¡»è·Ÿæ•°æ®åº“æŒ‚é’©, è€Œä¸æ˜¯å†…å­˜, æœ¬ç« å°†ç½—åˆ—æ€ä¹ˆåšçš„è¿‡ç¨‹</p><h3 id="åŸºäºå†…å­˜"><a href="#åŸºäºå†…å­˜" class="headerlink" title="åŸºäºå†…å­˜"></a>åŸºäºå†…å­˜</h3><p>å‰é¢æ¡ˆä¾‹ä¸­ç”¨æˆ·çš„å®šä¹‰æœ¬è´¨ä¸Šè¿˜æ˜¯åŸºäºå†…å­˜ï¼Œåªæ˜¯æˆ‘ä»¬æ²¡æœ‰å°†<code>InMemoryUserDetailsManager</code>ç±»æ˜ç¡®æŠ½å‡ºæ¥è‡ªå®šä¹‰ï¼Œç°åœ¨æˆ‘ä»¬é€šè¿‡è‡ªå®šä¹‰<code>InMemoryUserDetailsManager</code>æ¥çœ‹ä¸€ä¸‹åŸºäºå†…å­˜çš„ç”¨æˆ·æ˜¯å¦‚ä½•è‡ªå®šä¹‰çš„ã€‚<br>é‡å†™<code>WebSecurityConfigurerAdapter</code>ç±»çš„<code>configure(AuthenticationManagerBuilder)</code>æ–¹æ³•ï¼Œå†…å®¹å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="type">InMemoryUserDetailsManager</span> <span class="variable">detailsManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserDetailsManager</span>();</span><br><span class="line">detailsManager.createUser(User.withUsername(<span class="string">&quot;zhazha&quot;</span>)</span><br><span class="line">.password(<span class="string">&quot;&#123;noop&#125;123456&quot;</span>)</span><br><span class="line">.roles(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">.build());</span><br><span class="line">detailsManager.createUser(User.withUsername(<span class="string">&quot;zhangsan&quot;</span>)</span><br><span class="line">.password(<span class="string">&quot;&#123;noop&#125;666666&quot;</span>)</span><br><span class="line">.roles(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">.build());</span><br><span class="line">auth.userDetailsService(detailsManager);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯<code>WebSecurityConfigurerAdapter</code>æ—©å°±ä¸æ¨èä½¿ç”¨äº†</p><p>ç°åœ¨éƒ½æ˜¯è¿™ä¹ˆç”¨:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> UserDetailsService <span class="title function_">inMemoryUserDetailsManager</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">InMemoryUserDetailsManager</span> <span class="variable">userDetailsManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserDetailsManager</span>();</span><br><span class="line">    userDetailsManager.createUser(User.withUsername(<span class="string">&quot;zhazha&quot;</span>)</span><br><span class="line">                                  .password(<span class="string">&quot;&#123;noop&#125;123456&quot;</span>)</span><br><span class="line">                                  .roles(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                                  .build());</span><br><span class="line">    userDetailsManager.createUser(User.withUsername(<span class="string">&quot;zhangsan&quot;</span>)</span><br><span class="line">                                  .password(<span class="string">&quot;&#123;noop&#125;666666&quot;</span>)</span><br><span class="line">                                  .roles(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">                                  .build());</span><br><span class="line">    <span class="keyword">return</span> userDetailsManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨æˆ·è´¦æˆ·éƒ½è¢« put åˆ°è¿™ä¸ªå¯¹è±¡ä¸­(ä¹Ÿå°±æ˜¯å†…å­˜ä¸­)</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151112897.png" alt="image-20221115111214823"></p><p>è¿™äº›ä»£ç éƒ½ç›¸å½“çš„ç®€å•, å°±ä¸æ·±å…¥ç ”ç©¶äº†</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151113967.png" alt="image-20221115111310877"></p><p>éœ€è¦ä»”ç»†ç ”ç©¶çš„æ˜¯è¿™ä¸ª:</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151214564.png" alt="image-20221115121426489"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151216526.png" alt="image-20221115121605411"></p><p>åªè¦Springå®¹å™¨ä¸­ä¸å­˜åœ¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AuthenticationManager.class, AuthenticationProvider.class, UserDetailsService.class, AuthenticationManagerResolver.class</span><br></pre></td></tr></table></figure><p>è¿™å‡ ä¸ªç±»çš„Bean, é‚£ä¹ˆè¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»å°±å¼€å¯, ä¸‹é¢çš„<code>InMemoryUserDetailsManager</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Lazy</span></span><br><span class="line"><span class="keyword">public</span> InMemoryUserDetailsManager <span class="title function_">inMemoryUserDetailsManager</span><span class="params">(SecurityProperties properties, ObjectProvider&lt;PasswordEncoder&gt; passwordEncoder)</span> &#123;</span><br><span class="line">   SecurityProperties.<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> properties.getUser();</span><br><span class="line">   List&lt;String&gt; roles = user.getRoles();</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserDetailsManager</span>(</span><br><span class="line">         User.withUsername(user.getName()).password(getOrDeducePassword(user, passwordEncoder.getIfAvailable())).roles(StringUtils.toStringArray(roles)).build());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±ä¼šç”Ÿæ•ˆ, å¦åˆ™ä¸ç”Ÿæ•ˆ</p><blockquote><p>æ„å‘³ç€æˆ‘ä»¬è‡ªå·±å®ç°ä¸€ä¸ªSpring Bean ä¸º <code>AuthenticationManager.class, AuthenticationProvider.class, UserDetailsService.class, AuthenticationManagerResolver.class</code>è¿™äº›å¯¹è±¡çš„æ—¶å€™, å°±éœ€è¦ç»™ä»–ä¸€ç§<code>User</code>æ•°æ®å­˜å‚¨çš„å¯¹è±¡</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151221020.png" alt="image-20221115122146949"></p><p>è‡ªå®šä¹‰å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">   </span><br><span class="line">   UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†…éƒ¨ä½¿ç”¨<code>mybatis/JPA</code>æ ¹æ®<code>username</code>ç”¨æˆ·, å¹¶å°†å…¶åŠ å…¥åˆ°<code>Spring</code>å®¹å™¨å†…, <code>SpringSecurity</code>å°±ä¼šä½¿ç”¨æˆ‘ä»¬çš„<code>UserDetailsService</code></p></blockquote><h3 id="åŸºäºJDBCUserDetailsManager"><a href="#åŸºäºJDBCUserDetailsManager" class="headerlink" title="åŸºäºJDBCUserDetailsManager"></a>åŸºäºJDBCUserDetailsManager</h3><p><code>JdbcUserDetailsManager</code>æ”¯æŒå°†ç”¨æˆ·æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼ŒåŒæ—¶å®ƒå°è£…äº†ä¸€ç³»åˆ—æ“ä½œç”¨æˆ·çš„æ–¹æ³•ï¼Œä¾‹å¦‚ç”¨æˆ·çš„æ·»åŠ ã€æ›´æ–°ã€æŸ¥æ‰¾ç­‰ã€‚</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151114602.png" alt="image-20221115111448510"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151115284.png" alt="image-20221115111521209"></p><p>è€Œè¡¨ç»“æ„åœ¨è¿™é‡Œ<img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151123500.png" alt="image-20221115112325406"></p><p>å¦ä¸€æ–¹é¢ï¼Œç”±äºè¦å°†æ•°æ®å­˜å…¥æ•°æ®åº“ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„é¡¹ç›®ä¹Ÿè¦æä¾›æ•°æ®åº“æ”¯æŒï¼Œ<code>JdbcUserDetailsManager</code>åº•å±‚å®é™…ä¸Šæ˜¯ä½¿ç”¨<code>JdbcTemplate</code> æ¥å®Œæˆçš„</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151125870.png" alt="image-20221115112551796"></p><p>éœ€è¦å¼•å…¥è¿™ä¸¤ä¸ªä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-jdbc&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>åœ¨application.ymlä¸­å¡«å…¥:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">datasource:</span></span><br><span class="line">  <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/spring_security?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œåˆšåˆšçš„<code>user.ddl</code> sqlè¯­å¥, åˆ›å»ºè¡¨ç»“æ„</p><p>è¿™ç§æ–¹å¼è™½ç„¶å¯ä»¥å¯¹æ•°æ®åº“è¿›è¡Œcurd, ä½†æ˜¯ä¸å¤ªçµæ´»</p><h3 id="åŸºäºmybatis"><a href="#åŸºäºmybatis" class="headerlink" title="åŸºäºmybatis"></a>åŸºäºmybatis</h3><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211172104935.png" alt="image-20221117210444814"></p><p>ä»£ç å¯ä»¥åœ¨è¿™é‡ŒæŠ„:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NOOP_PASSWORD_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;&#123;noop&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">PASSWORD_ALGORITHM_PATTERN</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;^\\&#123;.+&#125;.*$&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">logger</span> <span class="operator">=</span> LogFactory.getLog(UserDetailsServiceAutoConfiguration.class);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Lazy</span></span><br><span class="line"><span class="keyword">public</span> InMemoryUserDetailsManager <span class="title function_">inMemoryUserDetailsManager</span><span class="params">(SecurityProperties properties,</span></span><br><span class="line"><span class="params">ObjectProvider&lt;PasswordEncoder&gt; passwordEncoder)</span> &#123;</span><br><span class="line">SecurityProperties.<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> properties.getUser();</span><br><span class="line">List&lt;String&gt; roles = user.getRoles();</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserDetailsManager</span>(</span><br><span class="line">User.withUsername(user.getName()).password(getOrDeducePassword(user, passwordEncoder.getIfAvailable()))</span><br><span class="line">.roles(StringUtils.toStringArray(roles)).build());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">mybatis-spring-security</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/spring_security?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.zhazha.springcloud.entity</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:/mapper/**/*.xml</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Roles</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String role;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysUserRole</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long roleId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Users</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>, UserDetails &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean enabled;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean accountnonexpired;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean accountnonlocked;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean credentialsnonexpired;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Roles&gt; rolesList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">        ArrayList&lt;SimpleGrantedAuthority&gt; authorities = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Roles roles : getRolesList()) &#123;</span><br><span class="line">            authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(roles.getRole()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> authorities;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountnonexpired;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountnonlocked;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> credentialsnonexpired;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> enabled;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SysUserRoleMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * insert record to table</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record the record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> insert count</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(SysUserRole record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * insert record to table selective</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record the record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> insert count</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertSelective</span><span class="params">(SysUserRole record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insertBatch</span><span class="params">(<span class="meta">@Param(&quot;sysUserRoleList&quot;)</span> List&lt;SysUserRole&gt; sysUserRoleList)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UsersMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * delete by primary key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id primaryKey</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> deleteCount</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteByPrimaryKey</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * insert record to table</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record the record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> insert count</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(Users record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * insert record to table selective</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record the record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> insert count</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertSelective</span><span class="params">(Users record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * select by primary key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id primary key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> object by primary key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Users <span class="title function_">selectByPrimaryKey</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * update record selective</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record the updated record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> update count</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateByPrimaryKeySelective</span><span class="params">(Users record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * update record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record the updated record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> update count</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateByPrimaryKey</span><span class="params">(Users record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from users&quot;)</span></span><br><span class="line">    List&lt;Users&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select *, r.id rid from spring_security.users u &quot; +</span></span><br><span class="line"><span class="meta">            &quot;join sys_user_role sur on u.id = sur.user_id &quot; +</span></span><br><span class="line"><span class="meta">            &quot;join roles r on r.id = sur.role_id &quot; +</span></span><br><span class="line"><span class="meta">            &quot;where u.username = #&#123;username&#125; and u.enabled = true &quot;)</span></span><br><span class="line">    <span class="meta">@ResultMap(&quot;UserJoinRole&quot;)</span></span><br><span class="line">    Users <span class="title function_">loadUserByUsername</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RolesMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * delete by primary key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id primaryKey</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> deleteCount</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteByPrimaryKey</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * insert record to table</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record the record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> insert count</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(Roles record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * insert record to table selective</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record the record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> insert count</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertSelective</span><span class="params">(Roles record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * select by primary key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id primary key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> object by primary key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Roles <span class="title function_">selectByPrimaryKey</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * update record selective</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record the updated record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> update count</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateByPrimaryKeySelective</span><span class="params">(Roles record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * update record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record the updated record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> update count</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateByPrimaryKey</span><span class="params">(Roles record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from roles&quot;)</span></span><br><span class="line">    List&lt;Roles&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>UserMapper.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.zhazha.springcloud.entity.Users&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--@mbg.generated--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--@Table users--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;enabled&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIT&quot;</span> <span class="attr">property</span>=<span class="string">&quot;enabled&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;accountNonExpired&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIT&quot;</span> <span class="attr">property</span>=<span class="string">&quot;accountnonexpired&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;accountNonLocked&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIT&quot;</span> <span class="attr">property</span>=<span class="string">&quot;accountnonlocked&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;credentialsNonExpired&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIT&quot;</span> <span class="attr">property</span>=<span class="string">&quot;credentialsnonexpired&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;UserJoinRole&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Users&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;rolesList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.zhazha.springcloud.entity.Roles&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;rid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä»–Mapper xml å°±ä¸è´´äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisUserDetailsService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UsersMapper usersMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        <span class="type">Users</span> <span class="variable">users</span> <span class="operator">=</span> usersMapper.loadUserByUsername(username);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == users) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(username);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> UserDetailsService <span class="title function_">userDetailsService</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MybatisUserDetailsService</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> PasswordEncoderFactories.createDelegatingPasswordEncoder();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="keyword">return</span> httpSecurity.authorizeHttpRequests()</span><br><span class="line">.anyRequest().authenticated()</span><br><span class="line">.and()</span><br><span class="line">.formLogin()</span><br><span class="line">.defaultSuccessUrl(<span class="string">&quot;/hello&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">.permitAll()</span><br><span class="line">.and()</span><br><span class="line">.logout()</span><br><span class="line">.logoutUrl(<span class="string">&quot;/logout&quot;</span>)</span><br><span class="line">.logoutSuccessUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">.clearAuthentication(<span class="literal">true</span>)</span><br><span class="line">.invalidateHttpSession(<span class="literal">true</span>)</span><br><span class="line">.and()</span><br><span class="line">.build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> HashMap&lt;String, Object&gt; <span class="title function_">hello</span><span class="params">(Authentication authentication)</span> &#123;</span><br><span class="line">HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="type">Object</span> <span class="variable">credentials</span> <span class="operator">=</span> authentication.getCredentials();</span><br><span class="line">Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; authorities = authentication.getAuthorities();</span><br><span class="line"><span class="type">Object</span> <span class="variable">details</span> <span class="operator">=</span> authentication.getDetails();</span><br><span class="line"><span class="type">Object</span> <span class="variable">principal</span> <span class="operator">=</span> authentication.getPrincipal();</span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> authentication.getName();</span><br><span class="line">map.put(<span class="string">&quot;credentials&quot;</span>, credentials);</span><br><span class="line">map.put(<span class="string">&quot;authorities&quot;</span>, authorities);</span><br><span class="line">map.put(<span class="string">&quot;details&quot;</span>, details);</span><br><span class="line">map.put(<span class="string">&quot;principal&quot;</span>, principal);</span><br><span class="line">map.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line"><span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211171135949.png" alt="image-20221117113023354"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211171135684.png" alt="image-20221117113545608"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(value = &quot;com.zhazha.springcloud.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisSpringSecurityApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(MybatisSpringSecurityApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸºäºJPA"><a href="#åŸºäºJPA" class="headerlink" title="åŸºäºJPA"></a>åŸºäºJPA</h3><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211172104307.png"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.querydsl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>querydsl-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.querydsl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>querydsl-apt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysema.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>apt-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>process<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>target/generated-sources/java<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">processor</span>&gt;</span>com.querydsl.apt.jpa.JPAAnnotationProcessor<span class="tag">&lt;/<span class="name">processor</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">jpa-spring-security</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/spring_security?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">database-platform:</span> <span class="string">org.hibernate.dialect.MySQL8Dialect</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">none</span></span><br><span class="line">      <span class="attr">naming:</span></span><br><span class="line">        <span class="attr">physical-strategy:</span> <span class="string">org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl</span></span><br><span class="line">        <span class="attr">implicit-strategy:</span> <span class="string">org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">hibernate:</span></span><br><span class="line">        <span class="attr">format_sql:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">show_sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">open-in-view:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ObjectMapper <span class="title function_">objectMapper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        objectMapper.registerModule(<span class="keyword">new</span> <span class="title class_">Hibernate5Module</span>());</span><br><span class="line">        <span class="keyword">return</span> objectMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityUserDetails <span class="title function_">securityUserDetails</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SecurityUserDetails</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> httpSecurity</span><br><span class="line">                .authorizeHttpRequests()</span><br><span class="line">                .anyRequest()</span><br><span class="line">                .authenticated()</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin()</span><br><span class="line">                .defaultSuccessUrl(<span class="string">&quot;/index&quot;</span>)</span><br><span class="line">                .permitAll()</span><br><span class="line">                .and()</span><br><span class="line">                .logout()</span><br><span class="line">                .logoutSuccessUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">                .clearAuthentication(<span class="literal">true</span>)</span><br><span class="line">                .invalidateHttpSession(<span class="literal">true</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;roles&quot;, schema = &quot;spring_security&quot;, indexes = &#123;</span></span><br><span class="line"><span class="meta">        @Index(name = &quot;unique_role&quot;, columnList = &quot;role&quot;, unique = true)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Role</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;role&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String role;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ToString</span>.Exclude</span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;role&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;SysUserRole&gt; sysUserRoles = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;, schema = &quot;spring_security&quot;)</span></span><br><span class="line"><span class="meta">@JsonIdentityInfo(generator = ObjectIdGenerators.PropertyGenerator.class, property = &quot;id&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">UserDetails</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(generator = &quot;id&quot;)</span></span><br><span class="line">    <span class="meta">@GenericGenerator(name = &quot;id&quot;, strategy = &quot;com.zhazha.springcloud.utils.SnowIdGenerator&quot;)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;username&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;password&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;enabled&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean enabled;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;accountNonExpired&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean accountNonExpired;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;accountNonLocked&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean accountNonLocked;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;credentialsNonExpired&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean credentialsNonExpired;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ToString</span>.Exclude</span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;user&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;SysUserRole&gt; sysUserRoles = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">        ArrayList&lt;SimpleGrantedAuthority&gt; authorities = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (SysUserRole sysUserRole : getSysUserRoles()) &#123;</span><br><span class="line">            <span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> sysUserRole.getRole();</span><br><span class="line">            authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(role.getRole()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> authorities;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountNonExpired;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountNonLocked;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> credentialsNonExpired;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> enabled;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;sys_user_role&quot;, schema = &quot;spring_security&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysUserRole</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ToString</span>.Exclude</span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY, optional = false)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;user_id&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ToString</span>.Exclude</span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY, optional = false)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;role_id&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> Role role;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || Hibernate.getClass(<span class="built_in">this</span>) != Hibernate.getClass(o)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">SysUserRole</span> <span class="variable">that</span> <span class="operator">=</span> (SysUserRole) o;</span><br><span class="line">        <span class="keyword">return</span> id != <span class="literal">null</span> &amp;&amp; Objects.equals(id, that.id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getClass().hashCode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoleRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Role, Long&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SysUserRoleRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;SysUserRole, Long&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line">    <span class="meta">@Query(&quot;select u from User u where u.username = :username and u.enabled = true &quot;)</span></span><br><span class="line">    User <span class="title function_">findByUsernameAndEnabled</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityUserDetails</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line"><span class="comment">//        User user = queryDSLGetUser(username);</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findByUsernameAndEnabled(username);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// åŠ è½½æ‡’åŠ è½½çš„é›†åˆ, é˜²æ­¢ session åœ¨å…³é—­ä¹‹åæ— æ³•è¯»å–åˆ°æ‡’åŠ è½½çš„é›†åˆ</span></span><br><span class="line">        Hibernate.initialize(user.getSysUserRoles());</span><br><span class="line">        Set&lt;SysUserRole&gt; sysUserRoles = user.getSysUserRoles();</span><br><span class="line">        <span class="keyword">for</span> (SysUserRole sysUserRole : sysUserRoles) &#123;</span><br><span class="line">            <span class="comment">// åŠ è½½æ‡’åŠ è½½çš„å¯¹è±¡, é˜²æ­¢ session åœ¨å…³é—­ä¹‹åæ— æ³•è¯»å–åˆ°æ‡’åŠ è½½çš„å¯¹è±¡</span></span><br><span class="line">            <span class="comment">// ä½†æ˜¯ä¼šå¯¼è‡´æ–°çš„é—®é¢˜, å°±æ˜¯ controller è¿”å›ç»™å‰ç«¯å¯¹è±¡æ—¶, ä¼šå€’æ˜¯å›è°ƒ json åºåˆ—åŒ–çš„æƒ…å†µ</span></span><br><span class="line">            <span class="comment">// éœ€è¦æ·»åŠ æ–°çš„æ³¨è§£ @JsonIdentityInfo(generator = ObjectIdGenerators.PropertyGenerator.class, property = &quot;id&quot;)</span></span><br><span class="line">            Hibernate.initialize(sysUserRole.getRole());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;index&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">index</span><span class="params">(Authentication authentication)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; objects = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; roleList = authentication.getAuthorities();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">credentials</span> <span class="operator">=</span> authentication.getCredentials();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">principal</span> <span class="operator">=</span> authentication.getPrincipal();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">details</span> <span class="operator">=</span> authentication.getDetails();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> authentication.getName();</span><br><span class="line">        objects.put(<span class="string">&quot;roleList&quot;</span>, roleList);</span><br><span class="line">        objects.put(<span class="string">&quot;credentials&quot;</span>, credentials);</span><br><span class="line">        objects.put(<span class="string">&quot;principal&quot;</span>, principal);</span><br><span class="line">        objects.put(<span class="string">&quot;details&quot;</span>, details);</span><br><span class="line">        objects.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">        <span class="keyword">return</span> objects;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JpaStartApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(JpaStartApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211172045974.png" alt="image-20221117204541746"></p><h2 id="SpringSecurityè®¤è¯æµç¨‹"><a href="#SpringSecurityè®¤è¯æµç¨‹" class="headerlink" title="SpringSecurityè®¤è¯æµç¨‹"></a>SpringSecurityè®¤è¯æµç¨‹</h2><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211180820279.png" alt="spring-securityè®¤è¯æµç¨‹å›¾"></p><h3 id="AuthenticationManagerè®¤è¯ç®¡ç†å™¨"><a href="#AuthenticationManagerè®¤è¯ç®¡ç†å™¨" class="headerlink" title="AuthenticationManagerè®¤è¯ç®¡ç†å™¨"></a>AuthenticationManagerè®¤è¯ç®¡ç†å™¨</h3><p>å®šä¹‰äº†SpringSecurityè¦å¦‚ä½•æ‰§è¡Œè®¤è¯æ“ä½œ.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Processes an &#123;<span class="doctag">@link</span> Authentication&#125; request.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Ben Alex</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthenticationManager</span> &#123;</span><br><span class="line">Authentication <span class="title function_">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹æ³¨é‡Š, æ˜¯ä¸€ä¸ªå¤„ç†<code>Authentication</code>è¯·æ±‚çš„æ¥å£</p><p>çœ‹æ¥å£å‡½æ•°, ä¼ å…¥<code>authentication</code>å¯¹è±¡, ç„¶åæ‰§è¡ŒæŸäº›æ“ä½œ, æœ€åè¿”å›, çœ‹å¼‚å¸¸å¥½åƒæ˜¯è®¤è¯å¡«å……<code>authentication</code>å¯¹è±¡çš„è¿‡ç¨‹</p><p>çœ‹å‡½æ•°ä¸Šé¢çš„æ³¨é‡Š:</p><p>å°è¯•è®¤è¯Authenticationå¯¹è±¡, å¦‚æœè®¤è¯æˆåŠŸ, åˆ™è¿”å›å¡«å……äº†ä¸ªAuthenticationå¯¹è±¡(åŒ…å«æˆäºˆçš„è§’è‰²)</p><p>AuthenticationManagerå¿…é¡»éµå®ˆä¸‹åˆ—å¼‚å¸¸æƒ…å†µ:</p><ul><li>DisabledException: è´¦æˆ·ä¸å¯ç”¨å¿…å®šæŠ›å‡ºDisabledException, AuthenticationManagerå°†ä¼šæ£€æµ‹è¿™ä¸ªçŠ¶æ€</li><li>LockedException: å¦‚æœè´¦æˆ·è¢«é”å®š, å¿…å®šæŠ›å‡ºLockedException å¼‚å¸¸, å¹¶ä¸”AuthenticationManager å¯ä»¥æµ‹è¯•è´¦æˆ·é”å®šæƒ…å†µ</li><li>BadCredentialsException: å¦‚æœå‘ˆç°çš„å‡­è¯é”™è¯¯, æŠ›å‡ºBadCredentialsExceptionå¼‚å¸¸, åŒæ—¶ä¸Šé¢çš„å¼‚å¸¸ä¹Ÿæ˜¯å¯é€‰çš„, AuthenticationManager æ€»æ˜¯æ£€æµ‹è®¤è¯ä¿¡æ¯</li></ul><p>çœ‹ç±»æ—:</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211180843457.png" alt="image-20221118084351327"></p><p>ç”¨çš„æœ€å¤šçš„æ˜¯ä¸Šé¢çš„å®ç°ç±»</p><h3 id="AuthenticationProvider"><a href="#AuthenticationProvider" class="headerlink" title="AuthenticationProvider"></a>AuthenticationProvider</h3><p>é’ˆå¯¹ä¸åŒçš„èº«ä»½ç±»å‹æ‰§è¡Œå…·ä½“çš„èº«ä»½è®¤è¯.</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211180850606.png" alt="image-20221118085027482"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‡æ˜AuthenticationProviderå¯ä»¥å¤„ç†æŒ‡å®šçš„Authenticationå®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthenticationProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ‰§è¡Œå…·ä½“çš„èº«ä»½è®¤è¯</span></span><br><span class="line">   Authentication <span class="title function_">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// åˆ¤æ–­AuthenticationProvideræ˜¯å¦æ”¯æŒä¼ å…¥çš„authentication</span></span><br><span class="line">   <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class&lt;?&gt; authentication)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬æŒ‘é€‰è¿™ä¸ª<code>DaoAuthenticationProvider</code>å®ç°ç±»ç ”ç©¶, SpringSecurityé»˜è®¤ä½¿ç”¨<code>DaoAuthenticationProvider</code></p><p>ä½†æ˜¯è¿™ä¸ªç±»æ²¡æœ‰<code>authenticate</code>å‡½æ•°, è¯¥å‡½æ•°åœ¨<code>AbstractUserDetailsAuthenticationProvider</code>æŠ½è±¡ç±»ä¸­å­˜åœ¨</p><h5 id="å…ˆç ”ç©¶AbstractUserDetailsAuthenticationProvider"><a href="#å…ˆç ”ç©¶AbstractUserDetailsAuthenticationProvider" class="headerlink" title="å…ˆç ”ç©¶AbstractUserDetailsAuthenticationProvider"></a>å…ˆç ”ç©¶<code>AbstractUserDetailsAuthenticationProvider</code></h5><ul><li><p><code>userCache</code>æ˜¯ä¸€ä¸ªç”¨æˆ·ç¼“å­˜å±æ€§</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211181532270.png" alt="image-20221118153208119"><br><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211181531224.png" alt="image-20221118153146096"></p></li><li><p><code>hideUserNotFoundExceptions</code>: æ˜¯å¦éšè—ç”¨æˆ·æœªæ‰¾åˆ°å¼‚å¸¸. å¦‚æœç”¨æˆ·æœªæ‰¾åˆ°ä¸€èˆ¬æƒ…å†µä¸‹ä¼šå‘Šè¯‰å®¢æˆ·è¯´â€ç”¨æˆ·æœªæ‰¾åˆ°â€, ä½†æ­£å¸¸æƒ…å†µä¸‹ä¸ºäº†å®‰å…¨åº”è¯¥å‘Šè¯‰å®¢æˆ·â€ç”¨æˆ·åæˆ–å¯†ç æœªæ‰¾åˆ°â€, è¿™æ ·ä¸ä¼šæš´éœ²æ›´å¤šçš„ä¿¡æ¯, è€Œè¯¥å±æ€§å°±æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„å¼€å…³, ä»ç›´æ¥æŠ›å‡º<code>UsernameNotFoundException</code>å¼‚å¸¸æ”¹é€ æˆä½¿ç”¨<code>BadCredentialsException</code>å¼‚å¸¸</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211181530071.png" alt="image-20221118153022770"></p></li><li><p><code>forcePrincipalAsString</code>: æ˜¯å¦å¼ºåˆ¶å°† <code>Principal</code> è½¬åŒ–æˆ <code>String</code>, é»˜è®¤æ˜¯ <code>false</code>, å¦‚æœè®¾ç½®æˆ <code>true</code></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211181536274.png" alt="image-20221118153621128"></p><ul><li>å°†ä¼šä»<code>User</code>å¯¹è±¡å˜æˆ <code>User</code>å¯¹è±¡çš„ <code>Username</code>å­—ç¬¦ä¸²</li></ul></li><li><p><code>preAuthenticationChecks</code>: è¿™ä¸ªæ˜¯ä¸€ä¸ªç”¨æˆ·è´¦æˆ·æ£€æµ‹, æ£€æµ‹è´¦æˆ·æ˜¯å¦è¢«é”å®š, æ˜¯å¦è¿‡æœŸç­‰</p></li><li><p><code>postAuthenticationChecks</code>: ç”¨æˆ·å¯†ç æ˜¯å¦è¿‡æœŸæ ¡éªŒ</p></li><li><p><code>additionalAuthenticationChecks</code>: æ ¡éªŒå¯†ç ä½¿ç”¨, æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•</p><ul><li><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211181548223.png" alt="image-20221118154810066"></li><li>å¯†ç æ ¡éªŒæ ¸å¿ƒä»£ç å°±åœ¨ä¸Šé¢</li></ul></li><li><p><code>authenticate</code>è¿™ä¸ªæ–¹æ³•æŒæ¡äº†æ•´ä¸ªè´¦æˆ·å¯†ç æ ¡éªŒçš„è¿‡ç¨‹</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211181550108.png" alt="image-20221118155010972"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Authentication <span class="title function_">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">    <span class="comment">// æ˜ç¡®ç”¨æˆ·å, è¯´ç™½äº†æ‹¿åˆ°ç”¨æˆ·å authentication.getName()</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> determineUsername(authentication);</span><br><span class="line">    <span class="comment">// é»˜è®¤ç¼“å­˜å·²ç»ä½¿ç”¨, æ‰€ä»¥ä¸éœ€è¦ç¼“å­˜äº†</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">cacheWasUsed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// ä»ç¼“å­˜ä¸­æ‹¿ user å¯¹è±¡</span></span><br><span class="line">    <span class="type">UserDetails</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">this</span>.userCache.getUserFromCache(username);</span><br><span class="line">    <span class="comment">// ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®çš„å¤„ç†æ–¹å¼</span></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// ç»“æœç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®, è¯´æ˜éœ€è¦ç¼“å­˜, æ‰€ä»¥æ”¹ä¸º false</span></span><br><span class="line">        cacheWasUsed = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ‹¿ user å¯¹è±¡, è¿˜è®°å¾—å‰é¢åŸºäº mybatis ç« èŠ‚çš„é‡å†™çš„ loadUserByUsernameå‡½æ•°ä¹ˆ? å°±åœ¨è¿™é‡Œå¤´è°ƒç”¨äº†</span></span><br><span class="line">            user = retrieveUser(username, (UsernamePasswordAuthenticationToken) authentication);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ‰¾ä¸åˆ°ç”¨æˆ·</span></span><br><span class="line">        <span class="keyword">catch</span> (UsernameNotFoundException ex) &#123;</span><br><span class="line">            <span class="built_in">this</span>.logger.debug(<span class="string">&quot;Failed to find user &#x27;&quot;</span> + username + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">            <span class="comment">// hideUserNotFoundExceptionsé»˜è®¤ä¸º true</span></span><br><span class="line">            <span class="comment">// è¿™é‡Œä¸æ‰§è¡Œä¸‹é¢æŠ›å‡ºçš„ å¼‚å¸¸, è¿™é‡Œçš„å¼‚å¸¸æ˜¯ UsernameNotFoundException</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">this</span>.hideUserNotFoundExceptions) &#123;</span><br><span class="line">                <span class="keyword">throw</span> ex;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// åŒ…è£…å¼‚å¸¸ç±»å‹</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadCredentialsException</span>(<span class="built_in">this</span>.messages</span><br><span class="line">                                              .getMessage(<span class="string">&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;</span>, <span class="string">&quot;Bad credentials&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        Assert.notNull(user, <span class="string">&quot;retrieveUser returned null - a violation of the interface contract&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç¼“å­˜ä¸­æœ‰ userçš„å¤„ç†æ–¹å¼</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ç¼“å­˜ä¸­æ‹¿åˆ°çš„ user æˆ–è€… ä» retrieveUser å‡½æ•°æ‹¿å‡ºæ¥çš„ user  å†æ¬¡éªŒè¯ æ˜¯å¦è¿‡æœŸ, æ˜¯å¦é”å®šç­‰</span></span><br><span class="line">        <span class="built_in">this</span>.preAuthenticationChecks.check(user);</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ passwordEncoder è¿›è¡Œ match åŒ¹é…</span></span><br><span class="line">        additionalAuthenticationChecks(user, (UsernamePasswordAuthenticationToken) authentication);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¤è¯å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">catch</span> (AuthenticationException ex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!cacheWasUsed) &#123;</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœèƒ½èµ°åˆ°è¿™é‡Œçš„è¯</span></span><br><span class="line">        <span class="comment">// é‚£ä¹ˆå°±æ²¡æœ‰ä»ç¼“å­˜ä¸­æ‹¿åˆ° user</span></span><br><span class="line">        cacheWasUsed = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// æ‹¿åˆ°ç”¨æˆ·</span></span><br><span class="line">        user = retrieveUser(username, (UsernamePasswordAuthenticationToken) authentication);</span><br><span class="line">        <span class="built_in">this</span>.preAuthenticationChecks.check(user);</span><br><span class="line">        additionalAuthenticationChecks(user, (UsernamePasswordAuthenticationToken) authentication);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ£€æµ‹å¯†ç æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    <span class="built_in">this</span>.postAuthenticationChecks.check(user);</span><br><span class="line">    <span class="keyword">if</span> (!cacheWasUsed) &#123;</span><br><span class="line">        <span class="comment">// ç¼“å­˜</span></span><br><span class="line">        <span class="built_in">this</span>.userCache.putUserInCache(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">principalToReturn</span> <span class="operator">=</span> user;</span><br><span class="line">    <span class="comment">// å¼ºåˆ¶å°†Principalè½¬æ¢æˆString</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.forcePrincipalAsString) &#123;</span><br><span class="line">        principalToReturn = user.getUsername();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¯†ç æ ¡éªŒæˆåŠŸ, å°†å€¼ä»€ä¹ˆçš„ä¼ é€’å‡ºå», åç»­è‚¯å®šæ˜¯å­˜å‚¨åˆ°SecurityHolderäº†</span></span><br><span class="line">    <span class="keyword">return</span> createSuccessAuthentication(principalToReturn, authentication, user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211182105633.png" alt="image-20221118210500416"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">prepareTimingAttackProtection</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.userNotFoundEncodedPassword == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.userNotFoundEncodedPassword = <span class="built_in">this</span>.passwordEncoder.encode(USER_NOT_FOUND_PASSWORD);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">mitigateAgainstTimingAttack</span><span class="params">(UsernamePasswordAuthenticationToken authentication)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (authentication.getCredentials() != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">presentedPassword</span> <span class="operator">=</span> authentication.getCredentials().toString();</span><br><span class="line">        <span class="built_in">this</span>.passwordEncoder.matches(presentedPassword, <span class="built_in">this</span>.userNotFoundEncodedPassword);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>è¿™ä¸¤æ®µä»£ç å¦‚æœæ²¡æœ‰ç ”ç©¶é€çœ‹èµ·æ¥å°±æ²¡å•¥ç”¨, å®ƒçš„è¡¨é¢åŠŸèƒ½æ˜¯åœ¨æ‰¾åˆ°ä¸åˆ°ç”¨æˆ·åçš„æ—¶å€™, å†æ¬¡å¯¹passwordå¯†ç è¿›è¡ŒéªŒè¯</p></li><li><p>çœŸæ­£çš„ç›®çš„æ˜¯é˜²æ­¢<code>Side-Channel Attack</code>(ä¾§ä¿¡é“æ”»å‡»), å¤§æ„æ˜¯hackeré€šè¿‡éªŒè¯å’Œå“åº”çš„æ—¶é—´æ¥ç¡®å®šç”¨æˆ·è´¦æˆ·æ˜¯å¦å­˜åœ¨äºæ•°æ®åº“ä¸­, å› ä¸ºéªŒè¯ç”¨æˆ·å’ŒéªŒè¯ç”¨æˆ·+å¯†ç çš„æ—¶é—´æ˜¯ä¸åŒçš„, æ˜æ˜¾éªŒè¯ç”¨æˆ·ç„¶åå¤±è´¥çš„æ—¶é—´è¾ƒçŸ­, éªŒè¯ç”¨æˆ·åå’Œå¯†ç çš„æ—¶é—´è¾ƒé•¿, å¦‚æœéªŒè¯æ—¶é—´è¾ƒé•¿è¯´æ˜ç”¨æˆ·åæ­£ç¡®, æ•°æ®åº“ä¸­æœ‰ç”¨æˆ·å</p></li></ul></li></ul><blockquote><p>ä¾§ä¿¡é“æ”»å‡»: ä¸æ˜¯æš´åŠ›ç ´è§£æˆ–æ˜¯ç ”ç©¶åŠ å¯†ç®—æ³•çš„å¼±ç‚¹, å®ƒæ˜¯åŸºäºä»å¯†ç ç³»ç»Ÿçš„ç‰©ç†å®ç°ä¸­è·å–ä¿¡æ¯, æ¯”å¦‚æ—¶é—´, åŠŸç‡æ¶ˆè€—, ç”µç£æ³„æ¼ç­‰, è¿™äº›ä¿¡æ¯å¯è¢«åˆ©ç”¨äºå¯¹ç³»ç»Ÿçš„è¿›ä¸€æ­¥ç ´è§£.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mybatis </tag>
            
            <tag> è¿‡æ»¤å™¨ </tag>
            
            <tag> JPA </tag>
            
            <tag> è®¤è¯ </tag>
            
            <tag> ç™»å½• </tag>
            
            <tag> è§’è‰² </tag>
            
            <tag> SpringSecurity </tag>
            
            <tag> æºç åˆ†æ </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>12SpringSecurity-åŸºç¡€å…¥é—¨å’Œæºç åˆ†æ</title>
      <link href="/2022/11/15/02springcloud/12SpringSecurity-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
      <url>/2022/11/15/02springcloud/12SpringSecurity-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Securityç®€ä»‹"><a href="#Spring-Securityç®€ä»‹" class="headerlink" title="Spring Securityç®€ä»‹"></a>Spring Securityç®€ä»‹</h1><h2 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ?"></a>æ˜¯ä»€ä¹ˆ?</h2><p>æ˜¯ä¸€ä¸ªå®‰å…¨ç®¡ç†æ¡†æ¶</p><h3 id="æ ¸å¿ƒåŠŸèƒ½æ˜¯ä»€ä¹ˆ"><a href="#æ ¸å¿ƒåŠŸèƒ½æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ ¸å¿ƒåŠŸèƒ½æ˜¯ä»€ä¹ˆ?"></a>æ ¸å¿ƒåŠŸèƒ½æ˜¯ä»€ä¹ˆ?</h3><ul><li><p>è®¤è¯</p></li><li><p>æˆæƒ</p></li></ul><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211130347536.png" alt="image-20221113034753386"></p><h3 id="è®¤è¯"><a href="#è®¤è¯" class="headerlink" title="è®¤è¯"></a>è®¤è¯</h3><p>spring securityæä¾›äº†: </p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211130349711.png" alt="image-20221113034919624"></p><p>è¿˜å¯ä»¥ä¾é ç¬¬ä¸‰æ–¹ä¾èµ–æ¥è‡ªå®šä¹‰</p><h3 id="æˆæƒ"><a href="#æˆæƒ" class="headerlink" title="æˆæƒ"></a>æˆæƒ</h3><p>æ— è®ºé‡‡ç”¨äº†ä¸Šé¢å“ªç§è®¤è¯æ–¹å¼ï¼Œéƒ½ä¸å½±å“åœ¨Spring Securityä¸­ä½¿ç”¨æˆæƒåŠŸèƒ½ã€‚<code>SpringSecurity</code>æ”¯æŒ<strong>åŸºäºURLçš„è¯·æ±‚æˆæƒã€æ”¯æŒæ–¹æ³•è®¿é—®æˆæƒã€æ”¯æŒSpELè®¿é—®æ§åˆ¶ã€æ”¯æŒåŸŸå¯¹è±¡å®‰å…¨(ACL)ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒåŠ¨æ€æƒé™é…ç½®ã€æ”¯æŒRBACæƒé™æ¨¡å‹ç­‰</strong>ï¼Œæ€»ä¹‹ï¼Œæˆ‘ä»¬å¸¸è§çš„æƒé™ç®¡ç†éœ€æ±‚ï¼ŒSpring SecurityåŸºæœ¬ä¸Šéƒ½æ˜¯æ”¯æŒçš„ã€‚</p><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p><code>SpringSecurity</code>è¿˜æä¾›äº†HTTPé˜²ç«å¢™åŠŸèƒ½, æ‹¦æˆªå¤§é‡éæ³•è¯·æ±‚, é˜²æ­¢ç½‘ç»œæ”»å‡».</p><h2 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h2><h3 id="è®¤è¯å’Œæˆæƒ"><a href="#è®¤è¯å’Œæˆæƒ" class="headerlink" title="è®¤è¯å’Œæˆæƒ"></a>è®¤è¯å’Œæˆæƒ</h3><h4 id="è®¤è¯-1"><a href="#è®¤è¯-1" class="headerlink" title="è®¤è¯"></a>è®¤è¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Authentication</span> <span class="keyword">extends</span> <span class="title class_">Principal</span>, Serializable &#123;</span><br><span class="line"></span><br><span class="line">   Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities();</span><br><span class="line">   <span class="comment">// è·å–ç”¨æˆ·å¯†ç </span></span><br><span class="line">   Object <span class="title function_">getCredentials</span><span class="params">()</span>;</span><br><span class="line">   <span class="comment">// è·å–ç”¨æˆ·æºå¸¦çš„è¯¦ç»†ä¿¡æ¯, å¯èƒ½æ˜¯å½“å‰è¯·æ±‚ä¹‹ç±»ç­‰</span></span><br><span class="line">   Object <span class="title function_">getDetails</span><span class="params">()</span>;</span><br><span class="line">   <span class="comment">// ç”¨æ¥è·å–å½“å‰ç”¨æˆ·ï¼Œä¾‹å¦‚æ˜¯ä¸€ä¸ªç”¨æˆ·åæˆ–è€…ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ã€‚</span></span><br><span class="line">   Object <span class="title function_">getPrincipal</span><span class="params">()</span>;</span><br><span class="line">   <span class="comment">// å½“å‰ç”¨æˆ·æ˜¯å¦è®¤è¯æˆåŠŸã€‚</span></span><br><span class="line">   <span class="type">boolean</span> <span class="title function_">isAuthenticated</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">setAuthenticated</span><span class="params">(<span class="type">boolean</span> isAuthenticated)</span> <span class="keyword">throws</span> IllegalArgumentException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·ä½¿ç”¨ç”¨æˆ·å&#x2F;å¯†ç ç™»å½•æˆ–ä½¿ç”¨ <code>Remember-me</code>ç™»å½•æ—¶ï¼Œéƒ½ä¼šå¯¹åº”ä¸€ä¸ªä¸åŒçš„<code>Authentication</code>å®ä¾‹ã€‚</p><p>Spring Securityä¸­çš„è®¤è¯å·¥ä½œä¸»è¦ç”±<code>AuthenticationManager</code>æ¥å£æ¥è´Ÿè´£ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹è¯¥æ¥å£çš„å®šä¹‰:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthenticationManager</span> &#123;</span><br><span class="line">Authentication <span class="title function_">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AuthenticationManager</code> åªæœ‰ä¸€ä¸ª<code>authenticate</code>æ–¹æ³•å¯ä»¥ç”¨æ¥åšè®¤è¯ï¼Œè¯¥æ–¹æ³•æœ‰ä¸‰ä¸ªä¸åŒçš„è¿”å›å€¼:</p><ul><li>è¿”å›<code>Authentication</code>ï¼Œè¡¨ç¤ºè®¤è¯æˆåŠŸã€‚</li><li>æŠ›å‡º<code>AuthenticationException</code>å¼‚å¸¸ï¼Œè¡¨ç¤ºç”¨æˆ·è¾“å…¥äº†æ— æ•ˆçš„å‡­è¯ã€‚</li><li>è¿”å›nullï¼Œè¡¨ç¤ºä¸èƒ½æ–­å®šã€‚</li></ul><p><code>AuthenticationManager</code>æœ€ä¸»è¦çš„å®ç°ç±»æ˜¯<code>ProviderManager</code>ï¼Œ<code>ProviderManager</code>ç®¡ç†äº†ä¼—å¤šçš„<code>AuthenticationProvider</code>å®ä¾‹ï¼Œ<code>AuthenticationProvider</code>æœ‰ç‚¹ç±»ä¼¼äº<code>AuthenticationManager</code>ï¼Œä½†æ˜¯<code>AuthenticationProvider</code>å¤šäº†ä¸€ä¸ª <code>supports</code>æ–¹æ³•ç”¨æ¥åˆ¤æ–­æ˜¯å¦æ”¯æŒç»™å®šçš„<code>Authentication</code>ç±»å‹ã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211130413003.png" alt="image-20221113041314895"></p><p>ç”±äº<code>Authentication</code>æ‹¥æœ‰ä¼—å¤šä¸åŒçš„å®ç°ç±»ï¼Œè¿™äº›ä¸åŒçš„å®ç°ç±»åˆç”±ä¸åŒçš„<code>AuthenticationProvider</code> æ¥å¤„ç†ï¼Œæ‰€ä»¥<code>AuthenticationProvider</code> ä¼šæœ‰ä¸€ä¸ª<code>supports</code>æ–¹æ³•ï¼Œç”¨æ¥åˆ¤æ–­å½“å‰çš„<code>Authentication Provider</code>æ˜¯å¦æ”¯æŒå¯¹åº”çš„<code>Authentication</code>ã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211130423552.png" alt="image-20221113042305473"></p><p>åœ¨ä¸€æ¬¡å®Œæ•´çš„è®¤è¯æµç¨‹ä¸­ï¼Œå¯èƒ½ä¼šåŒæ—¶å­˜åœ¨å¤šä¸ª<code>AuthenticationProvider</code>ï¼ˆä¾‹å¦‚ï¼Œé¡¹ç›®åŒæ—¶æ”¯æŒ<code>form</code>è¡¨å•ç™»å½•å’ŒçŸ­ä¿¡éªŒè¯ç ç™»å½•)ï¼Œå¤šä¸ª<code>AuthenticationProvider</code>ç»Ÿä¸€ç”±<code>ProviderManager</code>æ¥ç®¡ç†ã€‚åŒæ—¶ï¼Œ<code>ProviderManager</code>å…·æœ‰ä¸€ä¸ªå¯é€‰çš„<code>parent</code>ï¼Œå¦‚æœæ‰€æœ‰çš„ <code>AuthenticationProvider</code>éƒ½è®¤è¯å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨<code>parent</code>è¿›è¡Œè®¤è¯ã€‚<code>parent</code>ç›¸å½“äºä¸€ä¸ªå¤‡ç”¨è®¤è¯æ–¹å¼ï¼Œå³å„ä¸ª<code>AuthenticationProvider</code>éƒ½æ— æ³•å¤„ç†è®¤è¯é—®é¢˜çš„æ—¶å€™ï¼Œå°±ç”±<code>parent</code>å‡ºåœºæ”¶æ‹¾æ®‹å±€ã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211130440410.png" alt="spring-securityè®¤è¯æµç¨‹å›¾"></p><h4 id="æˆæƒ-1"><a href="#æˆæƒ-1" class="headerlink" title="æˆæƒ"></a>æˆæƒ</h4><p>å½“å®Œæˆè®¤è¯åï¼Œæ¥ä¸‹æ¥å°±æ˜¯æˆæƒäº†ã€‚åœ¨Spring Securityçš„æˆæƒä½“ç³»ä¸­ï¼Œæœ‰ä¸¤ä¸ªå…³é”®æ¥å£:</p><ul><li><code>AccessDecisionManager</code></li><li><code>AccessDecisionVoter</code></li></ul><p><code>AccessDecisionVoter</code>æ˜¯ä¸€ä¸ªæŠ•ç¥¨å™¨ï¼ŒæŠ•ç¥¨å™¨ä¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·å¤‡åº”æœ‰çš„è§’è‰²ï¼Œè¿›è€ŒæŠ•å‡ºèµæˆã€åå¯¹æˆ–è€…å¼ƒæƒç¥¨: <code>AccessDecisionManager</code>åˆ™æ˜¯ä¸€ä¸ªå†³ç­–å™¨ï¼Œæ¥å†³å®šæ­¤æ¬¡è®¿é—®æ˜¯å¦è¢«å…è®¸ã€‚<code>AccessDecisionVoter</code>å’Œ <code>AccessDecisionManager</code>éƒ½æœ‰ä¼—å¤šçš„å®ç°ç±»ï¼Œåœ¨.<code>AccessDecisionManager</code>ä¸­ä¼šæŒ¨ä¸ªéå†<code>AccessDecisionVoter</code>ï¼Œè¿›è€Œå†³å®šæ˜¯å¦å…è®¸ç”¨æˆ·è®¿é—®ï¼Œå› è€Œ<code>AccessDecisionVoter</code>å’Œ<code>AccessDecisionManager</code> ä¸¤è€…çš„å…³ç³»ç±»ä¼¼äº<code>AuthenticationProvider</code> å’Œ<code>ProvidenManager</code>çš„å…³ç³»ã€‚</p><p>åœ¨Spring Security ä¸­ï¼Œç”¨æˆ·è¯·æ±‚ä¸€ä¸ªèµ„æºï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªç½‘ç»œæ¥å£æˆ–è€…ä¸€ä¸ªJavaæ–¹æ³•ï¼‰æ‰€éœ€è¦çš„è§’è‰²ä¼šè¢«å°è£…æˆä¸€ä¸ª<code>ConfigAttribute</code>å¯¹è±¡ï¼Œåœ¨<code>ConfigAttribute</code>ä¸­åªæœ‰ä¸€ä¸ª<code>getAttribute</code>æ–¹æ³•,è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªStringå­—ç¬¦ä¸²,å°±æ˜¯è§’è‰²çš„åç§°ã€‚ä¸€èˆ¬æ¥è¯´,è§’è‰²åç§°éƒ½å¸¦æœ‰ä¸€ä¸ª<code>ROLE_</code>å‰ç¼€ï¼ŒæŠ•ç¥¨å™¨<code>AccessDecisionVoter</code> æ‰€åšçš„äº‹æƒ…ï¼Œå…¶å®å°±æ˜¯æ¯”è¾ƒç”¨æˆ·æ‰€å…·å¤‡çš„è§’è‰²å’Œè¯·æ±‚æŸä¸ªèµ„æºæ‰€éœ€çš„ <code>ConfigAttribute</code>ä¹‹é—´çš„å…³ç³»ã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211130447408.png" alt="æˆæƒè¿‡ç¨‹"></p><h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><p><code>SpringSecurity</code>çš„è¿‡æ»¤å™¨åˆ—è¡¨:</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211130451077.png" alt="image-20221113045141957"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211130452065.png" alt="image-20221113045206974"></p><p>å¼€å‘è€…æ‰€è§åˆ°çš„Spring Securityæä¾›çš„åŠŸèƒ½ï¼Œéƒ½æ˜¯é€šè¿‡è¿™äº›è¿‡æ»¤å™¨æ¥å®ç°çš„ï¼Œè¿™äº›è¿‡æ»¤å™¨æŒ‰ç…§æ—¢å®šçš„ä¼˜å…ˆçº§æ’åˆ—ï¼Œæœ€ç»ˆå½¢æˆä¸€ä¸ªè¿‡æ»¤å™¨é“¾ã€‚å¼€å‘è€…ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œå¹¶é€šè¿‡<code>@Order</code>æ³¨è§£å»è°ƒæ•´è‡ªå®šä¹‰è¿‡æ»¤å™¨åœ¨è¿‡æ»¤å™¨é“¾ä¸­çš„ä½ç½®ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤è¿‡æ»¤å™¨å¹¶ä¸æ˜¯ç›´æ¥æ”¾åœ¨ Web é¡¹ç›®çš„åŸç”Ÿè¿‡æ»¤å™¨é“¾ä¸­ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ª<code>FilterChainProxy</code>æ¥ç»Ÿä¸€ç®¡ç†ã€‚Spring Security ä¸­çš„è¿‡æ»¤å™¨é“¾é€šè¿‡<code>FilterChainProxy</code>åµŒå…¥åˆ°Webé¡¹ç›®çš„åŸç”Ÿè¿‡æ»¤å™¨é“¾ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211130455255.png" alt="image-20221113045512172"></p><p>åœ¨Spring Security ä¸­ï¼Œè¿™æ ·çš„è¿‡æ»¤å™¨é“¾ä¸ä»…ä»…åªæœ‰ä¸€ä¸ªï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211130456252.png" alt="image-20221113045607173"></p><p>å½“å­˜åœ¨å¤šä¸ªè¿‡æ»¤å™¨é“¾æ—¶ï¼Œå¤šä¸ªè¿‡æ»¤å™¨é“¾ä¹‹é—´è¦æŒ‡å®šä¼˜å…ˆçº§ï¼Œå½“è¯·æ±‚åˆ°è¾¾åï¼Œä¼šä»<code>FilterChainProxy</code>è¿›è¡Œåˆ†å‘ï¼Œå…ˆå’Œå“ªä¸ªè¿‡æ»¤å™¨é“¾åŒ¹é…ä¸Šï¼Œå°±ç”¨å“ªä¸ªè¿‡æ»¤å™¨é“¾è¿›è¡Œå¤„ç†ã€‚å½“ç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ªä¸åŒçš„è®¤è¯ä½“ç³»æ—¶ï¼Œé‚£ä¹ˆä½¿ç”¨å¤šä¸ªè¿‡æ»¤å™¨é“¾å°±éå¸¸æœ‰æ•ˆã€‚</p><p><code>FilterChainProxy</code>ä½œä¸ºä¸€ä¸ªé¡¶å±‚ç®¡ç†è€…ï¼Œå°†ç»Ÿä¸€ç®¡ç†Security Filterã€‚<code>FilterChainProxy</code>æœ¬èº«å°†é€šè¿‡Springæ¡†æ¶æä¾›çš„<code>DelegatingFilterProxy</code>æ•´åˆåˆ°åŸç”Ÿè¿‡æ»¤å™¨é“¾ä¸­ï¼Œæ‰€ä»¥ä¸Šå›¾æ‰€ç¤ºçš„æ¡†æ¶è¿˜å¯ä»¥åšè¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211130459245.png" alt="image-20221113045944165"></p><h4 id="ç™»å½•æ•°æ®ä¿å­˜"><a href="#ç™»å½•æ•°æ®ä¿å­˜" class="headerlink" title="ç™»å½•æ•°æ®ä¿å­˜"></a>ç™»å½•æ•°æ®ä¿å­˜</h4><p>å¦‚æœä¸ä½¿ç”¨ <code>Spring Security</code>è¿™ä¸€ç±»çš„å®‰å…¨ç®¡ç†æ¡†æ¶ï¼Œå¤§éƒ¨åˆ†çš„å¼€å‘è€…å¯èƒ½ä¼šå°†ç™»å½•ç”¨æˆ·æ•°æ®ä¿å­˜åœ¨<code>Session</code>ä¸­, </p><p>äº‹å®ä¸Š,Spring Securityä¹Ÿæ˜¯è¿™ä¹ˆåšçš„.</p><p>ä½†æ˜¯,ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿, Spring Securityåœ¨æ­¤åŸºç¡€ä¸Šè¿˜åšäº†ä¸€äº›æ”¹è¿›ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„ä¸€ä¸ªå˜åŒ–å°±æ˜¯<strong>çº¿ç¨‹ç»‘å®š</strong>ã€‚</p><p>å½“ç”¨æˆ·ç™»å½•æˆåŠŸå,Spring Securityä¼š<strong>å°†ç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°<code>SecurityContextHolder</code>ä¸­</strong>ã€‚<code>SecurityContextHolder</code> ä¸­çš„<strong>æ•°æ®ä¿å­˜é»˜è®¤æ˜¯é€šè¿‡<code>ThreadLocal</code><strong>æ¥å®ç°çš„ï¼Œä½¿ç”¨<code>ThreadLocal</code>åˆ›å»ºçš„å˜é‡åªèƒ½è¢«å½“å‰çº¿ç¨‹è®¿é—®ï¼Œä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®å’Œä¿®æ”¹ï¼Œ</strong>ä¹Ÿå°±æ˜¯ç”¨æˆ·æ•°æ®å’Œè¯·æ±‚çº¿ç¨‹ç»‘å®šåœ¨ä¸€èµ·</strong>ã€‚</p><p>å½“ç™»å½•è¯·æ±‚å¤„ç†å®Œæ¯•åï¼ŒSpring Security ä¼šå°†<code>SecurityContextHolder</code>ä¸­çš„æ•°æ®æ‹¿å‡ºæ¥ä¿å­˜åˆ°<code>Session</code>ä¸­ï¼ŒåŒæ—¶å°†<code>SecurityContextHolder</code> ä¸­çš„æ•°æ®æ¸…ç©ºã€‚</p><p>ä»¥åæ¯å½“æœ‰è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒSpring Securityå°±ä¼šå…ˆä»<code>Session</code>ä¸­å–å‡ºç”¨æˆ·ç™»å½•æ•°æ®ï¼Œä¿å­˜åˆ°<code>SecurityContextHolder</code>ä¸­ï¼Œæ–¹ä¾¿åœ¨è¯¥è¯·æ±‚çš„åç»­å¤„ç†è¿‡ç¨‹ä¸­ä½¿ç”¨</p><p>åŒæ—¶åœ¨è¯·æ±‚ç»“æŸæ—¶å°†<code>SecurityContextHolder</code> ä¸­çš„æ•°æ®æ‹¿å‡ºæ¥ä¿å­˜åˆ°<code>Session</code>ä¸­ï¼Œç„¶åå°†<code>SecurityContextHolder</code>ä¸­çš„æ•°æ®æ¸…ç©ºã€‚</p><p>è¿™ä¸€ç­–ç•¥éå¸¸æ–¹ä¾¿ç”¨æˆ·åœ¨ <code>Controller</code> æˆ–è€…<code>Service</code>å±‚è·å–å½“å‰ç™»å½•ç”¨æˆ·æ•°æ®</p><p>ä½†æ˜¯å¸¦æ¥çš„å¦å¤–ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œåœ¨å­çº¿ç¨‹ä¸­æƒ³è¦è·å–ç”¨æˆ·ç™»å½•æ•°æ®å°±æ¯”è¾ƒéº»çƒ¦ã€‚</p><p>Spring Securityå¯¹æ­¤ä¹Ÿæä¾›äº†ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœå¼€å‘è€…ä½¿ç”¨<code>@Async</code>æ³¨è§£æ¥å¼€å¯å¼‚æ­¥ä»»åŠ¡çš„è¯ï¼Œé‚£ä¹ˆåªéœ€è¦æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œä½¿ç”¨Spring Securityæä¾›çš„å¼‚æ­¥ä»»åŠ¡ä»£ç†ï¼Œå°±å¯ä»¥åœ¨å¼‚æ­¥ä»»åŠ¡ä¸­ä» <code>SecurityContextHolder</code>é‡Œè¾¹è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯:</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211130509741.png" alt="image-20221113050955659"></p><h1 id="è®¤è¯-2"><a href="#è®¤è¯-2" class="headerlink" title="è®¤è¯"></a>è®¤è¯</h1><h2 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><ol><li>æ·»åŠ ä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ›å»ºcontroller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello spring security&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è®¿é—® &#x2F;hello ç­‰ ä»»æ„ url éƒ½ä¼šè·³è½¬åˆ° &#x2F;login , å¯¹åŒ…æ‹¬ &#x2F;login, ä»–ä¼šé‡å®šå‘ä¸€æ¬¡, å¯ä»¥è€ƒè™‘å°† login ä¹Ÿç»™åŠ å…¥åˆ°ç™½åå•</p><p>è€Œç”±äºå¯†ç æ²¡æœ‰é…ç½®, é»˜è®¤ æ˜¯ user å¯†ç é»˜è®¤ä¸º UUID , è¾“å‡ºåœ¨å¯åŠ¨æ§åˆ¶å°ä¸­, éœ€è¦ä½ å»æŸ¥æ‰¾</p><h3 id="æºç æµç¨‹ç®€è¦åˆ†æ"><a href="#æºç æµç¨‹ç®€è¦åˆ†æ" class="headerlink" title="æºç æµç¨‹ç®€è¦åˆ†æ"></a>æºç æµç¨‹ç®€è¦åˆ†æ</h3><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113085111296.png" alt="image-20221113085111296"></p><p>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€äº†ä¸¤æ¬¡è¯·æ±‚, ç¬¬ä¸€æ¬¡è®¿é—® &#x2F;hello , è¢« spring security çš„è¿‡æ»¤å™¨ FilterSecurityIntercepotor æ‹¦æˆª, æŠ›å‡ºå¼‚å¸¸ç»™ ExceptionTranslationFilter é‡å®šå‘å®¢æˆ·ç«¯urlä¸º &#x2F;login(getè¯·æ±‚)</p><p>å®¢æˆ·ç«¯å†™å…¥è´¦å·å’Œå¯†ç ä¹‹å, å‘å‡º &#x2F;login(postè¯·æ±‚) è¿›è¡Œè´¦å·å¯†ç è®¤è¯</p><blockquote><p>è¿™é‡Œä¸è¦æä¹±äº†:</p><ul><li><p>getå½¢å¼çš„ &#x2F;login åœ°å€æ˜¯ç™»å½•é¡µé¢</p></li><li><p>postå½¢å¼çš„ &#x2F;login åœ°å€ä¸ºç™»é™†é¡µé¢çš„formè¡¨å•è¯·æ±‚åœ°å€, æ˜¯çœŸæ­£çš„è®¤è¯è´¦æˆ·å¯†ç åœ°å€</p></li></ul></blockquote><h3 id="èƒŒååšäº†ä»€ä¹ˆ"><a href="#èƒŒååšäº†ä»€ä¹ˆ" class="headerlink" title="èƒŒååšäº†ä»€ä¹ˆ?"></a>èƒŒååšäº†ä»€ä¹ˆ?</h3><p>è™½ç„¶ä¸Šé¢åšäº†æœ€ç®€å•çš„é…ç½®, ä½†æ˜¯ SpringSecurity åœ¨èƒŒååšäº†å¾ˆå¤šçš„äº‹æƒ…</p><ul><li>å¼€å¯ SpringSecurity è‡ªåŠ¨é…ç½®, ç„¶ååˆ›å»ºä¸€ä¸ª <code>springSecurityFilterChain</code> çš„è¿‡æ»¤å™¨, å¹¶æ³¨å…¥Springå®¹å™¨ä¸­, è¿™ä¸ªè¿‡æ»¤å™¨è´Ÿè´£å‡ ä¹æ‰€æœ‰çš„å®‰å…¨ç®¡ç†, åŒ…æ‹¬ è®¤è¯, æˆæƒç­‰(<code>springSecurityFilterChain</code>ä»£ç†äº†SpringSecurityçš„è¿‡æ»¤å™¨é“¾)</li><li>åˆ›å»ºä¸€ä¸ªUserDetailsServiceå®ä¾‹ï¼ŒUserDetailsServiceè´Ÿè´£æä¾›ç”¨æˆ·æ•°æ®ï¼Œé»˜è®¤çš„ç”¨æˆ·æ•°æ®æ˜¯åŸºäºå†…å­˜çš„ç”¨æˆ·ï¼Œç”¨æˆ·åä¸ºuserï¼Œå¯†ç åˆ™æ˜¯éšæœºç”Ÿæˆçš„UUIDå­—ç¬¦ä¸²ã€‚</li><li>ç»™ç”¨æˆ·ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ç™»å½•é¡µé¢ã€‚</li><li>å¼€å¯CSRFæ”»å‡»é˜²å¾¡ã€‚</li><li>å¼€å¯ä¼šè¯å›ºå®šæ”»å‡»é˜²å¾¡ã€‚é›†æˆX-XSS-Protectionã€‚</li><li>é›†æˆX-Frame-Options ä»¥é˜²æ­¢å•å‡»åŠ«æŒã€‚</li></ul><h4 id="é»˜è®¤ç”¨æˆ·è´¦å·å¯†ç çš„ç”Ÿæˆ"><a href="#é»˜è®¤ç”¨æˆ·è´¦å·å¯†ç çš„ç”Ÿæˆ" class="headerlink" title="é»˜è®¤ç”¨æˆ·è´¦å·å¯†ç çš„ç”Ÿæˆ"></a>é»˜è®¤ç”¨æˆ·è´¦å·å¯†ç çš„ç”Ÿæˆ</h4><p>Spring Securityä¸­å®šä¹‰äº†<code>UserDetails</code> æ¥å£æ¥<strong>è§„èŒƒå¼€å‘è€…è‡ªå®šä¹‰çš„ç”¨æˆ·å¯¹è±¡</strong>ï¼Œ<strong>è¿™æ ·æ–¹ä¾¿ä¸€äº›æ—§ç³»ç»Ÿã€ç”¨æˆ·è¡¨å·²ç»å›ºå®šçš„ç³»ç»Ÿé›†æˆåˆ°Spring Security è®¤è¯ä½“ç³»ä¸­ã€‚</strong><br>UserDetailsæ¥å£å®šä¹‰å¦‚ä¸‹:</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113093539557.png" alt="image-20221113093539557"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113093558047.png" alt="image-20221113093558047"></p><p>è¿™æ˜¯ç”¨æˆ·å¯¹è±¡çš„å®šä¹‰ï¼Œè€Œè´Ÿè´£æä¾›ç”¨æˆ·æ•°æ®æºçš„æ¥å£æ˜¯<code>UserDetailsService</code> ,<code>UserDetailsService</code>ä¸­åªæœ‰ä¸€ä¸ªæŸ¥è¯¢ç”¨æˆ·çš„æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>loadUserByUsername</code>æœ‰ä¸€ä¸ªå‚æ•°æ˜¯<code>username</code>ï¼Œè¿™æ˜¯ç”¨æˆ·åœ¨è®¤è¯æ—¶ä¼ å…¥çš„ç”¨æˆ·åï¼Œæœ€å¸¸è§çš„å°±æ˜¯ç”¨æˆ·åœ¨ç™»å½•è¡¨å•ä¸­è¾“å…¥çš„ç”¨æˆ·åï¼ˆå®é™…å¼€å‘æ—¶è¿˜å¯èƒ½å­˜åœ¨å…¶ä»–æƒ…å†µï¼Œä¾‹å¦‚ä½¿ç”¨<code>CASå•ç‚¹ç™»å½•</code>æ—¶, <code>username</code>å¹¶éè¡¨å•è¾“å…¥çš„ç”¨æˆ·å,è€Œæ˜¯<code>CAS Server</code>è®¤è¯æˆåŠŸåå›è°ƒçš„ç”¨æˆ·åå‚æ•°)ï¼Œå¼€å‘è€…åœ¨è¿™é‡Œæ‹¿åˆ°ç”¨æˆ·åä¹‹åï¼Œå†å»æ•°æ®åº“ä¸­æŸ¥è¯¢ç”¨æˆ·ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ª<code>UserDetails</code>å®ä¾‹ã€‚<br>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬éœ€è¦å¼€å‘è€…è‡ªå®šä¹‰<code>UserDetailsService</code> çš„å®ç°ã€‚å¦‚æœå¼€å‘è€…æ²¡æœ‰è‡ªå®šä¹‰<code>UserDetailsService</code> çš„å®ç°ï¼Œ<code>Spring Security</code>ä¹Ÿä¸º <code>UserDetailsService</code> æä¾›äº†å¾ˆå¤šé»˜è®¤å®ç°</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113094645604.png" alt="image-20221113094645604"></p><ul><li><code>UserDetailsManager</code> åœ¨ <code>UserDetailsService</code> çš„åŸºç¡€ä¸Šï¼Œç»§ç»­å®šä¹‰äº†æ·»åŠ ç”¨æˆ·ã€æ›´æ–°ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·ã€ä¿®æ”¹å¯†ç ä»¥åŠåˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨å…±5ç§æ–¹æ³•ã€‚</li><li><code>JdbcDaolmpl</code>åœ¨ <code>UserDetailsService</code> çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡<code>spring-jdbc</code>å®ç°äº†ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ç”¨æˆ·çš„æ–¹æ³•ã€‚</li><li><code>InMemoryUserDetailsManager</code>å®ç°äº†<code>UserDetailsManager</code>ä¸­å…³äºç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥æ–¹æ³•,ä¸è¿‡éƒ½æ˜¯åŸºäºå†…å­˜çš„æ“ä½œï¼Œæ•°æ®å¹¶æ²¡æœ‰æŒä¹…åŒ–ã€‚</li><li><code>JdbcUserDetailsManager</code>ç»§æ‰¿è‡ª<code>JdbcDaolmpl</code>åŒæ—¶åˆå®ç°äº†<code>UserDetailsManager</code>æ¥å£ï¼Œå› æ­¤å¯ä»¥é€šè¿‡<code>JdbcUserDetailsManager</code>å®ç°å¯¹ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œè¿™äº›æ“ä½œéƒ½ä¼šæŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ã€‚ä¸è¿‡<code>JdbcUserDetailsManager</code>æœ‰ä¸€ä¸ªå±€é™æ€§,å°±æ˜¯æ“ä½œæ•°æ®åº“ä¸­ç”¨æˆ·çš„SQLéƒ½æ˜¯æå‰å†™å¥½çš„ï¼Œä¸å¤Ÿçµæ´»ï¼Œå› æ­¤åœ¨å®é™…å¼€å‘ä¸­<code>JdbcUserDetailsManager</code>ä½¿ç”¨å¹¶ä¸å¤šã€‚</li><li><code>CachingUserDetailsService</code> çš„ç‰¹ç‚¹æ˜¯ä¼šå°†<code>UserDetailsService</code>ç¼“å­˜èµ·æ¥ã€‚</li><li><code>UserDetailsServiceDelegator</code> åˆ™æ˜¯æä¾›äº†<code>UserDetailsService</code> çš„æ‡’åŠ è½½åŠŸèƒ½ã€‚</li><li><code>ReactiveUserDetailsServiceAdapter</code>æ˜¯<code>webflux-web-security</code>æ¨¡å—å®šä¹‰çš„<code>UserDetailsService</code>å®ç°ã€‚</li></ul><p>åœ¨ä¸Šé¢å¿«é€Ÿå…¥é—¨çš„æƒ…å†µä¸‹, SpringSecurity é»˜è®¤ä½¿ç”¨çš„æ˜¯ <code>InMemoryUserDetailsManager</code>, å°†è´¦å·å¯†ç ä¿å­˜åœ¨å†…å­˜ä¸­, åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(AuthenticationManager.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(ObjectPostProcessor.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(</span></span><br><span class="line"><span class="meta">value = &#123; AuthenticationManager.class, AuthenticationProvider.class, UserDetailsService.class,</span></span><br><span class="line"><span class="meta">AuthenticationManagerResolver.class &#125;,</span></span><br><span class="line"><span class="meta">type = &#123; &quot;org.springframework.security.oauth2.jwt.JwtDecoder&quot;,</span></span><br><span class="line"><span class="meta">&quot;org.springframework.security.oauth2.server.resource.introspection.OpaqueTokenIntrospector&quot;,</span></span><br><span class="line"><span class="meta">&quot;org.springframework.security.oauth2.client.registration.ClientRegistrationRepository&quot;,</span></span><br><span class="line"><span class="meta">&quot;org.springframework.security.saml2.provider.service.registration.RelyingPartyRegistrationRepository&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NOOP_PASSWORD_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;&#123;noop&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">PASSWORD_ALGORITHM_PATTERN</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;^\\&#123;.+&#125;.*$&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">logger</span> <span class="operator">=</span> LogFactory.getLog(UserDetailsServiceAutoConfiguration.class);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Lazy</span></span><br><span class="line"><span class="keyword">public</span> InMemoryUserDetailsManager <span class="title function_">inMemoryUserDetailsManager</span><span class="params">(SecurityProperties properties,</span></span><br><span class="line"><span class="params">ObjectProvider&lt;PasswordEncoder&gt; passwordEncoder)</span> &#123;</span><br><span class="line">        <span class="comment">// private String name = &quot;user&quot;;</span></span><br><span class="line">        <span class="comment">// private String password = UUID.randomUUID().toString();</span></span><br><span class="line">SecurityProperties.<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> properties.getUser();</span><br><span class="line">        <span class="comment">// è·å¾—è§’è‰²åˆ—è¡¨</span></span><br><span class="line">List&lt;String&gt; roles = user.getRoles();</span><br><span class="line">        <span class="comment">// åˆ›å»ºå†…å­˜ä¸­ä¿å­˜çš„ ç”¨æˆ·åå’Œå¯†ç </span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserDetailsManager</span>(</span><br><span class="line">User.withUsername(user.getName()).password(getOrDeducePassword(user, passwordEncoder.getIfAvailable()))</span><br><span class="line">.roles(StringUtils.toStringArray(roles)).build());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨å¯†ç å‰é¢åŠ ä¸Š &#123;noop&#125;</span></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">getOrDeducePassword</span><span class="params">(SecurityProperties.User user, PasswordEncoder encoder)</span> &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> user.getPassword();</span><br><span class="line">        <span class="comment">// çœ‹çœ‹æœ‰æ²¡æœ‰åœ¨å¯†ç å‰é¢æ·»åŠ äº†å¯†ç ç±»å‹å­—ç¬¦ä¸²å‰ç¼€ &#123;xxxx&#125;</span></span><br><span class="line"><span class="keyword">if</span> (encoder != <span class="literal">null</span> || PASSWORD_ALGORITHM_PATTERN.matcher(password).matches()) &#123;</span><br><span class="line"><span class="keyword">return</span> password;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">// ä¸ºå¯†ç æ·»åŠ  &#123;noop&#125; å¯†æ–‡å‰ç¼€</span></span><br><span class="line"><span class="keyword">return</span> NOOP_PASSWORD_PREFIX + password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113095506501.png" alt="image-20221113095506501"></p><p>å¯ä»¥çœ‹å‡ºè¿™äº›æ¡ä»¶ä¸‹æ‰ä¼šå¯åŠ¨è¯¥è‡ªåŠ¨é…ç½®ç±», é…ç½®ç”¨æˆ·åå’Œå¯†ç </p><ul><li><p>éœ€è¦åœ¨<code>classpath</code>ä¸­æœ‰<code>AuthenticationManager.class</code>, è¿˜éœ€è¦<code>org.springframework.security.config.annotation.ObjectPostProcessor</code>åœ¨SpringBeanå®¹å™¨ä¸­</p></li><li><p>åœ¨Springå®¹å™¨ä¸­æ²¡æœ‰é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AuthenticationManager.class, AuthenticationProvider.class, UserDetailsService.class, AuthenticationManagerResolver.class</span><br></pre></td></tr></table></figure><p>å’Œä¸€äº›å…¶ä»–ç±»çš„æƒ…å†µä¸‹, åˆ™åŠ è½½<code>UserDetailsServiceAutoConfiguration</code></p></li></ul><p>çœ‹ä¸Šé¢çš„æºç å¯ä»¥å‘ç°</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113102414123.png" alt="image-20221113102414123"></p><p>passwordå°±æ˜¯UUID, ç”¨æˆ·åä¸º user</p><p>åœ¨è¿™é‡Œå¯ä»¥å‘ç°</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113102532200.png" alt="image-20221113102532200"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113102617171.png" alt="image-20221113102617171"></p><p>åœ¨ <code>application.yml</code> ä¸­å¯ä»¥é…ç½® ç”¨æˆ·åå’Œå¯†ç </p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113102909110.png" alt="image-20221113102909110"></p><h4 id="é»˜è®¤é¡µé¢ç”Ÿæˆ"><a href="#é»˜è®¤é¡µé¢ç”Ÿæˆ" class="headerlink" title="é»˜è®¤é¡µé¢ç”Ÿæˆ"></a>é»˜è®¤é¡µé¢ç”Ÿæˆ</h4><h5 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h5><p>åœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œä¸€å…±å­˜åœ¨ä¸¤ä¸ªé»˜è®¤é¡µé¢ï¼Œä¸€ä¸ªå°±æ˜¯<code>/login</code>çš„ç™»å½•é¡µé¢ï¼Œå¦å¤–ä¸€ä¸ªåˆ™æ˜¯æ³¨é”€ç™»å½•é¡µé¢ã€‚å½“ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥<code>http://localhost:8080/logout</code>å°±å¯ä»¥çœ‹åˆ°æ³¨é”€ç™»å½•é¡µé¢ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113103209198.png" alt="image-20221113103209198"></p><p>ç°åœ¨çš„ç›®çš„å°±æ˜¯æ‰¾æ‰¾, è¿™ä¸¤ä¸ªç½‘é¡µåœ¨å“ªç”Ÿæˆçš„</p><p>åœ¨å‰é¢çš„è¿‡æ»¤å™¨é“¾å¯ä»¥å‘ç°è¿™ä¸¤ä¸ªè¿‡æ»¤å™¨</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113103500301.png" alt="image-20221113103500301"></p><p>é€šè¿‡è¿‡æ»¤å™¨çš„åå­—å°±å¯ä»¥åˆ†è¾¨å‡º<code>DefaultLoginPageGeneratingFilter</code>è¿‡æ»¤å™¨ç”¨æ¥ç”Ÿæˆé»˜è®¤çš„ç™»å½•é¡µé¢ï¼Œ<code>DefaultLogoutPageGeneratingFilter</code>è¿‡æ»¤å™¨åˆ™ç”¨æ¥ç”Ÿæˆé»˜è®¤çš„æ³¨é”€é¡µé¢ã€‚</p><p>å…ˆæ¥çœ‹<code>DefaultLoginPageGeneratingFilter</code>ã€‚ä½œä¸º<code>Spring Security</code>è¿‡æ»¤å™¨é“¾ä¸­çš„ä¸€å‘˜ï¼Œåœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚<code>hello</code>æ¥å£çš„æ—¶å€™ï¼Œå°±ä¼šç»è¿‡<code>DefaultLoginPageGeneratingFilter</code>è¿‡æ»¤å™¨ï¼Œä½†æ˜¯ç”±äº<code>/hello</code>æ¥å£å’Œç™»å½•æ— å…³ï¼Œå› æ­¤ <code>DefaultLoginPageGeneratingFilter</code>è¿‡æ»¤å™¨å¹¶æœªå¹²æ¶‰<code>hello</code>æ¥å£ã€‚ç­‰åˆ°ç¬¬äºŒæ¬¡é‡å®šå‘åˆ°<code>/login</code>é¡µé¢çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™å°±å’Œ <code>DefaultLoginPageGeneratingFilter</code>æœ‰å…³ç³»äº†ï¼Œæ­¤æ—¶è¯·æ±‚å°±ä¼šåœ¨<code>DefaultLoginPageGeneratingFilter</code> ä¸­è¿›è¡Œå¤„ç†ï¼Œç”Ÿæˆç™»å½•é¡µé¢è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<code>DefaultLoginPageGeneratingFilter</code> çš„æºç ï¼Œæºç æ¯”è¾ƒé•¿ï¼Œè¿™é‡Œä»…åˆ—å‡ºæ ¸å¿ƒéƒ¨åˆ†:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span><br><span class="line">    <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="comment">// è¿‡æ»¤å™¨å°†ä¼šè¢« chain è‡ªåŠ¨è°ƒç”¨</span></span><br><span class="line">    doFilter((HttpServletRequest) request, (HttpServletResponse) response, chain);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain)</span></span><br><span class="line">    <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">loginError</span> <span class="operator">=</span> isErrorPage(request);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">logoutSuccess</span> <span class="operator">=</span> isLogoutSuccess(request);</span><br><span class="line">    <span class="keyword">if</span> (isLoginUrlRequest(request) || loginError || logoutSuccess) &#123;</span><br><span class="line">        <span class="comment">// æ ¸å¿ƒä»£ç , è¿™é‡Œç”Ÿæˆäº†SpringSecurityçš„é»˜è®¤ /login ç½‘é¡µ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">loginPageHtml</span> <span class="operator">=</span> generateLoginPageHtml(request, loginError, logoutSuccess);</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.setContentLength(loginPageHtml.getBytes(StandardCharsets.UTF_8).length);</span><br><span class="line">        <span class="comment">// å°†ç½‘é¡µæºç å†™å…¥</span></span><br><span class="line">        response.getWriter().write(loginPageHtml);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸‹ä¸€ä¸ª Filter</span></span><br><span class="line">    chain.doFilter(request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113110544532.png" alt="image-20221113110544532"></p><blockquote><p> å¯¹äº† _csrf åœ¨è¿™é‡Œè¢«è®¾ç½®äº†</p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113111029887.png" alt="image-20221113111029887"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">renderHiddenInputs</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; input : <span class="built_in">this</span>.resolveHiddenInputs.apply(request).entrySet()) &#123;</span><br><span class="line">        sb.append(<span class="string">&quot;&lt;input name=\&quot;&quot;</span>);</span><br><span class="line">        sb.append(input.getKey());</span><br><span class="line">        sb.append(<span class="string">&quot;\&quot; type=\&quot;hidden\&quot; value=\&quot;&quot;</span>);</span><br><span class="line">        sb.append(input.getValue());</span><br><span class="line">        sb.append(<span class="string">&quot;\&quot; /&gt;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦åˆ†æè¿™æ®µä»£ç , æ‰èƒ½å‘ç° csrf è¢«è®¾ç½®äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">DefaultLoginPageConfigurer</span>&lt;H <span class="keyword">extends</span> <span class="title class_">HttpSecurityBuilder</span>&lt;H&gt;&gt;</span><br><span class="line"><span class="keyword">extends</span> <span class="title class_">AbstractHttpConfigurer</span>&lt;DefaultLoginPageConfigurer&lt;H&gt;, H&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œå°† csrf çš„å€¼è®¾ç½®, æˆ–è€…è¯´æä¾›äº†ä¸€ä¸ªFunctionæ¥å£, æä¾›äº† csrf</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">DefaultLoginPageGeneratingFilter</span> <span class="variable">loginPageGeneratingFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultLoginPageGeneratingFilter</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(H http)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.loginPageGeneratingFilter.setResolveHiddenInputs(DefaultLoginPageConfigurer.<span class="built_in">this</span>::hiddenInputs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Map&lt;String, String&gt; <span class="title function_">hiddenInputs</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œå°±æ˜¯è·å– csrf çš„ value</span></span><br><span class="line"><span class="type">CsrfToken</span> <span class="variable">token</span> <span class="operator">=</span> (CsrfToken) request.getAttribute(CsrfToken.class.getName());</span><br><span class="line"><span class="keyword">return</span> (token != <span class="literal">null</span>) ? Collections.singletonMap(token.getParameterName(), token.getToken())</span><br><span class="line">: Collections.emptyMap();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(H http)</span> &#123;</span><br><span class="line"><span class="type">AuthenticationEntryPoint</span> <span class="variable">authenticationEntryPoint</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">ExceptionHandlingConfigurer&lt;?&gt; exceptionConf = http.getConfigurer(ExceptionHandlingConfigurer.class);</span><br><span class="line"><span class="keyword">if</span> (exceptionConf != <span class="literal">null</span>) &#123;</span><br><span class="line">authenticationEntryPoint = exceptionConf.getAuthenticationEntryPoint();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.loginPageGeneratingFilter.isEnabled() &amp;&amp; authenticationEntryPoint == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.loginPageGeneratingFilter = postProcess(<span class="built_in">this</span>.loginPageGeneratingFilter);</span><br><span class="line">http.addFilter(<span class="built_in">this</span>.loginPageGeneratingFilter);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªç±»çœç•¥äº†å¾ˆå¤šä»£ç </p></blockquote><p>åœ¨ä¸Šé¢è®¾ç½®å¥½çš„ Function å‡½æ•°ä¹‹å, ç„¶ååœ¨</p><p><code>DefaultLoginPageGeneratingFilter#renderHiddenInputs</code>è¿™ä¸ªå‡½æ•°ä¸­ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">renderHiddenInputs</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">   <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">   <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; input : <span class="built_in">this</span>.resolveHiddenInputs.apply(request).entrySet()) &#123;</span><br><span class="line">      sb.append(<span class="string">&quot;&lt;input name=\&quot;&quot;</span>);</span><br><span class="line">      sb.append(input.getKey());</span><br><span class="line">      sb.append(<span class="string">&quot;\&quot; type=\&quot;hidden\&quot; value=\&quot;&quot;</span>);</span><br><span class="line">      sb.append(input.getValue());</span><br><span class="line">      sb.append(<span class="string">&quot;\&quot; /&gt;\n&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åä¿ƒæˆäº†å‰ç«¯é¡µé¢çš„</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113111827392.png" alt="image-20221113111827392"></p><p>å¦å¤–è¿™é‡Œé…ç½®äº†ç™»å½•åœ°å€å’Œç™»å‡ºåœ°å€</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/image-20221113110822317.png" alt="image-20221113110822317"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(UsernamePasswordAuthenticationFilter authFilter,</span></span><br><span class="line"><span class="params">      AbstractAuthenticationProcessingFilter openIDFilter)</span> &#123;</span><br><span class="line">   <span class="comment">// è¿™é‡Œåˆå§‹åŒ–äº† /login åœ°å€</span></span><br><span class="line">   <span class="built_in">this</span>.loginPageUrl = DEFAULT_LOGIN_PAGE_URL;</span><br><span class="line">    <span class="comment">// è¿™é‡Œè®¾ç½®äº† ç™»å‡º çš„åœ°å€</span></span><br><span class="line">   <span class="built_in">this</span>.logoutSuccessUrl = DEFAULT_LOGIN_PAGE_URL + <span class="string">&quot;?logout&quot;</span>;</span><br><span class="line">   <span class="comment">// è¿™é‡Œè®¾ç½®äº†ç™»å½•é”™è¯¯çš„åœ°å€</span></span><br><span class="line">   <span class="built_in">this</span>.failureUrl = DEFAULT_LOGIN_PAGE_URL + <span class="string">&quot;?&quot;</span> + ERROR_PARAMETER_NAME;</span><br><span class="line">   <span class="keyword">if</span> (authFilter != <span class="literal">null</span>) &#123;</span><br><span class="line">      initAuthFilter(authFilter);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (openIDFilter != <span class="literal">null</span>) &#123;</span><br><span class="line">      initOpenIdFilter(openIDFilter);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç™»å‡º"><a href="#ç™»å‡º" class="headerlink" title="ç™»å‡º"></a>ç™»å‡º</h5><p>å¦‚æœä½ ä»”ç»†çœ‹<code>DefaultLoginPageConfigurer</code>ç±»çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">DefaultLoginPageConfigurer</span>&lt;H <span class="keyword">extends</span> <span class="title class_">HttpSecurityBuilder</span>&lt;H&gt;&gt;</span><br><span class="line"><span class="keyword">extends</span> <span class="title class_">AbstractHttpConfigurer</span>&lt;DefaultLoginPageConfigurer&lt;H&gt;, H&gt; &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">DefaultLoginPageGeneratingFilter</span> <span class="variable">loginPageGeneratingFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultLoginPageGeneratingFilter</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">DefaultLogoutPageGeneratingFilter</span> <span class="variable">logoutPageGeneratingFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultLogoutPageGeneratingFilter</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(H http)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.loginPageGeneratingFilter.setResolveHiddenInputs(DefaultLoginPageConfigurer.<span class="built_in">this</span>::hiddenInputs);</span><br><span class="line"><span class="built_in">this</span>.logoutPageGeneratingFilter.setResolveHiddenInputs(DefaultLoginPageConfigurer.<span class="built_in">this</span>::hiddenInputs);</span><br><span class="line">http.setSharedObject(DefaultLoginPageGeneratingFilter.class, <span class="built_in">this</span>.loginPageGeneratingFilter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Map&lt;String, String&gt; <span class="title function_">hiddenInputs</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line"><span class="type">CsrfToken</span> <span class="variable">token</span> <span class="operator">=</span> (CsrfToken) request.getAttribute(CsrfToken.class.getName());</span><br><span class="line"><span class="keyword">return</span> (token != <span class="literal">null</span>) ? Collections.singletonMap(token.getParameterName(), token.getToken())</span><br><span class="line">: Collections.emptyMap();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(H http)</span> &#123;</span><br><span class="line"><span class="type">AuthenticationEntryPoint</span> <span class="variable">authenticationEntryPoint</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">ExceptionHandlingConfigurer&lt;?&gt; exceptionConf = http.getConfigurer(ExceptionHandlingConfigurer.class);</span><br><span class="line"><span class="keyword">if</span> (exceptionConf != <span class="literal">null</span>) &#123;</span><br><span class="line">authenticationEntryPoint = exceptionConf.getAuthenticationEntryPoint();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.loginPageGeneratingFilter.isEnabled() &amp;&amp; authenticationEntryPoint == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.loginPageGeneratingFilter = postProcess(<span class="built_in">this</span>.loginPageGeneratingFilter);</span><br><span class="line">http.addFilter(<span class="built_in">this</span>.loginPageGeneratingFilter);</span><br><span class="line">LogoutConfigurer&lt;H&gt; logoutConfigurer = http.getConfigurer(LogoutConfigurer.class);</span><br><span class="line"><span class="keyword">if</span> (logoutConfigurer != <span class="literal">null</span>) &#123;</span><br><span class="line">http.addFilter(<span class="built_in">this</span>.logoutPageGeneratingFilter);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†ä¼šçœ‹åˆ° ç™»å‡º è¿‡æ»¤å™¨æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultLogoutPageGeneratingFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">RequestMatcher</span> <span class="variable">matcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathRequestMatcher</span>(<span class="string">&quot;/logout&quot;</span>, <span class="string">&quot;GET&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Function&lt;HttpServletRequest, Map&lt;String, String&gt;&gt; resolveHiddenInputs = (request) -&gt; Collections.emptyMap();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span></span><br><span class="line"><span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.matcher.matches(request)) &#123;</span><br><span class="line">renderLogout(request, response);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">filterChain.doFilter(request, response);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">renderLogout</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">sb.append(<span class="string">&quot;&lt;!DOCTYPE html&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;&lt;html lang=\&quot;en\&quot;&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;  &lt;head&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;    &lt;meta charset=\&quot;utf-8\&quot;&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1, shrink-to-fit=no\&quot;&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;    &lt;meta name=\&quot;description\&quot; content=\&quot;\&quot;&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;    &lt;meta name=\&quot;author\&quot; content=\&quot;\&quot;&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;    &lt;title&gt;Confirm Log Out?&lt;/title&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;    &lt;link href=\&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css\&quot; &quot;</span></span><br><span class="line">+ <span class="string">&quot;rel=\&quot;stylesheet\&quot; integrity=\&quot;sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M\&quot; &quot;</span></span><br><span class="line">+ <span class="string">&quot;crossorigin=\&quot;anonymous\&quot;&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;    &lt;link href=\&quot;https://getbootstrap.com/docs/4.0/examples/signin/signin.css\&quot; &quot;</span></span><br><span class="line">+ <span class="string">&quot;rel=\&quot;stylesheet\&quot; crossorigin=\&quot;anonymous\&quot;/&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;  &lt;/head&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;  &lt;body&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;     &lt;div class=\&quot;container\&quot;&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;      &lt;form class=\&quot;form-signin\&quot; method=\&quot;post\&quot; action=\&quot;&quot;</span> + request.getContextPath()</span><br><span class="line">+ <span class="string">&quot;/logout\&quot;&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;        &lt;h2 class=\&quot;form-signin-heading\&quot;&gt;Are you sure you want to log out?&lt;/h2&gt;\n&quot;</span>);</span><br><span class="line">sb.append(renderHiddenInputs(request)</span><br><span class="line">+ <span class="string">&quot;        &lt;button class=\&quot;btn btn-lg btn-primary btn-block\&quot; type=\&quot;submit\&quot;&gt;Log Out&lt;/button&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;      &lt;/form&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;    &lt;/div&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;  &lt;/body&gt;\n&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">response.getWriter().write(sb.toString());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setResolveHiddenInputs</span><span class="params">(Function&lt;HttpServletRequest, Map&lt;String, String&gt;&gt; resolveHiddenInputs)</span> &#123;</span><br><span class="line">Assert.notNull(resolveHiddenInputs, <span class="string">&quot;resolveHiddenInputs cannot be null&quot;</span>);</span><br><span class="line"><span class="built_in">this</span>.resolveHiddenInputs = resolveHiddenInputs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">renderHiddenInputs</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line"><span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;String, String&gt; input : <span class="built_in">this</span>.resolveHiddenInputs.apply(request).entrySet()) &#123;</span><br><span class="line">sb.append(<span class="string">&quot;&lt;input name=\&quot;&quot;</span>);</span><br><span class="line">sb.append(input.getKey());</span><br><span class="line">sb.append(<span class="string">&quot;\&quot; type=\&quot;hidden\&quot; value=\&quot;&quot;</span>);</span><br><span class="line">sb.append(input.getValue());</span><br><span class="line">sb.append(<span class="string">&quot;\&quot; /&gt;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»ä¸Šè¿°æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¯·æ±‚åˆ°æ¥ä¹‹åï¼Œä¼šå…ˆåˆ¤æ–­æ˜¯å¦æ˜¯æ³¨é”€è¯·æ±‚<code>/logout</code>ï¼Œå¦‚æœæ˜¯<code>/logout</code>è¯·æ±‚ï¼Œåˆ™æ¸²æŸ“ä¸€ä¸ªæ³¨é”€è¯·æ±‚çš„é¡µé¢è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ¸²æŸ“è¿‡ç¨‹å’Œå‰é¢ç™»å½•é¡µé¢çš„æ¸²æŸ“è¿‡ç¨‹ç±»ä¼¼,ä¹Ÿæ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆè¿™é‡Œçœç•¥äº†å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¯»è€…å¯ä»¥å‚è€ƒ<code>DefaultLogoutPageGeneratingFilter</code>çš„æºç )ï¹”å¦åˆ™è¯·æ±‚ç»§ç»­å¾€ä¸‹èµ°ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚</p><h2 id="è‡ªå®šä¹‰ç™»å½•è¡¨å•"><a href="#è‡ªå®šä¹‰ç™»å½•è¡¨å•" class="headerlink" title="è‡ªå®šä¹‰ç™»å½•è¡¨å•"></a>è‡ªå®šä¹‰ç™»å½•è¡¨å•</h2><h3 id="å¿«é€Ÿå…¥é—¨-1"><a href="#å¿«é€Ÿå…¥é—¨-1" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h3><p>åœ¨<code>resources/templates</code>åˆ›å»º<code>login.html</code>é¡µé¢, è‡ªå®šä¹‰æˆ‘ä»¬è‡ªå·±çš„ç½‘é¡µ</p><blockquote><p>ç”±äºæˆ‘ä»¬åœ¨ <code>templates</code> åˆ›å»º<code>html</code>, æ‰€ä»¥éœ€è¦åœ¨<code>controller</code>ä¸‹åˆ›å»º <code>mapping</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;</span><br><span class="line"><span class="meta">@GetMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">login</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>form-login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/font-awesome-4.7.0/css/font-awesome.min.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/style.css&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;materialContainer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>form-ç™»å½•<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/doLogin&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>ç”¨æˆ·å<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;input type=&quot;text&quot; name=&quot;username&quot; id=&quot;name&quot;&gt;--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;spin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;pass&quot;</span>&gt;</span>å¯†ç <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;input type=&quot;password&quot; name=&quot;password&quot; id=&quot;pass&quot;&gt;--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pass&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;spin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button login&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span>&gt;</span>ç™»å½•<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-check&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.SPRING_SECURITY_LAST_EXCEPTION&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:&quot;</span> <span class="attr">class</span>=<span class="string">&quot;pass-forgot&quot;</span>&gt;</span>å¿˜è®°å¯†ç ï¼Ÿ<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;overbox&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;material-button alt-2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;shape&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>form-æ³¨å†Œ<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;regname&quot;</span>&gt;</span>ç”¨æˆ·å<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;regname&quot;</span> <span class="attr">id</span>=<span class="string">&quot;regname&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;spin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;regpass&quot;</span>&gt;</span>å¯†ç <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;regpass&quot;</span> <span class="attr">id</span>=<span class="string">&quot;regpass&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;spin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;reregpass&quot;</span>&gt;</span>ç¡®è®¤å¯†ç <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;reregpass&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reregpass&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;spin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>æ³¨å†Œ<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å€¼å¾—æ³¨æ„çš„æ˜¯, æˆ‘ä»¬å°†è¡¨å•ç™»å½•çš„<code>action</code>åœ°å€ä¿®æ”¹ä¸º <code>doLogin</code>, å°†åŸå…ˆçš„ <code>username</code>å’Œ<code>password</code>ä¿®æ”¹ä¸º<code>name</code>å’Œ<code>pwd</code></p></blockquote><p>æˆ‘ä»¬å¯¹ <code>login.html</code> çš„ä¿®æ”¹, éœ€è¦å‘ŠçŸ¥ spring security </p><p>é…ç½®SpringSecurityé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityWebFilterChain</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> httpSecurity.authorizeHttpRequests()</span><br><span class="line">        .anyRequest()</span><br><span class="line">        .authenticated()</span><br><span class="line">        .and()</span><br><span class="line">        .formLogin()</span><br><span class="line">        .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">        .loginProcessingUrl(<span class="string">&quot;/doLogin&quot;</span>)</span><br><span class="line">        .defaultSuccessUrl(<span class="string">&quot;/index&quot;</span>)</span><br><span class="line">        .failureUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">        .usernameParameter(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">        .passwordParameter(<span class="string">&quot;pwd&quot;</span>)</span><br><span class="line">        .permitAll()</span><br><span class="line">        .and()</span><br><span class="line">        .csrf()</span><br><span class="line">        .disable()</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>authorizeRequests()</code>æ–¹æ³•è¡¨ç¤ºå¼€å¯æƒé™é…ç½®ï¼ˆè¯¥æ–¹æ³•çš„å«ä¹‰å…¶å®æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬åœ¨åé¢è¿˜ä¼šå†æ¬¡ä»‹ç»è¯¥æ–¹æ³•)ï¼Œ<code>.anyRequest().authenticated()</code>è¡¨ç¤ºæ‰€æœ‰çš„è¯·æ±‚éƒ½è¦è®¤è¯ä¹‹åæ‰èƒ½è®¿é—®ã€‚</li><li>æœ‰çš„è¯»è€…ä¼šå¯¹<code>and()</code>æ–¹æ³•è¡¨ç¤ºç–‘æƒ‘ï¼Œ<code>and()</code>æ–¹æ³•ä¼šè¿”å›<code>HttpSecurityBuilder</code>å¯¹è±¡çš„ä¸€ä¸ªå­ç±»(å®é™…ä¸Šå°±æ˜¯<code>HttpSecurity</code>)ï¼Œæ‰€ä»¥ <code>and()</code>æ–¹æ³•ç›¸å½“äºåˆå›åˆ°<code>HttpSecurity</code>å®ä¾‹ï¼Œé‡æ–°å¼€å¯æ–°ä¸€è½®çš„é…ç½®ã€‚å¦‚æœè§‰å¾—<code>and</code>(æ–¹æ³•å¾ˆéš¾ç†è§£ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨<code>and()</code>æ–¹æ³•ï¼Œåœ¨<code>.anyRequest().authenticated()</code>é…ç½®å®Œæˆåç›´æ¥ç”¨åˆ†å·(;ï¼‰ç»“æŸï¼Œç„¶åé€šè¿‡ <code>http.formLogin()</code>ç»§ç»­é…ç½®è¡¨å•ç™»å½•ã€‚</li><li><code>formLogin()</code>è¡¨ç¤ºå¼€å¯è¡¨å•ç™»å½•é…ç½®ï¼Œ<code>loginPage</code>ç”¨æ¥é…ç½®ç™»å½•é¡µé¢åœ°å€<code>loginProcessingUrl</code>ç”¨æ¥é…ç½®ç™»å½•æ¥å£åœ°å€; <code>defaultSuccessUrl</code>è¡¨ç¤ºç™»å½•æˆåŠŸåçš„è·³è½¬åœ°å€; <code>failureUrl</code>è¡¨ç¤ºç™»å½•å¤±è´¥åçš„è·³è½¬åœ°å€; <code>usernameParameter</code>è¡¨ç¤ºç™»å½•ç”¨æˆ·åçš„å‚æ•°åç§°; <code>passwordParameter</code>è¡¨ç¤ºç™»å½•å¯†ç çš„å‚æ•°åç§°;  <code>permitAll</code> è¡¨ç¤ºè·Ÿç™»å½•ç›¸å…³çš„é¡µé¢å’Œæ¥å£ä¸åšæ‹¦æˆªï¼Œç›´æ¥é€šè¿‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>loginProcessingUrl</code>ã€<code>usernameParameter</code>ã€<code>passwordParameter</code>éœ€è¦å’Œ<code>login.html</code>ä¸­ç™»å½•è¡¨å•çš„é…ç½®ä¸€è‡´ã€‚</li><li>æœ€åçš„<code>csrf().disable()</code>è¡¨ç¤ºç¦ç”¨<code>CSRFé˜²å¾¡åŠŸèƒ½</code>ï¼Œ<code>Spring Security</code>è‡ªå¸¦äº†<code>CSRF</code>é˜²å¾¡æœºåˆ¶,ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä¸ºäº†æµ‹è¯•æ–¹ä¾¿,å…ˆå°†<code>CSRF</code>é˜²å¾¡æœºåˆ¶å…³é—­,åç»­å°†ä¼šè¯¦ç»†ä»‹ç»<code>CSRF</code>æ”»å‡»ä¸é˜²å¾¡é—®é¢˜ã€‚</li></ul><h4 id="é…ç½®ç»†èŠ‚"><a href="#é…ç½®ç»†èŠ‚" class="headerlink" title="é…ç½®ç»†èŠ‚"></a>é…ç½®ç»†èŠ‚</h4><p>å½“ç„¶ï¼Œå‰é¢çš„é…ç½®æ¯”è¾ƒç²—ç³™ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€äº›é…ç½®çš„ç»†èŠ‚éœ€è¦å’Œè¯»è€…åˆ†äº«ä¸€ä¸‹ã€‚<br>åœ¨å‰é¢çš„é…ç½®ä¸­ï¼Œæˆ‘ä»¬ç”¨<code>defaultSuccessUrl</code>è¡¨ç¤ºç”¨æˆ·ç™»å½•æˆåŠŸåçš„è·³è½¬åœ°å€ï¼Œç”¨<code>failureUrl</code>è¡¨ç¤ºç”¨æˆ·ç™»å½•å¤±è´¥åçš„è·³è½¬åœ°å€ã€‚å…³äºç™»å½•æˆåŠŸå’Œç™»å½•å¤±è´¥ï¼Œé™¤äº†è¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥é…ç½®ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸¤ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥é…ç½®ã€‚</p><h5 id="ç™»é™†æˆåŠŸ"><a href="#ç™»é™†æˆåŠŸ" class="headerlink" title="ç™»é™†æˆåŠŸ"></a>ç™»é™†æˆåŠŸ</h5><p>å½“ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œé™¤äº†<code>defaultSuccessUnl</code> æ–¹æ³•å¯ä»¥å®ç°ç™»å½•æˆåŠŸåçš„è·³è½¬ä¹‹å¤–ï¼Œ<code>successForwardUrl</code>ä¹Ÿå¯ä»¥å®ç°ç™»å½•æˆåŠŸåçš„è·³è½¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .successForwardUrl(&quot;/&quot;)</span></span><br><span class="line">.defaultSuccessUrl(<span class="string">&quot;/&quot;</span>, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure><h6 id="defaultSuccessUrl-å’Œ-successForwardUrlçš„åŒºåˆ«"><a href="#defaultSuccessUrl-å’Œ-successForwardUrlçš„åŒºåˆ«" class="headerlink" title="defaultSuccessUrl å’Œ successForwardUrlçš„åŒºåˆ«"></a><code>defaultSuccessUrl</code> å’Œ <code>successForwardUrl</code>çš„åŒºåˆ«</h6><ul><li><code>defaultSuccessUrl</code>è¡¨ç¤ºå½“ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œä¼šè‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•ä¹‹å‰çš„åœ°å€ä¸Šï¼Œå¦‚æœç”¨æˆ·æœ¬èº«å°±æ˜¯ç›´æ¥è®¿é—®çš„ç™»å½•é¡µé¢ï¼Œåˆ™ç™»å½•æˆåŠŸåå°±ä¼šé‡å®šå‘åˆ°<code>defaultSuccessUrl</code>æŒ‡å®šçš„é¡µé¢ä¸­ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·åœ¨æœªè®¤è¯çš„æƒ…å†µä¸‹ï¼Œè®¿é—®äº†<code>hello</code>é¡µé¢ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼Œå½“ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå°±ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°<code>/hello</code>é¡µé¢; è€Œç”¨æˆ·å¦‚æœä¸€å¼€å§‹å°±è®¿é—®ç™»å½•é¡µé¢ï¼Œåˆ™ç™»å½•æˆåŠŸåå°±ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°<code>defaulItSuccessUrl</code>æ‰€æŒ‡å®šçš„é¡µé¢ä¸­ã€‚</li><li><code>successForwardUrl</code>åˆ™ä¸ä¼šè€ƒè™‘ç”¨æˆ·ä¹‹å‰çš„è®¿é—®åœ°å€ï¼Œåªè¦ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œå°±ä¼šé€šè¿‡æœåŠ¡å™¨ç«¯è·³è½¬åˆ°<code>successForwardUrl</code>æ‰€æŒ‡å®šçš„é¡µé¢ã€‚</li><li><code>defaultSuccessUrl</code>æœ‰ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œå¦‚æœé‡è½½æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥<code>true</code>ï¼Œåˆ™<code>defaultSuccessUrl</code>çš„æ•ˆæœä¸<code>successForwardUrl</code>ç±»ä¼¼ï¼Œå³ä¸è€ƒè™‘ç”¨æˆ·ä¹‹å‰çš„è®¿é—®åœ°å€ï¼Œåªè¦ç™»å½•æˆåŠŸï¼Œå°±é‡å®šå‘åˆ°<code>defaultSuccessUrl</code>æ‰€æŒ‡å®šçš„é¡µé¢ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œ<code>defaultSuccessUrl</code>æ˜¯é€šè¿‡é‡å®šå‘å®ç°çš„è·³è½¬ï¼ˆå®¢æˆ·ç«¯è·³è½¬)ï¼Œè€Œ<code>successForwardUrl</code>åˆ™æ˜¯é€šè¿‡æœåŠ¡å™¨ç«¯è·³è½¬å®ç°çš„ã€‚</li></ul><h6 id="ç›¸å…³æºç ç®€å•åˆ†æ"><a href="#ç›¸å…³æºç ç®€å•åˆ†æ" class="headerlink" title="ç›¸å…³æºç ç®€å•åˆ†æ"></a>ç›¸å…³æºç ç®€å•åˆ†æ</h6><p>æ— è®ºæ˜¯<code>defaultSuccessUrl</code>è¿˜æ˜¯<code>successForwardUrl</code>,æœ€ç»ˆæ‰€é…ç½®çš„éƒ½æ˜¯<code>AuthenticationSuccessHandler</code>æ¥å£çš„å®ä¾‹ã€‚<br><code>Spring Security</code>ä¸­ä¸“é—¨æä¾›äº†<code>AuthenticationSuccessHandler</code>æ¥å£ç”¨æ¥å¤„ç†ç™»å½•æˆåŠŸäº‹é¡¹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthenticationSuccessHandler</span> &#123;</span><br><span class="line"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain,</span></span><br><span class="line"><span class="params">Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">onAuthenticationSuccess(request, response, authentication);</span><br><span class="line">chain.doFilter(request, response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”±ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œ<code>AuthenticationSuccessHandler</code>æ¥å£ä¸­ä¸€å…±å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ <code>default</code>æ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ˜¯<code>Spring Security 5.2</code>å¼€å§‹åŠ å…¥è¿›æ¥çš„ï¼Œåœ¨å¤„ç†ç‰¹å®šçš„è®¤è¯è¯·æ±‚<code>Authentication Filter</code>ä¸­ä¼šç”¨åˆ°; å¦å¤–ä¸€ä¸ªé <code>default</code>æ–¹æ³•ï¼Œåˆ™ç”¨æ¥å¤„ç†ç™»å½•æˆåŠŸçš„å…·ä½“äº‹é¡¹ï¼Œå…¶ä¸­<code>request</code>å’Œ<code>response</code>å‚æ•°å¥½ç†è§£ï¼Œ<code>authentication</code>å‚æ•°ä¿å­˜äº†ç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¿¡æ¯ã€‚æˆ‘ä»¬å°†åœ¨åé¢çš„ç« èŠ‚ä¸­è¯¦ç»†ä»‹ç» <code>authentication</code>å‚æ•°ã€‚</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140307647.png" alt="image-20221114030734539"></p><p>è¿™ä¸ªæ¥å£çš„å‡½æ•°è¶…çº§ç®€å•</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140309293.png" alt="image-20221114030913206"></p><p>ä½ åœ¨ç”¨æˆ·è®¤è¯æˆåŠŸä¹‹å, å°±ä¼šè°ƒç”¨ä¸Šé¢çš„é‚£ä¸ªå‡½æ•°, ç´§æ¥ç€ä¸Šé¢çš„é»˜è®¤å‡½æ•°ä¼šè°ƒç”¨ä¸‹é¢çš„å‡½æ•°, è¯¥å‡½æ•°æ˜¯ä¸ªæ¥å£, å°†ä¼šæœ‰å®ç°ç±»</p><p><code>AuthenticationSuccessHandler</code>æ¥å£å…±æœ‰ä¸‰ä¸ªå®ç°ç±», å¦‚å›¾æ‰€ç¤º</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blogimage-20221113191332026.png" alt="image-20221113191332026"></p><ul><li><code>ForwardAuthenticationSuccessHandler</code></li></ul><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140311357.png" alt="image-20221114031131230"></p><p>æˆåŠŸå°±è½¬å‘</p><ul><li><code>SavedRequestAwareAuthenticationSuccessHandler</code></li></ul><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140312669.png" alt="image-20221114031233549"></p><p><code>SavedRequestAwareAuthenticationSuccessHandler</code> åœ¨ <code>SimpleUrlAuthenticationSuccessHandler</code> çš„åŸºç¡€ä¸Šå¢åŠ äº†è¯·æ±‚ç¼“å­˜çš„åŠŸèƒ½ï¼Œå¯ä»¥è®°å½•ä¹‹å‰è¯·æ±‚çš„åœ°å€ï¼Œè¿›è€Œåœ¨ç™»å½•æˆåŠŸåé‡å®šå‘åˆ°ä¸€å¼€å§‹è®¿é—®çš„åœ°å€ã€‚</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140320251.png" alt="image-20221114032000138"></p><ul><li><code>SimpleUrlAuthenticationSuccessHandler</code></li></ul><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140318471.png" alt="image-20221114031804364"></p><p>è¿™ä¸ªæ˜¯é»˜è®¤çš„, å¦‚æœä½ æ²¡æœ‰é…ç½®ä»»ä½•ç›¸å…³é…ç½®æ—¶, å°†ä¼šä½¿ç”¨å®ƒ</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140318977.png" alt="image-20221114031852842"></p><p>æˆ‘ä»¬æ¥é‡ç‚¹åˆ†æ<code>SavedRequestAwareAuthenticationSuccessHandler</code>å’Œ <code>ForwardAuthenticationSuccessHandler</code>çš„å®ç°ã€‚</p><p>å½“é€šè¿‡<code>defaultSuccessUrl</code>æ¥è®¾ç½®ç™»å½•æˆåŠŸåé‡å®šå‘çš„åœ°å€æ—¶ï¼Œå®é™…ä¸Šå¯¹åº”çš„å®ç°ç±»å°±æ˜¯<code>SavedRequestAwareAuthenticationSuccessHandler</code>ï¼Œç”±äºè¯¥ç±»çš„æºç æ¯”è¾ƒé•¿ï¼Œè¿™é‡Œåˆ—å‡ºæ¥ä¸€éƒ¨åˆ†æ ¸å¿ƒä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SavedRequestAwareAuthenticationSuccessHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleUrlAuthenticationSuccessHandler</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">logger</span> <span class="operator">=</span> LogFactory.getLog(<span class="built_in">this</span>.getClass());</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">RequestCache</span> <span class="variable">requestCache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpSessionRequestCache</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">Authentication authentication)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// ä»ç¼“å­˜ä¸­æ‹¿è¯·æ±‚, ä½†æ˜¯æ²¡æœ‰, è¯´æ˜ç”¨æˆ·åœ¨ç™»å½•ä¹‹å‰æ²¡æœ‰è®¿é—®çš„åœ°å€</span></span><br><span class="line"><span class="type">SavedRequest</span> <span class="variable">savedRequest</span> <span class="operator">=</span> <span class="built_in">this</span>.requestCache.getRequest(request, response);</span><br><span class="line"><span class="keyword">if</span> (savedRequest == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// èµ°SimpleUrlAuthenticationSuccessHandleré»˜è®¤é‡å®šå‘åœ°å€ </span></span><br><span class="line"><span class="built_in">super</span>.onAuthenticationSuccess(request, response, authentication);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">// æ‹¿åˆ°è¯·æ±‚ ?target=/hello å‚æ•°çš„ /hello </span></span><br><span class="line"><span class="type">String</span> <span class="variable">targetUrlParameter</span> <span class="operator">=</span> getTargetUrlParameter();</span><br><span class="line">        <span class="comment">// å¦‚æœä½¿ç”¨é»˜è®¤çš„targetUrl, åˆ™targetUrlParameterè®¾ç½®æ— æ„ä¹‰</span></span><br><span class="line">        <span class="comment">// è¿˜æ˜¯å’Œå‰é¢ä¸€æ ·, ç›´æ¥èµ°SimpleUrlAuthenticationSuccessHandleré»˜è®¤é‡å®šå‘åœ°å€</span></span><br><span class="line"><span class="keyword">if</span> (isAlwaysUseDefaultTargetUrl()</span><br><span class="line">|| (targetUrlParameter != <span class="literal">null</span> &amp;&amp; StringUtils.hasText(request.getParameter(targetUrlParameter)))) &#123;</span><br><span class="line"><span class="built_in">this</span>.requestCache.removeRequest(request, response);</span><br><span class="line"><span class="built_in">super</span>.onAuthenticationSuccess(request, response, authentication);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">clearAuthenticationAttributes(request);</span><br><span class="line"><span class="comment">// Use the DefaultSavedRequest URL</span></span><br><span class="line"><span class="type">String</span> <span class="variable">targetUrl</span> <span class="operator">=</span> savedRequest.getRedirectUrl();</span><br><span class="line">getRedirectStrategy().sendRedirect(request, response, targetUrl);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRequestCache</span><span class="params">(RequestCache requestCache)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.requestCache = requestCache;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><code>String targetUrlParameter = getTargetUrlParameter();</code><ul><li>æ¥ä¸‹æ¥ä¼šè·å–ä¸€ä¸ª<code>targetUrlParameter</code>ï¼Œè¿™ä¸ªæ˜¯ç”¨æˆ·æ˜¾å¼æŒ‡å®šçš„ã€å¸Œæœ›ç™»å½•æˆåŠŸåé‡å®šå‘çš„åœ°å€ï¼Œä¾‹å¦‚ç”¨æˆ·å‘é€çš„ç™»å½•è¯·æ±‚æ˜¯<code>http:/localhost:8080/doLogin?target=/hello</code>ï¼Œè¿™å°±è¡¨ç¤ºå½“ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œå¸Œæœ›è‡ªåŠ¨é‡å®šå‘åˆ°<code>/hello</code>è¿™ä¸ªæ¥å£ã€‚<code>getTargetUrlParameter</code>å°±æ˜¯è¦è·å–é‡å®šå‘åœ°å€å‚æ•°çš„<code>key</code>ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„<code>target</code>ï¼Œæ‹¿åˆ°<code>target</code>ä¹‹åï¼Œå°±å¯ä»¥è·å–åˆ°é‡å®šå‘åœ°å€äº†ã€‚å®Œæ•´é€»è¾‘çœ‹ä¸‹å›¾</li><li><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140334498.png" alt="image-20221114033424360"></li></ul></li></ul><p>å¦‚æœå‰é¢çš„æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆæœ€ç»ˆä¼šä»ç¼“å­˜è¯·æ±‚<code>savedRequest</code> ä¸­è·å–é‡å®šå‘åœ°å€ï¼Œç„¶åè¿›è¡Œé‡å®šå‘æ“ä½œã€‚å¦‚ä¸‹å›¾:</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140336993.png" alt="image-20221114033632889"></p><p>æ•´ä½“é€»è¾‘éå¸¸ç®€å•</p><p>çœ‹è¿™æ®µä»£ç æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> T <span class="title function_">defaultSuccessUrl</span><span class="params">(String defaultSuccessUrl, <span class="type">boolean</span> alwaysUse)</span> &#123;</span><br><span class="line">   <span class="type">SavedRequestAwareAuthenticationSuccessHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SavedRequestAwareAuthenticationSuccessHandler</span>();</span><br><span class="line">   handler.setDefaultTargetUrl(defaultSuccessUrl);</span><br><span class="line">   handler.setAlwaysUseDefaultTargetUrl(alwaysUse);</span><br><span class="line">   <span class="built_in">this</span>.defaultSuccessHandler = handler;</span><br><span class="line">   <span class="keyword">return</span> successHandler(handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“ç„¶å®é™…å¼€å‘ä¸­ä¸ä¼šè¿™ä¹ˆç”¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SavedRequestAwareAuthenticationSuccessHandler <span class="title function_">successHandler</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">SavedRequestAwareAuthenticationSuccessHandler</span> <span class="variable">savedRequestAwareAuthenticationSuccessHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SavedRequestAwareAuthenticationSuccessHandler</span>();</span><br><span class="line">   savedRequestAwareAuthenticationSuccessHandler.setDefaultTargetUrl(<span class="string">&quot;/index&quot;</span>);</span><br><span class="line">   savedRequestAwareAuthenticationSuccessHandler.setTargetUrlParameter(<span class="string">&quot;target&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> savedRequestAwareAuthenticationSuccessHandler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…æ•ˆä»¿è¿™ä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">SavedRequest</span> <span class="variable">savedRequest</span> <span class="operator">=</span> <span class="built_in">this</span>.requestCache.getRequest(request, response);</span><br><span class="line">    <span class="keyword">if</span> (savedRequest == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">super</span>.onAuthenticationSuccess(request, response, authentication);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">targetUrlParameter</span> <span class="operator">=</span> <span class="built_in">this</span>.getTargetUrlParameter();</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.isAlwaysUseDefaultTargetUrl() &amp;&amp; (targetUrlParameter == <span class="literal">null</span> || !StringUtils.hasText(request.getParameter(targetUrlParameter)))) &#123;</span><br><span class="line">            <span class="built_in">this</span>.clearAuthenticationAttributes(request);</span><br><span class="line">            <span class="type">String</span> <span class="variable">targetUrl</span> <span class="operator">=</span> savedRequest.getRedirectUrl();</span><br><span class="line">            <span class="built_in">this</span>.getRedirectStrategy().sendRedirect(request, response, targetUrl);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.requestCache.removeRequest(request, response);</span><br><span class="line">            <span class="built_in">super</span>.onAuthenticationSuccess(request, response, authentication);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.successHandler((request, response, authentication) -&gt; &#123;</span><br><span class="line">   HashMap&lt;String, Object&gt; retHashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">   retHashMap.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;ç™»å½•æˆåŠŸ&quot;</span>);</span><br><span class="line">   retHashMap.put(<span class="string">&quot;status&quot;</span>, HttpStatus.OK.value());</span><br><span class="line">   retHashMap.put(<span class="string">&quot;authentication&quot;</span>, authentication);</span><br><span class="line">   response.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);</span><br><span class="line">   <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> objectMapper.writeValueAsString(retHashMap);</span><br><span class="line">   response.getWriter().write(s);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="ç™»å½•å¤±è´¥"><a href="#ç™»å½•å¤±è´¥" class="headerlink" title="ç™»å½•å¤±è´¥"></a>ç™»å½•å¤±è´¥</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityWebFilterChain</span><span class="params">(HttpSecurity httpSecurity, ObjectMapper objectMapper)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> httpSecurity.authorizeHttpRequests()</span><br><span class="line">        .anyRequest()</span><br><span class="line">        .authenticated()</span><br><span class="line">        .and()</span><br><span class="line">        .formLogin()</span><br><span class="line">        .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">        .çœç•¥ ...</span><br><span class="line">        .failureUrl(<span class="string">&quot;/login&quot;</span>) <span class="comment">// ç™»å½•å¤±è´¥</span></span><br><span class="line">        .permitAll()</span><br><span class="line">        .and()</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>.failureUrl(&quot;/login&quot;)</code> è¿™ç§æ˜¯é‡å®šå‘, æ— æ³•æºå¸¦é”™è¯¯ä¿¡æ¯</p><p>å¯ä»¥æ”¹æˆè½¬å‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.failureForwardUrl(<span class="string">&quot;/login&quot;</span>) <span class="comment">// è½¬å‘, å¯ä»¥æºå¸¦é”™è¯¯ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><h6 id="æºç ç®€å•åˆ†æ"><a href="#æºç ç®€å•åˆ†æ" class="headerlink" title="æºç ç®€å•åˆ†æ"></a>æºç ç®€å•åˆ†æ</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForwardAuthenticationFailureHandler</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationFailureHandler</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> String forwardUrl;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ForwardAuthenticationFailureHandler</span><span class="params">(String forwardUrl)</span> &#123;</span><br><span class="line">Assert.isTrue(UrlUtils.isValidRedirectUrl(forwardUrl), () -&gt; <span class="string">&quot;&#x27;&quot;</span> + forwardUrl + <span class="string">&quot;&#x27; is not a valid forward URL&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®è½¬å‘åœ°å€</span></span><br><span class="line"><span class="built_in">this</span>.forwardUrl = forwardUrl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationFailure</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">AuthenticationException exception)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®é”™è¯¯ä¿¡æ¯ key = &quot;SPRING_SECURITY_LAST_EXCEPTION&quot; value = å¼‚å¸¸</span></span><br><span class="line">request.setAttribute(WebAttributes.AUTHENTICATION_EXCEPTION, exception);</span><br><span class="line">        <span class="comment">// è½¬å‘åœ°å€</span></span><br><span class="line">request.getRequestDispatcher(<span class="built_in">this</span>.forwardUrl).forward(request, response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„çœ‹, ä»–çš„æ¥å£<code>AuthenticationFailureHandler</code></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140409564.png" alt="image-20221114040945454"></p><ul><li><code>SimpleUrlAuthenticationFailureHandler</code> é»˜è®¤çš„å¤„ç†é€»è¾‘å°±æ˜¯é€šè¿‡é‡å®šå‘è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®<code>forwardToDestination</code>å±æ€§å°†é‡å®šå‘æ”¹ä¸ºæœåŠ¡å™¨ç«¯è·³è½¬ï¼Œ<code>failureUrl</code>æ–¹æ³•çš„åº•å±‚å®ç°é€»è¾‘å°±æ˜¯<code>SimpleUrlAuthenticationFailureHandler</code>ã€‚</li><li><code>ExceptionMappingAuthenticationFailureHandler</code>å¯ä»¥å®ç°æ ¹æ®ä¸åŒçš„å¼‚å¸¸ç±»å‹ï¼Œæ˜ å°„åˆ°ä¸åŒçš„è·¯å¾„ã€‚</li><li><code>ForwardAuthenticationFailureHandler</code>è¡¨ç¤ºé€šè¿‡æœåŠ¡å™¨ç«¯è·³è½¬æ¥é‡æ–°å›åˆ°ç™»å½•é¡µé¢ï¼Œ<code>failureForwardUrl</code>æ–¹æ³•çš„åº•å±‚å®ç°é€»è¾‘å°±æ˜¯<code>ForwardAuthenticationFailureHandler</code>ã€‚</li><li><code>AuthenticationEntryPointFailureHandler</code>æ˜¯<code>Spring Security 5.2</code>æ–°å¼•è¿›çš„å¤„ç†ç±»ï¼Œå¯ä»¥é€šè¿‡<code>AuthenticationEntryPoint</code>æ¥å¤„ç†ç™»å½•å¼‚å¸¸ã€‚</li><li><code>DelegatingAuthenticationFailureHandler</code> å¯ä»¥å®ç°ä¸ºä¸åŒçš„å¼‚å¸¸ç±»å‹é…ç½®ä¸åŒçš„ç™»å½•å¤±è´¥å¤„ç†å›è°ƒã€‚</li></ul><blockquote><p>æºç å°±ä¸åˆ†æäº†, è®°å¾—è½¬å‘ä¹Ÿå¯ä»¥è®¾ç½®å‰åç«¯åˆ†æ, åŸºæœ¬ä»£ç å’Œé‡å®šå‘é‚£è¾¹ä¸€è‡´</p></blockquote><h5 id="æ³¨é”€ç™»å½•"><a href="#æ³¨é”€ç™»å½•" class="headerlink" title="æ³¨é”€ç™»å½•"></a>æ³¨é”€ç™»å½•</h5><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140424284.png" alt="image-20221114042414165"></p><ul><li>é€šè¿‡.logout(æ–¹æ³•å¼€å¯æ³¨é”€ç™»å½•é…ç½®ã€‚</li><li>logoutUrlæŒ‡å®šäº†æ³¨é”€ç™»å½•è¯·æ±‚åœ°å€ï¼Œé»˜è®¤æ˜¯GETè¯·æ±‚ï¼Œè·¯å¾„ä¸º&#x2F;logoutã€‚</li><li>invalidateHttpSessionè¡¨ç¤ºæ˜¯å¦ä½¿sessionå¤±æ•ˆï¼Œé»˜è®¤ä¸ºtrueã€‚</li><li>clearAuthenticationè¡¨ç¤ºæ˜¯å¦æ¸…é™¤è®¤è¯ä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚(5)logoutSuccessUrlè¡¨ç¤ºæ³¨é”€ç™»å½•åçš„è·³è½¬åœ°å€ã€‚</li></ul><p>è®¾ç½®å¤šä¸ªæ³¨é”€ç™»å½•åœ°å€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.logoutRequestMatcher(<span class="keyword">new</span> <span class="title class_">OrRequestMatcher</span>(<span class="keyword">new</span> <span class="title class_">AntPathRequestMatcher</span>(<span class="string">&quot;/logout1&quot;</span>, <span class="string">&quot;GET&quot;</span>), <span class="keyword">new</span> <span class="title class_">AntPathRequestMatcher</span>(<span class="string">&quot;logout2&quot;</span>, <span class="string">&quot;GET&quot;</span>))) <span class="comment">// è®¾ç½®å¤šä¸ªæ¨å‡ºç™»å½•åœ°å€</span></span><br></pre></td></tr></table></figure><h2 id="ç™»å½•ç”¨æˆ·æ•°æ®è·å–"><a href="#ç™»å½•ç”¨æˆ·æ•°æ®è·å–" class="headerlink" title="ç™»å½•ç”¨æˆ·æ•°æ®è·å–"></a>ç™»å½•ç”¨æˆ·æ•°æ®è·å–</h2><p>ç™»å½•æˆåŠŸä¹‹åï¼Œåœ¨åç»­çš„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œå¼€å‘è€…å¯èƒ½è¿˜éœ€è¦è·å–ç™»å½•æˆåŠŸçš„ç”¨æˆ·å¯¹è±¡ï¼Œå¦‚æœä¸ä½¿ç”¨ä»»ä½•å®‰å…¨ç®¡ç†æ¡†æ¶ï¼Œé‚£ä¹ˆå¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åœ¨<code>HtpSession</code> ä¸­ï¼Œä»¥åéœ€è¦çš„æ—¶å€™ç›´æ¥ä» <code>HttpSession</code>ä¸­è·å–æ•°æ®ã€‚åœ¨ Spring Securityä¸­ï¼Œç”¨æˆ·ç™»å½•ä¿¡æ¯æœ¬è´¨ä¸Šè¿˜æ˜¯ä¿å­˜åœ¨<code>HttpSession</code>ä¸­ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒSpring Securityå¯¹<code>HtpSession</code>ä¸­çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œäº†å°è£…ï¼Œå°è£…ä¹‹åï¼Œå¼€å‘è€…è‹¥å†æƒ³è·å–ç”¨æˆ·ç™»å½•æ•°æ®å°±ä¼šæœ‰ä¸¤ç§ä¸åŒçš„æ€è·¯:<br>(1ï¼‰ä» <code>SecurityContextHolder</code>ä¸­è·å–ã€‚<br>(2ï¼‰ä»å½“å‰è¯·æ±‚å¯¹è±¡ä¸­è·å–ã€‚</p><p>è¿™é‡Œåˆ—å‡ºæ¥çš„ä¸¤ç§æ–¹å¼æ˜¯ä¸»æµçš„åšæ³•ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº›éä¸»æµçš„æ–¹å¼è·å–ç™»å½•æˆåŠŸåçš„ç”¨æˆ·ä¿¡æ¯ï¼Œä¾‹å¦‚ç›´æ¥ä»<code>HttpSession</code> ä¸­è·å–ç”¨æˆ·ç™»å½•æ•°æ®ã€‚<br>æ— è®ºæ˜¯å“ªç§è·å–æ–¹å¼ï¼Œéƒ½ç¦»ä¸å¼€ä¸€ä¸ªé‡è¦çš„å¯¹è±¡: <code>Authentication</code>ã€‚åœ¨Spring Security ä¸­ï¼Œ<code>Authentication</code>å¯¹è±¡ä¸»è¦æœ‰ä¸¤æ–¹é¢çš„åŠŸèƒ½:</p><p>(1ï¼‰ä½œä¸º<code>AuthenticationManager</code> çš„è¾“å…¥å‚æ•°ï¼Œæä¾›ç”¨æˆ·èº«ä»½è®¤è¯çš„å‡­è¯ï¼Œå½“å®ƒä½œä¸ºä¸€ä¸ªè¾“å…¥å‚æ•°æ—¶ï¼Œå®ƒçš„<code>isAuthenticated</code>æ–¹æ³•è¿”å›<code>false</code>ï¼Œè¡¨ç¤ºç”¨æˆ·è¿˜æœªè®¤è¯ã€‚<br>(2)ä»£è¡¨å·²ç»ç»è¿‡èº«ä»½è®¤è¯çš„ç”¨æˆ·,æ­¤æ—¶çš„<code>Authentication</code>å¯ä»¥ä»<code>SecurityContext</code>ä¸­è·å–ã€‚</p><p>ä¸€ä¸ª<code>Authentication</code>å¯¹è±¡ä¸»è¦åŒ…å«ä¸‰ä¸ªæ–¹é¢çš„ä¿¡æ¯:</p><p>(1) <code>principal</code>:å®šä¹‰è®¤è¯çš„ç”¨æˆ·ã€‚å¦‚æœç”¨æˆ·ä½¿ç”¨ç”¨æˆ·å&#x2F;å¯†ç çš„æ–¹å¼ç™»å½•ï¼Œ<code>principal</code> é€šå¸¸å°±æ˜¯ä¸€ä¸ª<code>UserDetails</code>å¯¹è±¡ã€‚<br>(2) <code>credentials</code>:ç™»å½•å‡­è¯ï¼Œä¸€èˆ¬å°±æ˜¯æŒ‡å¯†ç ã€‚å½“ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œç™»å½•å‡­è¯ä¼šè¢«è‡ªåŠ¨æ“¦é™¤ï¼Œä»¥é˜²æ­¢æ³„æ¼ã€‚<br>(3ï¼‰<code>authorities</code>:ç”¨æˆ·è¢«æˆäºˆçš„æƒé™ä¿¡æ¯ã€‚</p><p>Javaä¸­æœ¬èº«æä¾›äº†<code>Principal</code> æ¥å£ç”¨æ¥æè¿°è®¤è¯ä¸»ä½“ï¼Œ<code>Principal</code>å¯ä»¥ä»£è¡¨ä¸€ä¸ªå…¬å¸ã€ä¸ªäººæˆ–è€…<code>ç™»å½•ID</code>ã€‚Spring Securityä¸­å®šä¹‰äº†<code>Authentication</code>æ¥å£ç”¨æ¥è§„èŒƒç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œ<code>Authentication</code>ç»§æ‰¿è‡ª<code>Principal</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Authentication</span> <span class="keyword">extends</span> <span class="title class_">Principal</span>, Serializable &#123;</span><br><span class="line">    </span><br><span class="line">Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities();</span><br><span class="line"></span><br><span class="line">Object <span class="title function_">getCredentials</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">Object <span class="title function_">getDetails</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">Object <span class="title function_">getPrincipal</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isAuthenticated</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setAuthenticated</span><span class="params">(<span class="type">boolean</span> isAuthenticated)</span> <span class="keyword">throws</span> IllegalArgumentException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><code>getAuthorities</code>æ–¹æ³•:ç”¨æ¥è·å–ç”¨æˆ·æƒé™ã€‚</li><li><code>getCredentials</code> æ–¹æ³•:ç”¨æ¥è·å–ç”¨æˆ·å‡­è¯ï¼Œä¸€èˆ¬æ¥è¯´å°±æ˜¯å¯†ç ã€‚</li><li><code>getDetails</code>æ–¹æ³•:ç”¨æ¥è·å–ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯å½“å‰çš„è¯·æ±‚ä¹‹ç±»ã€‚</li><li><code>getPrincipal</code>æ–¹æ³•:ç”¨æ¥è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªç”¨æˆ·åï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ã€‚</li><li><code>isAuthenticated</code>æ–¹æ³•:å½“å‰ç”¨æˆ·æ˜¯å¦è®¤è¯æˆåŠŸã€‚</li></ul><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140456000.png" alt="image-20221114045647861"></p><p>ä¸åŒçš„è®¤è¯æ–¹å¼æœ‰ä¸åŒçš„<code>Authentication</code>å¯¹è±¡</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211140501798.png" alt="image-20221114050140666"></p><ul><li><code>AbstractAuthenticationToken</code>:è¯¥ç±»å®ç°äº†<code>Authentication</code>å’Œ <code>CredentialsContainer</code>ä¸¤ä¸ªæ¥å£,åœ¨<code>AbstractAuthenticationToken</code> ä¸­å¯¹<code>Authentication</code> æ¥å£å®šä¹‰çš„å„ä¸ªæ•°æ®è·å–æ–¹æ³•è¿›è¡Œäº†å®ç°ï¼Œ<code>CredentialsContainer</code>åˆ™æä¾›äº†ç™»å½•å‡­è¯æ“¦é™¤æ–¹æ³•ã€‚ä¸€èˆ¬åœ¨ç™»å½•æˆåŠŸåï¼Œä¸ºäº†é˜²æ­¢ç”¨æˆ·ä¿¡æ¯æ³„æ¼ï¼Œå¯ä»¥å°†ç™»å½•å‡­è¯ï¼ˆä¾‹å¦‚å¯†ç ï¼‰æ“¦é™¤ã€‚</li><li><code>RememberMeAuthenticationToken</code>:å¦‚æœç”¨æˆ·ä½¿ç”¨<code>RememberMe</code>çš„æ–¹å¼ç™»å½•ï¼Œç™»å½•ä¿¡æ¯å°†å°è£…åœ¨<code>RememberMeAuthenticationToken</code> ä¸­ã€‚</li><li><code>TestingAuthenticationToken</code>:å•å…ƒæµ‹è¯•æ—¶å°è£…çš„ç”¨æˆ·å¯¹è±¡ã€‚</li><li><code>AnonymousAuthenticationToken</code>:åŒ¿åç™»å½•æ—¶å°è£…çš„ç”¨æˆ·å¯¹è±¡ã€‚</li><li><code>RunAsUserToken</code>:æ›¿æ¢éªŒè¯èº«ä»½æ—¶å°è£…çš„ç”¨æˆ·å¯¹è±¡ã€‚</li><li><code>UsernamePasswordAuthenticationToken</code>:è¡¨å•ç™»å½•æ—¶å°è£…çš„ç”¨æˆ·å¯¹è±¡ã€‚</li><li><code>JaasAuthenticationToken</code>:<code>JAAS</code>è®¤è¯æ—¶å°è£…çš„ç”¨æˆ·å¯¹è±¡ã€‚</li><li><code>PreAuthenticatedAuthenticationToken</code>: <code>Pre-Authentication</code>åœºæ™¯ä¸‹å°è£…çš„ç”¨æˆ·å¯¹è±¡ã€‚</li></ul><p>åœ¨è¿™äº›<code>Authentication</code>çš„å®ä¾‹ä¸­ï¼Œæœ€å¸¸ç”¨çš„æœ‰ä¸¤ä¸ª:<code>UsernamePasswordAuthenticationToken</code>å’Œ<code>RememberMeAuthenticationToken</code>ã€‚åœ¨å‰é¢ä¸­çš„æ¡ˆä¾‹å¯¹åº”çš„ç”¨æˆ·è®¤è¯å¯¹è±¡å°±æ˜¯<code>UsernamePasswordAuthenticationToken</code>ã€‚<br>äº†è§£äº†<code>Authentication</code>å¯¹è±¡ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ç™»å½•æˆåŠŸåè·å–ç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼Œå³ <code>Authentication</code>å¯¹è±¡ã€‚</p><h3 id="ä¿®æ”¹SecurityContextHolderå­˜å‚¨çš„ä½ç½®"><a href="#ä¿®æ”¹SecurityContextHolderå­˜å‚¨çš„ä½ç½®" class="headerlink" title="ä¿®æ”¹SecurityContextHolderå­˜å‚¨çš„ä½ç½®"></a>ä¿®æ”¹SecurityContextHolderå­˜å‚¨çš„ä½ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userInfo</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">// è¿™ä¸ªå¯¹è±¡ç»‘å®šåœ¨ ThreadLocal</span></span><br><span class="line"><span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> authentication.getName();</span><br><span class="line">Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; authorities = authentication.getAuthorities();</span><br><span class="line">System.err.println(<span class="string">&quot;username: &quot;</span> + name);</span><br><span class="line">System.err.println(<span class="string">&quot;authorities: &quot;</span> + authorities);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆåœ¨ <code>SecurityContextHolder</code>ä¸­å­˜æ”¾çš„æ˜¯<code>SecurityContext</code>ï¼Œ<code>SecurityContextHolder</code> ä¸­å®šä¹‰äº†ä¸‰ç§ä¸åŒçš„æ•°æ®å­˜å‚¨ç­–ç•¥ï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸€ç§å…¸å‹çš„ç­–ç•¥æ¨¡å¼:<br>(1ï¼‰<code>MODE_THREADLOCAL</code>:è¿™ç§å­˜æ”¾ç­–ç•¥æ˜¯å°†<code>SecurityContext</code>å­˜æ”¾åœ¨<code>ThreadLocal</code>ä¸­ï¼Œå¤§å®¶çŸ¥é“<code>ThreadLocal</code>çš„ç‰¹ç‚¹æ˜¯åœ¨å“ªä¸ªçº¿ç¨‹ä¸­å­˜å‚¨å°±è¦åœ¨å“ªä¸ªçº¿ç¨‹ä¸­è¯»å–ï¼Œè¿™å…¶å®éå¸¸é€‚åˆWeb åº”ç”¨ï¼Œå› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè¯·æ±‚æ— è®ºç»è¿‡å¤šå°‘<code>Filter</code>åˆ°è¾¾ <code>Servlet</code>ï¼Œéƒ½æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†çš„ã€‚è¿™ä¹Ÿæ˜¯<code>SecurityContextHolder</code> çš„é»˜è®¤å­˜å‚¨ç­–ç•¥ï¼Œè¿™ç§å­˜å‚¨ç­–ç•¥æ„å‘³ç€å¦‚æœåœ¨å…·ä½“çš„ä¸šåŠ¡å¤„ç†ä»£ç ä¸­ï¼Œå¼€å¯äº†å­çº¿ç¨‹ï¼Œåœ¨å­çº¿ç¨‹ä¸­å»è·å–ç™»å½•ç”¨æˆ·æ•°æ®ï¼Œå°±ä¼šè·å–ä¸åˆ°ã€‚<br>(2)<code>MODE_INHERITABLETHREADLOCAL</code>:è¿™ç§å­˜å‚¨æ¨¡å¼é€‚ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒï¼Œå¦‚æœå¸Œæœ›åœ¨å­çº¿ç¨‹ä¸­ä¹Ÿèƒ½å¤Ÿè·å–åˆ°ç™»å½•ç”¨æˆ·æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨è¿™ç§å­˜å‚¨æ¨¡å¼ã€‚<br>(3ï¼‰<code>MODE_GLOBAL</code>:è¿™ç§å­˜å‚¨æ¨¡å¼å®é™…ä¸Šæ˜¯å°†æ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªé™æ€å˜é‡ä¸­ï¼Œåœ¨ <code>JavaWeb</code>å¼€å‘ä¸­ï¼Œè¿™ç§æ¨¡å¼å¾ˆå°‘ä½¿ç”¨åˆ°ã€‚</p><p><code>Spring Security</code> ä¸­å®šä¹‰äº†<code>SecurityContextHolderStrategy</code>æ¥å£ç”¨æ¥è§„èŒƒå­˜å‚¨ç­–ç•¥ä¸­çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SecurityContextHolderStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤å½“å‰ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">clearContext</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å½“å‰ä¸Šä¸‹æ–‡</span></span><br><span class="line">SecurityContext <span class="title function_">getContext</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å½“å‰ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setContext</span><span class="params">(SecurityContext context)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„, ç©ºçš„ä¸Šä¸‹æ–‡å®ç°, ä¾›SecurityContextRepositoryå®ç°åœ¨é¦–æ¬¡åˆ›å»ºæ–°ä¸Šä¸‹æ–‡æ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line">SecurityContext <span class="title function_">createEmptyContext</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ‰4ä¸ªå®ç°ç±»</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211141500812.png" alt="image-20221114150030634"></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211141503475.png" alt="image-20221114150301372"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalSecurityContextHolderStrategy</span> <span class="keyword">implements</span> <span class="title class_">SecurityContextHolderStrategy</span> &#123;</span><br><span class="line"><span class="comment">// å­˜å‚¨çŠ¶æ€, æ›´çº¿ç¨‹ç»‘å®š</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;SecurityContext&gt; contextHolder = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clearContext</span><span class="params">()</span> &#123;</span><br><span class="line">contextHolder.remove();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> SecurityContext <span class="title function_">getContext</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SecurityContext</span> <span class="variable">ctx</span> <span class="operator">=</span> contextHolder.get();</span><br><span class="line"><span class="keyword">if</span> (ctx == <span class="literal">null</span>) &#123;</span><br><span class="line">ctx = createEmptyContext();</span><br><span class="line">contextHolder.set(ctx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ctx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContext</span><span class="params">(SecurityContext context)</span> &#123;</span><br><span class="line">Assert.notNull(context, <span class="string">&quot;Only non-null SecurityContext instances are permitted&quot;</span>);</span><br><span class="line">contextHolder.set(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> SecurityContext <span class="title function_">createEmptyContext</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SecurityContextImpl</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›éƒ½æ˜¯éå¸¸ç®€å•çš„ä»£ç , å°±ä¸ä»‹ç»äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">InheritableThreadLocalSecurityContextHolderStrategy</span> <span class="keyword">implements</span> <span class="title class_">SecurityContextHolderStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;SecurityContext&gt; contextHolder = <span class="keyword">new</span> <span class="title class_">InheritableThreadLocal</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·Ÿä¸Šé¢å”¯ä¸€çš„åŒºåˆ«åœ¨äº <code>ThreadLocal</code>å’Œ<code>InheritableThreadLocal</code></p><p><code>InheritableThreadLocal</code>éå¸¸ç®€å•</p><p>è¯¥å¯¹è±¡æ‰©å±•äº† <code>ThreadLocal</code>, æä¾›äº†ä»çˆ¶çº¿ç¨‹åˆ°å­çº¿ç¨‹çš„å€¼ç»§æ‰¿</p><p>å½“å­çº¿ç¨‹è¢«åˆ›å»º, æ­¤æ—¶å­çº¿ç¨‹å°†ä¼šè·å¾—æ‰€æœ‰å¹¶åˆå§‹åŒ–ç»§æ‰¿çš„çˆ¶çº¿ç¨‹æœ‰çš„ThreadLocalå˜é‡çš„å€¼</p><p>é€šå¸¸, å­çº¿ç¨‹çš„å€¼å°†ä¼šå’Œçˆ¶çº¿ç¨‹ç›¸åŒ, ç„¶è€Œ, å­çº¿ç¨‹çš„å€¼å¯ä»¥é€šè¿‡é‡å†™åœ¨ç±»ä¸­çš„childValueå‡½æ•°å˜æˆçˆ¶ç±»çš„ä»»æ„æ–¹æ³•</p><p>å½“å˜é‡ä¸­ç»´æŠ¤çš„æ¯çº¿ç¨‹å±æ€§ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·IDï¼Œäº‹åŠ¡IDï¼‰å¿…é¡»è‡ªåŠ¨ä¼ è¾“åˆ°åˆ›å»ºçš„ä»»ä½•å­çº¿ç¨‹æ—¶ï¼Œå¯ç»§æ‰¿çš„çº¿ç¨‹å±€éƒ¨å˜é‡ä¼˜å…ˆäºæ™®é€šçº¿ç¨‹å±€éƒ¨å˜é‡ã€‚<br>æ³¨æ„ï¼šåœ¨åˆ›å»ºæ–°çº¿ç¨‹æœŸé—´ï¼Œå¯ä»¥é€‰æ‹©ä¸æ¥æ”¶å¯ç»§æ‰¿çº¿ç¨‹å±€éƒ¨å˜é‡çš„åˆå§‹å€¼ã€‚</p><p>æœ€å</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211150114152.png" alt="image-20221115011402986"></p><p>å°±æ›´ç®€å•äº†, ç›´æ¥ä½¿ç”¨ä¸€ä¸ªé™æ€å˜é‡è®©å¤šçº¿ç¨‹å…±äº«ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityContextHolder</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MODE_THREADLOCAL</span> <span class="operator">=</span> <span class="string">&quot;MODE_THREADLOCAL&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MODE_INHERITABLETHREADLOCAL</span> <span class="operator">=</span> <span class="string">&quot;MODE_INHERITABLETHREADLOCAL&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MODE_GLOBAL</span> <span class="operator">=</span> <span class="string">&quot;MODE_GLOBAL&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MODE_PRE_INITIALIZED</span> <span class="operator">=</span> <span class="string">&quot;MODE_PRE_INITIALIZED&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SYSTEM_PROPERTY</span> <span class="operator">=</span> <span class="string">&quot;spring.security.strategy&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">strategyName</span> <span class="operator">=</span> System.getProperty(SYSTEM_PROPERTY);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> SecurityContextHolderStrategy strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">initializeCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">initialize();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">()</span> &#123;</span><br><span class="line">initializeStrategy();</span><br><span class="line">initializeCount++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initializeStrategy</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (MODE_PRE_INITIALIZED.equals(strategyName)) &#123;</span><br><span class="line">Assert.state(strategy != <span class="literal">null</span>, <span class="string">&quot;When using &quot;</span> + MODE_PRE_INITIALIZED</span><br><span class="line">+ <span class="string">&quot;, setContextHolderStrategy must be called with the fully constructed strategy&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!StringUtils.hasText(strategyName)) &#123;</span><br><span class="line"><span class="comment">// Set default</span></span><br><span class="line">strategyName = MODE_THREADLOCAL;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (strategyName.equals(MODE_THREADLOCAL)) &#123;</span><br><span class="line">strategy = <span class="keyword">new</span> <span class="title class_">ThreadLocalSecurityContextHolderStrategy</span>();</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (strategyName.equals(MODE_INHERITABLETHREADLOCAL)) &#123;</span><br><span class="line">strategy = <span class="keyword">new</span> <span class="title class_">InheritableThreadLocalSecurityContextHolderStrategy</span>();</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (strategyName.equals(MODE_GLOBAL)) &#123;</span><br><span class="line">strategy = <span class="keyword">new</span> <span class="title class_">GlobalSecurityContextHolderStrategy</span>();</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Try to load a custom strategy</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Class&lt;?&gt; clazz = Class.forName(strategyName);</span><br><span class="line">Constructor&lt;?&gt; customStrategy = clazz.getConstructor();</span><br><span class="line">strategy = (SecurityContextHolderStrategy) customStrategy.newInstance();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">ReflectionUtils.handleReflectionException(ex);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clearContext</span><span class="params">()</span> &#123;</span><br><span class="line">strategy.clearContext();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> SecurityContext <span class="title function_">getContext</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> strategy.getContext();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getInitializeCount</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> initializeCount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setContext</span><span class="params">(SecurityContext context)</span> &#123;</span><br><span class="line">strategy.setContext(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setStrategyName</span><span class="params">(String strategyName)</span> &#123;</span><br><span class="line">SecurityContextHolder.strategyName = strategyName;</span><br><span class="line">initialize();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setContextHolderStrategy</span><span class="params">(SecurityContextHolderStrategy strategy)</span> &#123;</span><br><span class="line">Assert.notNull(strategy, <span class="string">&quot;securityContextHolderStrategy cannot be null&quot;</span>);</span><br><span class="line">SecurityContextHolder.strategyName = MODE_PRE_INITIALIZED;</span><br><span class="line">SecurityContextHolder.strategy = strategy;</span><br><span class="line">initialize();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> SecurityContextHolderStrategy <span class="title function_">getContextHolderStrategy</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> strategy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> SecurityContext <span class="title function_">createEmptyContext</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> strategy.createEmptyContext();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;SecurityContextHolder[strategy=&#x27;&quot;</span> + strategy.getClass().getSimpleName() + <span class="string">&quot;&#x27;; initializeCount=&quot;</span></span><br><span class="line">+ initializeCount + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è¿™æ®µæºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<code>SecurityContextHolder</code>å®šä¹‰äº†ä¸‰ä¸ªé™æ€å¸¸é‡ç”¨æ¥æè¿°ä¸‰ç§ä¸åŒçš„å­˜å‚¨ç­–ç•¥;å­˜å‚¨ç­–ç•¥<code>strategy</code> ä¼šåœ¨é™æ€ä»£ç å—ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œæ ¹æ®ä¸åŒçš„<code>strategyName</code>åˆå§‹åŒ–ä¸åŒçš„å­˜å‚¨ç­–ç•¥; <code>strategyName</code>å˜é‡è¡¨ç¤ºç›®å‰æ­£åœ¨ä½¿ç”¨çš„å­˜å‚¨ç­–ç•¥ï¼Œ<strong>å¼€å‘è€…å¯ä»¥é€šè¿‡é…ç½®ç³»ç»Ÿå˜é‡æˆ–è€…è°ƒç”¨<code>setStrategyName</code>æ¥ä¿®æ”¹<code>SecurityContextHolder</code> ä¸­çš„å­˜å‚¨ç­–ç•¥</strong>ï¼Œè°ƒç”¨<code>setStrategyName</code>åä¼šé‡æ–°åˆå§‹åŒ– <code>strategy</code>ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå¼€å‘è€…è¯•å›¾ä»å­çº¿ç¨‹ä¸­è·å–å½“å‰ç™»å½•ç”¨æˆ·æ•°æ®ï¼Œå°±ä¼šè·å–å¤±è´¥ï¼Œä»£ç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userInfo</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">// è¿™ä¸ªå¯¹è±¡ç»‘å®šåœ¨ ThreadLocal</span></span><br><span class="line"><span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> authentication.getName();</span><br><span class="line">Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; authorities = authentication.getAuthorities();</span><br><span class="line">System.err.println(<span class="string">&quot;ä¸»çº¿ç¨‹: username = &quot;</span> + name);</span><br><span class="line">System.err.println(<span class="string">&quot;ä¸»çº¿ç¨‹: authorities = &quot;</span> + authorities);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line"><span class="type">Authentication</span> <span class="variable">authentication1</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line"><span class="keyword">if</span> (authentication1 == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(Thread.currentThread().getName() + <span class="string">&quot;: è·å¾—ç”¨æˆ·ä¿¡æ¯å¤±è´¥&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">String</span> <span class="variable">name1</span> <span class="operator">=</span> authentication1.getName();</span><br><span class="line">Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; authorities1 = authentication.getAuthorities();</span><br><span class="line">System.err.println(Thread.currentThread().getName() + <span class="string">&quot;: username: &quot;</span> + name1);</span><br><span class="line">System.err.println(Thread.currentThread().getName() + <span class="string">&quot;: authorities: &quot;</span> + authorities1);</span><br><span class="line">&#125;, <span class="string">&quot;å­çº¿ç¨‹&quot;</span>).start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¸»çº¿ç¨‹: username = user</span><br><span class="line">ä¸»çº¿ç¨‹: authorities = []</span><br><span class="line">å­çº¿ç¨‹: è·å¾—ç”¨æˆ·ä¿¡æ¯å¤±è´¥</span><br></pre></td></tr></table></figure><p>è®¾ç½®å¤šçº¿ç¨‹ThreadLocalç»§æ‰¿ç­–ç•¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FormLoginApplication</span> &#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      System.setProperty(SecurityContextHolder.SYSTEM_PROPERTY, SecurityContextHolder.MODE_INHERITABLETHREADLOCAL); <span class="comment">// è®¾ç½® SecurityContextHolder æ¨¡å¼</span></span><br><span class="line">      SpringApplication.run(FormLoginApplication.class, args);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211150126252.png" alt="image-20221115012656176"></p><h3 id="SecurityContextPersistenceFilter-å·²å¼ƒç”¨"><a href="#SecurityContextPersistenceFilter-å·²å¼ƒç”¨" class="headerlink" title="SecurityContextPersistenceFilter(å·²å¼ƒç”¨)"></a>SecurityContextPersistenceFilter(å·²å¼ƒç”¨)</h3><p>ä½¿ç”¨åœ¨è¯·æ±‚ä¹‹å‰æ‰€é…ç½®çš„<code>SecurityContextRepository</code>è·å–çš„ä¿¡æ¯å»å¡«å……<code>SecurityContextHolder</code></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211150210196.png" alt="image-20221115021029092"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SecurityContextRepository</span> &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// å·²è¢«å¼ƒç”¨, ä½¿ç”¨ä¸‹é¢çš„é‚£ä¸ªdefault Supplier&lt;SecurityContext&gt; loadContext(HttpServletRequest request)</span></span><br><span class="line">   <span class="meta">@Deprecated</span></span><br><span class="line">   SecurityContext <span class="title function_">loadContext</span><span class="params">(HttpRequestResponseHolder requestResponseHolder)</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">default</span> Supplier&lt;SecurityContext&gt; <span class="title function_">loadContext</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> SingletonSupplier.of(() -&gt; loadContext(<span class="keyword">new</span> <span class="title class_">HttpRequestResponseHolder</span>(request, <span class="literal">null</span>)));</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">saveContext</span><span class="params">(SecurityContext context, HttpServletRequest request, HttpServletResponse response)</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="type">boolean</span> <span class="title function_">containsContext</span><span class="params">(HttpServletRequest request)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é»˜è®¤å®ƒä½¿ç”¨<code>HttpSessionSecurityContextRepository </code>, æœ‰å…³ <code>HttpSession</code> ç›¸å…³é…ç½®é€‰é¡¹çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…æ­¤ç±»ã€‚</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211150204707.png" alt="image-20221115020400589"></p><p>è¯¥è¿‡æ»¤å™¨åªä¼šåœ¨æ¯ä¸€ä¸ª<code>request</code>è¯·æ±‚æ‰§è¡Œä¸€æ¬¡, ä»¥è§£æ<code>servlet</code>å®¹å™¨ï¼ˆç‰¹åˆ«æ˜¯ <code>Weblogic</code>ï¼‰çš„å…¼å®¹é—®é¢˜</p><p>è¿‡æ»¤å™¨å¿…é¡»åœ¨ä»»ä½•è®¤è¯å¤„ç†æœºåˆ¶å‰æ‰§è¡Œ</p><p>è®¤è¯å¤„ç†æœºåˆ¶(ä¾‹å¦‚: Basic, cas å¤„ç†è¿‡æ»¤å™¨ç­‰)æœŸæœ›<code>SecurityContextHolder</code>åœ¨ä»–ä»¬æ‰§è¡Œæ—¶åŒ…å«æœ‰æ•ˆçš„<code>SecurityContext</code></p><p>è¿™æœ¬è´¨ä¸Šæ˜¯å°±<code>HttpSessionContextIntegrationFilter</code> çš„é‡æ„è¿‡ç¨‹, ä»¥å§”æ‰˜å­˜å‚¨é—®é¢˜ç»™å•ç‹¬çš„ç­–ç•¥, ä»è€Œå…è®¸åœ¨è¯·æ±‚ä¹‹é—´ç»´æŠ¤å®‰å…¨ä¸Šä¸‹æ–‡æ–¹å¼è¿›è¡Œæ›´å¤šçš„è‡ªå®šä¹‰</p><p><code>forceEagerSessionCreation</code> å±æ€§å°†è¢«ç”¨äºç¡®ä¿<code>session</code>æ€»æ˜¯åœ¨è¿‡æ»¤å™¨é“¾æ‰§è¡Œä¹‹å‰å¯ç”¨(é»˜è®¤æ˜¯<code>false</code>, ä»–æ˜¯ä¸æ¨è ä¸”å¯†é›†çš„èµ„æº)</p><p>è¯¥ç±»å·²å¼ƒç”¨, ç°åœ¨ä½¿ç”¨<code>SecurityContextHolderFilter</code></p><p>æ•´ä½“ä¸Šæ¥è¯´ï¼Œ<code>SecurityContextPersistenceFilter</code>ä¸»è¦åšä¸¤ä»¶äº‹æƒ…: </p><ul><li><p>å½“ä¸€ä¸ªè¯·æ±‚åˆ°æ¥æ—¶ï¼Œä»<code>HttpSession</code>ä¸­è·å–<code>SecurityContext</code>å¹¶å­˜å…¥<code>SecurityContextHolder</code>ä¸­ï¼Œè¿™æ ·åœ¨åŒä¸€ä¸ªè¯·æ±‚çš„åç»­å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå¼€å‘è€…å§‹ç»ˆå¯ä»¥é€šè¿‡<code>SecurityContextHolder</code>è·å–åˆ°å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ã€‚</p></li><li><p>å½“ä¸€ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•æ—¶ï¼Œä» <code>SecurityContextHolder</code> ä¸­è·å– <code>SecurityContext</code>å¹¶å­˜å…¥<code>HttpSession</code>ä¸­ï¼ˆä¸»è¦é’ˆå¯¹å¼‚æ­¥<code>Servlet</code>ï¼‰ï¼Œæ–¹ä¾¿ä¸‹ä¸€ä¸ªè¯·æ±‚åˆ°æ¥æ—¶ï¼Œå†ä»<code>HttpSession</code>ä¸­æ‹¿å‡ºæ¥ä½¿ç”¨ï¼ŒåŒæ—¶æ“¦é™¤<code>SecurityContextHolder</code> ä¸­çš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ã€‚</p><blockquote><p>åœ¨<code>SecurityContextPersistenceFilter</code>è¿‡æ»¤å™¨ä¸­ï¼Œå½“ä¸€ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•æ—¶ï¼Œä»<code>SecurityContextHolder</code>ä¸­è·å–<code>SecurityContext</code> å­˜å…¥<code>HtpSession</code>ä¸­,è¿™ä¸€æ­¥çš„æ“ä½œä¸»è¦æ˜¯é’ˆå¯¹å¼‚æ­¥<code>Servlet</code>ã€‚å¦‚æœä¸æ˜¯å¼‚æ­¥<code>Servlet</code>,åœ¨å“åº”æäº¤æ—¶,å°±ä¼šå°†<code>SecurityContext</code>ä¿å­˜åˆ°<code>HtpSession</code>ä¸­äº†ï¼Œè€Œä¸ä¼šç­‰åˆ°åœ¨<code>SecurityContextPersistenceFilter</code>è¿‡æ»¤å™¨ä¸­å†å»å­˜å‚¨ã€‚</p></blockquote></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityContextPersistenceFilter</span> <span class="keyword">extends</span> <span class="title class_">GenericFilterBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILTER_APPLIED</span> <span class="operator">=</span> <span class="string">&quot;__spring_security_scpf_applied&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> SecurityContextRepository repo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">forceEagerSessionCreation</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">SecurityContextPersistenceFilter</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">this</span>(<span class="keyword">new</span> <span class="title class_">HttpSessionSecurityContextRepository</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">SecurityContextPersistenceFilter</span><span class="params">(SecurityContextRepository repo)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.repo = repo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span><br><span class="line"><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">doFilter((HttpServletRequest) request, (HttpServletResponse) response, chain);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain)</span></span><br><span class="line"><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"><span class="comment">// ensure that filter is only applied once per request</span></span><br><span class="line"><span class="keyword">if</span> (request.getAttribute(FILTER_APPLIED) != <span class="literal">null</span>) &#123;</span><br><span class="line">chain.doFilter(request, response);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">request.setAttribute(FILTER_APPLIED, Boolean.TRUE);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.forceEagerSessionCreation) &#123;</span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.logger.isDebugEnabled() &amp;&amp; session.isNew()) &#123;</span><br><span class="line"><span class="built_in">this</span>.logger.debug(LogMessage.format(<span class="string">&quot;Created session %s eagerly&quot;</span>, session.getId()));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">HttpRequestResponseHolder</span> <span class="variable">holder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpRequestResponseHolder</span>(request, response);</span><br><span class="line"><span class="type">SecurityContext</span> <span class="variable">contextBeforeChainExecution</span> <span class="operator">=</span> <span class="built_in">this</span>.repo.loadContext(holder);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">SecurityContextHolder.setContext(contextBeforeChainExecution);</span><br><span class="line"><span class="keyword">if</span> (contextBeforeChainExecution.getAuthentication() == <span class="literal">null</span>) &#123;</span><br><span class="line">logger.debug(<span class="string">&quot;Set SecurityContextHolder to empty SecurityContext&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.logger.isDebugEnabled()) &#123;</span><br><span class="line"><span class="built_in">this</span>.logger</span><br><span class="line">.debug(LogMessage.format(<span class="string">&quot;Set SecurityContextHolder to %s&quot;</span>, contextBeforeChainExecution));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">chain.doFilter(holder.getRequest(), holder.getResponse());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="type">SecurityContext</span> <span class="variable">contextAfterChainExecution</span> <span class="operator">=</span> SecurityContextHolder.getContext();</span><br><span class="line"><span class="comment">// Crucial removal of SecurityContextHolder contents before anything else.</span></span><br><span class="line">SecurityContextHolder.clearContext();</span><br><span class="line"><span class="built_in">this</span>.repo.saveContext(contextAfterChainExecution, holder.getRequest(), holder.getResponse());</span><br><span class="line">request.removeAttribute(FILTER_APPLIED);</span><br><span class="line"><span class="built_in">this</span>.logger.debug(<span class="string">&quot;Cleared SecurityContextHolder to complete request&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setForceEagerSessionCreation</span><span class="params">(<span class="type">boolean</span> forceEagerSessionCreation)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.forceEagerSessionCreation = forceEagerSessionCreation;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½†è¯¥ç±»å·²è¢«å¼ƒç”¨, ç°åœ¨ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityContextHolderFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> SecurityContextRepository securityContextRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> shouldNotFilterErrorDispatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a new instance.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> securityContextRepository the repository to use. Cannot be null.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">SecurityContextHolderFilter</span><span class="params">(SecurityContextRepository securityContextRepository)</span> &#123;</span><br><span class="line">Assert.notNull(securityContextRepository, <span class="string">&quot;securityContextRepository cannot be null&quot;</span>);</span><br><span class="line"><span class="built_in">this</span>.securityContextRepository = securityContextRepository;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span></span><br><span class="line"><span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// è¯»å–SecurityContext</span></span><br><span class="line"><span class="type">SecurityContext</span> <span class="variable">securityContext</span> <span class="operator">=</span> <span class="built_in">this</span>.securityContextRepository.loadContext(request).get();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å­˜å‚¨åˆ° SecurityContextHolder</span></span><br><span class="line">SecurityContextHolder.setContext(securityContext);</span><br><span class="line">filterChain.doFilter(request, response);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">finally</span> &#123;</span><br><span class="line">SecurityContextHolder.clearContext();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">shouldNotFilterErrorDispatch</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.shouldNotFilterErrorDispatch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setShouldNotFilterErrorDispatch</span><span class="params">(<span class="type">boolean</span> shouldNotFilterErrorDispatch)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.shouldNotFilterErrorDispatch = shouldNotFilterErrorDispatch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»–ä»¬æœ‰ä¸ªé€šç”¨çš„å±æ€§: <code>SecurityContextRepository</code> </p><p>è¯¥å±æ€§å‰é¢ä¹Ÿçœ‹è¿‡äº†, ä¸»è¦ä½¿ç”¨ <code>HttpSessionSecurityContextRepository </code>ä½œä¸ºå®ç°ç±»å®ä½“ç”¨äºå¢åˆ æ”¹æŸ¥<code>SecurityContext</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveContext</span><span class="params">(SecurityContext context, HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">SaveContextOnUpdateOrErrorResponseWrapper</span> <span class="variable">responseWrapper</span> <span class="operator">=</span> WebUtils.getNativeResponse(response,</span><br><span class="line">                                                                                           SaveContextOnUpdateOrErrorResponseWrapper.class);</span><br><span class="line">    <span class="keyword">if</span> (responseWrapper == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// è·å¾—session</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">httpSessionExists</span> <span class="operator">=</span> request.getSession(<span class="literal">false</span>) != <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// åˆ›å»ºSecurityContext</span></span><br><span class="line">        <span class="type">SecurityContext</span> <span class="variable">initialContext</span> <span class="operator">=</span> SecurityContextHolder.createEmptyContext();</span><br><span class="line">        <span class="comment">// åˆ›å»ºå­˜å‚¨å®¹å™¨ å…¶æœ¬è´¨æ˜¯ä¸€ä¸ªHttpServletResponse</span></span><br><span class="line">        responseWrapper = <span class="keyword">new</span> <span class="title class_">SaveToSessionResponseWrapper</span>(response, request, httpSessionExists, initialContext);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å­˜å‚¨ SecurityContext ä¸‹é¢æœ‰ä»£ç æˆªå›¾</span></span><br><span class="line">    responseWrapper.saveContext(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211150953686.png" alt="image-20221115095326549"></p><p>å¦‚æœæ‹¿ä¸åˆ°<code>authentication</code> åˆ™åˆ é™¤æ‰httpsessionä¸­çš„<code>authentication</code></p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211150952064.png" alt="image-20221115095204890"></p><p>å¦‚æœ<code>authentication</code>å’Œ<code>httpSession</code>éƒ½ä¸æ˜¯ç©ºçš„, å°±ä¿å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">httpSession.setAttribute(springSecurityContextKey, context);</span><br></pre></td></tr></table></figure><p>ä¿å­˜åˆ° key &#x3D; <img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211150955845.png" alt="image-20221115095542749"></p><p>çš„sessionä¸­</p><blockquote><p>å…¶ä»–æºç å°±ä¸çœ‹äº†, åŸºæœ¬ä¸Šéƒ½æ˜¯å¯¹<code>httpSession</code>çš„æ“ä½œ</p></blockquote><h2 id="ä»å½“å‰è¯·æ±‚å¯¹è±¡ä¸­è·å–"><a href="#ä»å½“å‰è¯·æ±‚å¯¹è±¡ä¸­è·å–" class="headerlink" title="ä»å½“å‰è¯·æ±‚å¯¹è±¡ä¸­è·å–"></a>ä»å½“å‰è¯·æ±‚å¯¹è±¡ä¸­è·å–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;authentication&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Authentication <span class="title function_">authentication</span><span class="params">(Authentication authentication)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> authentication;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;principal&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Principal <span class="title function_">principal</span><span class="params">(Principal principal)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> principal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤éƒ½æ˜¯ä¸€ä¸ªçš„JSON:<br><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151011543.png" alt="image-20221115101135403"></p><p>å­¦è¿‡springMVCéƒ½åº”è¯¥çŸ¥é“, <code>Controller</code>æ–¹æ³•çš„å‚æ•°éƒ½æ˜¯ç”±<code>HttpServletRequest</code>è¯·æ±‚æ‹¿å‡ºæ¥çš„</p><p>é‚£ä»–æ˜¯ä»€ä¹ˆæ—¶å€™å­˜å‚¨åˆ°<code>HttpServletRequest</code>çš„?</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151020042.png" alt="image-20221115102021918"></p><p>çœ‹ä¸Šé¢è¿™ä¸‰ä¸ªå‡½æ•° æ‰¾åˆ°è¿™ä¸‰ä¸ªå‡½æ•°çš„ spring securityå®ç°:</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151022808.png" alt="image-20221115102248679"></p><p>å†çœ‹è¿™ä¸‰ä¸ªå‡½æ•°:</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151026078.png" alt="image-20221115102646943"></p><p>æ‰¾ SpringSecurityçš„å®ç°ç±»<code>HttpServlet3RequestFactory</code>çš„å†…éƒ¨ç±»<code>Servlet3SecurityContextHolderAwareRequestWrapper</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">   <span class="keyword">if</span> (isAuthenticated()) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(<span class="string">&quot;Cannot perform login for &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; already authenticated as &#x27;&quot;</span></span><br><span class="line">            + getRemoteUser() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">AuthenticationManager</span> <span class="variable">authManager</span> <span class="operator">=</span> HttpServlet3RequestFactory.<span class="built_in">this</span>.authenticationManager;</span><br><span class="line">   <span class="keyword">if</span> (authManager == <span class="literal">null</span>) &#123;</span><br><span class="line">      HttpServlet3RequestFactory.<span class="built_in">this</span>.logger.debug(</span><br><span class="line">            <span class="string">&quot;authenticationManager is null, so allowing original HttpServletRequest to handle login&quot;</span>);</span><br><span class="line">      <span class="built_in">super</span>.login(username, password);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> getAuthentication(authManager, username, password);</span><br><span class="line">   <span class="type">SecurityContext</span> <span class="variable">context</span> <span class="operator">=</span> SecurityContextHolder.createEmptyContext();</span><br><span class="line">   context.setAuthentication(authentication);</span><br><span class="line">   SecurityContextHolder.setContext(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Authentication <span class="title function_">getAuthentication</span><span class="params">(AuthenticationManager authManager, String username, String password)</span></span><br><span class="line">      <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authentication</span> <span class="operator">=</span> UsernamePasswordAuthenticationToken</span><br><span class="line">            .unauthenticated(username, password);</span><br><span class="line">      <span class="type">Object</span> <span class="variable">details</span> <span class="operator">=</span> HttpServlet3RequestFactory.<span class="built_in">this</span>.authenticationDetailsSource.buildDetails(<span class="built_in">this</span>);</span><br><span class="line">      authentication.setDetails(details);</span><br><span class="line">      <span class="keyword">return</span> authManager.authenticate(authentication);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (AuthenticationException ex) &#123;</span><br><span class="line">      SecurityContextHolder.clearContext();</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(ex.getMessage(), ex);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å°±çŸ¥é“æ€ä¹ˆä½¿ç”¨ HttpServletRequest äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;information&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">information</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">   <span class="type">Principal</span> <span class="variable">userPrincipal</span> <span class="operator">=</span> request.getUserPrincipal();</span><br><span class="line">   <span class="type">String</span> <span class="variable">remoteUser</span> <span class="operator">=</span> request.getRemoteUser();</span><br><span class="line">   <span class="type">boolean</span> <span class="variable">admin</span> <span class="operator">=</span> request.isUserInRole(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">   List&lt;Object&gt; objectList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">   objectList.add(userPrincipal);</span><br><span class="line">   objectList.add(remoteUser);</span><br><span class="line">   objectList.add(admin);</span><br><span class="line">   <span class="keyword">return</span> objectMapper.writeValueAsString(objectList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151040399.png" alt="image-20221115104022282"></p><p>å‰é¢æˆ‘ä»¬ç›´æ¥å°†<code>Authentication</code>æˆ–è€…<code>Principal</code> å†™åˆ°<code>Controller</code>å‚æ•°ä¸­ï¼Œå®é™…ä¸Šå°±æ˜¯<code>SpringMVC</code>æ¡†æ¶ä»<code>Servlet3SecurityContextHolderAwareRequestWrapper</code> ä¸­æå–çš„ç”¨æˆ·ä¿¡æ¯ã€‚<br>é‚£ä¹ˆ<code>Spring Security</code>æ˜¯å¦‚ä½•å°†é»˜è®¤çš„è¯·æ±‚å¯¹è±¡è½¬åŒ–ä¸º<code>Servlet3SecurityContextHolderAwareRequestWrapper</code> çš„å‘¢?è¿™å°±æ¶‰åŠ<code>Spring Security</code>è¿‡æ»¤å™¨é“¾ä¸­å¦å¤–ä¸€ä¸ªé‡è¦çš„è¿‡æ»¤å™¨â€”â€”<code>SecurityContextHolderAwareRequestFilter</code>ã€‚<br>å‰é¢æˆ‘ä»¬æåˆ°<code>Spring Security</code>è¿‡æ»¤å™¨ä¸­ï¼Œæœ‰ä¸€ä¸ª<code>SecurityContextHolderAwareRequestFilter</code>è¿‡æ»¤å™¨ï¼Œè¯¥è¿‡æ»¤å™¨çš„ä¸»è¦ä½œç”¨å°±æ˜¯å¯¹<code>HttpServletRequest</code>è¯·æ±‚è¿›è¡Œå†åŒ…è£…ï¼Œé‡å†™<code>HtpServletRequest</code> ä¸­å’Œå®‰å…¨ç®¡ç†ç›¸å…³çš„æ–¹æ³•ã€‚<code>HtpServletRequest</code> åœ¨æ•´ä¸ªè¯·æ±‚è¿‡ç¨‹ä¸­ä¼šè¢«åŒ…è£…å¤šæ¬¡ï¼Œæ¯ä¸€æ¬¡çš„åŒ…è£…éƒ½ä¼šç»™å®ƒå¢æ·»æ–°çš„åŠŸèƒ½ï¼Œä¾‹å¦‚åœ¨ç»è¿‡ <code>SecurityContextPersistenceFilter</code>è¯·æ±‚æ—¶å°±ä¼šå¯¹å®ƒè¿›è¡ŒåŒ…è£…ã€‚</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151044214.png" alt="image-20221115104459115"></p><p>æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151047995.png" alt="image-20221115104708878"></p><p><code>requestFactory</code>è¿™ä¸ªå¯¹è±¡åœ¨è¿™é‡Œè¢«è¢«åˆ›å»º</p><p><img src="https://jsd.cdn.zzko.cn/gh/bangiao/blog_images@main/blog/202211151048208.png" alt="image-20221115104857077"></p><p>è·Ÿè¿›<code>HttpServlet3RequestFactory</code>ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> HttpServletRequest <span class="title function_">create</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Servlet3SecurityContextHolderAwareRequestWrapper</span>(request, <span class="built_in">this</span>.rolePrefix, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>Servlet3SecurityContextHolderAwareRequestWrapper</code>ç±»å†æ¬¡è§åˆ°äº†</p><p>æœ€ç»ˆåœ¨<code>Spring MVC</code> çš„<code>ServletRequestMethodArgumentResolver#resolveArgument(Class&lt;?&gt;,HttpServletRequest)</code>æ–¹æ³•ä¸­è¿›è¡Œé»˜è®¤å‚æ•°è§£æï¼Œè‡ªåŠ¨è§£æå‡º <code>Principal</code>å¯¹è±¡ã€‚å¼€å‘è€…åœ¨<code>Controller</code>ä¸­æ—¢å¯ä»¥é€šè¿‡ <code>Principal</code>æ¥æ¥æ”¶å‚æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>Authentication</code>å¯¹è±¡æ¥æ¥æ”¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¿‡æ»¤å™¨ </tag>
            
            <tag> è®¤è¯ </tag>
            
            <tag> ç™»å½• </tag>
            
            <tag> è§’è‰² </tag>
            
            <tag> SpringSecurity </tag>
            
            <tag> æºç åˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>04XMLç‰¹æ®Šå­—ç¬¦å¤„ç†æ–¹å¼</title>
      <link href="/2022/11/11/03ORM/04XML%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F/"/>
      <url>/2022/11/11/03ORM/04XML%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="1-é—®é¢˜è¯´æ˜"><a href="#1-é—®é¢˜è¯´æ˜" class="headerlink" title="1. é—®é¢˜è¯´æ˜"></a>1. é—®é¢˜è¯´æ˜</h3><p>å¹³æ—¶æˆ‘ä»¬åœ¨é¡¹ç›®æ–‡ä»¶çš„é…ç½®æˆ–è€…ç”¨xmlè¿›è¡Œæ•°æ®çš„å­˜å‚¨æˆ–ä¼ è¾“æ—¶ï¼Œä¼šé‡åˆ°ä¸èƒ½ç”¨ä¸€äº›ç‰¹æ®Šç¬¦å·çš„é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘åœ¨ä¹‹å‰å­¦ä¹ c3p0çš„æ—¶å€™ï¼Œç¼–è¾‘<code>c3p0-config.xml</code>ä¸­çš„<code>jdbcUrl</code>å±æ€§ï¼š<code>jdbc:mysql://localhost:3306/mydb?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</code></p><p>ä¸¥æ ¼åœ°è®²ï¼Œåœ¨ XML ä¸­ä»…æœ‰å­—ç¬¦ â€œ&lt;â€å’Œâ€&amp;â€ æ˜¯éæ³•çš„ã€‚çœç•¥å·ã€å¼•å·å’Œå¤§äºå·æ˜¯åˆæ³•çš„ã€‚è¿™æ—¶ï¼Œxmlæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆæ¥å¤„ç†è¿™ç§é—®é¢˜ã€‚</p><p>â‘ CDATA</p><p>â‘¡è½¬ä¹‰å­—ç¬¦</p><h3 id="2-æ–¹æ³•è¯¦è§£"><a href="#2-æ–¹æ³•è¯¦è§£" class="headerlink" title="2. æ–¹æ³•è¯¦è§£"></a>2. æ–¹æ³•è¯¦è§£</h3><h4 id="1-CDATA"><a href="#1-CDATA" class="headerlink" title="1. CDATA"></a>1. CDATA</h4><p>CDATA æŒ‡çš„æ˜¯ä¸åº”ç”± XML è§£æå™¨è¿›è¡Œè§£æçš„æ–‡æœ¬æ•°æ®ï¼Œåœ¨ XML å…ƒç´ ä¸­ï¼Œâ€&lt;â€ å’Œ â€œ&amp;â€ æ˜¯éæ³•çš„ã€‚â€&lt;â€ ä¼šäº§ç”Ÿé”™è¯¯ï¼Œå› ä¸ºè§£æå™¨ä¼šæŠŠè¯¥å­—ç¬¦è§£é‡Šä¸ºæ–°å…ƒç´ çš„å¼€å§‹ã€‚â€&amp;â€ ä¹Ÿä¼šäº§ç”Ÿé”™è¯¯ï¼Œå› ä¸ºè§£æå™¨ä¼šæŠŠè¯¥å­—ç¬¦è§£é‡Šä¸ºå­—ç¬¦å®ä½“çš„å¼€å§‹ã€‚æŸäº›æ–‡æœ¬ï¼Œæ¯”å¦‚ JavaScript ä»£ç ï¼ŒåŒ…å«å¤§é‡ â€œ&lt;â€ æˆ– â€œ&amp;â€ å­—ç¬¦ã€‚ä¸ºäº†é¿å…é”™è¯¯ï¼Œå¯ä»¥å°†è„šæœ¬ä»£ç å®šä¹‰ä¸º CDATAã€‚</p><ul><li>CDATA éƒ¨åˆ†ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šè¢«è§£æå™¨å¿½ç•¥ã€‚</li><li>CDATA éƒ¨åˆ†ç”± â€œ<![CDATA[" å¼€å§‹ï¼Œç”± "]]>â€œ ç»“æŸã€‚<code>&lt;property&gt;&lt;![CDATA[&quot;&amp;&amp;&amp;&amp;&amp;&amp;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;]]&gt;&lt;/property&gt;</code></li></ul><p>è¿™æ ·å°±ä¼šè¢«è§£æå™¨å¿½ç•¥<code>&amp;&amp;&amp;&amp;&amp;&amp;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>ï¼Œä¸ä¼šå‘ç”ŸæŠ¥é”™ã€‚ä½†å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹æ³•å¾ˆéº»çƒ¦ã€‚</p><h4 id="2-è½¬ä¹‰å­—ç¬¦"><a href="#2-è½¬ä¹‰å­—ç¬¦" class="headerlink" title="2. è½¬ä¹‰å­—ç¬¦"></a>2. è½¬ä¹‰å­—ç¬¦</h4><p>åœ¨ XML ä¸­æœ‰ 5 ä¸ªé¢„å®šä¹‰çš„å®ä½“å¼•ç”¨ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211111003247.png" alt="image-20221111100330168"></p><p>è™½ç„¶æœ‰äº›ç¬¦å·åˆæ³•ï¼Œä½†æ˜¯æŠŠå®ƒä»¬æ›¿æ¢ä¸ºå®ä½“å¼•ç”¨ä¸å¤±ä¸ºä¸€ä¸ªå¥½çš„ä¹ æƒ¯ã€‚</p><p><a href="https://www.cnblogs.com/zlshtml/p/15209109.html">xmlæ–‡ä»¶ä¸­çš„ç‰¹æ®Šç¬¦å·ï¼ˆ&amp;ï¼Œ&lt;ï¼‰çš„ä½¿ç”¨æ–¹æ³• - Mrzxs999 - åšå®¢å›­ (cnblogs.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XML </tag>
            
            <tag> è¸©å‘ </tag>
            
            <tag> ç¼–ç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>03è§£å†³JPAçš„N+1é—®é¢˜</title>
      <link href="/2022/11/11/03ORM/03%E8%A7%A3%E5%86%B3JPA%E7%9A%84N+1%E9%97%AE%E9%A2%98/"/>
      <url>/2022/11/11/03ORM/03%E8%A7%A3%E5%86%B3JPA%E7%9A%84N+1%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯N-1é—®é¢˜ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯N-1é—®é¢˜ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯N+1é—®é¢˜ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯N+1é—®é¢˜ï¼Ÿ</h2><p>å½“ä½¿ç”¨<code>@ManyToManyã€@ManyToOneã€@OneToManyã€@OneToOneï¼Œ@Element</code>å…³è”å…³ç³»çš„æ—¶å€™ï¼ŒæŸ¥è¯¢ä¸€çš„ä¸€æ–¹ï¼Œç»“æœ<code>hibernate</code>ä¼šæ ¹æ®<code>@OneToMany</code>ï¼ˆç­‰ï¼‰ æŸ¥è¯¢å‡ºå¤šä¸ªå…³è”è¡¨çš„æ•°æ®</p><p>æ¯”å¦‚ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211110038265.png" alt="image-20221111003803164"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211110038117.png" alt="image-20221111003820990"></p><p>ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211110038182.png" alt="image-20221111003843117"></p><p>æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®æ˜¯è¿™æ ·ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211110040293.png" alt="image-20221111004014188"></p><p>æˆ‘ä»¬ç°åœ¨åªéœ€è¦ User çš„å¯¹è±¡ï¼Œä½†Hibernateç»™äº†æˆ‘ä»¬ accounts åˆ—è¡¨çš„æ•°æ®</p><p>å‡è®¾accountè¡¨å¯¹åº”çš„æ•°æ®æœ‰ 1000_000 æ¡æ•°æ®ï¼Œéš¾é“ä¹Ÿè¦æŸ¥å‡ºæ¥ä¹ˆï¼Ÿ</p><p>ç»™äº†æˆ‘ä»¬ accounts çš„æ•°æ®è¿˜ä¸æï¼Œæœ€è€—è´¹æ€§èƒ½çš„æ˜¯ï¼š</p><blockquote><p>ç¤ºä¾‹ sql æŸ¥è¯¢å‡ºæ¥çš„rowå¤ªå°‘ï¼Œæ¢äº†ä¸ªæ¡ä»¶æŸ¥è¯¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Page&lt;User&gt; userPage = userRepository.findAllByGender(<span class="string">&#x27;å¥³&#x27;</span>, Pageable.ofSize(<span class="number">10</span>));</span><br></pre></td></tr></table></figure></blockquote><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211110203105.gif" alt="åŠ¨ç”»"></p><p>å¦‚æœæ˜¯å…³è”æŸ¥è¯¢è¿˜å¥½è¯´ï¼Œå¯è¿™æ˜¯å¤šæ¬¡æŸ¥è¯¢ã€‚ã€‚ã€‚</p><h2 id="æ€ä¹ˆè§£å†³N-1é—®é¢˜ï¼Ÿ"><a href="#æ€ä¹ˆè§£å†³N-1é—®é¢˜ï¼Ÿ" class="headerlink" title="æ€ä¹ˆè§£å†³N+1é—®é¢˜ï¼Ÿ"></a>æ€ä¹ˆè§£å†³N+1é—®é¢˜ï¼Ÿ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NamedEntityGraph</span>ï¼šåœ¨ç±»ä¸Šï¼Œå®šä¹‰ + æŒ‡å®šå±æ€§</span><br><span class="line"><span class="meta">@EntityGraph</span>ï¼šåœ¨æ–¹æ³•ä¸Šï¼ŒæŒ‡å®šä½¿ç”¨å£°æ˜çš„ä½ç½®</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211110055085.png" alt="image-20221111005525995"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NamedEntityGraph(name = &quot;User_Account&quot;, attributeNodes = &#123;@NamedAttributeNode(&quot;accounts&quot;)&#125;)</span></span><br></pre></td></tr></table></figure><blockquote><p>æˆ–è€…ä½ ä¹Ÿå¯ä»¥è®¤ä¸ºï¼š</p><ul><li><code>@NamedEntityGraph</code> æ˜¯ æ²»æ„Ÿå†’çš„è¯ï¼ˆè¿˜æœ‰å¾ˆå¤šæ²»åˆ«çš„ç—…çš„è¯ï¼‰</li><li><code>name = &quot;User_Account&quot;</code>ï¼šè¿™æ˜¯è¯¥è¯çš„åç§°ï¼ˆè¯¥åŠŸèƒ½çš„ IDï¼‰</li><li><code>attributeNodes = &#123;@NamedAttributeNode(&quot;accounts&quot;)&#125;</code>ï¼šè¿™æ˜¯è¯¥æ„Ÿå†’è¯åŠŸæ•ˆä½œç”¨äºèº«ä½“çš„ä½ç½®ï¼Œæ¯”å¦‚ï¼šå’½å–‰</li></ul></blockquote><p>ç°åœ¨æˆ‘ä»¬éœ€è¦ç»™ç‰¹å®šæ‚£è€…æœè¯</p><p>è¿™æ˜¯æˆ‘ä»¬çš„æ„Ÿå†’æ‚£è€…ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211110100366.png" alt="image-20221111010039276"></p><p>ç»™ä»–æœè¯ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211110104546.png" alt="image-20221111010401365"></p><p>å¯ä»¥å‘ç°ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211110206675.png" alt="image-20221111020643607"></p><p>ä»£ç è¢«æ”¹æˆå…³è”æŸ¥è¯¢äº†ï¼Œè™½ç„¶è¿˜ä¸æ˜¯æœ€ä¼˜æ€§èƒ½</p><h2 id="jacksonåºåˆ—åŒ–å¯¼è‡´çš„N-1é—®é¢˜"><a href="#jacksonåºåˆ—åŒ–å¯¼è‡´çš„N-1é—®é¢˜" class="headerlink" title="jacksonåºåˆ—åŒ–å¯¼è‡´çš„N+1é—®é¢˜"></a>jacksonåºåˆ—åŒ–å¯¼è‡´çš„N+1é—®é¢˜</h2><p>åœ¨ controller å±‚ï¼Œæˆ‘ä»¬è¿”å›ç»™å‰ç«¯çš„æ•°æ®é€šå¸¸ä¸º jsonï¼Œ è¿™ä¹Ÿéœ€è¦è°ƒç”¨åˆ° jackson è¿›è¡Œè½¬æ¢ï¼Œæ‰€ä»¥è¿˜ä¼šå‡ºç°N + 1 é—®é¢˜</p><p>éœ€è¦è§£å†³</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-datatype-hibernate5<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MappingJackson2HttpMessageConverter <span class="title function_">mappingJackson2HttpMessageConverter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MappingJackson2HttpMessageConverter</span> <span class="variable">converter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> converter.getObjectMapper();</span><br><span class="line">        <span class="type">Hibernate5Module</span> <span class="variable">hibernate5Module</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hibernate5Module</span>();</span><br><span class="line">        mapper.registerModule(hibernate5Module);</span><br><span class="line">        mapper.setDateFormat(<span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> converter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ORM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> JPA </tag>
            
            <tag> ORM </tag>
            
            <tag> è¸©å‘ </tag>
            
            <tag> æŸ¥è¯¢ä¸åˆ°æ•°æ® </tag>
            
            <tag> ç¼–ç  </tag>
            
            <tag> å­—ç¬¦é›†ç¼–ç  </tag>
            
            <tag> N+1é—®é¢˜ </tag>
            
            <tag> jacksonåºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02JPAè‡ªåŠ¨å»ºè¡¨æœ‰å‘</title>
      <link href="/2022/11/11/03ORM/02JPA%E8%87%AA%E5%8A%A8%E5%BB%BA%E8%A1%A8%E6%9C%89%E5%9D%91/"/>
      <url>/2022/11/11/03ORM/02JPA%E8%87%AA%E5%8A%A8%E5%BB%BA%E8%A1%A8%E6%9C%89%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h1 id="JPAæŸ¥è¯¢ä¸åˆ°æ•°æ®çš„å‘"><a href="#JPAæŸ¥è¯¢ä¸åˆ°æ•°æ®çš„å‘" class="headerlink" title="JPAæŸ¥è¯¢ä¸åˆ°æ•°æ®çš„å‘"></a>JPAæŸ¥è¯¢ä¸åˆ°æ•°æ®çš„å‘</h1><h2 id="ç¼–ç æ ¼å¼å‘"><a href="#ç¼–ç æ ¼å¼å‘" class="headerlink" title="ç¼–ç æ ¼å¼å‘"></a>ç¼–ç æ ¼å¼å‘</h2><p>æœ‰æ—¶å€™<code>JPA</code>è‡ªåŠ¨å»ºè¡¨çš„å­—ç¬¦é›†ç¼–ç ä¸å¯¹ï¼Œå¯¼è‡´ä¸­æ–‡æ¡ä»¶æ˜æ˜æ”¾åˆ°<code>navicat</code>æŸ¥è¯¢å¯ä»¥æŸ¥åˆ°æ•°æ®ï¼Œåœ¨é¡¹ç›®ä¸­å´åˆæ— æ³•æŸ¥è¯¢</p><p>æŸ¥çœ‹<code>DDL</code>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `account` (</span><br><span class="line">  `ID` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç¼–å·&#x27;</span>,</span><br><span class="line">  `UID` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·ç¼–å·&#x27;</span>,</span><br><span class="line">  `MONEY` <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é‡‘é¢&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`ID`),</span><br><span class="line">  KEY `FK_Reference_8` (`UID`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `FKtjvpeqb8ep4ymri3fi58hmaqa` <span class="keyword">FOREIGN</span> KEY (`UID`) <span class="keyword">REFERENCES</span> `<span class="keyword">user</span>` (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3;</span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¯ <code>utf8mb3</code></p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><ol><li>ä¿®æ”¹<code>mysql</code>çš„ <code>my.ini</code>é…ç½®</li></ol><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4</span><br><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4</span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">port</span> = <span class="number">3306</span></span><br><span class="line"><span class="attr">basedir</span>=D:\programs\env\mysql-<span class="number">8.0</span>.<span class="number">28</span>-winx64</span><br><span class="line"><span class="attr">datadir</span>=D:\programs\env\mysql-<span class="number">8.0</span>.<span class="number">28</span>-winx64\data</span><br><span class="line"><span class="attr">max_connections</span>=<span class="number">200</span></span><br><span class="line"><span class="attr">character-set-client-handshake</span> = <span class="literal">FALSE</span> </span><br><span class="line"><span class="attr">character-set-server</span>=utf8mb4 </span><br><span class="line"><span class="attr">collation-server</span>=utf8mb4_unicode_ci </span><br><span class="line"><span class="attr">init_connect</span>=<span class="string">&#x27;SET NAMES utf8mb4&#x27;</span></span><br><span class="line"><span class="attr">default-storage-engine</span>=INNODB</span><br><span class="line"><span class="attr">default-time_zone</span>=<span class="string">&#x27;+8:00&#x27;</span></span><br><span class="line"><span class="attr">sql_mode</span>=<span class="string">&#x27;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION&#x27;</span></span><br><span class="line"><span class="attr">default_authentication_plugin</span>=mysql_native_password</span><br></pre></td></tr></table></figure><p>é‡å¯<code>mysql</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">WHERE</span> Variable_name <span class="keyword">LIKE</span> <span class="string">&#x27;character_set_%&#x27;</span> <span class="keyword">OR</span> Variable_name <span class="keyword">LIKE</span> <span class="string">&#x27;collation%&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211110008795.png" alt="image-20221111000859640"></p><ol start="2"><li>å°†å·²ç»å»ºå¥½çš„æ•°æ®åº“ã€è¡¨å’Œåˆ—è½¬æ¢æˆ<code>utf8mb4,utf8mb4_unicode_ci</code></li></ol><p>æ›´æ”¹æ•°æ®åº“ç¼–ç ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE database_name <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure><p>æ›´æ”¹è¡¨ç¼–ç ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure><p>æ›´æ”¹åˆ—ç¼–ç ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name CHANGE column_name column_name <span class="type">VARCHAR</span>( <span class="number">36</span> ) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure><ol start="3"><li><p>åœ¨<code>JPA</code>å»ºè¡¨æ—¶è®¾ç½®è¡¨çš„ç¼–ç å’Œæ’åºè§„åˆ™</p></li><li><p>é‡å†™<code>MySQL8InnoDBDialect#getTableTypeString()</code></p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySQL8InnoDBDialectUtf8mb4</span> <span class="keyword">extends</span> <span class="title class_">MySQL8InnoDBDialect</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTableTypeString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE utf8mb4_unicode_ci&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>é…ç½®<code>hibernate.dialect</code></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">hibernate:</span></span><br><span class="line">        <span class="attr">dialect:</span> <span class="string">com.ä½ çš„åŒ…å.MySQL8InnoDBDialectUtf8mb4</span></span><br></pre></td></tr></table></figure><ol start="6"><li>è®¾ç½®è¿æ¥åˆå§‹åŒ–<code>SQL</code></li></ol><blockquote><p>é…ç½®<code>Druid</code>è¿æ¥æ± ,å¦‚æœä¸ºå…¶ä»–è¿æ¥æ± ,è®¾ç½®å¯¹åº”çš„<code>connectionInitSqls</code>å³å¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.druid.connection-init-sqls&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; connectionInitSqls;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DruidDataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        dataSource.setConnectionInitSqls(connectionInitSqls);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>application.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">connection-init-sqls:</span> [<span class="string">&quot;SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci&quot;</span>]</span><br></pre></td></tr></table></figure><blockquote><p><code>mysql.url</code>è¿˜æ˜¯éœ€è¦è®¾ç½®<code>characterEncoding=utf8</code>ä¸ç„¶ä¼šå‡ºç°ä¸­æ–‡ä¹±ç </p></blockquote><h2 id="æµ‹è¯•ç”¨ä¾‹éœ€è¦äº‹åŠ¡æ³¨è§£çš„å‘"><a href="#æµ‹è¯•ç”¨ä¾‹éœ€è¦äº‹åŠ¡æ³¨è§£çš„å‘" class="headerlink" title="æµ‹è¯•ç”¨ä¾‹éœ€è¦äº‹åŠ¡æ³¨è§£çš„å‘"></a>æµ‹è¯•ç”¨ä¾‹éœ€è¦äº‹åŠ¡æ³¨è§£çš„å‘</h2><p>å¦‚æœä½ çš„æµ‹è¯•ç”¨ä¾‹æ²¡æœ‰åŠ ä¸Š<code>@Transactional</code>æ³¨è§£ï¼Œåˆ™ä¼šå¯¼è‡´ä½ æœç´¢ä¸åˆ°æ•°æ®çš„é—®é¢˜</p><blockquote><p>åœ¨æ‰§è¡Œ<code>springDataJpa</code>ä¸­ä½¿ç”¨<code>sql</code>å®Œæˆæ›´æ–°ï¼Œåˆ é™¤æ“ä½œæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ äº‹åŠ¡çš„æ”¯æŒ å¿…é¡»çš„ï¼›å› ä¸ºé»˜è®¤ä¼šæ‰§è¡Œç»“æŸåï¼Œå›æ»šäº‹åŠ¡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findUserByTelephone(<span class="string">&quot;21-9022-9458&quot;</span>);</span><br><span class="line">System.err.println(JSONUtil.toJsonStr(user));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">List&lt;User&gt; userList = userRepository.findAllByGender(<span class="string">&#x27;F&#x27;</span>);</span><br><span class="line">System.err.println(JSONUtil.toJsonStr(userList));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">List&lt;User&gt; userList = userRepository.findAll();</span><br><span class="line">System.err.println(JSONUtil.toJsonStr(userList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ ä¸Šå»å°±èƒ½æœç´¢åˆ°äº†</p>]]></content>
      
      
      <categories>
          
          <category> ORM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> JPA </tag>
            
            <tag> ORM </tag>
            
            <tag> è¸©å‘ </tag>
            
            <tag> æŸ¥è¯¢ä¸åˆ°æ•°æ® </tag>
            
            <tag> ç¼–ç  </tag>
            
            <tag> å­—ç¬¦é›†ç¼–ç  </tag>
            
            <tag> äº‹åŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01JSONæ–¹é¢çš„å·¥å…·</title>
      <link href="/2022/11/08/05tools%E5%B7%A5%E5%85%B7%E7%B1%BB/01JSON%E6%96%B9%E9%9D%A2%E7%9A%84%E5%B7%A5%E5%85%B7/"/>
      <url>/2022/11/08/05tools%E5%B7%A5%E5%85%B7%E7%B1%BB/01JSON%E6%96%B9%E9%9D%A2%E7%9A%84%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h2 id="ç”¨äºJSON-æ—¶é—´-æ–¹é¢çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#ç”¨äºJSON-æ—¶é—´-æ–¹é¢çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="ç”¨äºJSON æ—¶é—´ æ–¹é¢çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>ç”¨äºJSON æ—¶é—´ æ–¹é¢çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JavaType;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateTimeDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalTimeDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalTimeSerializer;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JSONå·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JSONUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STANDARD_PATTERN</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DATE_PATTERN</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TIME_PATTERN</span> <span class="operator">=</span> <span class="string">&quot;HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(JSONUtils.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®java.util.Dateæ—¶é—´ç±»çš„åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–çš„æ ¼å¼</span></span><br><span class="line">        objectMapper.setDateFormat(<span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(STANDARD_PATTERN));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–JavaTimeModule</span></span><br><span class="line">        <span class="type">JavaTimeModule</span> <span class="variable">javaTimeModule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaTimeModule</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¤„ç†LocalDateTime</span></span><br><span class="line">        <span class="type">DateTimeFormatter</span> <span class="variable">dateTimeFormatter</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(STANDARD_PATTERN);</span><br><span class="line">        javaTimeModule.addSerializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeSerializer</span>(dateTimeFormatter));</span><br><span class="line">        javaTimeModule.addDeserializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeDeserializer</span>(dateTimeFormatter));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¤„ç†LocalDate</span></span><br><span class="line">        <span class="type">DateTimeFormatter</span> <span class="variable">dateFormatter</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(DATE_PATTERN);</span><br><span class="line">        javaTimeModule.addSerializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateSerializer</span>(dateFormatter));</span><br><span class="line">        javaTimeModule.addDeserializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateDeserializer</span>(dateFormatter));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¤„ç†LocalTime</span></span><br><span class="line">        <span class="type">DateTimeFormatter</span> <span class="variable">timeFormatter</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(TIME_PATTERN);</span><br><span class="line">        javaTimeModule.addSerializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeSerializer</span>(timeFormatter));</span><br><span class="line">        javaTimeModule.addDeserializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeDeserializer</span>(timeFormatter));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ³¨å†Œæ—¶é—´æ¨¡å—, æ”¯æŒæ”¯æŒjsr310, å³æ–°çš„æ—¶é—´ç±»(java.timeåŒ…ä¸‹çš„æ—¶é—´ç±»)</span></span><br><span class="line">        objectMapper.registerModule(javaTimeModule);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŒ…å«æ‰€æœ‰å­—æ®µ</span></span><br><span class="line">        objectMapper.setSerializationInclusion(JsonInclude.Include.ALWAYS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åœ¨åºåˆ—åŒ–ä¸€ä¸ªç©ºå¯¹è±¡æ—¶æ—¶ä¸æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        objectMapper.disable(SerializationFeature.FAIL_ON_EMPTY_BEANS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¿½ç•¥ååºåˆ—åŒ–æ—¶åœ¨jsonå­—ç¬¦ä¸²ä¸­å­˜åœ¨, ä½†åœ¨javaå¯¹è±¡ä¸­ä¸å­˜åœ¨çš„å±æ€§</span></span><br><span class="line">        objectMapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">JSONUtils</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†Javaå¯¹è±¡åºåˆ—åŒ–æˆä¸€ä¸ªJSONå¯¹è±¡æˆ–è€…JSONæ•°ç»„.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object Javaå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å›ä¸€ä¸ªJSONæ ¼å¼çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">objToJson</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (object != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> objectMapper.writeValueAsString(object);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            LOG.error(<span class="string">&quot;parse &#123;&#125; to json error!&quot;</span>, object, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†JSONå¯¹è±¡ååºåˆ—åŒ–æˆä¸€ä¸ªJavaåŸç”Ÿå¯¹è±¡, ä¸æ”¯æŒæ³›å‹.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> json JSONå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cls  Javaå¯¹è±¡åŸå§‹ç±»å‹çš„classå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;  Javaå¯¹è±¡çš„åŸå§‹ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å›ä¸€ä¸ªTç±»å‹çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">jsonToObj</span><span class="params">(String json, Class&lt;T&gt; cls)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (json != <span class="literal">null</span> &amp;&amp; json.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> objectMapper.readValue(json, cls);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            LOG.error(<span class="string">&quot;parse &#123;&#125; to object error!&quot;</span>, json, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†JSONååºåˆ—åŒ–æˆä¸€ä¸ªJavaå¯¹è±¡, æ”¯æŒæ³›å‹.</span></span><br><span class="line"><span class="comment">     * TypeReferenceæ˜¯ä¸€ä¸ªæŠ½è±¡ç±», ç”¨æ¥æ„é€ ç±»å‹</span></span><br><span class="line"><span class="comment">     * è°ƒç”¨æ–¹å¼: ä¼ å…¥ä¸€ä¸ªTypeReferenceçš„åŒ¿åå®ç°ç±»å³å¯</span></span><br><span class="line"><span class="comment">     * User user = jsonToObj(json, new TypeReference&lt;User&gt;()&#123;&#125;)</span></span><br><span class="line"><span class="comment">     * List&lt;User&gt; users = jsonToObj(json, new TypeReference&lt;List&lt;User&gt;&gt;()&#123;&#125;)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> json          JSONå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> typeReference ç±»å‹å¼•ç”¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;           è¿”å›å€¼ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å›ä¸€ä¸ªJavaå¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">jsonToObj</span><span class="params">(String json, TypeReference&lt;?&gt; typeReference)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (json != <span class="literal">null</span> &amp;&amp; json.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> (T) objectMapper.readValue(json, typeReference);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            LOG.error(<span class="string">&quot;parse &#123;&#125; to object error!&quot;</span>, json, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ä¸€ä¸ªJSONæ•°ç»„ååºåˆ—åŒ–æˆä¸€ä¸ªListå¯¹è±¡.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> json JSONæ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cls  Javaå¯¹è±¡åŸå§‹ç±»å‹çš„classå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;  Javaå¯¹è±¡çš„åŸå§‹ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å›ä¸€ä¸ªListåˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">jsonToList</span><span class="params">(String json, Class&lt;T&gt; cls)</span> &#123;</span><br><span class="line">        List&lt;T&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (json != <span class="literal">null</span> &amp;&amp; json.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">JavaType</span> <span class="variable">javaType</span> <span class="operator">=</span> objectMapper.getTypeFactory().constructCollectionType(List.class, cls);</span><br><span class="line">                list = objectMapper.readValue(json, javaType);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            LOG.error(<span class="string">&quot;parse &#123;&#125; to object error!&quot;</span>, json, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jackson </tag>
            
            <tag> JSON </tag>
            
            <tag> åºåˆ—åŒ– </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
            <tag> æ—¶é—´è½¬åŒ– </tag>
            
            <tag> å·¥å…·ç±» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01-Springbootè‡ªå®šä¹‰é…ç½®ç±»</title>
      <link href="/2022/11/07/04springboot/01Springboot%E8%87%AA%E5%AE%9A%E4%B9%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%B1%BB/"/>
      <url>/2022/11/07/04springboot/01Springboot%E8%87%AA%E5%AE%9A%E4%B9%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.yuque.com/attachments/yuque/0/2022/mmap/22744322/1665395912889-b60fb6ee-288d-4269-8fd6-6f8a92a6a5f2.mmap">Springbootè‡ªå®šä¹‰é…ç½®ç±».mmap</a></p><p><a href="https://www.yuque.com/attachments/yuque/0/2022/docx/22744322/1665396003640-0ef35eda-8083-4864-84ef-b532c184abc7.docx">Springbootè‡ªå®šä¹‰é…ç½®ç±».docx</a></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç”±äºç¬”è®°æ˜¯ç”±MindManagerè½¬è¿‡æ¥çš„ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæœ‰ç‚¹ä¹±ï¼Œå¯ä»¥ç›´æ¥çœ‹ä¸Šé¢çš„ mmap è„‘å›¾</p><h1 id="Springbootè‡ªå®šä¹‰é…ç½®ç±»"><a href="#Springbootè‡ªå®šä¹‰é…ç½®ç±»" class="headerlink" title="Springbootè‡ªå®šä¹‰é…ç½®ç±»"></a>Springbootè‡ªå®šä¹‰é…ç½®ç±»</h1><h2 id="å‰è¨€-1"><a href="#å‰è¨€-1" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡å‚è€ƒå®˜æ–¹æ–‡æ¡£: </p><p><a href="https://docs.spring.io/spring-boot/docs/2.6.x/reference/html/configuration-metadata.html">https://docs.spring.io/spring-boot/docs/2.6.x/reference/html/configuration-metadata.html</a></p><h1 id="2-7-xä»¥å‰çš„ç‰ˆæœ¬"><a href="#2-7-xä»¥å‰çš„ç‰ˆæœ¬" class="headerlink" title="2.7.xä»¥å‰çš„ç‰ˆæœ¬"></a>2.7.xä»¥å‰çš„ç‰ˆæœ¬</h1><h2 id="å¼•å‡ºç›¸å…³çŸ¥è¯†"><a href="#å¼•å‡ºç›¸å…³çŸ¥è¯†" class="headerlink" title="å¼•å‡ºç›¸å…³çŸ¥è¯†"></a>å¼•å‡ºç›¸å…³çŸ¥è¯†</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„å­ç±»å¾—åˆ°çˆ¶ç±»çš„æ¥å£</p><p>ä½†æˆ‘ä»¬æ— æ³•é€šè¿‡ä»»ä½•æœºåˆ¶é€šè¿‡çˆ¶ç±»è·å¾—å­ç±»</p><h3 id="ä»€ä¹ˆæ˜¯SPIï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯SPIï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯SPIï¼Ÿ"></a>ä»€ä¹ˆæ˜¯<code>SPI</code>ï¼Ÿ</h3><ul><li><p>ç®€å•ç‚¹ï¼šæ ¹æ®æ¥å£æ‰¾åˆ°å®ç°ç±»</p></li><li><p>å…¨åå«<code>Service Provider Interface</code></p><p>æ˜¯JDKå†…ç½®çš„ä¸€ç§æœåŠ¡æä¾›å‘ç°æœºåˆ¶ï¼Œå¯ä»¥ç”¨æ¥å¯ç”¨æ¡†æ¶æ‰©å±•å’Œæ›¿æ¢ç»„ä»¶ï¼Œä¸»è¦æ˜¯è¢«æ¡†æ¶çš„å¼€å‘äººå‘˜ä½¿ç”¨ï¼Œæ¯”å¦‚java.sql.Driveræ¥å£ï¼Œå…¶ä»–ä¸åŒå‚å•†å¯ä»¥é’ˆå¯¹åŒä¸€æ¥å£åšå‡ºä¸åŒçš„å®ç°ï¼ŒMySQLå’ŒPostgreSQLéƒ½æœ‰ä¸åŒçš„å®ç°æä¾›ç»™ç”¨æˆ·ï¼Œè€Œ<strong>Javaçš„SPIæœºåˆ¶å¯ä»¥ä¸ºæŸä¸ªæ¥å£å¯»æ‰¾æœåŠ¡å®ç°</strong>ã€‚<strong>Javaä¸­SPIæœºåˆ¶ä¸»è¦æ€æƒ³æ˜¯å°†è£…é…çš„æ§åˆ¶æƒç§»åˆ°ç¨‹åºä¹‹å¤–</strong>ï¼Œåœ¨æ¨¡å—åŒ–è®¾è®¡ä¸­è¿™ä¸ªæœºåˆ¶å°¤å…¶é‡è¦ï¼Œå…¶æ ¸å¿ƒæ€æƒ³å°±æ˜¯è§£è€¦ã€‚</p></li></ul><h3 id="SPIæ€ä¹ˆç©"><a href="#SPIæ€ä¹ˆç©" class="headerlink" title="SPIæ€ä¹ˆç©?"></a><code>SPI</code>æ€ä¹ˆç©?</h3><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211050150742.png" alt="image-20221105015035572"></p><h3 id="æ€»ç»“ä¸‹SPIåšäº†ä»€ä¹ˆï¼Ÿ"><a href="#æ€»ç»“ä¸‹SPIåšäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ€»ç»“ä¸‹SPIåšäº†ä»€ä¹ˆï¼Ÿ"></a>æ€»ç»“ä¸‹SPIåšäº†ä»€ä¹ˆï¼Ÿ</h3><ol><li>åŠŸèƒ½: æ ¹æ®æ¥å£æ‰¾å®ç°ç±»</li><li>æœ‰æ¥å£å’Œå®ç°ç±»çš„ key value é”®å€¼å¯¹</li><li>æ ¹æ®æ¡ä»¶é€‰å®ç°ç±»</li></ol><p>é‚£ä¹ˆ springboot è‡ªåŠ¨é…ç½®ç±»å‘¢?</p><ul><li><p>è‚¯å®šæœ‰ä¸ªæ¥å£, å®ç°ç±»</p></li><li><p>è‚¯å®šæœ‰è®°å½•æœºåˆ¶, è®°å½•ç€æ¥å£å’Œå®ç°ç±»</p><ul><li><p><code>META-INF/spring.factories</code></p></li><li><p>&#96;&#96;&#96;properties<br>org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;<br>com.mycorp.libx.autoconfigure.LibXAutoConfiguration,<br>com.mycorp.libx.autoconfigure.LibXWebAutoConfiguration</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- å¯ä»¥ä»ä¼—å¤šå®ç°ç±»ä¸­æŒ‘é€‰å‡ºç¬¦åˆè¦æ±‚çš„å®ç°ç±»</span><br><span class="line">  </span><br><span class="line">  - `Conditional`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; è®°ä½è¿™å¹¶ä¸æ„å‘³ç€springbootä½¿ç”¨çš„SPIæœºåˆ¶åŠ è½½ç±»</span><br><span class="line"></span><br><span class="line">## å›åˆ°springbootè‡ªåŠ¨é…ç½®</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![](https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070029822.png)</span><br><span class="line"></span><br><span class="line">&gt; æ³¨æ„ï¼š**è‡ªåŠ¨é…ç½®ç±»åªèƒ½ä»¥è¿™ç§æ–¹å¼åŠ è½½**ã€‚ç¡®ä¿ä»–ä»¬è¢«å®šä¹‰åœ¨ç‰¹å®šçš„åŒ…ç©ºé—´ï¼Œå¹¶ä¸”**ç¡®ä¿ä»–ä»¬æ°¸è¿œä¸æ˜¯ç»„ä»¶æ‰«æçš„ç›®æ ‡**ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ**è‡ªåŠ¨é…ç½®ç±»ä¸éœ€è¦å¼€å¯ä¸»é”®æ‰«æä»¥æ‰¾åˆ°é¢å¤–çš„ç»„ä»¶ã€‚åº”è¯¥æ”¹ç”¨ç‰¹å®šçš„`@Import`æ³¨è§£ã€‚** </span><br><span class="line"></span><br><span class="line">   - å¦‚æœä½ æä¾›ç‰¹å®šçš„webé…ç½®ï¼Œä½ çš„ç±»å¯èƒ½éœ€è¦åœ¨`WebMvcAutoConfiguration`ä¹‹ååŠ è½½ã€‚ </span><br><span class="line"></span><br><span class="line">   - å¦‚æœä½ çš„é…ç½®éœ€è¦ä»¥ç‰¹å®šçš„é¡ºåºåŠ è½½ï¼Œä½ å¯ä»¥ä½¿ç”¨`@AutoConfigureAfter` or `@AutoConfigureBefore`æ³¨è§£ã€‚  </span><br><span class="line"></span><br><span class="line">   - &gt; **è®°ä½è¿™ç§æ–¹å¼ä¿è¯çš„é¡ºåºä¸èƒ½è¢«SpringBootçš„ç»„ä»¶æ‰«ææ³¨è§£æ‰«æï¼Œè€Œæ˜¯ä½¿ç”¨`spring.factories`æˆ–è€…`@import`æ³¨è§£å¯¼å…¥ å¦åˆ™ä½ ä¼šå‘ç°é¡ºåºä¸ç”Ÿæ•ˆ**</span><br><span class="line"></span><br><span class="line">   - å°±åƒæ ‡å‡†çš„`@Configuration`ç±»ä¸€æ ·ï¼Œè‡ªåŠ¨é…ç½®ç±»è¢«åŠ è½½çš„å¾ªåºåªå½±å“ä»–ä»¬Beanè¢«å®šä¹‰çš„é¡ºåºã€‚éšååˆ›å»ºè¿™äº› bean çš„é¡ºåºä¸å—å½±å“ï¼Œç”±æ¯ä¸ª bean çš„ä¾èµ–å…³ç³»å’Œä»»ä½• `@DependsOn`  å…³ç³»å†³å®šã€‚  </span><br><span class="line"></span><br><span class="line">   - å¦‚æœä½ æƒ³è¦åºæ’åºç‰¹å®šçš„å½¼æ­¤ä¸åº”è¯¥æœ‰ä»»ä½•ç›´æ¥äº†è§£çš„çš„è‡ªåŠ¨é…ç½®ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `@AutoConfigureOrder`æ³¨è§£ã€‚è¯¥æ³¨è§£å°±åƒ`@Order`æ³¨è§£ä¸€æ ·æœ‰ç›¸åŒçš„è¯­ä¹‰ï¼Œä¸ºè‡ªåŠ¨é…ç½®ç±»æä¾›ç‰¹å®šçš„é¡ºåºã€‚ </span><br><span class="line"></span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">     ### æ¡ä»¶æ³¨è§£</span><br><span class="line"></span><br><span class="line">     ä½ æ€»æ˜¯æƒ³è¦å»åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª`@Conditional`æ³¨è§£åœ¨ä½ çš„è‡ªåŠ¨é…ç½®ç±»ä¸Šã€‚`@ConditionalOnMissingBean`æ³¨è§£æ˜¯ä¸€ä¸ªå¸¸è§ä¾‹å­ï¼Œè¢«ç”¨äºåœ¨ä»–ä»¬ä¸æ»¡è¶³äºé»˜è®¤é…ç½®æ—¶ï¼Œå¼€å‘äººå‘˜é‡å†™è‡ªåŠ¨é…ç½®&lt;br /&gt;spring boot åŒ…å«å¤šä¸ª`@Conditional`æ³¨è§£ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ä»£ç ä¸­ï¼Œé€šè¿‡`@Configuration`ç±»æˆ–è€…ä¸ªäººçš„`@Bean` æ–¹æ³•é‡ç”¨è¿™äº›æ³¨è§£ã€‚è¿™äº›æ³¨è§£åŒ…æ‹¬:</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">     | Class Conditions               | ç±»æ¡ä»¶         |</span><br><span class="line">     | ------------------------------ | -------------- |</span><br><span class="line">     | Bean Conditions                | Beanæ¡ä»¶       |</span><br><span class="line">     | Property Conditions            | å±æ€§æ¡ä»¶       |</span><br><span class="line">     | Resource Conditions            | èµ„æºæ¡ä»¶       |</span><br><span class="line">     | Web Application Conditions     | webåº”ç”¨æ¡ä»¶    |</span><br><span class="line">     | SpEL Expression ConditionsSpEL | SpELè¡¨è¾¾å¼æ¡ä»¶ |</span><br><span class="line"></span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">     - #### Class Conditions </span><br><span class="line"></span><br><span class="line">        -  ä½¿ç”¨åœºæ™¯ </span><br><span class="line">           </span><br><span class="line">           - ä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºä½ æ˜¯å¦å¯¼å…¥äº†æŸä¸ªæ¨¡å—</span><br><span class="line">        - `@ConditionalOnClass`  and `@ConditionalOnMissingClass`æ³¨è§£ç±»æ ¹æ®æŒ‡å®šç±»çš„å­˜åœ¨æˆ–è€…ä¸å­˜åœ¨è€ŒåŒ…å«ã€‚ &lt;br /&gt;ç”±äºæ³¨è§£å…ƒç”±ASMè§£æçš„äº‹å®ï¼Œä½ å¯ä»¥ä½¿ç”¨valueå±æ€§å»å¼•ç”¨çœŸå®çš„ç±»ï¼Œå³ä½¿è¯¥ç±»å¯èƒ½ä¸å­˜åœ¨äºapplicationçš„classpathä¸Šã€‚&lt;br /&gt;å¦‚æœä½ æ¯”è¾ƒå–œæ¬¢ä½¿ç”¨å­—ç¬¦ä¸²å»æŒ‡å®šç±»åï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ name å±æ€§ã€‚ </span><br><span class="line"></span><br><span class="line">           ![image.png](https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211042224947.png)</span><br><span class="line"></span><br><span class="line">           - `@ConditionalOnClass(ConnectionFactory.class)` å’Œ `@ConditionalOnClass(name)`</span><br><span class="line">        -  `@ConditionalOnClass`çš„è¿™ç§æœºåˆ¶ä¸é€‚ç”¨äº`@Bean`æ–¹æ³• </span><br><span class="line">           </span><br><span class="line">           -  ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨å•ç‹¬çš„`Configuration` ç±»æ¥éš”ç¦»æ¡ä»¶ï¼Œé—´æ¥çš„ä½¿å‡½æ•°å¯ä»¥ä½¿ç”¨`@ConditionalOnClass`ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š </span><br><span class="line">```java</span><br><span class="line">@Configuration(proxyBeanMethods = false)</span><br><span class="line">// Some conditions ...</span><br><span class="line">public class MyAutoConfiguration &#123;</span><br><span class="line">    // Auto-configured beans ...</span><br><span class="line">    @Configuration(proxyBeanMethods = false)</span><br><span class="line">    @ConditionalOnClass(SomeService.class)</span><br><span class="line">    public static class SomeServiceConfiguration &#123;</span><br><span class="line">        @Bean</span><br><span class="line">        @ConditionalOnMissingBean</span><br><span class="line">        public SomeService someService() &#123;</span><br><span class="line">            return new SomeService();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><blockquote><p>æ³¨æ„ï¼šåœ¨å‡½æ•°ä¸Šä½¿ç”¨<code>@ConditionalOnBean</code> and <code>@ConditionalOnMissingBean</code>æ³¨è§£ä¸ä¼šé˜»æ­¢åˆ›å»ºé…ç½®ç±»ã€‚ä½†æ˜¯ åœ¨ç±»ä¸Šä½¿ç”¨<code>Conditional</code>å’Œæ ‡è®°æ¯ä¸ªåŒ…å«ä½¿ç”¨æ³¨è§£çš„<code>@Bean</code>å‡½æ•°çš„å”¯ä¸€ä¸åŒä¹‹å¤„åœ¨äº, å¦‚æœ<code>Conditional</code>ä¸åŒ¹é…ï¼Œä¼šé˜²æ­¢é…ç½®ç±»æ³¨å†Œä¸º<code>bean</code>ã€‚  </p></blockquote><ul><li><h3 id="Bean-Conditions"><a href="#Bean-Conditions" class="headerlink" title="Bean Conditions"></a>Bean Conditions</h3><ul><li>ä½¿ç”¨åœºæ™¯ <ul><li><p>ä¸»è¦ç”¨æ¥åˆ¤æ–­Beanæ˜¯å¦å·²ç»å­˜åœ¨ </p><p> <img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211042225183.png" alt="image.png"></p></li></ul></li><li><code>@ConditionalOnBean</code> å’Œ <code>@ConditionalOnMissingBean</code>æ³¨è§£è®©beanæ ¹æ®æŒ‡å®šçš„beançš„å­˜åœ¨ä¸å¦è€ŒåŒ…å«ã€‚ä½ å¯ä»¥ä½¿ç”¨ value å±æ€§å€ŸåŠ©ç±»å‹æŒ‡å®šbeans æˆ–è€… ä½¿ç”¨nameå®‰è£…åç§°å»æŒ‡å®šbeansã€‚searchå±æ€§å¯ä»¥è®©ä½ é™åˆ¶æœç´¢Beanæ—¶åº”è€ƒè™‘çš„ApplicationContextå±‚æ¬¡ç»“æ„ã€‚  </li><li>å½“æ³¨è§£åœ¨@Beanæ ‡æ³¨çš„æ–¹æ³•ä¸Šæ—¶ï¼Œç›®æ ‡ç±»å‹é»˜è®¤è¿”å›æ–¹æ³•çš„ç±»å‹ï¼Œ</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods  = false)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span>  </span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> SomeService <span class="title function_">someService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SomeService</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><pre><code>  - åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœåœ¨ApplicationContextä¸­æ²¡æœ‰åŒ…å«SomeServiceç±»å‹çš„Beanæ—¶ï¼ŒSomeServiceå°†è¢«åˆ›å»ºã€‚  -  Tipï¼šä½ éœ€è¦éå¸¸å°å¿ƒçš„æ·»åŠ Beanå®šä¹‰çš„é¡ºåºï¼Œå› ä¸ºè¿™äº›æ¡ä»¶æ˜¯æ ¹æ®åˆ°ç›®å‰ä¸ºæ­¢å·²ç»å¤„ç†è¿‡çš„å†…å®¹è¿›è¡Œè¯„ä¼°çš„ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬å»ºè®®åœ¨è‡ªåŠ¨é…ç½®ç±»ä¸Šåªä½¿ç”¨@ConditionalOnBeanå’Œ@ConditionalOnMissingBeanæ³¨è§£ï¼ˆå› ä¸ºè¿™äº›æ³¨è§£å¯ä»¥ä¿è¯åœ¨ä»»ä½•ç”¨æˆ·å®šä¹‰çš„Beanå®šä¹‰è¢«æ·»åŠ ååŠ è½½ï¼‰ã€‚   -  å¦‚æœä½ çš„Beançš„å…·ä½“ç±»å®ç°äº†ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆBeanæ–¹æ³•çš„è¿”å›ç±»å‹åº”è¯¥æ˜¯å…·ä½“ç±»è€Œä¸æ˜¯æ¥å£ã€‚ </code></pre><ul><li><h3 id="Property-Conditions"><a href="#Property-Conditions" class="headerlink" title="Property Conditions"></a>Property Conditions</h3><ul><li><code>@ConditionalOnProperty</code>æ³¨è§£è®©é…ç½®åŸºäºSpringç¯å¢ƒå±æ€§è€Œè¢«åŒ…å«ã€‚ä½¿ç”¨å‰ç¼€å’Œåç§°å±æ€§æ¥æŒ‡å®šåº”è¯¥è¢«æ£€æŸ¥çš„å±æ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•å­˜åœ¨ä¸”ä¸ç­‰äºfalseçš„å±æ€§éƒ½è¢«åŒ¹é…ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨havingValueå’ŒmatchIfMissingå±æ€§åˆ›å»ºæ›´é«˜çº§çš„æ£€æŸ¥ã€‚ </li><li>prefix+name or prefix+valueå±æ€§ <ul><li>ç”¨äºæŸ¥åˆ°ï¼Œå®šä½application.ymlä¸­çš„key</li></ul></li><li>havingValueå±æ€§ <ul><li>ç”¨æ¥æ¯”è¾ƒ<code>application,yml</code>ä¸­çš„valueå€¼</li></ul></li><li>matchIfMissingå±æ€§ <ul><li>ç”¨æ¥è¡¨ç¤ºå¦‚æœ<code>application.yml</code>ä¸­æ²¡æœ‰å†™é…ç½®çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¦åŠ è½½æˆ‘ä»¬çš„è‡ªåŠ¨é…ç½®ç±» <ul><li><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211042224924.png" alt="image.png"></li><li>è¿™ç§æƒ…å†µæ˜¯å¦è‡ªåŠ¨åŠ è½½è¯¥æ¨¡å—ï¼Ÿ</li><li>trueï¼šåŠ è½½</li><li>falseï¼šä¸åŠ è½½</li></ul></li></ul></li></ul></li><li><h3 id="Resource-Conditions"><a href="#Resource-Conditions" class="headerlink" title="Resource Conditions"></a>Resource Conditions</h3><ul><li><code>@ConditionalOnResource</code>æ³¨è§£è®©é…ç½®ä»…åœ¨ç‰¹å®šèµ„æºå­˜åœ¨æ—¶æ‰è¢«åŒ…å«ã€‚èµ„æºå¯ä»¥é€šè¿‡ä½¿ç”¨é€šå¸¸çš„Springçº¦å®šæ¥æŒ‡å®šï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼š<code>file:/home/user/test.dat</code>ã€‚</li></ul></li><li><h3 id="Web-Application-Conditions"><a href="#Web-Application-Conditions" class="headerlink" title="Web Application Conditions"></a>Web Application Conditions</h3><ul><li><code>@ConditionalOnWebApplication</code>å’Œ<code>@ConditionalOnNotWebApplication</code>æ³¨è§£å…è®¸æ ¹æ®åº”ç”¨æ˜¯å¦æ˜¯ â€œWebåº”ç”¨ â€œæ¥åŒ…å«é…ç½®ã€‚åŸºäºServletçš„Webåº”ç”¨æ˜¯æŒ‡ä»»ä½•ä½¿ç”¨Spring <code>WebApplicationContext</code>ã€å®šä¹‰ä¼šè¯èŒƒå›´æˆ–å…·æœ‰å¯é…ç½®<code>WebEnvironment</code>çš„åº”ç”¨ã€‚ååº”å¼Webåº”ç”¨æ˜¯æŒ‡ä»»ä½•ä½¿ç”¨<code>ReactiveWebApplicationContext</code>æˆ–å…·æœ‰<code>ConfigurableReactiveWebEnvironment</code>çš„åº”ç”¨ã€‚</li><li><code>@ConditionalOnWarDeployment</code>æ³¨è§£å…è®¸æ ¹æ®åº”ç”¨ç¨‹åºæ˜¯å¦æ˜¯è¢«éƒ¨ç½²åˆ°å®¹å™¨ä¸­çš„ä¼ ç»ŸWARåº”ç”¨ç¨‹åºè€ŒåŒ…å«é…ç½®ã€‚è¿™ä¸ªæ¡ä»¶å°†ä¸ç¬¦åˆä½¿ç”¨åµŒå…¥å¼æœåŠ¡å™¨è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚</li></ul></li><li><h3 id="SpEL-Expression-Conditions"><a href="#SpEL-Expression-Conditions" class="headerlink" title="SpEL Expression Conditions"></a>SpEL Expression Conditions</h3><ul><li><code>@ConditionalOnExpression</code>æ³¨è§£å…è®¸æ ¹æ®SpELè¡¨è¾¾å¼çš„ç»“æœæ¥åŒ…å«é…ç½®ã€‚</li><li>åœ¨è¡¨è¾¾å¼ä¸­å¼•ç”¨Beanå°†å¯¼è‡´è¯¥Beanåœ¨ä¸Šä¸‹æ–‡åˆ·æ–°å¤„ç†ä¸­å¾ˆæ—©å°±è¢«åˆå§‹åŒ–ã€‚å› æ­¤ï¼Œè¯¥Beanå°†æ²¡æœ‰èµ„æ ¼è¿›è¡Œåå¤„ç†ï¼ˆæ¯”å¦‚é…ç½®å±æ€§ç»‘å®šï¼‰ï¼Œå…¶çŠ¶æ€å¯èƒ½æ˜¯ä¸å®Œæ•´çš„ã€‚</li></ul></li><li><p>æ¨¡å—å‘½å </p><ul><li>ä½ åº”è¯¥ç¡®ä¿ä¸ºä½ çš„starteræä¾›ä¸€ä¸ªåˆé€‚çš„å‘½åç©ºé—´ã€‚ä¸è¦ä»¥â€œspring-bootâ€ä½œä¸ºä½ æ¨¡å—å¼€å¤´çš„åå­—ï¼Œå³ä¾¿ä½ ä½¿ç”¨ä¸åŒçš„Maven groupIdã€‚åœ¨æœªæ¥ï¼Œæˆ‘ä»¬å¯èƒ½ä¸ºæ‚¨çš„é¡¹ç›®æä¾›å®˜æ–¹çš„æ”¯æŒ</li><li>æ ¹æ®ç»éªŒï¼Œä½ éœ€è¦åœ¨starteræ¨¡å—ä¹‹åå‘½åä¸€ä¸ªç»„åˆæ¨¡å—ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ ä¸ºâ€œacmeâ€åˆ›å»ºä¸€ä¸ªstarterï¼Œä½ å‘½åè‡ªåŠ¨é…ç½®æ¨¡å— â€œacme-spring-bootâ€ï¼Œå’Œstarteræ¨¡å—ä¸º â€œacme-spring-boot-starterâ€ï¼Œå¦‚æœä½ åªæœ‰ä¸€ä¸ªç»“åˆäº†ä¸¤è€…çš„æ¨¡å—ï¼Œå‘½åå®ƒä¸ºâ€œacme-spring-boot-starterâ€</li></ul></li><li><p>é…ç½®Key </p><ul><li>åˆ›å»ºProperties</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(value  = &quot;example&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleProperties</span> &#123;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨Annotation Processorç”Ÿæˆä½ çš„å…ƒæ•°æ® </li><li>ä½¿ç”¨æ³¨è§£å¤„ç†å™¨ç”Ÿæˆæ‚¨è‡ªå·±çš„å…ƒæ•°æ®<br />ä½ å¯ä»¥å¾ˆç®€å•çš„ä»<code>@ConfigurationProperties</code>æ³¨é‡Šçš„é¡¹ç›®ä¸­ä½¿ç”¨â€œspring-boot-configuration-processorâ€ jaråŒ…ç”Ÿæˆä½ çš„é…ç½®å…ƒæ•°æ®æ–‡ä»¶ã€‚è¯¥jaråŒ…å«ä¸€ä¸ªä½ çš„é¡¹ç›®ç¼–è¯‘æ—¶è°ƒç”¨çš„javaæ³¨è§£å¤„ç†å™¨ <ul><li>é…ç½®æ³¨è§£å¤„ç†å™¨ <ul><li>æ·»åŠ ä¾èµ–</li></ul></li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>å¦‚æœä½ åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨AspectJï¼Œä½ éœ€è¦ç¡®ä¿æ³¨è§£å¤„ç†å™¨åªè¿è¡Œä¸€æ¬¡ã€‚æœ‰å‡ ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚åœ¨Mavenä¸­ï¼Œä½ å¯ä»¥æ˜ç¡®é…ç½®maven-apt-pluginï¼Œåªåœ¨é‚£é‡Œæ·»åŠ å¯¹æ³¨é‡Šå¤„ç†å™¨çš„ä¾èµ–ã€‚ä½ ä¹Ÿå¯ä»¥è®©AspectJæ’ä»¶è¿è¡Œæ‰€æœ‰å¤„ç†ï¼Œå¹¶åœ¨<code>maven-compiler-plugin</code>é…ç½®ä¸­ç¦ç”¨æ³¨é‡Šå¤„ç†ï¼Œå¦‚ä¸‹æ‰€ç¤º </p></li><li><p>å¦‚æœä½ åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Lombokï¼Œä½ éœ€è¦ç¡®ä¿å…¶æ³¨é‡Šå¤„ç†å™¨åœ¨<code>spring-boot-configuration-processor</code>ä¹‹å‰è¿è¡Œã€‚è¦ç”¨Mavenåšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥ä½¿ç”¨Mavenç¼–è¯‘å™¨æ’ä»¶çš„<code>annotationProcessors</code>å±æ€§æŒ‰æ­£ç¡®é¡ºåºåˆ—å‡ºæ³¨é‡Šå¤„ç†å™¨ã€‚å¦‚æœä¸ä½¿ç”¨è¯¥å±æ€§ï¼Œæ³¨é‡Šå¤„ç†å™¨ç”±classpathä¸Šçš„å¯ç”¨ä¾èµ–é¡¹æ‹¾å–ï¼Œè¯·ç¡®ä¿lombokä¾èµ–é¡¹å®šä¹‰åœ¨<code>spring-boot-configuration-processor</code>ä¾èµ–é¡¹ä¹‹å‰ã€‚ </p></li><li><p>è‡ªåŠ¨å…ƒæ•°æ®ç”Ÿæˆ </p><ul><li><code>@ConfigurationProperties</code> æ³¨é‡Šçš„ç±»å’Œæ–¹æ³•ã€‚å¦‚æœè¯¥ç±»ä¹Ÿè¢«<code>@ConstructorBinding</code>æ³¨è§£ï¼Œé‚£ä¹ˆé¢„è®¡ä¼šæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¹¶ä¸”æ¯ä¸ªæ„é€ å‡½æ•°å‚æ•°ä¼šåˆ›å»ºä¸€ä¸ªå±æ€§ã€‚å¦åˆ™ï¼Œå±æ€§æ˜¯é€šè¿‡æ ‡å‡†çš„getterå’Œsetterçš„å­˜åœ¨æ¥å‘ç°çš„ï¼Œå¹¶å¯¹é›†åˆå’Œmapç±»å‹è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼ˆå³ä½¿åªæœ‰ä¸€ä¸ªgetterå­˜åœ¨ï¼Œä¹Ÿä¼šè¢«å‘ç°ï¼‰ã€‚æ³¨è§£å¤„ç†å™¨ä¹Ÿæ”¯æŒä½¿ç”¨<code>@Dataã€@Valueã€@Getterå’Œ@Setter</code> lombokæ³¨é‡Šã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;my.server&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServerProperties</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Name of the server.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * IP address to listen to.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Port to listener to.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">9797</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getIp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.ip;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIp</span><span class="params">(String ip)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ip = ip;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPort</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.port;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPort</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// fold:off</span></span><br></pre></td></tr></table></figure><ul><li>æ³¨é‡Šå¤„ç†å™¨åº”ç”¨ä¸€äº›å¯å‘å¼æ–¹æ³•æ¥ä»æºæ¨¡å‹ä¸­æå–é»˜è®¤å€¼ã€‚é»˜è®¤å€¼å¿…é¡»ä»¥é™æ€æ–¹å¼æä¾›ã€‚ç‰¹åˆ«æ˜¯ï¼Œä¸è¦å¼•ç”¨å¦ä¸€ä¸ªç±»ä¸­å®šä¹‰çš„å¸¸é‡ã€‚å¦å¤–ï¼Œæ³¨é‡Šå¤„ç†å™¨ä¸èƒ½è‡ªåŠ¨æ£€æµ‹ <code>Enums</code> å’Œ <code>Collectionss</code> çš„é»˜è®¤å€¼ã€‚å¯¹äºæ— æ³•æ£€æµ‹åˆ°é»˜è®¤å€¼çš„æƒ…å†µï¼Œåº”æä¾›æ‰‹åŠ¨å…ƒæ•°æ®ã€‚è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;my.messaging&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMessagingProperties</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; addresses = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>));</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="type">ContainerType</span> <span class="variable">containerType</span> <span class="operator">=</span> ContainerType.SIMPLE;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getAddresses</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.addresses;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddresses</span><span class="params">(List&lt;String&gt; addresses)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addresses = addresses;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> ContainerType <span class="title function_">getContainerType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.containerType;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContainerType</span><span class="params">(ContainerType containerType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.containerType = containerType;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ContainerType</span> &#123;</span><br><span class="line">        SIMPLE, DIRECT</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ä¸ºäº†è®°å½•ä¸Šè¿°ç±»ä¸­å±æ€§çš„é»˜è®¤å€¼ï¼Œæ‚¨å¯ä»¥å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ¨¡å—çš„æ‰‹åŠ¨å…ƒæ•°æ®ä¸­ï¼š</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my.messaging.addresses&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;defaultValue&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span> <span class="string">&quot;b&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my.messaging.container-type&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;defaultValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;simple&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">&#125;</span> </span><br></pre></td></tr></table></figure><ul><li>åµŒå¥—å±æ€§ <ul><li>æ³¨é‡Šå¤„ç†å™¨è‡ªåŠ¨å°†å†…éƒ¨ç±»è§†ä¸ºåµŒå¥—å±æ€§ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå­å‘½åç©ºé—´ï¼Œè€Œä¸æ˜¯åœ¨å‘½åç©ºé—´çš„æ ¹ç›®å½•è®°å½• ip å’Œç«¯å£ã€‚è€ƒè™‘æ›´æ–°çš„ç¤ºä¾‹ï¼š</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;my.server&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServerProperties</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Host host;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Host <span class="title function_">getHost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.host;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHost</span><span class="params">(Host host)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Host</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">private</span> String ip;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getIp</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.ip;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIp</span><span class="params">(String ip)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.ip = ip;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPort</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.port;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPort</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.port = port;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>å‰é¢çš„ä¾‹å­ä¸º<code>my.server.name</code>ã€<code>my.server.host.ip</code>å’Œ<code>my.server.host.port</code>å±æ€§äº§ç”Ÿå…ƒæ•°æ®ä¿¡æ¯ã€‚ä½ å¯ä»¥åœ¨ä¸€ä¸ªå­—æ®µä¸Šä½¿ç”¨<code>@NestedConfigurationProperty</code>æ³¨è§£æ¥è¡¨ç¤ºä¸€ä¸ªæ™®é€šçš„ï¼ˆéå†…éƒ¨ï¼‰ç±»åº”è¯¥è¢«å½“ä½œæ˜¯åµŒå¥—çš„ã€‚</p></li><li><p>è¿™å¯¹é›†åˆå’Œmapæ²¡æœ‰å½±å“ï¼Œå› ä¸ºè¿™äº›ç±»å‹è¢«è‡ªåŠ¨è¯†åˆ«ï¼Œå¹¶ä¸”ä¸ºå®ƒä»¬ä¸­çš„æ¯ä¸€ä¸ªç”Ÿæˆä¸€ä¸ªå…ƒæ•°æ®å±æ€§ã€‚</p><ul><li>æ·»åŠ é¢å¤–çš„å…ƒæ•°æ® <ul><li>Spring Bootçš„é…ç½®æ–‡ä»¶å¤„ç†æ˜¯ç›¸å½“çµæ´»çš„ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå¯èƒ½å­˜åœ¨æœªä¸<code>@ConfigurationProperties</code> Beanç»‘å®šçš„å±æ€§ã€‚ä½ ä¹Ÿå¯èƒ½éœ€è¦è°ƒæ•´ç°æœ‰é”®çš„ä¸€äº›å±æ€§ã€‚ä¸ºäº†æ”¯æŒè¿™ç§æƒ…å†µå¹¶è®©ä½ æä¾›è‡ªå®šä¹‰çš„ â€œæç¤ºâ€ï¼Œæ³¨è§£å¤„ç†å™¨è‡ªåŠ¨å°†<code>META-INF/additional-spring-configuration-metadata.json</code>ä¸­çš„é¡¹ç›®åˆå¹¶åˆ°ä¸»å…ƒæ•°æ®æ–‡ä»¶ä¸­ã€‚</li><li>å¦‚æœä½ å¼•ç”¨äº†ä¸€ä¸ªå·²ç»è¢«è‡ªåŠ¨æ£€æµ‹åˆ°çš„å±æ€§ï¼Œé‚£ä¹ˆæè¿°ã€é»˜è®¤å€¼å’ŒåºŸå¼ƒä¿¡æ¯å°†è¢«è¦†ç›–ï¼Œå¦‚æœæŒ‡å®šçš„è¯ã€‚å¦‚æœæ‰‹åŠ¨å±æ€§å£°æ˜åœ¨å½“å‰æ¨¡å—ä¸­æ²¡æœ‰è¢«è¯†åˆ«ï¼Œå®ƒå°†è¢«ä½œä¸ºä¸€ä¸ªæ–°çš„å±æ€§æ·»åŠ ã€‚</li><li><code>additional-spring-configuration-metadata.json</code>æ–‡ä»¶çš„æ ¼å¼ä¸å¸¸è§„çš„<code>spring-configuration-metadata.json</code>å®Œå…¨ç›¸åŒã€‚é™„åŠ å±æ€§æ–‡ä»¶æ˜¯å¯é€‰çš„ã€‚å¦‚æœä½ æ²¡æœ‰ä»»ä½•é™„åŠ å±æ€§ï¼Œè¯·ä¸è¦æ·»åŠ è¯¥æ–‡ä»¶ã€‚</li></ul></li></ul></li><li><p>â€œautoconfigureâ€æ¨¡å— </p><ul><li>autoconfigureæ¨¡å—åŒ…å«äº†å¼€å§‹ä½¿ç”¨è¯¥åº“æ‰€éœ€çš„ä¸€åˆ‡ã€‚å®ƒè¿˜å¯èƒ½åŒ…å«é…ç½®é”®çš„å®šä¹‰ï¼ˆå¦‚<code>@ConfigurationProperties</code>ï¼‰å’Œä»»ä½•å¯ç”¨äºè¿›ä¸€æ­¥å®šåˆ¶ç»„ä»¶åˆå§‹åŒ–æ–¹å¼çš„å›è°ƒæ¥å£ã€‚ <ul><li>ä½ åº”è¯¥æŠŠå¯¹åº“çš„ä¾èµ–æ ‡è®°ä¸ºå¯é€‰çš„ï¼Œè¿™æ ·ä½ å°±å¯ä»¥æ›´å®¹æ˜“åœ°æŠŠè‡ªåŠ¨é…ç½®æ¨¡å—çº³å…¥ä½ çš„é¡¹ç›®ä¸­ã€‚å¦‚æœä½ è¿™æ ·åšï¼Œè¯¥åº“å°±ä¸ä¼šè¢«æä¾›ï¼Œè€Œä¸”åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Bootä¼šé€€ç¼©ã€‚</li></ul></li><li>Spring Bootä½¿ç”¨æ³¨é‡Šå¤„ç†å™¨æ¥æ”¶é›†å…ƒæ•°æ®æ–‡ä»¶ï¼ˆ<code>META-INF/spring-autoconfigure-metadata.properties</code>ï¼‰ä¸­çš„è‡ªåŠ¨é…ç½®æ¡ä»¶ã€‚å¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨ï¼Œå®ƒè¢«ç”¨æ¥æ€¥åˆ‡åœ°è¿‡æ»¤ä¸åŒ¹é…çš„è‡ªåŠ¨é…ç½®ï¼Œè¿™å°†æ”¹å–„å¯åŠ¨æ—¶é—´ã€‚å»ºè®®åœ¨åŒ…å«è‡ªåŠ¨é…ç½®çš„æ¨¡å—ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–å…³ç³»ã€‚</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å¦‚æœä½ åœ¨åº”ç”¨ç¨‹åºä¸­ç›´æ¥å®šä¹‰äº†è‡ªåŠ¨é…ç½®ï¼Œè¯·ç¡®ä¿é…ç½®spring-boot-maven-pluginï¼Œä»¥é˜²æ­¢repackageç›®æ ‡å°†ä¾èµ–å…³ç³»åŠ å…¥fat jarä¸­ã€‚</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç›¸å…³åŒ…çš„ä½œç”¨"><a href="#ç›¸å…³åŒ…çš„ä½œç”¨" class="headerlink" title="ç›¸å…³åŒ…çš„ä½œç”¨"></a>ç›¸å…³åŒ…çš„ä½œç”¨</h2><h3 id="spring-boot-autoconfigureåŒ…"><a href="#spring-boot-autoconfigureåŒ…" class="headerlink" title="spring-boot-autoconfigureåŒ…"></a>spring-boot-autoconfigureåŒ…</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡çµæ´»çš„Auto-configurationæ³¨è§£ä½¿SpringBootä¸­çš„åŠŸèƒ½å®ç°æ¨¡å—åŒ–å’Œå¯è¢«æ›¿æ¢æ‰©å±•ã€‚</li><li>spring-boot-autoconfigureæ€è·¯ç±»ä¼¼SPI(Service Provider Interface)ï¼Œéƒ½æ˜¯ä¸åŒçš„å®ç°ç±»å®ç°äº†å®šä¹‰çš„æ¥å£ï¼ŒåŠ è½½æ—¶å€™å»æŸ¥æ‰¾classpathä¸‹çš„å®ç°ç±»ï¼Œä¸åŒåœ¨äºå‰è€…ä½¿ç”¨autoconfigureå®ç°åè€…ä½¿ç”¨çš„æ˜¯ServiceLoaderã€‚</li></ul><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070020091.png"></p><h3 id="spring-boot-configuration-processoråŒ…"><a href="#spring-boot-configuration-processoråŒ…" class="headerlink" title="spring-boot-configuration-processoråŒ…"></a>spring-boot-configuration-processoråŒ…</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>spring-boot-configuration-processorçš„ä½œç”¨æ˜¯ç”Ÿæˆé…ç½®çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå³META-INFç›®å½•ä¸‹çš„spring-configuration-metadata.jsonæ–‡ä»¶ï¼Œä»è€Œå‘Šè¯‰springè¿™ä¸ªjaråŒ…ä¸­æœ‰å“ªäº›è‡ªå®šä¹‰çš„é…ç½®</li><li>å…¶ä¸­spring-configuration-metadata.jsonæ–‡ä»¶æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆçš„</li></ul><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070019590.png"></p><h3 id="spring-boot-autoconfigure-processoråŒ…"><a href="#spring-boot-autoconfigure-processoråŒ…" class="headerlink" title="spring-boot-autoconfigure-processoråŒ…"></a>spring-boot-autoconfigure-processoråŒ…</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070026766.png"></p><ul><li>è¿™ä¸ªæ–‡ä»¶éœ€è¦æ‰‹åŠ¨åˆ›å»º</li><li>åœ¨å¯åŠ¨æ—¶ä¼šè¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œå…ˆæ ¹æ®æ¡ä»¶æƒ…å†µåŠ è½½ï¼Œè¿™æ ·ä¸ä¼šå‡ºç°ä»»ä½•é…ç½®ç±»éƒ½åŠ è½½ä¸€è¾¹çš„æƒ…å†µï¼ŒåŠ å¿«springå¯åŠ¨çš„é€Ÿåº¦</li><li>spring-bootä¼šé€šè¿‡spring-bootçš„SPIæœºåˆ¶ï¼Œè·å¾—æ‰€æœ‰è‡ªåŠ¨è£…é…é…ç½®ä¸»ç±»ä¿¡æ¯</li></ul><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211051956312.png" alt="image-20221105195559287"></p><h2 id="æ€ä¹ˆç©"><a href="#æ€ä¹ˆç©" class="headerlink" title="æ€ä¹ˆç©?"></a>æ€ä¹ˆç©?</h2><h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><ul><li><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211042225778.png" alt="image.png"></li><li>ä¸Šé¢è¿™ç§ç»“æ„æ˜¯æˆ‘æ•…æ„çš„ï¼Œå…¶å®æœ€å¥½çš„ç»“æ„æ˜¯ç›´æ¥ä½¿ç”¨â€œexample-spring-boot-starterâ€ä½œä¸ºé¡¹ç›®ï¼Œè€Œéå†…éƒ¨çš„å­æ¨¡å—â€example-spring-boot-autoconfiguationâ€</li><li>æˆ‘è¿™æ ·çš„åšçš„ç›®çš„æ˜¯çœ‹åˆ°è¿‡ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä½¿ç”¨çš„å°±æ˜¯Springçš„AutoConfigurationè¿™ç§å½¢å¼ï¼Œç»„åˆæ•´ä¸ªé¡¹ç›®</li></ul><h3 id="å…·ä½“æ­¥éª¤"><a href="#å…·ä½“æ­¥éª¤" class="headerlink" title="å…·ä½“æ­¥éª¤"></a>å…·ä½“æ­¥éª¤</h3><ul><li>åŸºç¡€ä¾èµ–åŒ…</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>è¿˜å¯ä»¥æ·»åŠ lombokä¾èµ–</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><pre><code>  -  ä¸è¿‡è¿™ä¸ªä¾èµ–éœ€è¦é¦–å…ˆè¢«é¡¹ç›®åŠ è½½ï¼Œç„¶åæ‰æ˜¯annotation processor</code></pre><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥spring-boot-autoconfigure-processoråŒ…ï¼Œåœ¨å¯åŠ¨æ˜¯æ ¹æ®æ¡ä»¶åˆ¤æ–­æ˜¯å¦åŠ è½½éƒ¨åˆ†é…ç½®ç±» <ul><li>åŠ å¿«springbootå¯åŠ¨é€Ÿåº¦</li></ul></li><li>å®Œæ•´ä¾èµ–</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>æ€»å…±æœ‰å››ä¸ªå¿…é¡»çš„è§’è‰² <ul><li>propertieså¯¹è±¡</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.autoconfiguration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;com.zhazha.example&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">enable</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Host</span> <span class="variable">host</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Host</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">8777</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Host</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">8080</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>è‡ªåŠ¨é…ç½®ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.autoconfiguration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.service.ExampleTools;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnClass;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @Configuration è¿™ä¸ªæ³¨è§£æœ€å¥½åˆ«åŠ ï¼ŒåŠ äº†å¯èƒ½è¢« spring æ³¨è§£æ‰«æå™¨æ‰«æåˆ°</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(value = ExampleProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(value = SpringApplication.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;com.zhazha.example&quot;, name = &quot;enable&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> ExampleTools <span class="title function_">exampleTools</span><span class="params">(ExampleProperties properties)</span> &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;åŠ è½½ Example&quot;</span>);</span><br><span class="line">        <span class="type">ExampleTools</span> <span class="variable">exampleTools</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExampleTools</span>();</span><br><span class="line">        exampleTools.setUsername(properties.getUsername());</span><br><span class="line">        exampleTools.setPassword(properties.getPassword());</span><br><span class="line">        exampleTools.setHost(properties.getHost());</span><br><span class="line">        <span class="keyword">return</span> exampleTools;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>  - æ³¨æ„ï¼š@Configuration è¿™ä¸ªæ³¨è§£æœ€å¥½åˆ«åŠ ï¼ŒåŠ äº†å¯èƒ½è¢« spring æ³¨è§£æ‰«æå™¨æ‰«æåˆ° </code></pre><ul><li>éœ€è¦è‡ªåŠ¨é…ç½®ï¼Œåœ¨å¤–éƒ¨é¡¹ç›®ä½¿ç”¨çš„ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.autoconfiguration.ExampleProperties;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleTools</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> ExampleProperties.Host host;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ç”¨æˆ·åä¸ºï¼š&quot;</span> + username + <span class="string">&quot;&gt;&gt;&gt;&quot;</span> + <span class="string">&quot;å¯†ç ä¸ºï¼š&quot;</span> + password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">host</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;host: &quot;</span> + host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>spring.factories</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">  com.zhazha.autoconfiguration.ExampleAutoConfiguration</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºspring-autoconfigure-metadata.propertiesï¼ˆå¯é€‰ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.zhazha.autoconfiguration.ExampleAutoConfiguration=</span><br><span class="line">com.zhazha.autoconfiguration.ExampleAutoConfiguration.ConditionalOnClass=org.springframework.boot.SpringApplication</span><br></pre></td></tr></table></figure><ul><li>mavenå®‰è£…è‡ªåŠ¨é…ç½®é¡¹ç›®åˆ°mavenä»“åº“ <ul><li><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211042225550.png" alt="image.png"></li><li>ä¹Ÿå¯ä»¥ä½¿ç”¨mvn clean install -Dmaven.test.skip&#x3D;true </li><li>installä¹‹åä¼šå‘ç° <ul><li><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211042224215.png" alt="image.png"></li></ul></li><li>å¤šåˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°±æ˜¯spring-boot-configuration-processorè¿™ä¸ªåŒ…è‡ªåŠ¨åˆ›å»ºçš„ </li><li>ä¸»è¦åŠŸèƒ½ï¼šapplication,ymlçš„æç¤º</li></ul></li></ul><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><ul><li>ä½¿ç”¨æ–¹å¼å°±éå¸¸ç®€å•äº† </li><li><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211042225731.png" alt="image.png"></li><li>application.yml</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">com:</span></span><br><span class="line">  <span class="attr">zhazha:</span></span><br><span class="line">    <span class="attr">example:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">zhazha</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">host:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8088</span></span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.zhazha.service.ExampleTools;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line">    <span class="meta">@RestController</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            SpringApplication.run(Application.class, args);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Resource</span></span><br><span class="line">        <span class="keyword">private</span> ExampleTools exampleTools;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@GetMapping(&quot;hello&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">hello</span> <span class="operator">=</span> exampleTools.hello();</span><br><span class="line">            <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> exampleTools.host();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;example: &quot;</span> + <span class="string">&quot;\t hello: &quot;</span> + hello + <span class="string">&quot; \t host: &quot;</span> + host + <span class="string">&quot;\t random: &quot;</span> + <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h3><ul><li>é¡¹ç›®æ ¹æ®Spring AutoConfigurationå½¢å¼è¿›è¡Œç»„åˆ <ul><li>é¡¹ç›®ç»“æ„ <ul><li><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211042226908.png" alt="image.png"></li><li>example-spring-boot <ul><li>è¿™æ˜¯ä¸»é¡¹ç›®</li></ul></li><li>example-spring-boot-autoconfiguation <ul><li>è¿™ä¸ªé¡¹ç›®å¸¦ç€è‡ªåŠ¨é…ç½®åŠŸèƒ½</li><li>è¯¥é¡¹ç›®å¯ä»¥è‡ªå·±å¯åŠ¨ï¼Œå› ä¸ºæœ‰å¯åŠ¨ç±»ï¼Œä¹Ÿå¯ä»¥åœ¨example-spring-booté¡¹ç›®ä¸­å¯åŠ¨ï¼Œç„¶åä½¿ç”¨</li></ul></li></ul></li><li>example-spring-boot-autoconfiguationè‡ªåŠ¨é…ç½®é¡¹ç›® <ul><li>ä¾èµ–</li></ul></li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>propertiesç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.autoconfiguration.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;com.zhazha.example&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Boolean enable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åŠ è½½ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.autoconfiguration.<span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.autoconfiguration.ModuleApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ClassPathBeanDefinitionScanner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ImportBeanDefinitionRegistrar;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.AnnotationMetadata;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleModuleLoader</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="type">ClassPathBeanDefinitionScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>(registry);</span><br><span class="line">        <span class="type">int</span> <span class="variable">scan</span> <span class="operator">=</span> scanner.scan(ModuleApplication.class.getPackageName());</span><br><span class="line">        System.err.println(<span class="string">&quot;example-autoconfiguration æ¨¡å—åŠ è½½äº† &quot;</span> + scan + <span class="string">&quot;ä¸ªç±»&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ ¸å¿ƒä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ClassPathBeanDefinitionScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>(registry);</span><br><span class="line"><span class="type">int</span> <span class="variable">scan</span> <span class="operator">=</span> scanner.scan(ModuleApplication.class.getPackageName());</span><br><span class="line">System.err.println(<span class="string">&quot;example-autoconfiguration æ¨¡å—åŠ è½½äº† &quot;</span> + scan + <span class="string">&quot;ä¸ªç±»&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li><p>å°±æ˜¯ä¸çŸ¥é“è¿™ç§æ–¹å¼åŠ è½½çš„ç±»æ˜¯å¦å­˜åœ¨é—®é¢˜ </p></li><li><p>æ˜¯å¦è¿˜æœ‰æ›´ä¼˜è§£ </p></li><li><p>è‡ªåŠ¨é…ç½®ç±»</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.autoconfiguration.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.autoconfiguration.<span class="keyword">module</span>.ExampleModuleLoader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="comment">//@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(value = ExampleProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;com.zhazha.example&quot;, name = &quot;enable&quot;, matchIfMissing = false)</span></span><br><span class="line"><span class="meta">@Import(ExampleModuleLoader.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleAutoConfiguration</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºMETA-INFæ–‡ä»¶ <ul><li>spring.factories</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">  com.zhazha.autoconfiguration.config.ExampleAutoConfiguration</span><br></pre></td></tr></table></figure><ul><li>spring-autoconfigure-metadata.properties</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.zhazha.autoconfiguration.config.ExampleAutoConfiguration=</span><br><span class="line">com.zhazha.autoconfiguration.config.ExampleAutoConfiguration.ConditionalOnClass=org.springframework.boot.SpringApplication</span><br></pre></td></tr></table></figure><ul><li>service</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.autoconfiguration.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModuleService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">module</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;zhazha ModuleService&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>controller</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.autoconfiguration.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.autoconfiguration.service.ModuleService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Module01Controller</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ModuleService moduleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;module01&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">module01</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;module-1 \t &quot;</span> + moduleService.<span class="keyword">module</span>() + <span class="string">&quot;\t&quot;</span> + <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ç±»ï¼ˆå¯é€‰ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.autoconfiguration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModuleApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    SpringApplication.run(ModuleApplication.class, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>example-spring-boot <ul><li>ä¾èµ–</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>example-spring-boot-autoconfiguation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8080</span><br><span class="line">com:</span><br><span class="line">  zhazha:</span><br><span class="line">    example:</span><br><span class="line">      enable: true</span><br></pre></td></tr></table></figure><ul><li><p>æˆ‘ä»¬çš„è‡ªåŠ¨é…ç½®é¡¹ç›®åœ¨è¿™é‡Œè¢«å¯åŠ¨</p></li><li><p>å¯åŠ¨ç±»</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            SpringApplication.run(ExampleApplication.class, args);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>controller</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.example.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.autoconfiguration.service.ModuleService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Resource</span></span><br><span class="line">  <span class="keyword">private</span> ModuleService moduleService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;index&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index Controller\t&quot;</span> + moduleService.<span class="keyword">module</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è‡ªå®šä¹‰ä¸€ä¸ªJasyncçš„spring-boot-starter <ul><li>èƒŒæ™¯ <ul><li>jasyncå¦‚æœæŒ‰ç…§å®˜æ–¹è‡ªåŠ¨é…ç½®ï¼Œä¼šæŠ¥é”™</li></ul></li><li>æ­¥éª¤ <ul><li>ä¾èµ–</li></ul></li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha.jasync<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasync-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-r2dbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.jasync-sql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasync-r2dbc-mysql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.projectreactor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reactor-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><ul><li>éœ€è¦æ·»åŠ ï¼Œé˜²æ­¢mavenæŠ¥é”™</li><li>ä¸»è¦åŸå› æ˜¯ï¼šå­æ¨¡å—çš„çˆ¶é¡¹ç›®ä¸æ˜¯åŸæœ¬çš„çˆ¶é¡¹ç›®ï¼Œè€Œæ˜¯å…¶ä»–çˆ¶é¡¹ç›®</li><li>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å­é¡¹ç›®çš„çˆ¶é¡¹ç›®æ˜¯spring-boot-parentï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ </li></ul></li><li>true <ul><li>è¿™ä¸ªä¹Ÿæ˜¯éœ€è¦æ·»åŠ çš„ </li><li>mavençš„scopeçš„ç¼–è¯‘æ¨¡å¼ä¼šä¼ é€’ä¾èµ–ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨è¿™é¡¹åŠŸèƒ½é˜»æ­¢ä¾èµ–è¢«ä¼ é€’åˆ°å¤–éƒ¨é¡¹ç›®ä¸­ï¼ˆproviderç­‰æ¨¡å¼ä¸ä¼ é€’ä¾èµ–ï¼‰ </li><li>ä¾èµ–</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-r2dbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.jasync-sql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasync-r2dbc-mysql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>è€Œä¸Šé¢çš„ä¸¤ä¸ªåŒ…ä¹‹æ‰€ä»¥ä¸éœ€è¦æ·»åŠ optionalæ˜¯å› ä¸ºéœ€è¦æœ‰è¿™ä¸¤ä¸ªåŒ…ï¼Œå¤–éƒ¨éœ€è¦æœ‰è¿™ä¸¤ä¸ªåŒ… </p><ul><li>propertiesç±»</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span>  </span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix  = &quot;com.zhazha.jasync&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JasyncProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">enabled</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><ul><li><p>å†³å®šäº†é…ç½®æœ€ç»ˆæ˜¯å¦åœ¨ä¸»é¡¹ç›®ä¸­ä½¿ç”¨</p><ul><li>è‡ªåŠ¨é…ç½®ç±»</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.jasync.r2dbc.mysql.JasyncConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> com.github.jasync.sql.db.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.github.jasync.sql.db.mysql.pool.MySQLConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> io.r2dbc.pool.ConnectionPool;</span><br><span class="line"><span class="keyword">import</span> io.r2dbc.pool.ConnectionPoolConfiguration;</span><br><span class="line"><span class="keyword">import</span> io.r2dbc.spi.ConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> io.r2dbc.spi.ConnectionFactoryOptions;</span><br><span class="line"><span class="keyword">import</span> org.jetbrains.annotations.NotNull;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.AutoConfigureOrder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnClass;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.r2dbc.R2dbcProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.PropertyMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.r2dbc.connection.R2dbcTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.ReactiveTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">//@AutoConfiguration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(value = JasyncAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(ConnectionFactory.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;com.zhazha.jasync&quot;, name = &quot;enabled&quot;, havingValue = &quot;true&quot;)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(value = Ordered.HIGHEST_PRECEDENCE + 12)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JasyncAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    ConnectionPool <span class="title function_">connectionFactory</span><span class="params">(R2dbcProperties properties)</span> &#123;</span><br><span class="line">        <span class="type">JasyncConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> createConnectionFactory(properties);</span><br><span class="line">        R2dbcProperties.<span class="type">Pool</span> <span class="variable">pool</span> <span class="operator">=</span> properties.getPool();</span><br><span class="line">        <span class="type">PropertyMapper</span> <span class="variable">map</span> <span class="operator">=</span> PropertyMapper.get().alwaysApplyingWhenNonNull();</span><br><span class="line">        ConnectionPoolConfiguration.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> ConnectionPoolConfiguration.builder(connectionFactory);</span><br><span class="line">        map.from(pool.getMaxIdleTime()).to(builder::maxIdleTime);</span><br><span class="line">        map.from(pool.getMaxLifeTime()).to(builder::maxLifeTime);</span><br><span class="line">        map.from(pool.getMaxAcquireTime()).to(builder::maxAcquireTime);</span><br><span class="line">        map.from(pool.getMaxCreateConnectionTime()).to(builder::maxCreateConnectionTime);</span><br><span class="line">        map.from(pool.getInitialSize()).to(builder::initialSize);</span><br><span class="line">        map.from(pool.getMaxSize()).to(builder::maxSize);</span><br><span class="line">        map.from(pool.getValidationQuery()).whenHasText().to(builder::validationQuery);</span><br><span class="line">        map.from(pool.getValidationDepth()).to(builder::validationDepth);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConnectionPool</span>(builder.build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JasyncConnectionFactory <span class="title function_">createConnectionFactory</span><span class="params">(R2dbcProperties properties)</span> &#123;</span><br><span class="line">        <span class="type">ConnectionFactoryOptions</span> <span class="variable">connectionFactoryOptions</span> <span class="operator">=</span> ConnectionFactoryOptions.parse(properties.getUrl());</span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(</span><br><span class="line">                properties.getUsername(),</span><br><span class="line">                Objects.requireNonNull(connectionFactoryOptions.getValue(ConnectionFactoryOptions.HOST)).toString(),</span><br><span class="line">                (Integer) connectionFactoryOptions.getValue(ConnectionFactoryOptions.PORT),</span><br><span class="line">                properties.getPassword(),</span><br><span class="line">                (String) connectionFactoryOptions.getValue(ConnectionFactoryOptions.DATABASE));</span><br><span class="line">        <span class="type">JasyncConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JasyncConnectionFactory</span>(<span class="keyword">new</span> <span class="title class_">MySQLConnectionFactory</span>(configuration));</span><br><span class="line">        <span class="keyword">return</span> connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ReactiveTransactionManager <span class="title function_">transactionManager</span><span class="params">(ConnectionPool factory)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R2dbcTransactionManager</span>(factory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>è¿™ä¸ªç±»ä¸èƒ½è¢«spring boot ç»„ä»¶æ‰«æå™¨æ‰«æåˆ°</p></li><li><p>åªèƒ½è¢«spring.factories æˆ–è€… @importæ³¨è§£è¢«springæ³¨å…¥</p></li><li><p>æ‰€ä»¥æˆ‘æŠŠ@AutoConfigurationæ³¨é‡Šæ‰äº†</p></li><li><p>åˆ›å»ºMETA-INF&#x2F;spring.factories </p><ul><li>å†…å®¹</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">  com.zhazha.jasync.config.JasyncAutoConfiguration</span><br></pre></td></tr></table></figure><h1 id="2-7-xæ–°ç‰ˆæœ¬"><a href="#2-7-xæ–°ç‰ˆæœ¬" class="headerlink" title="2.7.xæ–°ç‰ˆæœ¬"></a>2.7.xæ–°ç‰ˆæœ¬</h1><h2 id="æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ"><a href="#æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ" class="headerlink" title="æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ"></a>æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ</h2><p>ä¹‹å‰ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070032774.png" alt="image-20221107003224611"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070032112.png" alt="image-20221107003238956"></p><p>ä¹‹åæ˜¯è¿™æ ·:</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070049101.png" alt="image-20221107004909991"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070049330.png" alt="image-20221107004932572"></p><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥å°† <code>@AutoConfiguration</code> è¿™ä¸ªæ³¨è§£æ³¨é‡Šæ‰ï¼Œè¿˜æ˜¯ä¼šæˆåŠŸã€‚ä¸è¿‡æˆ‘çœ‹åˆ°çš„æ¡ˆä¾‹éƒ½æ·»åŠ äº†è¯¥æ³¨è§£</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070050891.png" alt="image-20221107005019751"></p><ul><li>æ–°ç‰ˆæœ¬æ¨èä½¿ç”¨<code>@AutoConfiguration</code>ä»£æ›¿ <code>spring.factories</code> æ–¹å¼</li><li>ä½¿ç”¨<code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>ä»£æ›¿<code>META-INF/spring.factories</code> <ul><li>å†…å®¹ä»key valueå˜æˆvalue</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.mycorp.libx.autoconfigure.LibXAutoConfiguration</span><br><span class="line">com.mycorp.libx.autoconfigure.LibXWebAutoConfiguration </span><br></pre></td></tr></table></figure><ul><li>è¿˜å¯ä»¥ä½¿ç”¨â€œ#â€æ·»åŠ ä½ çš„æ³¨é‡Š </li><li>æ—§ç‰ˆæœ¬çš„spring.factorieså¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬è¢«æ”¾å¼ƒ </li><li>ä½¿ç”¨@AutoConfigurationæ³¨è§£çš„before, beforeName, after and afterNameå±æ€§æ¥ç¡®å®šåŠ è½½é¡ºåº <ul><li>å½“ç„¶ @AutoConfigureBefore and @AutoConfigureAfterè¿™ä¸¤ä¸ªæ³¨è§£è¿˜å¯ä»¥ä½¿ç”¨ </li><li>beforeè¡¨ç¤ºè¿˜æœªè¢«åŠ è½½çš„è‡ªåŠ¨é…ç½®ç±»</li><li>afterè¡¨ç¤ºå·²ç»è¢«åŠ è½½çš„è‡ªåŠ¨é…ç½®ç±»</li><li>è¿™é‡Œçš„è¿˜æœªå’Œå·²ç»ä»¥è¢«@AutoConfigurationæ³¨è§£çš„ç±»è¢«åŠ è½½çš„é‚£ä¸€ç¬é—´ä¸ºåŸºå‡†</li><li>è¿™ç§ï¼Œè‡ªåŠ¨é…ç½®ç±»ä¹‹é—´èƒ½å¤Ÿè§„å®šé…ç½®ç±»çš„åŠ è½½é¡ºåºï¼Œå¯ä»¥ä¿è¯Aç±»å’ŒBç±»ä¹‹é—´çš„åŠ è½½é¡ºåº</li></ul></li><li>ä½¿ç”¨@AutoConfigureOrderæ³¨è§£æ¥æŒ‡å®šåœ¨è‡ªåŠ¨é…ç½®ç±»ä¹‹é—´çš„é¡ºåº <ul><li>è¿™ç§è™½ç„¶ä¹Ÿèƒ½è§„å®šåŠ è½½é¡ºåºï¼Œä½†æ˜¯å’Œå‰é¢çš„é‚£ç§æ˜ç¡®ä¿è¯Aç±»å’ŒBç±»ä¹‹é—´çš„åŠ è½½é¡ºåºå…³ç³»ä¸åŒï¼Œæ˜¯ç»Ÿä¸€çš„é¡ºåº</li><li>åªä¼šå½±å“è‡ªåŠ¨é…ç½®ç±»ä¹‹é—´çš„é¡ºåºï¼Œä¸ä¼šå½±å“AnnotationConfigApplicationContext.register(Classâ€¦)çš„æ³¨å†Œé¡ºåº</li></ul></li></ul><h2 id="æ€ä¹ˆåšï¼Ÿ"><a href="#æ€ä¹ˆåšï¼Ÿ" class="headerlink" title="æ€ä¹ˆåšï¼Ÿ"></a>æ€ä¹ˆåšï¼Ÿ</h2><ul><li><p>åˆ é™¤spring.factoriesæ”¹ç”¨org.springframework.boot.autoconfigure.AutoConfiguration.imports</p><p> org.springframework.boot.autoconfigure.AutoConfiguration.imports</p><ul><li><p>å†…å®¹</p><p>com.zhazha.autoconfiguration.config.ExampleAutoConfiguration</p></li></ul></li><li><p>ä¿®æ”¹è‡ªåŠ¨é…ç½®ç±»çš„æ³¨è§£</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.autoconfiguration.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.autoconfiguration.<span class="keyword">module</span>.ExampleModuleLoader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.AutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(value = ExampleProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;com.zhazha.example&quot;, name = &quot;enable&quot;, matchIfMissing = false)</span></span><br><span class="line"><span class="meta">@Import(ExampleModuleLoader.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleAutoConfiguration</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ä»Configurationåˆ°AutoConfiguration </li><li>ä½†å®é™…ä¸Šè¿™ä¸ªæ³¨è§£å¯ä»¥ä¸éœ€è¦</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.autoconfiguration.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.autoconfiguration.<span class="keyword">module</span>.ExampleModuleLoader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="comment">//@AutoConfiguration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(value = ExampleProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;com.zhazha.example&quot;, name = &quot;enable&quot;, matchIfMissing = false)</span></span><br><span class="line"><span class="meta">@Import(ExampleModuleLoader.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleAutoConfiguration</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>@AutoConfiguration</code>è¿™ä¸ªæ³¨è§£ä¸æ˜¯ <code>@Configuration</code>æ³¨è§£çš„ä»£æ›¿å“, å®ƒåªç”¨äºspringbooté¡¹ç›®å¯åŠ¨æ—¶</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211050510048.png" alt="image-20221105051008793"></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªåŠ¨é…ç½® </tag>
            
            <tag> SPI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>11Gateway è‡ªå®šä¹‰ç½‘å…³è¿‡æ»¤å™¨</title>
      <link href="/2022/11/07/02springcloud/11Gateway%20%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E5%85%B3%E8%BF%87%E6%BB%A4%E5%99%A8/"/>
      <url>/2022/11/07/02springcloud/11Gateway%20%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E5%85%B3%E8%BF%87%E6%BB%A4%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Gatewayè¿‡æ»¤å™¨æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#Gatewayè¿‡æ»¤å™¨æœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="Gatewayè¿‡æ»¤å™¨æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a>Gatewayè¿‡æ»¤å™¨æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h1><p>ä¸€ä¸ªæ ‡å‡†çš„Spring webFilterï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨<strong>è¯·æ±‚ä¹‹å‰æˆ–è€…ä¹‹åæ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚</strong></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070142198.png" alt="image.png"></p><p>ä»å›¾ä¸­å¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºï¼Œåœ¨è¯·æ±‚åç«¯æœåŠ¡å‰åéƒ½éœ€è¦ç»è¿‡Filterï¼Œäºæ˜¯ä¹Filterçš„ä½œç”¨å°±æ˜ç¡®äº†ï¼Œåœ¨PreFilter(è¯·æ±‚å‰å¤„ç†)å¯ä»¥åš<strong>å‚æ•°æ ¡éªŒ</strong>ã€<strong>æµé‡ç›‘æ§</strong>ã€<strong>æ—¥å¿—è®°å½•</strong>ã€<strong>ä¿®æ”¹è¯·æ±‚å†…å®¹</strong>ç­‰ç­‰ï¼Œåœ¨PostFilter(è¯·æ±‚åå¤„ç†)å¯ä»¥åš<strong>å“åº”å†…å®¹ä¿®æ”¹</strong>ã€‚</p><h1 id="Gatewayè¿‡æ»¤å™¨åˆ†ç±»"><a href="#Gatewayè¿‡æ»¤å™¨åˆ†ç±»" class="headerlink" title="Gatewayè¿‡æ»¤å™¨åˆ†ç±»"></a>Gatewayè¿‡æ»¤å™¨åˆ†ç±»</h1><p>Gatewayä¸­ä¸€å…±æä¾›äº†ä¸¤ç§è¿‡æ»¤å™¨ï¼Œä¸€ç§æ˜¯GatewayFilterã€GlobalFilterï¼›<br />GatewayFilterï¼šGatewayç½‘å…³è¿‡æ»¤å™¨ï¼Œæ˜¯é’ˆå¯¹å•ä¸ªè·¯ç”±çš„è¿‡æ»¤å™¨ï¼Œåˆç§°å±€éƒ¨è¿‡æ»¤å™¨ï¼Œå…¶åŠŸèƒ½æ˜¯é’ˆå¯¹è®¿é—®çš„URLèµ·åˆ°ä¸€å®šçš„è¿‡æ»¤æ•ˆæœã€‚<br />GlobalFilterï¼šä»åç§°è€Œè¨€ï¼Œé‚£å°±æ˜¯å…¨å±€è¿‡æ»¤å™¨ï¼Œæ˜¯éœ€è¦å®ç°å…·ä½“çš„Javaç±»æ¥å®ç°GlobalFilteræ¥å£ï¼Œè¿™å…¶ä¸­å¯ä»¥æ ¹æ®è¿›è¡Œæƒé™çš„éªŒè¯ï¼ŒHTTPè¯·æ±‚çš„å¤´éƒ¨æ·»åŠ ç­‰ç­‰ã€‚</p><h1 id="è¿‡æ»¤å™¨çš„å£°æ˜å‘¨æœŸ"><a href="#è¿‡æ»¤å™¨çš„å£°æ˜å‘¨æœŸ" class="headerlink" title="è¿‡æ»¤å™¨çš„å£°æ˜å‘¨æœŸ"></a>è¿‡æ»¤å™¨çš„å£°æ˜å‘¨æœŸ</h1><p>æœ‰preå’Œpostä¸¤ç§æ–¹å¼çš„filter,åˆ†åˆ«å¤„ç†å‰ç½®é€»è¾‘å’Œåç½®é€»è¾‘ã€‚å®¢æˆ·ç«¯çš„è¯·æ±‚å…ˆç»è¿‡preç±»å‹çš„filterï¼Œç„¶åå°†è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„ä¸šåŠ¡æœåŠ¡ï¼Œæ”¶åˆ°ä¸šåŠ¡æœåŠ¡çš„å“åº”ä¹‹åï¼Œå†ç»è¿‡postç±»å‹çš„filterå¤„ç†ï¼Œæœ€åè¿”å›å“åº”åˆ°å®¢æˆ·ç«¯ã€‚</p><h1 id="è¿‡æ»¤å™¨çš„ä¼˜å…ˆçº§"><a href="#è¿‡æ»¤å™¨çš„ä¼˜å…ˆçº§" class="headerlink" title="è¿‡æ»¤å™¨çš„ä¼˜å…ˆçº§"></a>è¿‡æ»¤å™¨çš„ä¼˜å…ˆçº§</h1><p><strong>orderè¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;AFilterå‰ç½®é€»è¾‘&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange).then(Mono.fromRunnable(() -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;AFilteråç½®é€»è¾‘&quot;</span>);</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;BFilterå‰ç½®é€»è¾‘&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange).then(Mono.fromRunnable(() -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;BFilteråç½®é€»è¾‘&quot;</span>);</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;CFilterå‰ç½®é€»è¾‘&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange).then(Mono.fromRunnable(() -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;CFilteråç½®é€»è¾‘&quot;</span>);</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Order(-1)</span></span><br><span class="line">    <span class="keyword">public</span> GlobalFilter <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AFilter</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Order(0)</span></span><br><span class="line">    <span class="keyword">public</span> GlobalFilter <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BFilter</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Order(1)</span></span><br><span class="line">    <span class="keyword">public</span> GlobalFilter <span class="title function_">c</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CFilter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AFilterå‰ç½®é€»è¾‘</span><br><span class="line">BFilterå‰ç½®é€»è¾‘</span><br><span class="line">CFilterå‰ç½®é€»è¾‘</span><br><span class="line"></span><br><span class="line">CFilteråç½®é€»è¾‘</span><br><span class="line">BFilteråç½®é€»è¾‘</span><br><span class="line">AFilteråç½®é€»è¾‘</span><br></pre></td></tr></table></figure><h1 id="è¿‡æ»¤å™¨å‚æ•°"><a href="#è¿‡æ»¤å™¨å‚æ•°" class="headerlink" title="è¿‡æ»¤å™¨å‚æ•°"></a>è¿‡æ»¤å™¨å‚æ•°</h1><p>è¿‡æ»¤å™¨å‚æ•°ç›¸å¯¹æ–­è¨€å‚æ•°è¦å°‘ä¸€äº›ï¼Œä½†æ˜¯åŒæ ·é‡è¦ï¼Œè®©æˆ‘ä»¬æ¥ç»†æ•°ä¸€ä¸‹ã€‚<br />è·¯ç”±ä¸­çš„filterså‚æ•°çš„è®¾ç½®ä¹Ÿæ˜¯éå¸¸å¹¿æ³›çš„ã€‚<br />è€Œæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨æœ€å¤šçš„å°±æ˜¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">routes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">demo</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">http://demo</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Path=/demo/**</span></span><br><span class="line">  <span class="attr">filters:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">StripPrefix=1</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‚æ•°æ˜¯ä»è¯·æ±‚ä¸­å‰¥ç¦»çš„è·¯å¾„ä¸ªæ•°ï¼Œæ¯”å¦‚<code>http://127.0.0.1/demo/user/list</code>, å°±å¯ä»¥å¾—åˆ°<code>http://127.0.0.1/demo/list</code>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœåŠ¡ç½‘å…³ </tag>
            
            <tag> gateway </tag>
            
            <tag> event loop </tag>
            
            <tag> è¿‡æ»¤å™¨ </tag>
            
            <tag> è‡ªå®šä¹‰åŠ¨æ€è¿‡æ»¤å™¨ </tag>
            
            <tag> é™æ€è¿‡æ»¤å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>10SpringCloud Gateway ç½‘å…³</title>
      <link href="/2022/11/07/02springcloud/010SpringCloud%20Gateway%20%E7%BD%91%E5%85%B3/"/>
      <url>/2022/11/07/02springcloud/010SpringCloud%20Gateway%20%E7%BD%91%E5%85%B3/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¨èç›´æ¥çœ‹è„‘å›¾"><a href="#æ¨èç›´æ¥çœ‹è„‘å›¾" class="headerlink" title="æ¨èç›´æ¥çœ‹è„‘å›¾"></a>æ¨èç›´æ¥çœ‹è„‘å›¾</h1><p>æœ¬ç¯‡å¹…è®°å¾—æ˜¯å¯¼å›¾ï¼Œä¸‹é¢çš„ç¬”è®°æ˜¯å¥½ä¸å®¹æ˜“ä»è„‘å›¾ä¸­æ•´ç†å‡ºæ¥çš„ï¼Œå¯èƒ½ä¸å®Œæ•´</p><p>åœ°å€ï¼š</p><h1 id="ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³"><a href="#ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³" class="headerlink" title="ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³?"></a>ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³?</h1><p>API Gatewayï¼ˆAPIGW &#x2F; API ç½‘å…³ï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯å‡ºç°åœ¨ç³»ç»Ÿè¾¹ç•Œä¸Šçš„ä¸€ä¸ªé¢å‘ API çš„ã€ä¸²è¡Œé›†ä¸­å¼çš„<code>ä¼ä¸šçº§åº”ç”¨é˜²ç«å¢™</code><br />API ç½‘å…³æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ˜¯ç³»ç»Ÿå¯¹å¤–çš„å”¯ä¸€å…¥å£ã€‚<br />API ç½‘å…³å°è£…äº†ç³»ç»Ÿå†…éƒ¨æ¶æ„ï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æä¾›å®šåˆ¶çš„ APIã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070140896.png" alt="image.png"></p><h1 id="ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç½‘å…³ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç½‘å…³ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç½‘å…³ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç½‘å…³ï¼Ÿ</h1><h2 id="ç»Ÿä¸€ç®¡ç†å¹³å°"><a href="#ç»Ÿä¸€ç®¡ç†å¹³å°" class="headerlink" title="ç»Ÿä¸€ç®¡ç†å¹³å°"></a>ç»Ÿä¸€ç®¡ç†å¹³å°</h2><blockquote><p>ä¸¾ä¸ªä¾‹å­: æŠ¥è­¦ç”µè¯ 110, æ‰“ç«è­¦ç”µè¯ 119, æ€¥æ•‘ç”µè¯ 120, äº¤é€šäº‹æ•…ç”µè¯ 122, é«˜é€Ÿå…¬è·¯æŠ¥è­¦ç”µè¯ 12122, æ£®æ—é˜²ç«æŠ¥è­¦ç”µè¯12119ç­‰ç­‰<br>ä½ çªç„¶å‘ç°è·¯è¾¹å˜å‹å™¨åäº†, ä½ æƒ³é€šçŸ¥æœ‰å…³éƒ¨åˆ†, ä½†ä½ ä¸çŸ¥é“åˆ°åº•æ˜¯å“ªä¸ªéƒ¨é—¨å’Œä»€ä¹ˆç”µè¯å·ç , æ‰€ä»¥ä½ æ™•äº†<br>æ¥ç€æœ‰ä¸ªå« Gateway çš„äººæäº†ä¸ªç±»ä¼¼ 114 æŸ¥å·å¹³å°, ä½ åªéœ€è¦æ‰“ç”µè¯ç»™ 114 , å‘ŠçŸ¥ä»–ä½ æœ‰ä»€ä¹ˆéœ€æ±‚, 114ä¼šè·Ÿä½ çš„è¦æ±‚è½¬æ’­åˆ°ç›¸åº”çš„å¹³å°<br>è€Œè¿™ä¸ª 114 å¹³å°å°±ç±»ä¼¼äº Gateway API ç½‘å…³, è€Œä½ å°±æ˜¯å®¢æˆ·ç«¯, Gatewayä¼šæ ¹æ®ä½ çš„è¦æ±‚åšå‡ºç”„åˆ«ã€å›åº”æˆ–è€…è½¬å‘ç»™ç›¸åº”çš„å¾®æœåŠ¡(110 119ç­‰)</p></blockquote><p>APIç½‘å…³å‡ºç°çš„åŸå› å°±è·Ÿä¸Šé¢çš„ä¾‹å­ç•¥æœ‰ä¸åŒï¼Œä½†æ€»ä½“ç›¸ä¼¼ã€‚éšç€å¾®æœåŠ¡æ¶æ„çš„å‡ºç°ï¼Œä¸åŒçš„å¾®æœåŠ¡ä¸€èˆ¬ä¼šæœ‰ä¸åŒçš„ç½‘ç»œåœ°å€ï¼Œè€Œå¤–éƒ¨å®¢æˆ·ç«¯å¯èƒ½éœ€è¦è°ƒç”¨å¤šä¸ªæœåŠ¡çš„æ¥å£æ‰èƒ½å®Œæˆä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ï¼Œå¦‚æœè®©å®¢æˆ·ç«¯ç›´æ¥ä¸å„ä¸ªå¾®æœåŠ¡é€šä¿¡ï¼Œä¼šæœ‰ä»¥ä¸‹çš„é—®é¢˜ï¼š</p><ul><li>å®¢æˆ·ç«¯è¯·æ±‚å¤šä¸ªå¾®æœåŠ¡ï¼Œå„ä¸ªæœåŠ¡ipä¸ä¸€æ ·ï¼Œå¢åŠ å®¢æˆ·ç«¯å¤æ‚åº¦ã€‚</li><li>å­˜åœ¨è·¨åŸŸï¼Œåœ¨ä¸€å®šåœºæ™¯ä¸‹å¤„ç†ç›¸å¯¹å¤æ‚ã€‚ </li><li>è®¤è¯å¤æ‚ï¼Œæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦ç‹¬ç«‹è®¤è¯ã€‚ </li><li>ä¸å¾®æœåŠ¡è€¦åˆå¤ªå¼ºï¼Œå¾®æœåŠ¡å˜æ›´ï¼Œå®¢æˆ·ç«¯éœ€è¦å˜æ›´</li></ul><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070140731.png" alt="image.png"></p><p>å½“ç„¶ä¸ç®¡æœ‰æ²¡æœ‰ API ç½‘å…³ï¼Œåç«¯å¾®æœåŠ¡éƒ½å¯ä»¥é€šè¿‡ API å¾ˆå¥½åœ°æ”¯æŒå®¢æˆ·ç«¯çš„è®¿é—®,  å¦‚ä¸‹å›¾: <br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070140008.png" alt="image.png"></p><p>ä½†å¯¹äºæœåŠ¡æ•°é‡ä¼—å¤šã€å¤æ‚åº¦æ¯”è¾ƒé«˜ã€è§„æ¨¡æ¯”è¾ƒå¤§çš„ä¸šåŠ¡æ¥è¯´ï¼Œå¼•å…¥ API ç½‘å…³ä¹Ÿæœ‰ä¸€ç³»åˆ—çš„å¥½å¤„ï¼š</p><ul><li>èšåˆæ¥å£ä½¿å¾—æœåŠ¡å¯¹è°ƒç”¨è€…é€æ˜ï¼Œå®¢æˆ·ç«¯ä¸åç«¯çš„è€¦åˆåº¦é™ä½</li><li>èšåˆåå°æœåŠ¡ï¼ŒèŠ‚çœæµé‡ï¼Œæé«˜æ€§èƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li><li>æä¾›å®‰å…¨ã€æµæ§ã€è¿‡æ»¤ã€ç¼“å­˜ã€è®¡è´¹ã€ç›‘æ§ç­‰ API ç®¡ç†åŠŸèƒ½</li></ul><h2 id="éš”ç¦»å¤–éƒ¨è®¿é—®ä¸å†…éƒ¨ç³»ç»Ÿ"><a href="#éš”ç¦»å¤–éƒ¨è®¿é—®ä¸å†…éƒ¨ç³»ç»Ÿ" class="headerlink" title="éš”ç¦»å¤–éƒ¨è®¿é—®ä¸å†…éƒ¨ç³»ç»Ÿ"></a>éš”ç¦»å¤–éƒ¨è®¿é—®ä¸å†…éƒ¨ç³»ç»Ÿ</h2><p>æ‰€æœ‰çš„å®¢æˆ·ç«¯å’Œæ¶ˆè´¹ç«¯éƒ½é€šè¿‡ç»Ÿä¸€çš„ç½‘å…³æ¥å…¥å¾®æœåŠ¡ï¼Œ<strong>åœ¨ç½‘å…³å±‚å¤„ç†æ‰€æœ‰éä¸šåŠ¡åŠŸèƒ½</strong>ã€‚</p><p>APIç½‘å…³æ–¹å¼çš„æ ¸å¿ƒè¦ç‚¹æ˜¯ï¼Œæ‰€æœ‰çš„å®¢æˆ·ç«¯å’Œæ¶ˆè´¹ç«¯éƒ½é€šè¿‡ç»Ÿä¸€çš„ç½‘å…³æ¥å…¥å¾®æœåŠ¡ï¼Œåœ¨ç½‘å…³å±‚å¤„ç†æ‰€æœ‰çš„éä¸šåŠ¡åŠŸèƒ½ã€‚é€šå¸¸ï¼Œç½‘å…³ä¹Ÿæ˜¯æä¾›REST&#x2F;HTTPçš„è®¿é—®APIã€‚</p><p>å¸¸è§çš„APIç½‘å…³ä¸»è¦æä¾›ä»¥ä¸‹çš„åŠŸèƒ½ï¼š</p><ul><li><strong>è·¯ç”±åŠŸèƒ½</strong>ï¼šè·¯ç”±æ˜¯å¾®æœåŠ¡ç½‘å…³çš„æ ¸å¿ƒèƒ½åŠ›ã€‚é€šè¿‡è·¯ç”±åŠŸèƒ½å¾®æœåŠ¡ç½‘å…³å¯ä»¥å°†è¯·æ±‚è½¬å‘åˆ°ç›®æ ‡å¾®æœåŠ¡ã€‚åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œç½‘å…³å¯ä»¥ç»“åˆæ³¨å†Œä¸­å¿ƒçš„åŠ¨æ€æœåŠ¡å‘ç°ï¼Œå®ç°å¯¹åç«¯æœåŠ¡çš„å‘ç°ï¼Œè°ƒç”¨æ–¹åªéœ€è¦çŸ¥é“ç½‘å…³å¯¹å¤–æš´éœ²çš„æœåŠ¡APIå°±å¯ä»¥é€æ˜åœ°è®¿é—®åç«¯å¾®æœåŠ¡ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šAPIç½‘å…³ç»“åˆè´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œåˆ©ç”¨Eurekaæˆ–è€…Consulç­‰æœåŠ¡å‘ç°å·¥å…·ï¼Œé€šè¿‡è½®è¯¢ã€æŒ‡å®šæƒé‡ã€IPåœ°å€å“ˆå¸Œç­‰æœºåˆ¶å®ç°ä¸‹æ¸¸æœåŠ¡çš„è´Ÿè½½å‡è¡¡ã€‚</li><li><strong>ç»Ÿä¸€é‰´æƒ</strong>ï¼šä¸€èˆ¬è€Œè¨€ï¼Œæ— è®ºå¯¹å†…ç½‘è¿˜æ˜¯å¤–ç½‘çš„æ¥å£éƒ½éœ€è¦åšç”¨æˆ·èº«ä»½è®¤è¯ï¼Œè€Œç”¨æˆ·è®¤è¯åœ¨ä¸€äº›è§„æ¨¡è¾ƒå¤§çš„ç³»ç»Ÿä¸­éƒ½ä¼šé‡‡ç”¨ç»Ÿä¸€çš„å•ç‚¹ç™»å½•ï¼ˆSingle Sign Onï¼‰ç³»ç»Ÿï¼Œå¦‚æœæ¯ä¸ªå¾®æœåŠ¡éƒ½è¦å¯¹æ¥å•ç‚¹ç™»å½•ç³»ç»Ÿï¼Œé‚£ä¹ˆæ˜¾ç„¶æ¯”è¾ƒæµªè´¹èµ„æºä¸”å¼€å‘æ•ˆç‡ä½ã€‚APIç½‘å…³æ˜¯ç»Ÿä¸€ç®¡ç†å®‰å…¨æ€§çš„ç»ä½³åœºæ‰€ï¼Œå¯ä»¥å°†è®¤è¯çš„éƒ¨åˆ†æŠ½å–åˆ°ç½‘å…³å±‚ï¼Œå¾®æœåŠ¡ç³»ç»Ÿæ— é¡»å…³æ³¨è®¤è¯çš„é€»è¾‘ï¼Œåªå…³æ³¨è‡ªèº«ä¸šåŠ¡å³å¯ã€‚</li><li><strong>åè®®è½¬æ¢</strong>ï¼šAPIç½‘å…³çš„ä¸€å¤§ä½œç”¨åœ¨äºæ„å»ºå¼‚æ„ç³»ç»Ÿï¼ŒAPIç½‘å…³ä½œä¸ºå•ä¸€å…¥å£ï¼Œé€šè¿‡åè®®è½¬æ¢æ•´åˆåå°åŸºäºRESTã€AMQPã€Dubboç­‰ä¸åŒé£æ ¼å’Œå®ç°æŠ€æœ¯çš„å¾®æœåŠ¡ï¼Œé¢å‘Web Mobileã€å¼€æ”¾å¹³å°ç­‰ç‰¹å®šå®¢æˆ·ç«¯æä¾›ç»Ÿä¸€æœåŠ¡ã€‚</li><li><strong>æŒ‡æ ‡ç›‘æ§</strong>ï¼šç½‘å…³å¯ä»¥ç»Ÿè®¡åç«¯æœåŠ¡çš„è¯·æ±‚æ¬¡æ•°ï¼Œå¹¶ä¸”å¯ä»¥å®æ—¶åœ°æ›´æ–°å½“å‰çš„æµé‡å¥åº·çŠ¶æ€ï¼Œå¯ä»¥å¯¹URLç²’åº¦çš„æœåŠ¡è¿›è¡Œå»¶è¿Ÿç»Ÿè®¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Hystrix DashboardæŸ¥çœ‹åç«¯æœåŠ¡çš„æµé‡çŠ¶æ€åŠæ˜¯å¦æœ‰ç†”æ–­å‘ç”Ÿã€‚</li><li><strong>é™æµç†”æ–­</strong>ï¼šåœ¨æŸäº›åœºæ™¯ä¸‹éœ€è¦æ§åˆ¶å®¢æˆ·ç«¯çš„è®¿é—®æ¬¡æ•°å’Œè®¿é—®é¢‘ç‡ï¼Œä¸€äº›é«˜å¹¶å‘ç³»ç»Ÿæœ‰æ—¶è¿˜ä¼šæœ‰é™æµçš„éœ€æ±‚ã€‚åœ¨ç½‘å…³ä¸Šå¯ä»¥é…ç½®ä¸€ä¸ªé˜ˆå€¼ï¼Œå½“è¯·æ±‚æ•°è¶…è¿‡é˜ˆå€¼æ—¶å°±ç›´æ¥è¿”å›é”™è¯¯è€Œä¸ç»§ç»­è®¿é—®åå°æœåŠ¡ã€‚å½“å‡ºç°æµé‡æ´ªå³°æˆ–è€…åç«¯æœåŠ¡å‡ºç°å»¶è¿Ÿæˆ–æ•…éšœæ—¶ï¼Œç½‘å…³èƒ½å¤Ÿä¸»åŠ¨è¿›è¡Œç†”æ–­ï¼Œä¿æŠ¤åç«¯æœåŠ¡ï¼Œå¹¶ä¿æŒå‰ç«¯ç”¨æˆ·ä½“éªŒè‰¯å¥½ã€‚</li><li><strong>é»‘ç™½åå•</strong>ï¼šå¾®æœåŠ¡ç½‘å…³å¯ä»¥ä½¿ç”¨ç³»ç»Ÿé»‘åå•ï¼Œè¿‡æ»¤HTTPè¯·æ±‚ç‰¹å¾ï¼Œæ‹¦æˆªå¼‚å¸¸å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¾‹å¦‚DDoSæ”»å‡»ç­‰ä¾µèš€å¸¦å®½æˆ–èµ„æºè¿«ä½¿æœåŠ¡ä¸­æ–­ç­‰è¡Œä¸ºï¼Œå¯ä»¥åœ¨ç½‘å…³å±‚é¢è¿›è¡Œæ‹¦æˆªè¿‡æ»¤ã€‚æ¯”è¾ƒå¸¸è§çš„æ‹¦æˆªç­–ç•¥æ˜¯æ ¹æ®IPåœ°å€å¢åŠ é»‘åå•ã€‚åœ¨å­˜åœ¨é‰´æƒç®¡ç†çš„è·¯ç”±æœåŠ¡ä¸­å¯ä»¥é€šè¿‡è®¾ç½®ç™½åå•è·³è¿‡é‰´æƒç®¡ç†è€Œç›´æ¥è®¿é—®åç«¯æœåŠ¡èµ„æºã€‚</li><li><strong>ç°åº¦å‘å¸ƒ</strong>ï¼šå¾®æœåŠ¡ç½‘å…³å¯ä»¥æ ¹æ®HTTPè¯·æ±‚ä¸­çš„ç‰¹æ®Šæ ‡è®°å’Œåç«¯æœåŠ¡åˆ—è¡¨å…ƒæ•°æ®æ ‡è¯†è¿›è¡Œæµé‡æ§åˆ¶ï¼Œå®ç°åœ¨ç”¨æˆ·æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹å®Œæˆç°åº¦å‘å¸ƒã€‚</li><li><strong>æµé‡æŸ“è‰²</strong>ï¼šå’Œç°åº¦å‘å¸ƒçš„åŸç†ç›¸ä¼¼ï¼Œç½‘å…³å¯ä»¥æ ¹æ®HTTPè¯·æ±‚çš„Hostã€Headã€Agentç­‰æ ‡è¯†å¯¹è¯·æ±‚è¿›è¡ŒæŸ“è‰²ï¼Œæœ‰äº†ç½‘å…³çš„æµé‡æŸ“è‰²åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æœåŠ¡åç»­çš„è°ƒç”¨é“¾è·¯è¿›è¡Œè·Ÿè¸ªï¼Œå¯¹æœåŠ¡å»¶è¿ŸåŠæœåŠ¡è¿è¡ŒçŠ¶å†µè¿›è¡Œè¿›ä¸€æ­¥çš„é“¾è·¯åˆ†æã€‚</li><li><strong>æ–‡æ¡£ä¸­å¿ƒ</strong>ï¼šç½‘å…³ç»“åˆSwaggerï¼Œå¯ä»¥å°†åç«¯çš„å¾®æœåŠ¡æš´éœ²ç»™ç½‘å…³ï¼Œç½‘å…³ä½œä¸ºç»Ÿä¸€çš„å…¥å£ç»™æ¥å£çš„ä½¿ç”¨æ–¹æä¾›æŸ¥çœ‹åç«¯æœåŠ¡çš„APIè§„èŒƒï¼Œä¸éœ€è¦çŸ¥é“æ¯ä¸€ä¸ªåç«¯å¾®æœåŠ¡çš„Swaggeråœ°å€ï¼Œè¿™æ ·ç½‘å…³èµ·åˆ°äº†å¯¹åç«¯APIèšåˆçš„æ•ˆæœã€‚</li><li><strong>æ—¥å¿—å®¡è®¡</strong>ï¼šå¾®æœåŠ¡ç½‘å…³å¯ä»¥ä½œä¸ºç»Ÿä¸€çš„æ—¥å¿—è®°å½•å’Œæ”¶é›†å™¨ï¼Œå¯¹æœåŠ¡URLç²’åº¦çš„æ—¥å¿—è¯·æ±‚ä¿¡æ¯å’Œå“åº”ä¿¡æ¯è¿›è¡Œæ‹¦æˆªã€‚</li></ul><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070140149.png" alt="image.png"></p><h1 id="ä»€ä¹ˆæ˜¯Spring-Cloud-Gateway"><a href="#ä»€ä¹ˆæ˜¯Spring-Cloud-Gateway" class="headerlink" title="ä»€ä¹ˆæ˜¯Spring Cloud Gateway?"></a>ä»€ä¹ˆæ˜¯Spring Cloud Gateway?</h1><p>SpringCloud Gateway æ˜¯ Spring Cloud çš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ˜¯åŸºäº Spring 5.0ï¼ŒSpring Boot 2.0 å’Œ Project Reactor ç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„ API è·¯ç”±ç®¡ç†æ–¹å¼ã€‚<br />SpringCloud Gateway ä½œä¸º Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£ Zuulï¼Œåœ¨Spring Cloud 2.0ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰å¯¹æ–°ç‰ˆæœ¬çš„Zuul 2.0ä»¥ä¸Šæœ€æ–°é«˜æ€§èƒ½ç‰ˆæœ¬è¿›è¡Œé›†æˆï¼Œä»ç„¶è¿˜æ˜¯ä½¿ç”¨çš„Zuul 2.0ä¹‹å‰çš„éReactoræ¨¡å¼çš„è€ç‰ˆæœ¬ã€‚è€Œä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼ŒSpringCloud Gatewayæ˜¯åŸºäºWebFluxæ¡†æ¶å®ç°çš„ï¼Œè€ŒWebFluxæ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„Reactoræ¨¡å¼é€šä¿¡æ¡†æ¶Nettyã€‚<br />Spring Cloud Gateway çš„ç›®æ ‡ï¼Œä¸ä»…æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ï¼Œå¹¶ä¸”åŸºäº Filter é“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ï¼Œç›‘æ§&#x2F;æŒ‡æ ‡ï¼Œå’Œé™æµã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070140994.png" alt="image.png"></p><p>ä¸Šå›¾å¯ä»¥å¾ˆç›´è§‚çš„çœ‹å‡ºæ¥ Gateway å¤§ä½“ä¸Šçš„è®¾è®¡æ€è·¯</p><p><strong>å®¢æˆ·ç«¯çš„è¯·æ±‚é€šè¿‡</strong><code>**Gatewayçš„Predicates**</code>**è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåˆ¤æ–­ä¸º **<code>**false**</code><strong>åˆ™è·³åˆ°ä¸‹ä¸€ä¸ª</strong><code>**Route**</code><strong>ï¼Œå¦‚æœä¸º</strong><code>**true**</code><strong>åˆ™é€šè¿‡ä¸€ç³»åˆ—çš„</strong><code>**Filter**</code><strong>é“¾è·¯å¤„ç†åå°†è¯·æ±‚è½¬å‘ç»™å¾®æœåŠ¡</strong></p><p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½çœ‹å‡ºGatewayåº•å±‚ä½¿ç”¨çš„æ˜¯ Netty è¿›è¡Œé€šè®¯, è€Œ Netty åº•å±‚ä½¿ç”¨çš„æ˜¯ event loop æ¨¡å‹<br />æˆ‘ä»¬æ¥è§£äº†è§£é¢è¯•å¸¸é—®é“çš„ event loopæ˜¯ä»€ä¹ˆï¼Ÿå’Œ Reactorçº¿ç¨‹æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ</p><h2 id="ä»€ä¹ˆæ˜¯-event-loop-æ¨¡å‹"><a href="#ä»€ä¹ˆæ˜¯-event-loop-æ¨¡å‹" class="headerlink" title="ä»€ä¹ˆæ˜¯ event loop æ¨¡å‹?"></a>ä»€ä¹ˆæ˜¯ event loop æ¨¡å‹?</h2><p>EventLoop è¿™ä¸ªæ¦‚å¿µå…¶å®å¹¶ä¸æ˜¯ Netty ç‹¬æœ‰çš„ï¼Œå®ƒæ˜¯ä¸€ç§äº‹ä»¶ç­‰å¾…å’Œå¤„ç†çš„ç¨‹åºæ¨¡å‹ï¼Œå¯ä»¥è§£å†³<strong>å¤šçº¿ç¨‹èµ„æºæ¶ˆè€—é«˜çš„é—®é¢˜</strong>ã€‚ä¾‹å¦‚ Node.js å°±é‡‡ç”¨äº† EventLoop çš„è¿è¡Œæœºåˆ¶ï¼Œä¸ä»…å ç”¨èµ„æºä½ï¼Œè€Œä¸”èƒ½å¤Ÿæ”¯æ’‘äº†å¤§è§„æ¨¡çš„æµé‡è®¿é—®ã€‚<br />ä¸‹å›¾å±•ç¤ºäº† EventLoop é€šç”¨çš„è¿è¡Œæ¨¡å¼ã€‚æ¯å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œåº”ç”¨ç¨‹åºéƒ½ä¼šå°†äº§ç”Ÿçš„äº‹ä»¶æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—å½“ä¸­ï¼Œç„¶å EventLoop ä¼šè½®è¯¢ä»é˜Ÿåˆ—ä¸­å–å‡ºäº‹ä»¶æ‰§è¡Œæˆ–è€…å°†äº‹ä»¶åˆ†å‘ç»™ç›¸åº”çš„äº‹ä»¶ç›‘å¬è€…æ‰§è¡Œã€‚äº‹ä»¶æ‰§è¡Œçš„æ–¹å¼é€šå¸¸åˆ†ä¸ºç«‹å³æ‰§è¡Œã€å»¶åæ‰§è¡Œã€å®šæœŸæ‰§è¡Œå‡ ç§ã€‚</p><blockquote><p>è§¦å‘äº‹ä»¶å’Œäº‹ä»¶å®Œæˆä¹‹é—´æ˜¯æœ‰äº‹ä»¶é—´éš”çš„ï¼Œæ‰€ä»¥è§¦å‘äº‹ä»¶æ—¶ä¼šå°†äº‹ä»¶å­˜å…¥ äº‹ä»¶é˜Ÿåˆ— ä¸­ï¼Œç„¶åäº¤ç»™ EventLoop çº¿ç¨‹ è½®è¯¢ï¼Œç­‰åˆ° Worker çº¿ç¨‹æ‰§è¡Œå®Œæ¯•äº‹ä»¶åå°†å‘ŠçŸ¥ Event Loop å°† æ‰§è¡Œç»“æœ+Callback è¿”å›ç»™ ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹æ‰§è¡Œ Callback </p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070140928.png" alt="image.png"></p><h2 id="ä»€ä¹ˆæ˜¯Reactorçº¿ç¨‹æ¨¡å‹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Reactorçº¿ç¨‹æ¨¡å‹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Reactorçº¿ç¨‹æ¨¡å‹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Reactorçº¿ç¨‹æ¨¡å‹ï¼Ÿ</h2><p>Reactor æ¨¡å¼æ˜¯åŸºäº<strong>äº‹ä»¶é©±åŠ¨</strong>çš„ï¼Œå®ƒä¼š<strong>ç›‘å¬</strong>äº‹ä»¶çš„å‘ç”Ÿï¼Œå½“ç›‘å¬åˆ°äº‹ä»¶å‘ç”Ÿåï¼Œæ ¹æ®å¤šè·¯å¤ç”¨ç­–ç•¥ï¼Œå°†äº‹ä»¶<strong>åˆ†å‘</strong>ç»™ç›¸åº”çš„å¤„ç†å™¨å¤„ç†ã€‚</p><p>æ ¸å¿ƒç»„ä»¶ï¼š</p><ul><li>Handleï¼ˆEventï¼‰ï¼šç”¨äºè¡¨ç¤ºäº‹ä»¶ã€‚</li><li>Event Demultiplexerï¼šäº‹ä»¶åˆ†ç¦»å™¨ï¼Œç”¨äºåŒæ­¥ç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿã€‚</li><li>Reactorï¼šååº”å™¨ï¼Œç”¨äºç›‘å¬å’Œåˆ†å‘äº‹ä»¶ã€‚å†…éƒ¨ä¼šè°ƒç”¨ Event Demultiplexer æ¥åŒæ­¥ç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿï¼Œç„¶åå°†äº‹ä»¶äº¤ç”± Event Handler å¤„ç†ã€‚</li><li>Event Handlerï¼šäº‹ä»¶å¤„ç†å™¨ï¼Œç”¨äºå¤„ç†äº‹ä»¶ã€‚</li></ul><h1 id="SpringCloud-Gatewayæ ¸å¿ƒæµç¨‹"><a href="#SpringCloud-Gatewayæ ¸å¿ƒæµç¨‹" class="headerlink" title="SpringCloud Gatewayæ ¸å¿ƒæµç¨‹"></a>SpringCloud Gatewayæ ¸å¿ƒæµç¨‹</h1><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070140236.png" alt="image.png"><br />æ ¸å¿ƒæ¦‚å¿µï¼š</p><ol><li>Gateway Client å‘ Spring Cloud Gateway å‘é€è¯·æ±‚</li><li>è¯·æ±‚é¦–å…ˆä¼šè¢« HttpWebHandlerAdapter è¿›è¡Œæå–ç»„è£…æˆç½‘å…³ä¸Šä¸‹æ–‡</li><li>ç„¶åç½‘å…³çš„ä¸Šä¸‹æ–‡ä¼šä¼ é€’åˆ° DispatcherHandler ï¼Œå®ƒè´Ÿè´£å°†è¯·æ±‚åˆ†å‘ç»™ RoutePredicateHandlerMapping</li><li>RoutePredicateHandlerMapping è´Ÿè´£è·¯ç”±æŸ¥æ‰¾ï¼Œå¹¶æ ¹æ®è·¯ç”±æ–­è¨€åˆ¤æ–­è·¯ç”±æ˜¯å¦å¯ç”¨</li><li>å¦‚æœè¿‡æ–­è¨€æˆåŠŸï¼Œç”±FilteringWebHandler åˆ›å»ºè¿‡æ»¤å™¨é“¾å¹¶è°ƒç”¨</li><li>é€šè¿‡ç‰¹å®šäºè¯·æ±‚çš„ Fliter é“¾è¿è¡Œè¯·æ±‚ï¼ŒFilter è¢«è™šçº¿åˆ†éš”çš„åŸå› æ˜¯Filterå¯ä»¥åœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆpreï¼‰å’Œä¹‹åï¼ˆpostï¼‰è¿è¡Œé€»è¾‘</li><li>æ‰§è¡Œæ‰€æœ‰preè¿‡æ»¤å™¨é€»è¾‘ã€‚ç„¶åè¿›è¡Œä»£ç†è¯·æ±‚ã€‚å‘å‡ºä»£ç†è¯·æ±‚åï¼Œå°†è¿è¡Œâ€œpostâ€è¿‡æ»¤å™¨é€»è¾‘ã€‚</li><li>å¤„ç†å®Œæ¯•ä¹‹åå°† Response è¿”å›åˆ° Gateway å®¢æˆ·ç«¯</li></ol><p>Filterè¿‡æ»¤å™¨ï¼š</p><ul><li>Filteråœ¨preç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå‚æ•°æ•ˆéªŒã€æƒé™æ•ˆéªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢ç­‰ã€‚</li><li>Filteråœ¨postç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå“åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ã€æ—¥å¿—è¾“å‡ºã€æµé‡ç›‘æ§ç­‰</li></ul><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070140699.gif" alt="åŠ¨ç”».gif"></p><h1 id="ä»£ç å®ä¾‹"><a href="#ä»£ç å®ä¾‹" class="headerlink" title="ä»£ç å®ä¾‹"></a>ä»£ç å®ä¾‹</h1><p>githubåˆ‡æ¢åˆ° consul åˆ†æ”¯</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070140686.png" alt="image.png"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070141210.png" alt="image.png"></p><h2 id="æ–°å»º-payment8007-é¡¹ç›®"><a href="#æ–°å»º-payment8007-é¡¹ç›®" class="headerlink" title="æ–°å»º payment8007 é¡¹ç›®"></a>æ–°å»º payment8007 é¡¹ç›®</h2><p>æ–°å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®: <code>cloud-providerconsul-payment8007</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud consul-server --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8007</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">consul-provider-payment</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#hostname: 127.0.0.1</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><h2 id="æ–°å»ºé¡¹ç›®gateway9527"><a href="#æ–°å»ºé¡¹ç›®gateway9527" class="headerlink" title="æ–°å»ºé¡¹ç›®gateway9527"></a>æ–°å»ºé¡¹ç›®<code>gateway9527</code></h2><p>åˆ›å»ºé¡¹ç›®<code>cloud-gateway-gateway9527</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--gateway--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--SpringCloud consul-server --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æ³¨æ„è¿™é‡Œä¸èƒ½å¯¼å…¥ webï¼Œå› ä¸º gatawayå·²ç»æœ‰webfluxäº† --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span><span class="comment">&lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®ç±»--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„éœ€è¦å°† <code>spring-boot-starter-web</code>åŒ…æ³¨é‡Šæ‰ï¼Œç„¶åæ·»åŠ  <code>spring-cloud-starter-gateway</code></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#hostname: 127.0.0.1</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="comment">#å°† payment-8007 8006 æä¾›çš„æœåŠ¡éšè—èµ·æ¥ï¼Œä¸æš´éœ²ç»™å®¢æˆ·ç«¯ï¼Œåªç»™å®¢æˆ·ç«¯æš´éœ² API ç½‘å…³çš„åœ°å€ 9527</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">provider_payment_consul_routh</span>   <span class="comment">#è·¯ç”± id,æ²¡æœ‰å›ºå®šè§„åˆ™ï¼Œä½†å”¯ä¸€ï¼Œå»ºè®®ä¸æœåŠ¡åå¯¹åº”</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://consul-provider-payment</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/consul/**</span>    <span class="comment">#æ–­è¨€ï¼Œè·¯å¾„åŒ¹é… æ³¨æ„ï¼šPath ä¸­ P ä¸ºå¤§å†™</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Method=GET</span> <span class="comment">#åªèƒ½æ—¶ GET è¯·æ±‚æ—¶ï¼Œæ‰èƒ½è®¿é—®</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„ <code>uri</code> å’Œ <code>predicates</code>è¿™ä¸¤ä¸ªé…ç½®</p><p>å…¶ä¸­</p><ul><li><code>predicates</code>ï¼šä¸‹é¢çš„é…ç½®ç›¸å½“äº åŒ¹é…æ¡ä»¶</li><li><code>uri</code>ï¼šç›¸å½“äºåŒ¹é…æˆåŠŸåè®¿é—®çš„åŸŸå</li><li><code>id</code>ï¼šå°±æ˜¯è¿™æ®µ <code>uri</code> å’Œ <code>predicates</code> çš„å”¯ä¸€å±æ€§ï¼Œç”¨äºæ ‡è¯†å”¯ä¸€æ€§ï¼Œä¸èƒ½é‡å</li></ul><p>**æœ€ç»ˆè®¿é—®çš„æ˜¯: <strong><code>**uri + predicates.Path**</code></strong> ç›¸å½“äº **<code>**https://consul-provider-payment/payment/consul/**</code></p><blockquote><p>æ³¨æ„ï¼Œå¦‚æœä½ åœ¨ <code>uri</code>ä¸­é…ç½®<code>uri: https://www.baidu.com</code>é‚£ä¹ˆä»–å°±ä¼šè®¿é—®åˆ° ç™¾åº¦</p></blockquote><p>æ‰€ä»¥å¦‚æœä½ è¿™æ ·é…ç½®:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GateWayConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouteLocator <span class="title function_">customRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span> &#123;</span><br><span class="line">        RouteLocatorBuilder.<span class="type">Builder</span> <span class="variable">routes</span> <span class="operator">=</span> builder.routes();</span><br><span class="line"></span><br><span class="line">        routes.route(<span class="string">&quot;path_route_zhazha&quot;</span>,</span><br><span class="line">                r -&gt; r.path(<span class="string">&quot;/guonei&quot;</span>)</span><br><span class="line">                        .uri(<span class="string">&quot;https://www.baidu.com&quot;</span>)).build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> routes.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouteLocator <span class="title function_">customRouteLocator2</span><span class="params">(RouteLocatorBuilder builder)</span> &#123;</span><br><span class="line">        RouteLocatorBuilder.<span class="type">Builder</span> <span class="variable">routes</span> <span class="operator">=</span> builder.routes();</span><br><span class="line">        routes.route(<span class="string">&quot;path_route_zhazha2&quot;</span>,</span><br><span class="line">                r -&gt; r.path(<span class="string">&quot;/guoji&quot;</span>)</span><br><span class="line">                        .uri(<span class="string">&quot;https://news.baidu.com&quot;</span>)).build();</span><br><span class="line">        <span class="keyword">return</span> routes.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸­å¦‚æœä½ è®¿é—®<code>[http://localhost:9527/guonei](http://localhost:9527/guonei)</code>ä¼šå¯¼è‡´:<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070141401.png" alt="image.png"><br />å¦‚æœä½ è®¿é—®<code>[https://www.baidu.com/guonei](https://www.baidu.com/guonei)</code>ç›¸åŒçš„:<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070141198.png" alt="image.png"></p><p><strong>æ‰€ä»¥éœ€è¦æ³¨æ„çš„æ˜¯</strong><code>**Path**</code><strong>å¿…é¡»æ˜¯</strong><code>**uri**</code><strong>åŸŸåå¿…é¡»å­˜åœ¨çš„è·¯å¾„</strong></p><h3 id="Java-Beanæ–¹å¼é…ç½®è·¯ç”±å™¨"><a href="#Java-Beanæ–¹å¼é…ç½®è·¯ç”±å™¨" class="headerlink" title="Java Beanæ–¹å¼é…ç½®è·¯ç”±å™¨"></a>Java Beanæ–¹å¼é…ç½®è·¯ç”±å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemogatewayApplication</span> &#123;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RouteLocator <span class="title function_">customRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> builder.routes()</span><br><span class="line">.route(<span class="string">&quot;path_route&quot;</span>, r -&gt; r.path(<span class="string">&quot;/get&quot;</span>)</span><br><span class="line">.uri(<span class="string">&quot;http://httpbin.org&quot;</span>))</span><br><span class="line">.route(<span class="string">&quot;host_route&quot;</span>, r -&gt; r.host(<span class="string">&quot;*.myhost.org&quot;</span>)</span><br><span class="line">.uri(<span class="string">&quot;http://httpbin.org&quot;</span>))</span><br><span class="line">.route(<span class="string">&quot;rewrite_route&quot;</span>, r -&gt; r.host(<span class="string">&quot;*.rewrite.org&quot;</span>)</span><br><span class="line">.filters(f -&gt; f.rewritePath(<span class="string">&quot;/foo/(?&lt;segment&gt;.*)&quot;</span>, <span class="string">&quot;/$&#123;segment&#125;&quot;</span>))</span><br><span class="line">.uri(<span class="string">&quot;http://httpbin.org&quot;</span>))</span><br><span class="line">.route(<span class="string">&quot;hystrix_route&quot;</span>, r -&gt; r.host(<span class="string">&quot;*.hystrix.org&quot;</span>)</span><br><span class="line">.filters(f -&gt; f.hystrix(c -&gt; c.setName(<span class="string">&quot;slowcmd&quot;</span>)))</span><br><span class="line">.uri(<span class="string">&quot;http://httpbin.org&quot;</span>))</span><br><span class="line">.route(<span class="string">&quot;hystrix_fallback_route&quot;</span>, r -&gt; r.host(<span class="string">&quot;*.hystrixfallback.org&quot;</span>)</span><br><span class="line">.filters(f -&gt; f.hystrix(c -&gt; c.setName(<span class="string">&quot;slowcmd&quot;</span>).setFallbackUri(<span class="string">&quot;forward:/hystrixfallback&quot;</span>)))</span><br><span class="line">.uri(<span class="string">&quot;http://httpbin.org&quot;</span>))</span><br><span class="line">.route(<span class="string">&quot;limit_route&quot;</span>, r -&gt; r</span><br><span class="line">.host(<span class="string">&quot;*.limited.org&quot;</span>).and().path(<span class="string">&quot;/anything/**&quot;</span>)</span><br><span class="line">.filters(f -&gt; f.requestRateLimiter(c -&gt; c.setRateLimiter(redisRateLimiter())))</span><br><span class="line">.uri(<span class="string">&quot;http://httpbin.org&quot;</span>))</span><br><span class="line">.build();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Gatewayç»„ä»¶ä¸­çš„é…ç½®è·¯ç”±è¯¦è§£"><a href="#Gatewayç»„ä»¶ä¸­çš„é…ç½®è·¯ç”±è¯¦è§£" class="headerlink" title="Gatewayç»„ä»¶ä¸­çš„é…ç½®è·¯ç”±è¯¦è§£"></a>Gatewayç»„ä»¶ä¸­çš„é…ç½®è·¯ç”±è¯¦è§£</h1><h2 id="è·¯ç”±å‚æ•°"><a href="#è·¯ç”±å‚æ•°" class="headerlink" title="è·¯ç”±å‚æ•°"></a>è·¯ç”±å‚æ•°</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">routes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">router1</span></span><br><span class="line">    <span class="attr">uri:</span> <span class="string">http://www.baidu.com</span></span><br><span class="line">    <span class="attr">predicates:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">Path=/baidu/**</span></span><br><span class="line">    <span class="attr">filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">StripPrefix=1</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„idå‚æ•°ï¼Œæ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœå¤šä¸ªè·¯ç”±çš„è¯ï¼Œidä¹Ÿåº”è¯¥æ˜¯ä¸åŒçš„ã€‚</p><p>uriï¼šè¯¥å‚æ•°æ—¶ç”¨æ¥æŒ‡å®šåŒ¹é…åçš„è®¿é—®é“¾æ¥ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œé‚£ä¹ˆå°±å»è®¿é—®ç™¾åº¦äº†ã€‚<br />predicatesï¼šæ–­è¨€å‚æ•°ï¼Œè¿™ä¸ªè¯·æ¥ç€å¾€ä¸‹çœ‹ã€‚<br />filtersï¼šè¿‡æ»¤å™¨å‚æ•°ã€‚</p><h2 id="æ–­è¨€å‚æ•°"><a href="#æ–­è¨€å‚æ•°" class="headerlink" title="æ–­è¨€å‚æ•°"></a>æ–­è¨€å‚æ•°</h2><p>æ–­è¨€å‚æ•°<code>predicates</code>ï¼Œæ˜¯ç”¨æ¥åŒ¹é…è·¯ç”±è§„åˆ™çš„ï¼Œæ¯”å¦‚æœ¬æ¬¡ä¾‹å­ä¸­çš„<code>Path=/baidu/**</code>ï¼Œæ„æ€å°±æ˜¯åŒ¹é…<code>[http://localhost/baidu/*/](http://localhost/baidu/*/)</code>çš„ç›¸å…³çš„é“¾æ¥ã€‚<br />æ–­è¨€å‚æ•°ä¹Ÿæ˜¯Gatewayä¸­è§„åˆ™æœ€å¤šçš„äº†ï¼Œä¸‹é¢æˆ‘ä»¬ç»†è¯´ä¸€ä¸‹æ–­è¨€æœ‰æä¾›å“ªäº›åŒ¹é…å‚æ•°ã€‚</p><h3 id="After"><a href="#After" class="headerlink" title="After"></a>After</h3><p><code>- After=2021-01-01</code><br />åŒ¹é…åœ¨2021å¹´ä¸€æœˆä¸€æ—¥æ—¶é—´ä¹‹åå‘ç”Ÿçš„è¯·æ±‚ã€‚</p><blockquote><p><code>After=2019-09-24T16:30:00+08:00[Asia/Shanghai] </code></p></blockquote><h3 id="Before"><a href="#Before" class="headerlink" title="Before"></a>Before</h3><p><code>- Before=2021-01-01</code><br />åŒ¹é…åœ¨2021å¹´ä¸€æœˆä¸€æ—¥æ—¶é—´ä¹‹å‰å‘ç”Ÿçš„è¯·æ±‚ã€‚</p><h3 id="Between"><a href="#Between" class="headerlink" title="Between"></a>Between</h3><p><code>- Before=2021-01-01,2021-01-02</code><br />åŒ¹é…åœ¨2021å¹´ä¸€æœˆä¸€æ—¥è‡³2021å¹´ä¸€æœˆäºŒæ—¥ä¹‹é—´å‘ç”Ÿçš„è¯·æ±‚ã€‚</p><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p><code>- Cookie=username, macro</code><br />cookieçš„è®¾ç½®ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯nameå’Œregexpï¼ˆJavaæ­£åˆ™ï¼‰ï¼Œå¯ä»¥åŒ¹é…åˆ°ç›¸åº”åç§°çš„Cookieåç§°ï¼Œä¸”ä¸æ­£åˆ™ç›¸åŒ¹é…çš„Cookieå€¼çš„é“¾æ¥ã€‚</p><blockquote><p>username&#x3D;macro</p></blockquote><h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><p><code>- Header=X-Request-Id, \d+</code><br />HeaderåŒæ ·ä¹Ÿæä¾›äº†ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯nameå’Œregexpï¼ˆJavaæ­£åˆ™ï¼‰ï¼Œå¯ä»¥åŒ¹é…ç›¸åº”ç±»å‹çš„Urlï¼Œæ¯”å¦‚127.0.0.1&#x2F;demo&#x2F;1ï¼Œè¿™æ ·å°±å¯ä»¥è¿›å…¥ä¸Šè¿°è§„åˆ™ã€‚</p><h3 id="Host"><a href="#Host" class="headerlink" title="Host"></a>Host</h3><p><code>- Host=**.baidu.com</code><br />Hostå°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œå…¶å‚æ•°å°±æ˜¯åŒ¹é…ç›¸åº”çš„ipï¼Œæˆ–è€…åŸŸåç­‰ä¿¡æ¯çš„Urlã€‚</p><h3 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h3><p><code>- Method=GET</code><br />Methodå°±æ›´åŠ ç†Ÿæ‚‰äº†ï¼ŒGETã€POSTã€PUTã€DELETEç­‰éƒ½æ˜¯å±äºMethodä¸­çš„ä¸€ç±»ï¼Œä¸Šè¿°å°±æ˜¯åŒ¹é…GETç±»çš„è¯·æ±‚ã€‚</p><h3 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h3><p><code>- Path=/baidu/**</code><br />Pathï¼šæˆ‘ä»¬æœ€å¸¸ç”¨çš„ï¼Œç”¨äºåŒ¹é…URLç›¸å…³è·¯å¾„ã€‚</p><h3 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h3><p><code>- Query=username</code><br />Queryï¼šæŸ¥è¯¢æ¡ä»¶ï¼Œç”¨äºåŒ¹é…æŸ¥è¯¢æ¡ä»¶æ˜¯å¦å­˜åœ¨abcæ¡ä»¶ã€‚</p><blockquote><p>curl <a href="http://localhost:9527/user?username=zhazha">http://localhost:9527/user?username=zhazha</a></p></blockquote><h3 id="RemoteAddr"><a href="#RemoteAddr" class="headerlink" title="RemoteAddr"></a>RemoteAddr</h3><p><code>- RemoteAddr=192.168.1.1/24</code></p><p>ä½¿ç”¨curlå·¥å…·ä»192.168.1.1å‘èµ·è¯·æ±‚å¯ä»¥åŒ¹é…è¯¥è·¯ç”±ã€‚</p><blockquote><p><code>curl http://localhost:9201/user/1</code></p></blockquote><h3 id="Weight"><a href="#Weight" class="headerlink" title="Weight"></a>Weight</h3><p>åˆ©ç”¨è·¯ç”±æƒé‡æ¥åŒ¹é…å¯¹åº”çš„è·¯ç”±è§„åˆ™</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">weight_high</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://localhost:8006</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Weight=group1,</span> <span class="number">8</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">weight_low</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://localhost:8007</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Weight=group1,</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æƒé‡æ¥è·¯ç”±ç›¸åº”è¯·æ±‚ï¼Œä»¥ä¸‹è¡¨ç¤ºæœ‰80%çš„è¯·æ±‚ä¼šè¢«è·¯ç”±åˆ°localhost:8006ï¼Œ20%ä¼šè¢«è·¯ç”±åˆ°localhost:8007ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœåŠ¡ç½‘å…³ </tag>
            
            <tag> gateway </tag>
            
            <tag> event loop </tag>
            
            <tag> Reactor </tag>
            
            <tag> è·¯ç”± </tag>
            
            <tag> åŠ¨æ€è·¯ç”± </tag>
            
            <tag> é™æ€è·¯ç”± </tag>
            
            <tag> è‡ªå®šä¹‰åŠ¨æ€è·¯ç”± </tag>
            
            <tag> æ–­è¨€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>09é™æµä¸ç†”æ–­ç†è®ºéƒ¨åˆ†â€”â€”hystrixç†”æ–­å™¨ï¼ˆä¸‰ï¼‰</title>
      <link href="/2022/11/07/02springcloud/09%E9%99%90%E6%B5%81%E4%B8%8E%E7%86%94%E6%96%AD%E7%90%86%E8%AE%BA%E9%83%A8%E5%88%86%E2%80%94%E2%80%94hystrix%E7%86%94%E6%96%AD%E5%99%A8%EF%BC%88%E4%B8%89%EF%BC%89/"/>
      <url>/2022/11/07/02springcloud/09%E9%99%90%E6%B5%81%E4%B8%8E%E7%86%94%E6%96%AD%E7%90%86%E8%AE%BA%E9%83%A8%E5%88%86%E2%80%94%E2%80%94hystrix%E7%86%94%E6%96%AD%E5%99%A8%EF%BC%88%E4%B8%89%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬ç¯‡åœ¨ç”¨ä¸åˆ°çš„æ—¶å€™å¯ä»¥ä¸å­¦ï¼Œåªè¦å­¦ä¼š sentinel å°±å¯ä»¥äº†</p></blockquote><h1 id="Hystrixèƒ½å¹²å˜›"><a href="#Hystrixèƒ½å¹²å˜›" class="headerlink" title="Hystrixèƒ½å¹²å˜›"></a>Hystrixèƒ½å¹²å˜›</h1><p>æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æ¥è¿‘å®æ—¶çš„ç›‘æ§Â·Â·Â·Â·Â·Â·</p><blockquote><p>hystrixä¿éšœæˆ‘ä»¬çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸ä¼šå¯¼è‡´æ•´ä¸ªä½“ç³»æœåŠ¡å¤±è´¥ï¼Œé¿å…<strong>çº§è”æ•…éšœ</strong>ï¼Œä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ã€‚</p></blockquote><h2 id="1ã€æœåŠ¡é™çº§"><a href="#1ã€æœåŠ¡é™çº§" class="headerlink" title="1ã€æœåŠ¡é™çº§"></a>1ã€æœåŠ¡é™çº§</h2><p>è®©å‡ºæœåŠ¡çš„èµ„æº, ç»™å¦å¤–çš„æœåŠ¡</p><p>æœåŠ¡é™çº§å¼ºè°ƒçš„æ˜¯<strong>å½“å‰æœåŠ¡ é™çº§(æˆ–ä¸å†è°ƒç”¨)<strong>è¢«è°ƒç”¨çš„</strong>æŠ¥é”™æœåŠ¡</strong></p><p>è¿™é‡Œçš„æŠ¥é”™æœåŠ¡åŒ…æ‹¬: </p><ul><li>å¯¹æ–¹æœåŠ¡çš„ç¨‹åºè¿è¡Œå¼‚å¸¸</li><li>è¶…å‡ºæˆ‘æ–¹è§„å®šçš„è¶…æ—¶æ—¶é—´</li><li>æœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§</li><li>çº¿ç¨‹æ± &#x2F;ä¿¡å·é‡æ‰“æ»¡ä¹Ÿä¼šå¯¼è‡´æœåŠ¡é™çº§</li></ul><h2 id="2ã€æœåŠ¡ç†”æ–­"><a href="#2ã€æœåŠ¡ç†”æ–­" class="headerlink" title="2ã€æœåŠ¡ç†”æ–­"></a>2ã€æœåŠ¡ç†”æ–­</h2><p>ç±»æ¯”ä¿é™©ä¸è¾¾åˆ°æœ€å¤§æœåŠ¡è®¿é—®åï¼Œç›´æ¥æ‹’ç»è®¿é—®ï¼Œæ‹‰é—¸é™ç”µï¼Œç„¶åè°ƒç”¨æœåŠ¡é™çº§çš„æ–¹æ³•å¹¶è¿”å›å‹å¥½æç¤º<br />å°±æ˜¯ä¿é™©ä¸ï¼šæœåŠ¡çš„é™çº§-&gt;è¿›è€Œç†”æ–­-&gt;æ¢å¤è°ƒç”¨é“¾è·¯</p><h2 id="3ã€æœåŠ¡é™æµ"><a href="#3ã€æœåŠ¡é™æµ" class="headerlink" title="3ã€æœåŠ¡é™æµ"></a>3ã€æœåŠ¡é™æµ</h2><p>ç§’æ€é«˜å¹¶å‘ç­‰æ“ä½œï¼Œä¸¥ç¦ä¸€çªèœ‚çš„è¿‡æ¥æ‹¥æŒ¤ï¼Œå¤§å®¶æ’é˜Ÿï¼Œä¸€ç§’é’ŸNä¸ªï¼Œæœ‰åºè¿›è¡Œ</p><h2 id="æœåŠ¡é™çº§"><a href="#æœåŠ¡é™çº§" class="headerlink" title="æœåŠ¡é™çº§"></a>æœåŠ¡é™çº§</h2><p>8001å…ˆä»è‡ªèº«æ‰¾é—®é¢˜ï¼šè®¾ç½®è‡ªèº«è°ƒç”¨è¶…æ—¶æ—¶é—´çš„å³°å€¼ï¼Œå³°å€¼å†…å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œè¶…è¿‡äº†éœ€è¦æœ‰å…œåº•çš„æ–¹æ³•å¤„ç†ï¼Œä½œæœåŠ¡é™çº§fallback</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070133893.png" alt="image.png"></p><blockquote><h3 id="ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ä»¥ä½¿ç”¨hystrix"><a href="#ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ä»¥ä½¿ç”¨hystrix" class="headerlink" title="ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ä»¥ä½¿ç”¨hystrix?"></a>ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ä»¥ä½¿ç”¨hystrix?</h3><ul><li>æœåŠ¡ç«¯</li></ul><p>serverA è°ƒç”¨äº† serverB çš„æœåŠ¡, serverBå¯èƒ½å·²ç»å®•æœºæˆ–è€…è´Ÿè½½, æ— æ³•åŠæ—¶çš„åšå‡ºååº”, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™ serverA æä¾› hystrix ä¿éšœ serverA èƒ½å¤ŸåŠæ—¶çš„åšå‡ºåé¦ˆ, è€Œä¸æ˜¯ ä¸€ç›´é˜»å¡ç­‰å¾… serverB æœ€ç»ˆå¼¹å‡ºä¸€å †æŠ¥é”™çš„ä¸å‹å¥½ä¿¡æ¯(è€Œä¸”è¿˜èƒ½ä¸å®‰å…¨)</p><ul><li>å®¢æˆ·ç«¯</li></ul><p>clientA è°ƒç”¨äº† serverA çš„æœåŠ¡, clientA ä¸ä¿¡ä»» serverA, æ‰€ä»¥ä¸€èˆ¬éƒ½ä¼šæœ‰ä¸ªå¦å¤–ä¸€ä¸ª serverB åšä¿éšœ.  å¦‚æœ clientA è®¿é—® serverA æ—¶é˜»å¡è¶…æ—¶, clientA ä¼šç†”æ–­ serverA, å¹¶å¯¹ serverA é™çº§, æœ€åclientAè¿”å›ä¸€ä¸ªå…œåº•çš„æ–¹æ³•ç»™ç”¨æˆ·, ä¸‹æ¬¡å†æ¬¡è®¿é—® clientA æ—¶, clientA ä¸å†è®¿é—® serverA, è€Œæ˜¯ serverA é›†ç¾¤ä¸­çš„å¦ä¸€å°æœåŠ¡ serverB(å¤šæ¬¡è®¿é—®æ—¶, è¿˜ä¼šç»™ä¸ªè¯·æ±‚ç»™ serverA è¯•è¯•èƒ½ä¸èƒ½ç”¨äº†)</p></blockquote><p>è¿™æ˜¯ä¸€æ¬¡hystrix ç†”æ–­å¹¶fallback çš„è¿‡ç¨‹</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070133854.png" alt="image.png"></p><p>hystrixå¯ä»¥é…ç½®åœ¨ clientA å¤„ é˜²æ­¢<strong>è“æ ‡2</strong>å‡ºç°é—®é¢˜é˜»å¡<br />ä¹Ÿå¯ä»¥é…ç½®åœ¨ serverB é˜²æ­¢ <strong>è“æ ‡3</strong> å‡ºç°é˜»å¡å’Œè¶…æ—¶çš„æƒ…å†µ</p><p>äº†è§£è¿™äº›, æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥åˆ†åˆ«ä»‹ç»ä»‹ç»æ€ä¹ˆç©</p><h3 id="serveræœåŠ¡ç«¯-æä¾›ç«¯"><a href="#serveræœåŠ¡ç«¯-æä¾›ç«¯" class="headerlink" title="serveræœåŠ¡ç«¯(æä¾›ç«¯)"></a>serveræœåŠ¡ç«¯(æä¾›ç«¯)</h3><p>ä¾èµ–:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--hystrix--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--SpringCloud consul-server --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- å…¶ä»–ç•¥ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>åªè¦å¯¼å…¥åŒ…å, hystrix é»˜è®¤å¯åŠ¨, ä¸éœ€è¦å¦å¤–è®¾ç½®</p></blockquote><p>åº•å±‚é»˜è®¤ä½¿ç”¨çš„è¿˜æ˜¯ ribbon åšè´Ÿè½½å‡è¡¡</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070133520.png" alt="image.png"></p><p>application.yml :</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###consulæœåŠ¡ç«¯å£å·</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">consul-provider-payment</span></span><br><span class="line">  <span class="comment">####consulæ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#hostname: 127.0.0.1</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å¯ä»¥ç»™ controller æˆ–è€… service æ·»åŠ  hystrix æ“ä½œåŠŸèƒ½</p><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©æ ‡è®° controller è®© hystrix æ‹¦æˆªå¹¶ä½¿ç”¨</p><p>hystrix æ ‡è®°è¶…æ—¶çš„æ³¨è§£æ˜¯ <code>@HystrixCommand</code></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070133176.png" alt="image.png"></p><p>æ³¨è§£å¯ä»¥ä½¿ç”¨ <code>fallbackMethod</code> æ ‡è®°ä¸€ä¸ªæ–¹æ³•, è®©<code>@HystrixCommand</code>æ ‡è®°çš„æ–¹æ³•åœ¨å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨çš„å¤‡é€‰æ–¹æ¡ˆ</p><p>è´´å‡ºå®Œæ•´ä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ­£å¸¸è®¿é—®ä¸€åˆ‡ OK</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">paymentInfoOk</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¶…æ—¶è®¿é—®ï¼Œæ¼”ç¤ºé™çº§</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">paymentInfoTimeOut</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfoOk</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± :&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_OK,id: &quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;O(âˆ©_âˆ©)O&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfoTimeOut</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± :&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_TimeOut,id: &quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;O(âˆ©_âˆ©)Oï¼Œè€—è´¹3ç§’&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfoOk</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfoOk(id);</span><br><span class="line">log.info(<span class="string">&quot;****result: &quot;</span> + result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;fallbackPaymentInfoTimeOut&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;3000&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfoTimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfoTimeOut(id);</span><br><span class="line">log.info(<span class="string">&quot;****result: &quot;</span> + result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">fallbackPaymentInfoTimeOut</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">&quot;fallback&quot;</span>;</span><br><span class="line">log.info(<span class="string">&quot;****result: &quot;</span> + result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// é€šç”¨ç†”æ–­å™¨æ³¨è§£, æœ‰äº†è¿™ä¸ªä¸‹é¢çš„`EnableHystrix`æ³¨è§£å°±ä¸éœ€è¦äº†</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="comment">//@EnableHystrix</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œé€‰æ‹© controller åš hystrix æ ‡è®°å¯èƒ½ä¸å¤ªæ°å½“, å¯èƒ½æ ‡è®° service å¯èƒ½ä¼šæ›´å¥½ä¸€ç‚¹, ä¸è¿‡æ²¡å…³ç³»ï¼Œèƒ½å¤Ÿäº§ç”Ÿæ•ˆæœå°±è¡Œ</p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134421.png" alt="image.png">è¿™éƒ¨åˆ†å®Œæˆ</p><p>æ ¸å¿ƒä»£ç åœ¨è¿™é‡Œ: </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;fallbackPaymentInfoTimeOut&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;3000&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br></pre></td></tr></table></figure><p>è¶…æ—¶æ—¶é—´æ˜¯3ç§’ï¼Œ å®é™…å»¶è¿Ÿæ—¶é—´æ˜¯ 5 ç§’</p><p>æ‰€ä»¥ä»£ç è‚¯å®šè¶…æ—¶</p><p>è®¿é—®: <code>[http://localhost:8001/payment/hystrix/timeout/3](http://localhost:8001/payment/hystrix/timeout/3)</code><br />åé¦ˆçš„ä¿¡æ¯: <code>fallback</code><br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134759.png" alt="image.png"></p><p>æŠ¥é”™, ç„¶åè¢« hystrix æ‹¦æˆª</p><blockquote><p>hystrix é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 1 ç§’, è€Œæ¥å£å»¶è¿Ÿæ˜¯ 5 ç§’, æ‰€ä»¥è¿™ä¸ªæ¥å£ä¼šæŠ¥é”™</p></blockquote><p>å°† hystrix è¶…æ—¶æ—¶é—´å®šä½ 6ç§’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;fallbackPaymentInfoTimeOut&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;6000&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨jmeter</p><p>åˆ›å»ºçº¿ç¨‹ç»„:<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134154.png" alt="image.png"></p><p>10ä¸ªçº¿ç¨‹, è·‘ 1ç§’ å¾ªç¯ 1æ¬¡<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134332.png" alt="image.png"><br />å‘ç°10ä¸ªè¯·æ±‚éƒ½æˆåŠŸäº†</p><p>æ”¹æˆ <img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134479.png" alt="image.png">, 20ä¸ªè¯·æ±‚éƒ½ä¼šæˆåŠŸ</p><p>ä½†æ˜¯å¦‚æœæ”¹æˆ:<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134757.png" alt="image.png"></p><p>å°±ä¼šèµ°hystrixå¤‡é€‰æ–¹æ¡ˆ:<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134913.png" alt="image.png"><br />ä½†æ˜¯ä¸‹é¢10ä¸ªè¯·æ±‚ä¼šæˆåŠŸ<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134000.png" alt="image.png"></p><p>è¿™æ˜¯ä»€ä¹ˆä¸ªæƒ…å†µ?</p><h4 id="hystrix-çº¿ç¨‹éš”ç¦»"><a href="#hystrix-çº¿ç¨‹éš”ç¦»" class="headerlink" title="hystrix çº¿ç¨‹éš”ç¦»"></a>hystrix çº¿ç¨‹éš”ç¦»</h4><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134033.png" alt="image.png"></p><p>ä¸Šå›¾çš„æƒ…å†µæ˜¯å¾ˆå®¹æ˜“å‡ºç°çš„, æ‰€ä»¥çš„è¯·æ±‚éƒ½é˜»å¡åœ¨ è®¢å•æœåŠ¡ è¿™é‡Œ.<br />è€ŒæœåŠ¡çš„çº¿ç¨‹æ€»é‡æ˜¯æœ‰é™çš„(å‡è®¾åªæœ‰100æ¡), é‚£ä¹ˆç°åœ¨çš„è¯·æ±‚å…¨éƒ¨è¢«é˜»å¡åœ¨ è®¢å•æœåŠ¡ å‰ <br />é‚£ä¹ˆç”¨æˆ·å°±æ²¡æœ‰å¤šä½™çš„çº¿ç¨‹å»è®¿é—® å•†å“å’Œç”¨æˆ· æœåŠ¡, æœåŠ¡å‡ºç°çº§è”é”™è¯¯, ä¹Ÿå°±æ˜¯æœåŠ¡é›ªå´©</p><p>é‡åˆ°è¿™ç§é—®é¢˜è¦æ€ä¹ˆè§£å†³å‘¢?<br />hystrixä½¿ç”¨äº†çº¿ç¨‹éš”ç¦»æŠ€æœ¯<br />å¤§è‡´çš„æ–¹æ³•æ˜¯, ç»™æ¯ä¸ªæœåŠ¡æä¾›é»˜è®¤ 10ä¸ªçº¿ç¨‹å¤§å° çš„çº¿ç¨‹æ± <br />è¿™æ ·å³ä½¿è®¢å•æœåŠ¡å‡ºç°é—®é¢˜, å¯¼è‡´çº¿ç¨‹é˜»å¡, æœ€ç»ˆé˜»å¡çš„çº¿ç¨‹ä¹Ÿåªä¸è¿‡æ˜¯ 10æ¡, ä¸ä¼šå¯¼è‡´ å¦å¤– çš„ 90 æ¡çº¿ç¨‹å‡ºç°é—®é¢˜<br />è¿™ç§æ–¹å¼å°±æ˜¯ä»¤ç‰Œæ¡¶é™æµç®—æ³•</p><p>hystrixåœ¨é‡åˆ°å„ä¸ªç±»å‹çš„ command æŒ‡ä»¤æ—¶, ä¼šå°†è¯¥ç±»å‹è®¾è®¡æˆ key , ç„¶ååˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± , æœ€ä¸º value, å­˜æ”¾åˆ°ä¸€ä¸ª ConcurrentHashMap ä¸­, å¦‚ä¸‹å›¾æ‰€ç¤º<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134472.png" alt="image.png"></p><p>å…·ä½“çš„æºç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ThreadPoolExecutor <span class="title function_">getThreadPool</span><span class="params">(<span class="keyword">final</span> HystrixThreadPoolKey threadPoolKey, HystrixProperty&lt;Integer&gt; corePoolSize, HystrixProperty&lt;Integer&gt; maximumPoolSize, HystrixProperty&lt;Integer&gt; keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue)</span> &#123;</span><br><span class="line">    <span class="type">ThreadFactory</span> <span class="variable">threadFactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (!PlatformSpecific.isAppEngineStandardEnvironment()) &#123;</span><br><span class="line">        threadFactory = <span class="keyword">new</span> <span class="title class_">ThreadFactory</span>() &#123;</span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">threadNumber</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line">                <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r, <span class="string">&quot;hystrix-&quot;</span> + threadPoolKey.name() + <span class="string">&quot;-&quot;</span> + threadNumber.incrementAndGet());</span><br><span class="line">                thread.setDaemon(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">return</span> thread;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        threadFactory = PlatformSpecific.getAppEngineThreadFactory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">dynamicCoreSize</span> <span class="operator">=</span> corePoolSize.get();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">dynamicMaximumSize</span> <span class="operator">=</span> maximumPoolSize.get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dynamicCoreSize &gt; dynamicMaximumSize) &#123;</span><br><span class="line">        logger.error(<span class="string">&quot;Hystrix ThreadPool configuration at startup for : &quot;</span> + threadPoolKey.name() + <span class="string">&quot; is trying to set coreSize = &quot;</span> +</span><br><span class="line">                dynamicCoreSize + <span class="string">&quot; and maximumSize = &quot;</span> + dynamicMaximumSize + <span class="string">&quot;.  Maximum size will be set to &quot;</span> +</span><br><span class="line">                dynamicCoreSize + <span class="string">&quot;, the coreSize value, since it must be equal to or greater than the coreSize value&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(dynamicCoreSize, dynamicCoreSize, keepAliveTime.get(), unit, workQueue, threadFactory);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(dynamicCoreSize, dynamicMaximumSize, keepAliveTime.get(), unit, workQueue, threadFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒCommandçš„æ–¹å¼ä¸€å…±å››ç§</p><ul><li>execute()ï¼šä»¥åŒæ­¥å µå¡æ–¹å¼æ‰§è¡Œrun()ã€‚è°ƒç”¨execute()åï¼Œhystrixå…ˆåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹è¿è¡Œrun()ï¼Œæ¥ç€è°ƒç”¨ç¨‹åºè¦åœ¨execute()è°ƒç”¨å¤„ä¸€ç›´å µå¡ç€ï¼Œç›´åˆ°run()è¿è¡Œå®Œæˆã€‚</li><li>queue()ï¼šä»¥å¼‚æ­¥éå µå¡æ–¹å¼æ‰§è¡Œrun()ã€‚è°ƒç”¨queue()å°±ç›´æ¥è¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼ŒåŒæ—¶hystrixåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹è¿è¡Œrun()ï¼Œè°ƒç”¨ç¨‹åºé€šè¿‡Future.get()æ‹¿åˆ°run()çš„è¿”å›ç»“æœï¼Œè€ŒFuture.get()æ˜¯å µå¡æ‰§è¡Œçš„ã€‚</li><li>observe()ï¼šäº‹ä»¶æ³¨å†Œå‰æ‰§è¡Œrun()&#x2F;construct()ã€‚ç¬¬ä¸€æ­¥æ˜¯äº‹ä»¶æ³¨å†Œå‰ï¼Œå…ˆè°ƒç”¨observe()è‡ªåŠ¨è§¦å‘æ‰§è¡Œrun()&#x2F;construct()ï¼ˆå¦‚æœç»§æ‰¿çš„æ˜¯HystrixCommandï¼Œhystrixå°†åˆ›å»ºæ–°çº¿ç¨‹éå µå¡æ‰§è¡Œrun()ï¼›å¦‚æœç»§æ‰¿çš„æ˜¯HystrixObservableCommandï¼Œå°†ä»¥è°ƒç”¨ç¨‹åºçº¿ç¨‹å µå¡æ‰§è¡Œconstruct()ï¼‰ï¼Œç¬¬äºŒæ­¥æ˜¯ä»observe()è¿”å›åè°ƒç”¨ç¨‹åºè°ƒç”¨subscribe()å®Œæˆäº‹ä»¶æ³¨å†Œï¼Œå¦‚æœrun()&#x2F;construct()æ‰§è¡ŒæˆåŠŸåˆ™è§¦å‘onNext()å’ŒonCompleted()ï¼Œå¦‚æœæ‰§è¡Œå¼‚å¸¸åˆ™è§¦å‘onError()ã€‚</li><li>toObservable()ï¼šäº‹ä»¶æ³¨å†Œåæ‰§è¡Œrun()&#x2F;construct()ã€‚ç¬¬ä¸€æ­¥æ˜¯äº‹ä»¶æ³¨å†Œå‰ï¼Œè°ƒç”¨toObservable()å°±ç›´æ¥è¿”å›ä¸€ä¸ªObservable<String>å¯¹è±¡ï¼Œç¬¬äºŒæ­¥è°ƒç”¨subscribe()å®Œæˆäº‹ä»¶æ³¨å†Œåè‡ªåŠ¨è§¦å‘æ‰§è¡Œrun()&#x2F;construct()ï¼ˆå¦‚æœç»§æ‰¿çš„æ˜¯HystrixCommandï¼Œhystrixå°†åˆ›å»ºæ–°çº¿ç¨‹éå µå¡æ‰§è¡Œrun()ï¼Œè°ƒç”¨ç¨‹åºä¸å¿…ç­‰å¾…run()ï¼›å¦‚æœç»§æ‰¿çš„æ˜¯HystrixObservableCommandï¼Œå°†ä»¥è°ƒç”¨ç¨‹åºçº¿ç¨‹å µå¡æ‰§è¡Œconstruct()ï¼Œè°ƒç”¨ç¨‹åºç­‰å¾…construct()æ‰§è¡Œå®Œæ‰èƒ½ç»§ç»­å¾€ä¸‹èµ°ï¼‰ï¼Œå¦‚æœrun()&#x2F;construct()æ‰§è¡ŒæˆåŠŸåˆ™è§¦å‘onNext()å’ŒonCompleted()ï¼Œå¦‚æœæ‰§è¡Œå¼‚å¸¸åˆ™è§¦å‘onError()</li></ul><h5 id="çº¿ç¨‹éš”ç¦»çš„ä¼˜ç‚¹"><a href="#çº¿ç¨‹éš”ç¦»çš„ä¼˜ç‚¹" class="headerlink" title="çº¿ç¨‹éš”ç¦»çš„ä¼˜ç‚¹"></a>çº¿ç¨‹éš”ç¦»çš„ä¼˜ç‚¹</h5><p><br />[1]:åº”ç”¨ç¨‹åºä¼šè¢«å®Œå…¨ä¿æŠ¤èµ·æ¥ï¼Œå³ä½¿ä¾èµ–çš„ä¸€ä¸ªæœåŠ¡çš„çº¿ç¨‹æ± æ»¡äº†ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ã€‚<br />[2]:æˆ‘ä»¬ç»™åº”ç”¨ç¨‹åºå¼•å…¥ä¸€ä¸ªæ–°çš„é£é™©è¾ƒä½çš„å®¢æˆ·ç«¯libçš„æ—¶å€™ï¼Œå¦‚æœå‘ç”Ÿé—®é¢˜ï¼Œä¹Ÿæ˜¯åœ¨æœ¬libä¸­ï¼Œå¹¶ä¸ä¼šå½±å“åˆ°å…¶ä»–å†…å®¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¤§èƒ†çš„å¼•å…¥æ–°libåº“ã€‚<br />[3]:å½“ä¾èµ–çš„ä¸€ä¸ªå¤±è´¥çš„æœåŠ¡æ¢å¤æ­£å¸¸æ—¶ï¼Œåº”ç”¨ç¨‹åºä¼šç«‹å³æ¢å¤æ­£å¸¸çš„æ€§èƒ½ã€‚<br />[4]:å¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸€äº›å‚æ•°é…ç½®é”™è¯¯äº†ï¼Œçº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶å†µå°†ä¼šå¾ˆå¿«æ˜¾ç¤ºå‡ºæ¥ï¼Œæ¯”å¦‚å»¶è¿Ÿã€è¶…æ—¶ã€æ‹’ç»ç­‰ã€‚åŒæ—¶å¯ä»¥é€šè¿‡åŠ¨æ€å±æ€§å®æ—¶æ‰§è¡Œæ¥å¤„ç†çº æ­£é”™è¯¯çš„å‚æ•°é…ç½®ã€‚<br />[5]:å¦‚æœæœåŠ¡çš„æ€§èƒ½æœ‰å˜åŒ–ï¼Œä»è€Œéœ€è¦è°ƒæ•´ï¼Œæ¯”å¦‚å¢åŠ æˆ–è€…å‡å°‘è¶…æ—¶æ—¶é—´ï¼Œæ›´æ”¹é‡è¯•æ¬¡æ•°ï¼Œå°±å¯ä»¥é€šè¿‡çº¿ç¨‹æ± æŒ‡æ ‡åŠ¨æ€å±æ€§ä¿®æ”¹ï¼Œè€Œä¸”ä¸ä¼šå½±å“åˆ°å…¶ä»–è°ƒç”¨è¯·æ±‚ã€‚<br />[6]:é™¤äº†éš”ç¦»ä¼˜åŠ¿å¤–ï¼Œhystrixæ‹¥æœ‰ä¸“é—¨çš„çº¿ç¨‹æ± å¯æä¾›å†…ç½®çš„å¹¶å‘åŠŸèƒ½ï¼Œä½¿å¾—å¯ä»¥åœ¨åŒæ­¥è°ƒç”¨ä¹‹ä¸Šæ„å»ºå¼‚æ­¥çš„å¤–è§‚æ¨¡å¼ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„åšå¼‚æ­¥ç¼–ç¨‹ï¼ˆHystrixå¼•å…¥äº†Rxjavaå¼‚æ­¥æ¡†æ¶ï¼‰ã€‚</p><blockquote><h4 id="å°½ç®¡çº¿ç¨‹æ± æä¾›äº†çº¿ç¨‹éš”ç¦»ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯åº•å±‚ä»£ç ä¹Ÿå¿…é¡»è¦æœ‰è¶…æ—¶è®¾ç½®ï¼Œä¸èƒ½æ— é™åˆ¶çš„é˜»å¡ä»¥è‡´çº¿ç¨‹æ± ä¸€ç›´é¥±å’Œã€‚"><a href="#å°½ç®¡çº¿ç¨‹æ± æä¾›äº†çº¿ç¨‹éš”ç¦»ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯åº•å±‚ä»£ç ä¹Ÿå¿…é¡»è¦æœ‰è¶…æ—¶è®¾ç½®ï¼Œä¸èƒ½æ— é™åˆ¶çš„é˜»å¡ä»¥è‡´çº¿ç¨‹æ± ä¸€ç›´é¥±å’Œã€‚" class="headerlink" title="å°½ç®¡çº¿ç¨‹æ± æä¾›äº†çº¿ç¨‹éš”ç¦»ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯åº•å±‚ä»£ç ä¹Ÿå¿…é¡»è¦æœ‰è¶…æ—¶è®¾ç½®ï¼Œä¸èƒ½æ— é™åˆ¶çš„é˜»å¡ä»¥è‡´çº¿ç¨‹æ± ä¸€ç›´é¥±å’Œã€‚"></a>å°½ç®¡çº¿ç¨‹æ± æä¾›äº†çº¿ç¨‹éš”ç¦»ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯åº•å±‚ä»£ç ä¹Ÿå¿…é¡»è¦æœ‰è¶…æ—¶è®¾ç½®ï¼Œä¸èƒ½æ— é™åˆ¶çš„é˜»å¡ä»¥è‡´çº¿ç¨‹æ± ä¸€ç›´é¥±å’Œã€‚</h4></blockquote><h5 id="çº¿ç¨‹éš”ç¦»çš„ç¼ºç‚¹"><a href="#çº¿ç¨‹éš”ç¦»çš„ç¼ºç‚¹" class="headerlink" title="çº¿ç¨‹éš”ç¦»çš„ç¼ºç‚¹"></a>çº¿ç¨‹éš”ç¦»çš„ç¼ºç‚¹</h5><p><br />[1]:çº¿ç¨‹æ± çš„ä¸»è¦ç¼ºç‚¹å°±æ˜¯å®ƒå¢åŠ äº†è®¡ç®—çš„å¼€é”€ï¼Œæ¯ä¸ªä¸šåŠ¡è¯·æ±‚ï¼ˆè¢«åŒ…è£…æˆå‘½ä»¤ï¼‰åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šæ¶‰åŠåˆ°è¯·æ±‚æ’é˜Ÿï¼Œè°ƒåº¦å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ä¸è¿‡Netflixå…¬å¸å†…éƒ¨è®¤ä¸ºçº¿ç¨‹éš”ç¦»å¼€é”€è¶³å¤Ÿå°ï¼Œä¸ä¼šäº§ç”Ÿé‡å¤§çš„æˆæœ¬æˆ–æ€§èƒ½çš„å½±å“ã€‚<br />The Netflix API processes 10+ billion Hystrix Command executions per day using thread isolation. Each API instance has 40+ thread-pools with 5â€“20 threads in each (most are set to 10).<br />Netflix APIæ¯å¤©ä½¿ç”¨çº¿ç¨‹éš”ç¦»å¤„ç†10äº¿æ¬¡Hystrix Commandæ‰§è¡Œã€‚ æ¯ä¸ªAPIå®ä¾‹éƒ½æœ‰40å¤šä¸ªçº¿ç¨‹æ± ï¼Œæ¯ä¸ªçº¿ç¨‹æ± ä¸­æœ‰5-20ä¸ªçº¿ç¨‹ï¼ˆå¤§å¤šæ•°è®¾ç½®ä¸º10ä¸ªï¼‰ã€‚<br />å¯¹äºä¸ä¾èµ–ç½‘ç»œè®¿é—®çš„æœåŠ¡ï¼Œæ¯”å¦‚åªä¾èµ–å†…å­˜ç¼“å­˜è¿™ç§æƒ…å†µä¸‹ï¼Œå°±ä¸é€‚åˆç”¨çº¿ç¨‹æ± éš”ç¦»æŠ€æœ¯ï¼Œè€Œæ˜¯é‡‡ç”¨ä¿¡å·é‡éš”ç¦»ï¼Œåé¢æ–‡ç« ä¼šä»‹ç»ã€‚<br />å› æ­¤æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒä½¿ç”¨Hystrixçš„çº¿ç¨‹éš”ç¦»æŠ€æœ¯ï¼Œæ¥é˜²æ­¢é›ªå´©è¿™ç§å¯æ€•çš„è‡´å‘½æ€§çº¿ä¸Šæ•…éšœã€‚</p><blockquote><p>è¿™ä¸€å°æ®µè½¬è½½è‡ªç®€ä¹¦<br />ä½œè€…ï¼šæ–°æ ‹BOOK<br />æ ‡é¢˜ï¼šHystrixçº¿ç¨‹éš”ç¦»æŠ€æœ¯è§£æ-çº¿ç¨‹æ± </p></blockquote><h3 id="clientå®¢æˆ·ç«¯-æ¶ˆè´¹ç«¯"><a href="#clientå®¢æˆ·ç«¯-æ¶ˆè´¹ç«¯" class="headerlink" title="clientå®¢æˆ·ç«¯(æ¶ˆè´¹ç«¯)"></a>clientå®¢æˆ·ç«¯(æ¶ˆè´¹ç«¯)<a href="https://blog.csdn.net/Mark42/article/details/123738225"><br /></a></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--SpringCloud consul-server --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###consulæœåŠ¡ç«¯å£å·</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-consumer-order</span></span><br><span class="line">  <span class="comment">####consulæ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#hostname: 127.0.0.1</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„ application.yml ä¸­å¦‚æœå¼€å¯äº† hystrix å°±éœ€è¦åŒæ—¶å¯åŠ¨ ribbon å’Œ hystrix çš„è¶…æ—¶é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">##è®¾ç½®feign å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´ï¼ˆopenFeigné»˜è®¤æ”¯æŒribbonï¼‰</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">7000</span></span><br><span class="line">  <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">7000</span></span><br><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">execution:</span></span><br><span class="line">        <span class="attr">isolation:</span></span><br><span class="line">          <span class="attr">thread:</span></span><br><span class="line">            <span class="attr">timeoutInMilliseconds:</span> <span class="number">7000</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å¯åŠ¨ hystrix ä¹Ÿéœ€è¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">//@EnableHystrix</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderHystrixMain80</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(OrderHystrixMain80.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(&quot;consul-provider-payment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentClient</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfoOk</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfoTimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderHystrixController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentClient paymentClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfoOk</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> paymentClient.paymentInfoOk(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfoTimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">return</span> paymentClient.paymentInfoTimeOut(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><h4 id="é—®é¢˜ä¸€-è¶…æ—¶é—®é¢˜"><a href="#é—®é¢˜ä¸€-è¶…æ—¶é—®é¢˜" class="headerlink" title="é—®é¢˜ä¸€: è¶…æ—¶é—®é¢˜"></a>é—®é¢˜ä¸€: è¶…æ—¶é—®é¢˜</h4><p>ç°åœ¨ä½¿ç”¨<code>[http://localhost:80/consumer/payment/hystrix/timeout/2](http://localhost:80/consumer/payment/hystrix/timeout/2)</code>è®¿é—®åœ°å€ä¼šæŠ¥é”™</p><p>å¤±è´¥ä¿¡æ¯:<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134970.png" alt="image.png"></p><p>ä»¥ä¸Š,é¢å°†é”™è¯¯ç›´æ¥ä¸¢ç»™å®¢æˆ·æ˜¯ä¸€ç§éå¸¸å¤±èŒçš„æ–¹å¼</p><p>é‚£ä¹ˆè¦æ€ä¹ˆè§£å†³å‘¢?</p><p>éå¸¸ç®€å•, å°±æ˜¯ä¸è®©ç”¨æˆ·çœ‹åˆ°ä¸å°±è¡Œäº†.</p><p>æ–¹æ³•æœ‰ä¸¤ç§:</p><ol><li>ä½¿ç”¨ hystrix å°†ç†”æ–­çš„æœåŠ¡é™çº§æ‰(è¿™æ ·å°±é‡ä¸åˆ°æŠ¥é”™çš„æœåŠ¡äº†)</li><li>ç†”æ–­è¿”å›çš„é”™è¯¯æ•°æ®åŒ…æ‹¦æˆªä¸‹æ¥, åŒ…è£…ä¸€ä¸ªæ–°çš„é¡µé¢ç»™ç”¨æˆ·</li></ol><p><code>@HystrixCommand(fallbackMethod = &quot;fallbackPaymentInfoTimeOut&quot;)</code><br />ç¼ºå°‘äº†è‡ªå®šä¹‰çš„è¶…æ—¶æ—¶é—´</p><p>å¯ä»¥è¿™ä¹ˆåš:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;fallbackPaymentInfoTimeOut&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">@HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;3000&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure><p>ç»™ä»–å®šæ—¶ 3 ç§’, 3ç§’åè¶…æ—¶</p><p>å¦‚æœä½ æ˜¯åœ¨<strong>å®¢æˆ·ç«¯</strong>å®¢æˆ·ç«¯ä»€ä¹ˆéƒ½æœ‰åªç”¨äº† openFeign çš„è¯, å¯ä»¥è¿™ä¹ˆåš:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="comment">## default è®¾ç½®çš„å…¨å±€è¶…æ—¶æ—¶é—´ï¼ŒæŒ‡å®šæœåŠ¡åç§°å¯ä»¥è®¾ç½®å•ä¸ªæœåŠ¡çš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">connectTimeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">readTimeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">basic</span></span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯ä½¿ç”¨äº† <code>openFeign</code>å¯ä»¥è¿™ä¹ˆé…ç½®, ä»–åº•å±‚å…¶å®ä½¿ç”¨äº† ribbon(æ—§ç‰ˆæœ¬)</p></blockquote><p>å½“ç„¶å¦‚æœä½ ç»™å®¢æˆ·ç«¯æ·»åŠ  hystrix å°±å¯ä»¥è¿™ä¹ˆåš:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">##è®¾ç½®feign å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´ï¼ˆopenFeigné»˜è®¤æ”¯æŒribbonï¼‰</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">7000</span></span><br><span class="line">  <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">7000</span></span><br><span class="line"><span class="comment"># hystrix å†…éƒ¨çš„è¶…æ—¶æ—¶é—´, ä¸¤ä¸ªè¶…æ—¶æ—¶é—´ç›¸åŒæ‰ä¼šæœ‰å‡†ç¡®çš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">execution:</span></span><br><span class="line">        <span class="attr">isolation:</span></span><br><span class="line">          <span class="attr">thread:</span></span><br><span class="line">            <span class="attr">timeoutInMilliseconds:</span> <span class="number">7000</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™ç§æƒ…å†µæ˜¯ä½¿ç”¨äº† hystrix ä¹‹åçš„è¶…æ—¶æ—¶é—´æ–¹æ³•, å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ·»åŠ  openFeignè¶…æ—¶é…ç½®, ä¹Ÿèƒ½ç”Ÿæ•ˆ, ä½†è¿˜æ˜¯è¦ç›¸åŒ, æˆ–è€… æ¯” 7000 æ›´å°æ‰èƒ½ç”Ÿæ•ˆ, å¤ªéº»çƒ¦äº†</p></blockquote><h4 id="é—®é¢˜äºŒ-ä»£ç å†—ä½™"><a href="#é—®é¢˜äºŒ-ä»£ç å†—ä½™" class="headerlink" title="é—®é¢˜äºŒ: ä»£ç å†—ä½™"></a>é—®é¢˜äºŒ: ä»£ç å†—ä½™</h4><p>æœåŠ¡ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;fallbackPaymentInfoTimeOut&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;6000&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfoTimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfoTimeOut(id);</span><br><span class="line">    log.info(<span class="string">&quot;****result: &quot;</span> + result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">fallbackPaymentInfoTimeOut</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;h1&gt;è®¿é—®&#x27;/payment/hystrix/timeout&#x27;å¤±è´¥: &quot;</span> + counter.getAndIncrement() + <span class="string">&quot;&lt;/h1&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯æœ‰é—®é¢˜çš„</p><p>æ¯æ ‡è®°ä¸€ä¸ªæ–¹æ³•, éƒ½éœ€è¦é…åˆçš„å†™ä¸€ä¸ªæ–°çš„ <code>fallbackMethod = &quot;fallbackPaymentInfoTimeOut&quot;</code>æ–¹æ³•æ˜æ˜¾æ˜¯ä¸åˆç†çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">fallbackPaymentInfoTimeOut</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;h1&gt;è®¿é—®&#x27;/payment/hystrix/timeout&#x27;å¤±è´¥: &quot;</span> + counter.getAndIncrement() + <span class="string">&quot;&lt;/h1&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸æ˜¯æ‰€æœ‰æ–¹æ³•éƒ½éœ€è¦ä¸“å±çš„å…œåº•æ–¹æ³•</p><p>æˆ‘ä»¬å¯ä»¥ç»Ÿä¸€é…ç½®</p><h5 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h5><blockquote><p>ç»™æœåŠ¡ç«¯æä¾›ä»£ç </p></blockquote><p>ç»™éœ€è¦é…ç½®çš„ç±»ä¸Šæ·»åŠ <br /><code>@DefaultProperties(defaultFallback = &quot;globalFallback&quot;)</code><br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134606.png" alt="image.png"></p><h5 id="ç¬¬äºŒæ­¥"><a href="#ç¬¬äºŒæ­¥" class="headerlink" title="ç¬¬äºŒæ­¥"></a>ç¬¬äºŒæ­¥</h5><p>å¹¶ä¸”åœ¨è¯¥ç±»ä¸­æ·»åŠ æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">globalFallback</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;h1&gt;Global port: &quot;</span> + port + <span class="string">&quot; counter: &quot;</span> + counter.getAndIncrement() + <span class="string">&quot;ç³»ç»Ÿç¹å¿™, è¯·ç¨åå†å°è¯•&lt;/h1&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070134984.png" alt="image.png"></p><h5 id="ç¬¬ä¸‰æ­¥"><a href="#ç¬¬ä¸‰æ­¥" class="headerlink" title="ç¬¬ä¸‰æ­¥"></a>ç¬¬ä¸‰æ­¥</h5><p>æ¥ç€æ·»åŠ ä¸¤ä¸ªæ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/hystrix/timeout01/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfoTimeOut01</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfoTimeOut(id);</span><br><span class="line">    log.info(<span class="string">&quot;timeout01: &quot;</span> + result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@HystrixCommand</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/hystrix/timeout02/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfoTimeOut02</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfoTimeOut(id);</span><br><span class="line">    log.info(<span class="string">&quot;timeout01: &quot;</span> + result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è®°ä½éœ€è¦åŠ ä¸Š <code>@HystrixCommand</code> æ³¨è§£, å¦åˆ™å…¨å±€å¼‚å¸¸ hystrix å¤±æ•ˆ, hystrix éœ€è¦æ ‡è®°æ–¹æ³•æ‰èƒ½ç”Ÿæ•ˆ</p></blockquote><h4 id="é—®é¢˜ä¸‰-å’Œä¸šåŠ¡é€»è¾‘æ··åˆåœ¨ä¸€èµ·"><a href="#é—®é¢˜ä¸‰-å’Œä¸šåŠ¡é€»è¾‘æ··åˆåœ¨ä¸€èµ·" class="headerlink" title="é—®é¢˜ä¸‰: å’Œä¸šåŠ¡é€»è¾‘æ··åˆåœ¨ä¸€èµ·"></a>é—®é¢˜ä¸‰: å’Œä¸šåŠ¡é€»è¾‘æ··åˆåœ¨ä¸€èµ·</h4><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070135515.png" alt="image.png"></p><p>è§£å†³åŠæ³•: æŠŠè¿™ç§ å…œåº•çš„æ–¹æ³• æ”¾åœ¨å®¢æˆ·ç«¯ä¸Š</p><p>åœ¨ å®¢æˆ·ç«¯ æ·»åŠ ä¸‹åˆ—ä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.client.PaymentClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentFallbackClient</span> <span class="keyword">implements</span> <span class="title class_">PaymentClient</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfoOk</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;====PaymentHystrixService fall back paymentInfoOkï¼Œo(â•¥ï¹â•¥)o====&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfoTimeOut</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;====PaymentHystrixService fall back paymentInfoTimeOutï¼Œo(â•¥ï¹â•¥)o====&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;consul-provider-payment&quot;, fallback = PaymentFallbackClient.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentClient</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfoOk</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfoTimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸»è¦æ–¹æ³•å°±æ˜¯ç»™ <code>@FeignClient</code>æ³¨è§£æ·»åŠ <code>fallback</code>å±æ€§<br>å€¼å¾—æ³¨æ„çš„æ˜¯<code>@Component</code>æ³¨è§£ä¸€å®šä¸è¦å¿˜è®°åŠ ä¸Š</p></blockquote><p>æ­¤æ—¶å…³é—­ 8001 æœåŠ¡å, å®¢æˆ·ç«¯ä¼šèµ° å…œåº•æ–¹æ³• , ä¸ä¼šå†æŒ‚èµ·ç­‰å¾…</p><p><a href="http://localhost/consumer/payment/hystrix/timeout/2">http://localhost/consumer/payment/hystrix/timeout/2</a> <br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070135734.png" alt="image.png"><br />æ¥ç€å†å¯åŠ¨ 8001 ç­‰ä¸€ä¸‹åˆå¯ä»¥é‡æ–°æ”¾åˆ°åˆ°è¯¥æœåŠ¡<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070135111.png" alt="image.png"></p><h2 id="æœåŠ¡ç†”æ–­"><a href="#æœåŠ¡ç†”æ–­" class="headerlink" title="æœåŠ¡ç†”æ–­"></a>æœåŠ¡ç†”æ–­</h2><p>ç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”(<strong>çº§è”æ•…éšœ</strong>)çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ï¼Œå½“æ‰‡å‡ºé“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡å‡ºé”™ä¸å¯ç”¨æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿æ—¶ï¼Œ<br />ä¼šè¿›è¡ŒæœåŠ¡çš„é™çº§ï¼Œè¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œå¿«é€Ÿè¿”å›é”™è¯¯çš„å“åº”ä¿¡æ¯ï¼Œå½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨å“åº”æ­£å¸¸åï¼Œæ¢å¤è°ƒç”¨é“¾è·¯</p><p>åœ¨ springcloud ä¸­å¦‚æœä½¿ç”¨ hystrix åšæœåŠ¡ç†”æ–­, ä»–å°±æœ‰ä¸€ä¸ªé˜ˆå€¼ å¦‚æœ 5 ç§’å†…å‡ºç° 20æ¬¡ é”™è¯¯, é‚£ä¹ˆå°±ä¼šè§¦å‘ç†”æ–­æœºåˆ¶.<br />hystrixè§¦å‘ç†”æ–­æœºåˆ¶çš„æ–¹å¼è¿˜æ˜¯ç»™æ–¹æ³•æ·»åŠ <code>@HystrixCommand</code>æ³¨è§£</p><p>hystrix ç†”æ–­çš„åŠŸèƒ½æ€»ç»“ä¸‹æ¥å°±æ˜¯: </p><ol><li>hystrixæ ‡è®°æ–¹æ³•</li><li>æ–¹æ³•é”™è¯¯æ—¶è°ƒç”¨ fallbackæ–¹æ³•, ç»Ÿè®¡æ–¹æ³•é”™è¯¯æ¬¡æ•°</li><li>æ¬¡æ•°ç»Ÿè®¡è§¦å‘é˜ˆå€¼å, ç›´æ¥ç†”æ–­ï¼ˆç†”æ–­å™¨åœ¨å…¨å¼€çŠ¶æ€ï¼šçº¿è·¯æ–­å¼€ï¼‰</li><li>ä¸‹æ¬¡è°ƒç”¨ä¸ä¼šå†å»è®¿é—®è¯¥æœåŠ¡, è€Œæ˜¯ç›´æ¥è°ƒç”¨ fallback</li><li>ç†”æ–­åæœåŠ¡ä¸å¯ç”¨, æ˜¯å› ä¸ºå®¢æˆ·ç«¯ç›´æ¥è·³è¿‡äº†è°ƒç”¨æ­£å¸¸æ–¹æ³•çš„è¿‡ç¨‹, ç›´æ¥æ‰§è¡Œ fallback æ–¹æ³•</li><li>ç†”æ–­åä¸æ˜¯ä¸€ç›´éƒ½ä¸å»ä½¿ç”¨ç†”æ–­çš„æœåŠ¡, hystrixä¼šæ‰¾æœºä¼šå»è¯•è¯•æ˜¯å¦èƒ½å¤Ÿå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼ˆç†”æ–­å™¨åœ¨åŠå¼€çŠ¶æ€ï¼šçº¿è·¯æ¥é€šï¼‰, ä»¥åˆ¤æ–­æœåŠ¡æ˜¯å¦æ¢å¤ï¼ˆç†”æ–­å™¨åœ¨å…³é—­çŠ¶æ€ ï¼šçº¿è·¯å…¨éƒ¨æ¥é€šï¼‰</li></ol><p>ç†”æ–­å™¨çš„çŠ¶æ€ï¼š</p><ul><li>ç†”æ–­æ‰“å¼€</li></ul><p>è¯·æ±‚ä¸å†è¿›è¡Œè°ƒç”¨å½“å‰æœåŠ¡ï¼Œå†…éƒ¨è®¾ç½®æ—¶é’Ÿä¸€èˆ¬ä¸ºMTTRï¼ˆå¹³å‡æ•…éšœå¤„ç†æ—¶é—´)ï¼Œå½“æ‰“å¼€æ—¶é•¿è¾¾åˆ°æ‰€è®¾æ—¶é’Ÿåˆ™è¿›å…¥åŠç†”æ–­çŠ¶æ€</p><ul><li>ç†”æ–­å…³é—­</li></ul><p>ç†”æ–­å…³é—­ä¸ä¼šå¯¹æœåŠ¡è¿›è¡Œç†”æ–­</p><ul><li>ç†”æ–­åŠå¼€</li></ul><p>éƒ¨åˆ†è¯·æ±‚æ ¹æ®è§„åˆ™è°ƒç”¨å½“å‰æœåŠ¡ï¼Œå¦‚æœè¯·æ±‚æˆåŠŸä¸”ç¬¦åˆè§„åˆ™åˆ™è®¤ä¸ºå½“å‰æœåŠ¡æ¢å¤æ­£å¸¸ï¼Œå…³é—­ç†”æ–­</p><p>å¯ä»¥é…åˆå¤§ä½¬çš„åšå®¢çœ‹</p><p><a href="https://martinfowler.com/bliki/CircuitBreaker.html">å¯ä»¥çœ‹ä¸‹Martin Fowlerå¤§ä½¬çš„æ–‡ç« CircuitBreaker</a></p><blockquote><p>Itâ€™s common for software systems to make remote calls to software running in different processes, probably on different machines across a network. One of the big differences between in-memory calls and remote calls is that remote calls can fail, or hang without a response until some timeout limit is reached. Whatâ€™s worse if you have many callers on a unresponsive supplier, then you can run out of critical resources leading to cascading failures across multiple systems.</p></blockquote><p>è½¯ä»¶ç³»ç»Ÿå¯¹è¿è¡Œåœ¨ä¸åŒè¿›ç¨‹çš„è½¯ä»¶è¿›è¡Œè¿œç¨‹è°ƒç”¨æ˜¯å¾ˆå¸¸è§çš„, è¿™äº›è½¯ä»¶å¯èƒ½è¿è¡Œåœ¨ç½‘ç»œä¸Šçš„ä¸åŒæœºå­ä¸Š. å†…å­˜è°ƒç”¨å’Œè¿œç¨‹è°ƒç”¨çš„ä¸åŒç‚¹ä¹‹ä¸€æ˜¯è¿œç¨‹è°ƒç”¨å¯èƒ½ä¼šå¤±è´¥æˆ–è€…æŒ‚èµ·è€Œæ²¡æœ‰å“åº”ç›´è‡³è¶…è¿‡è§„å®šæ—¶é—´çš„é™åˆ¶. æ›´ç³Ÿç³•çš„æ˜¯å¦‚æœä½ æœ‰å¾ˆå¤šæ— å“åº”çš„callers, åˆ™ä½ å¯èƒ½è€—å°½é‡è¦èµ„æºä», è€Œå¯¼è‡´å¤šä¸ªç³»ç»Ÿçš„çº§è”é”™è¯¯. </p><blockquote><p>The basic idea behind the circuit breaker is very simple. You wrap a protected function call in a circuit breaker object, which monitors for failures. Once the failures reach a certain threshold, the circuit breaker trips, and all further calls to the circuit breaker return with an error, without the protected call being made at all. Usually youâ€™ll also want some kind of monitor alert if the circuit breaker trips.</p></blockquote><p>æ–­è·¯å™¨èƒŒåçš„æ€æƒ³éå¸¸ç®€å•. ä½ åŒ…è£…äº†ä¸ªå—ä¿æŠ¤çš„å‡½æ•°è°ƒç”¨åœ¨æ–­è·¯å™¨å¯¹è±¡ä¸­, è¯¥å¯¹è±¡ç›‘å¬æ•…éšœ. ä¸€æ—¦é”™è¯¯è¾¾åˆ°æŸä¸ªé˜ˆå€¼, æ–­è·¯å™¨ä¼šè·³é—¸ï¼Œå¹¶ä¸”å¯¹æ–­è·¯å™¨çš„æ‰€æœ‰è¿›ä¸€æ­¥è°ƒç”¨éƒ½ä¼šè¿”å›é”™è¯¯ï¼Œè€Œæ ¹æœ¬ä¸ä¼šè¿›è¡Œå—ä¿æŠ¤çš„è°ƒç”¨ã€‚é€šå¸¸ï¼Œå¦‚æœæ–­è·¯å™¨è·³é—¸ï¼Œæ‚¨è¿˜éœ€è¦æŸç§ç›‘è§†å™¨è­¦æŠ¥ã€‚</p><blockquote><p>è¿™æ˜¯å¤§ä½¬å¯¹æ–­è·¯å™¨çš„æè¿°å’Œä½¿ç”¨</p></blockquote><h3 id="æ¡ˆä¾‹ä»£ç "><a href="#æ¡ˆä¾‹ä»£ç " class="headerlink" title="æ¡ˆä¾‹ä»£ç "></a>æ¡ˆä¾‹ä»£ç </h3><p>ç°åœ¨æˆ‘ä»¬æ ¹æ®ä¸Šé¢çš„æ€»ç»“ç¼–å†™ä»£ç </p><p>åœ¨æœåŠ¡ç«¯æ·»åŠ ä»£ç :</p><p>åœ¨<code>PaymentService</code>æ·»åŠ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">circuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;, value = &quot;true&quot;),// æ˜¯å¦å¼€å¯æ–­è·¯å™¨</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;, value = &quot;10&quot;),// æ–­è·¯åé‡æ–°å¼€å¯æœåŠ¡çš„è¯·æ±‚æ¬¡æ•°</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliseconds&quot;, value = &quot;10000&quot;),// æ—¶é—´çª—å£æœŸ</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;, value = &quot;30&quot;),// å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åè·³é—¸</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">circuitBreaker</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (id &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;******id ä¸èƒ½è´Ÿæ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">serialNumber</span> <span class="operator">=</span> IdUtil.simpleUUID();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;è°ƒç”¨æˆåŠŸï¼Œæµæ°´å·: &quot;</span> + serialNumber;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker_fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;id ä¸èƒ½è´Ÿæ•°ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~   id: &quot;</span> + id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>hystrix é…ç½®è¯´æ˜<br><br /><br><strong>circuitBreaker.enabled</strong><br>è®¾ç½®æ–­è·¯å™¨æ˜¯å¦èµ·ä½œç”¨ã€‚<br>é»˜è®¤å€¼ï¼štrue</p><p><strong>circuitBreaker.requestVolumeThreshold</strong><br>è®¾ç½®åœ¨ä¸€ä¸ªæ»šåŠ¨çª—å£ä¸­ï¼Œæ‰“å¼€æ–­è·¯å™¨çš„æœ€å°‘è¯·æ±‚æ•°ã€‚<br>æ¯”å¦‚ï¼šæ–­è·¯å™¨é‡æ–°æ•°é‡å¼€å¯æ¡ä»¶ã€‚å¦‚æœå€¼æ˜¯20ï¼Œåœ¨ä¸€ä¸ªçª—å£å†…ï¼ˆæ¯”å¦‚10ç§’ï¼‰ï¼Œæ”¶åˆ°19ä¸ªè¯·æ±‚ï¼Œå³ä½¿è¿™19ä¸ªè¯·æ±‚éƒ½å¤±è´¥äº†ï¼Œæ–­è·¯å™¨ä¹Ÿä¸ä¼šæ‰“å¼€ã€‚<br>é»˜è®¤å€¼ï¼š20</p><p><strong>circuitBreaker.sleepWindowInMilliseconds</strong><br>è®¾ç½®åœ¨å›è·¯è¢«æ‰“å¼€ï¼Œæ‹’ç»è¯·æ±‚åˆ°å†æ¬¡å°è¯•è¯·æ±‚å¹¶å†³å®šå›è·¯æ˜¯å¦ç»§ç»­æ‰“å¼€çš„æ—¶é—´ã€‚<br>çª—å£æ—¶é—´ã€‚ä¸€æ¬¡ç»Ÿè®¡çš„æ—¶é—´å•ä½<br>é»˜è®¤å€¼ï¼š5000ï¼ˆæ¯«ç§’ï¼‰</p><p><strong>circuitBreaker.errorThresholdPercentage</strong><br>è®¾ç½®æ‰“å¼€å›è·¯å¹¶å¯åŠ¨å›é€€é€»è¾‘çš„é”™è¯¯æ¯”ç‡ã€‚<br>åœ¨ç™¾åˆ†æ¯”ä¸º50%çš„æ¡ä»¶ä¸‹ï¼Œä¸€æ¬¡æ—¶é—´çª—å£å†…ï¼Œ å‘ç”Ÿäº†30æ¬¡è¯·æ±‚ï¼Œ æœ‰15æ¬¡å¤±è´¥ï¼Œåˆ™è§¦å‘<br>é»˜è®¤å€¼ï¼š50%</p><p><a href="https://www.jianshu.com/p/39763a0bd9b8">æ›´å¤šhystrixé…ç½®ç®€å•è¯´æ˜ï¼ˆå®˜æ–¹æ–‡æ¡£ç®€è¯‘ï¼‰</a></p></blockquote><p><code>PaymentController</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/circuit/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.circuitBreaker(id);</span><br><span class="line">    log.info(<span class="string">&quot;****result: &quot;</span> + result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€ä½ å°±å¯ä»¥è¿™ä¹ˆç©:<br /><a href="http://localhost:8001/payment/circuit/1">http://localhost:8001/payment/circuit/1</a><br /><a href="http://localhost:8001/payment/circuit/-31">http://localhost:8001/payment/circuit/-1</a></p><p>é¦–å…ˆæ•…æ„è®¿é—®é”™è¯¯ 30 æ¬¡<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070135359.png" alt="image.png"><br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070135303.png" alt="image.png"></p><p>ç„¶åç«‹å³åœ¨ç½‘é¡µä¸Šè®¿é—®11æ¬¡ï¼š <a href="http://localhost:8001/payment/circuit/1">http://localhost:8001/payment/circuit/1</a>  </p><blockquote><p>è®°ä½æ˜¯ç«‹å³è®¿é—® 11  æ¬¡å“¦ï¼Œ å¦åˆ™å°±ä¼šæ¢å¤æ­£å¸¸<br>å› ä¸ºè¶…å‡º 10 ç§’ çš„çª—å£æ—¶é—´ï¼Œhystrixå°±ä¼šé‡æ–°å°è¯•æ”¾è¡Œè¯·æ±‚</p></blockquote><p>ä½ ä¼šå‘ç°å‰é¢10æ¬¡éƒ½æ˜¯æŠ¥é”™ <img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070135514.png" alt="image.png"></p><p>è¿™ç§ç°è±¡å®Œå…¨ç¬¦åˆå¤§ä½¬å¯¹ æ–­è·¯å™¨çš„æè¿°ï¼š</p><blockquote><p> Once the failures reach a certain threshold, the circuit breaker trips, and all further calls to the circuit breaker return with an error, without the protected call being made at all. </p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070135651.png" alt="image.png"></p><h3 id="æ–­è·¯å™¨å¼€å¯æˆ–è€…å…³é—­çš„æ¡ä»¶"><a href="#æ–­è·¯å™¨å¼€å¯æˆ–è€…å…³é—­çš„æ¡ä»¶" class="headerlink" title="æ–­è·¯å™¨å¼€å¯æˆ–è€…å…³é—­çš„æ¡ä»¶"></a>æ–­è·¯å™¨å¼€å¯æˆ–è€…å…³é—­çš„æ¡ä»¶</h3><p>å½“æ»¡è¶³ä¸€å®šçš„é˜€å€¼çš„æ—¶å€™ï¼ˆé»˜è®¤10ç§’å†…è¶…è¿‡20ä¸ªè¯·æ±‚æ¬¡æ•°ï¼‰<br />å½“å¤±è´¥ç‡è¾¾åˆ°ä¸€å®šçš„æ—¶å€™ï¼ˆé»˜è®¤10ç§’å†…è¶…è¿‡50%çš„è¯·æ±‚å¤±è´¥ï¼‰<br />åˆ°è¾¾ä»¥ä¸Šé˜€å€¼ï¼Œæ–­è·¯å™¨å°†ä¼šå¼€å¯<br />å½“å¼€å¯çš„æ—¶å€™ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¸ä¼šè¿›è¡Œè½¬å‘<br />ä¸€æ®µæ—¶é—´ä¹‹åï¼ˆé»˜è®¤æ˜¯5ç§’ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æ–­è·¯å™¨æ˜¯åŠå¼€çŠ¶æ€ï¼Œä¼šè®©å…¶ä¸­ä¸€ä¸ªè¯·æ±‚è¿›è¡Œè½¬å‘ï¼›å¦‚æœæˆåŠŸï¼Œæ–­è·¯å™¨ä¼šå…³é—­ï¼›è‹¥å¤±è´¥ï¼Œç»§ç»­å¼€å¯ã€‚é‡å¤4å’Œ5<br /><a href="https://blog.csdn.net/Mark42/article/details/123738225"><br /></a></p><h3 id="æ–­è·¯å™¨æ‰“å¼€ä¹‹å"><a href="#æ–­è·¯å™¨æ‰“å¼€ä¹‹å" class="headerlink" title="æ–­è·¯å™¨æ‰“å¼€ä¹‹å"></a>æ–­è·¯å™¨æ‰“å¼€ä¹‹å</h3><p>å†æœ‰è¯·æ±‚è°ƒç”¨çš„æ—¶å€™ï¼Œå°†ä¸ä¼šè°ƒç”¨ä¸»é€»è¾‘ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨é™çº§fallbackï¼Œé€šè¿‡æ–­è·¯å™¨ï¼Œå®ç°äº†è‡ªåŠ¨åœ°å‘ç°é”™è¯¯å¹¶å°†é™çº§é€»è¾‘åˆ‡æ¢ä¸ºä¸»é€»è¾‘ï¼Œå‡å°‘å“åº”å»¶è¿Ÿçš„æ•ˆæœ</p><h3 id="åŸæ¥çš„ä¸»é€»è¾‘å¦‚ä½•æ¢å¤"><a href="#åŸæ¥çš„ä¸»é€»è¾‘å¦‚ä½•æ¢å¤" class="headerlink" title="åŸæ¥çš„ä¸»é€»è¾‘å¦‚ä½•æ¢å¤"></a>åŸæ¥çš„ä¸»é€»è¾‘å¦‚ä½•æ¢å¤</h3><p>å¯¹äºè¿™ä¸€é—®é¢˜ï¼Œhystrixä¹Ÿä¸ºæˆ‘ä»¬å®ç°äº†è‡ªåŠ¨æ¢å¤åŠŸèƒ½ã€‚å½“æ–­è·¯å™¨æ‰“å¼€ï¼Œå¯¹ä¸»é€»è¾‘è¿›è¡Œç†”æ–­ä¹‹åï¼Œhystrixä¼šå¯åŠ¨ä¸€ä¸ªä¼‘çœ æ—¶é—´çª—ï¼Œåœ¨è¿™ä¸ªæ—¶é—´çª—å†…ï¼Œé™çº§é€»è¾‘æ˜¯ä¸´æ—¶çš„æˆä¸ºä¸»é€»è¾‘ï¼Œå½“ä¼‘çœ æ—¶é—´çª—åˆ°æœŸï¼Œæ–­è·¯å™¨å°†è¿›å…¥åŠå¼€çŠ¶æ€ï¼Œé‡Šæ”¾ä¸€æ¬¡è¯·æ±‚åˆ°åŸæ¥çš„ä¸»é€»è¾‘ä¸Šï¼Œå¦‚æœæ­¤æ¬¡è¯·æ±‚æ­£å¸¸è¿”å›ï¼Œé‚£ä¹ˆæ–­è·¯å™¨å°†ç»§ç»­é—­åˆï¼Œä¸»é€»è¾‘æ¢å¤ï¼›å¦‚æœè¿™æ¬¡è¯·æ±‚ä¾ç„¶æœ‰é—®é¢˜ï¼Œæ–­è·¯å™¨ç»§ç»­è¿›å…¥æ‰“å¼€çŠ¶æ€ï¼Œä¼‘çœ æ—¶é—´çª—é‡æ–°è®¡æ—¶<br /><a href="https://blog.csdn.net/Mark42/article/details/123738225"><br /></a></p><h3 id="æ‰€æœ‰é…ç½®"><a href="#æ‰€æœ‰é…ç½®" class="headerlink" title="æ‰€æœ‰é…ç½®"></a>æ‰€æœ‰é…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//========================All</span></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;str_fallbackMethod&quot;,</span></span><br><span class="line"><span class="meta">        groupKey = &quot;strGroupCommand&quot;,</span></span><br><span class="line"><span class="meta">        commandKey = &quot;strCommand&quot;,</span></span><br><span class="line"><span class="meta">        threadPoolKey = &quot;strThreadPool&quot;,</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">        commandProperties = &#123;</span></span><br><span class="line"><span class="meta">                // è®¾ç½®éš”ç¦»ç­–ç•¥ï¼ŒTHREAD è¡¨ç¤ºçº¿ç¨‹æ±  SEMAPHOREï¼šä¿¡å·æ± éš”ç¦»</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.strategy&quot;, value = &quot;THREAD&quot;),</span></span><br><span class="line"><span class="meta">                // å½“éš”ç¦»ç­–ç•¥é€‰æ‹©ä¿¡å·æ± éš”ç¦»çš„æ—¶å€™ï¼Œç”¨æ¥è®¾ç½®ä¿¡å·æ± çš„å¤§å°ï¼ˆæœ€å¤§å¹¶å‘æ•°ï¼‰</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.semaphore.maxConcurrentRequests&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // é…ç½®å‘½ä»¤æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.thread.timeoutinMilliseconds&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // æ˜¯å¦å¯ç”¨è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.timeout.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // æ‰§è¡Œè¶…æ—¶çš„æ—¶å€™æ˜¯å¦ä¸­æ–­</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.thread.interruptOnTimeout&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // æ‰§è¡Œè¢«å–æ¶ˆçš„æ—¶å€™æ˜¯å¦ä¸­æ–­</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.thread.interruptOnCancel&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // å…è®¸å›è°ƒæ–¹æ³•æ‰§è¡Œçš„æœ€å¤§å¹¶å‘æ•°</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;fallback.isolation.semaphore.maxConcurrentRequests&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // æœåŠ¡é™çº§æ˜¯å¦å¯ç”¨ï¼Œæ˜¯å¦æ‰§è¡Œå›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;fallback.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // æ˜¯å¦å¯ç”¨æ–­è·¯å™¨</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®åœ¨æ»šåŠ¨æ—¶é—´çª—ä¸­ï¼Œæ–­è·¯å™¨ç†”æ–­çš„æœ€å°è¯·æ±‚æ•°ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤è¯¥å€¼ä¸º 20 çš„æ—¶å€™ï¼Œ</span></span><br><span class="line"><span class="meta">                // å¦‚æœæ»šåŠ¨æ—¶é—´çª—ï¼ˆé»˜è®¤10ç§’ï¼‰å†…ä»…æ”¶åˆ°äº†19ä¸ªè¯·æ±‚ï¼Œ å³ä½¿è¿™19ä¸ªè¯·æ±‚éƒ½å¤±è´¥äº†ï¼Œæ–­è·¯å™¨ä¹Ÿä¸ä¼šæ‰“å¼€ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;, value = &quot;20&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®åœ¨æ»šåŠ¨æ—¶é—´çª—ä¸­ï¼Œè¡¨ç¤ºåœ¨æ»šåŠ¨æ—¶é—´çª—ä¸­ï¼Œåœ¨è¯·æ±‚æ•°é‡è¶…è¿‡</span></span><br><span class="line"><span class="meta">                // circuitBreaker.requestVolumeThreshold çš„æƒ…å†µä¸‹ï¼Œå¦‚æœé”™è¯¯è¯·æ±‚æ•°çš„ç™¾åˆ†æ¯”è¶…è¿‡50,</span></span><br><span class="line"><span class="meta">                // å°±æŠŠæ–­è·¯å™¨è®¾ç½®ä¸º &quot;æ‰“å¼€&quot; çŠ¶æ€ï¼Œå¦åˆ™å°±è®¾ç½®ä¸º &quot;å…³é—­&quot; çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;, value = &quot;50&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®å½“æ–­è·¯å™¨æ‰“å¼€ä¹‹åçš„ä¼‘çœ æ—¶é—´çª—ã€‚ ä¼‘çœ æ—¶é—´çª—ç»“æŸä¹‹åï¼Œ</span></span><br><span class="line"><span class="meta">                // ä¼šå°†æ–­è·¯å™¨ç½®ä¸º &quot;åŠå¼€&quot; çŠ¶æ€ï¼Œå°è¯•ç†”æ–­çš„è¯·æ±‚å‘½ä»¤ï¼Œå¦‚æœä¾ç„¶å¤±è´¥å°±å°†æ–­è·¯å™¨ç»§ç»­è®¾ç½®ä¸º &quot;æ‰“å¼€&quot; çŠ¶æ€ï¼Œ</span></span><br><span class="line"><span class="meta">                // å¦‚æœæˆåŠŸå°±è®¾ç½®ä¸º &quot;å…³é—­&quot; çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.sleepWindowinMilliseconds&quot;, value = &quot;5000&quot;),</span></span><br><span class="line"><span class="meta">                // æ–­è·¯å™¨å¼ºåˆ¶æ‰“å¼€</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.forceOpen&quot;, value = &quot;false&quot;),</span></span><br><span class="line"><span class="meta">                // æ–­è·¯å™¨å¼ºåˆ¶å…³é—­</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.forceClosed&quot;, value = &quot;false&quot;),</span></span><br><span class="line"><span class="meta">                // æ»šåŠ¨æ—¶é—´çª—è®¾ç½®ï¼Œè¯¥æ—¶é—´ç”¨äºæ–­è·¯å™¨åˆ¤æ–­å¥åº·åº¦æ—¶éœ€è¦æ”¶é›†ä¿¡æ¯çš„æŒç»­æ—¶é—´</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingStats.timeinMilliseconds&quot;, value = &quot;10000&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®æ»šåŠ¨æ—¶é—´çª—ç»Ÿè®¡æŒ‡æ ‡ä¿¡æ¯æ—¶åˆ’åˆ†&quot;æ¡¶&quot;çš„æ•°é‡ï¼Œæ–­è·¯å™¨åœ¨æ”¶é›†æŒ‡æ ‡ä¿¡æ¯çš„æ—¶å€™ä¼šæ ¹æ®</span></span><br><span class="line"><span class="meta">                // è®¾ç½®çš„æ—¶é—´çª—é•¿åº¦æ‹†åˆ†æˆå¤šä¸ª &quot;æ¡¶&quot; æ¥ç´¯è®¡å„åº¦é‡å€¼ï¼Œæ¯ä¸ª&quot;æ¡¶&quot;è®°å½•äº†ä¸€æ®µæ—¶é—´å†…çš„é‡‡é›†æŒ‡æ ‡ã€‚</span></span><br><span class="line"><span class="meta">                // æ¯”å¦‚ 10 ç§’å†…æ‹†åˆ†æˆ 10 ä¸ª&quot;æ¡¶&quot;æ”¶é›†è¿™æ ·ï¼Œæ‰€ä»¥ timeinMilliseconds å¿…é¡»èƒ½è¢« numBuckets æ•´é™¤ã€‚å¦åˆ™ä¼šæŠ›å¼‚å¸¸</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingStats.numBuckets&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®å¯¹å‘½ä»¤æ‰§è¡Œçš„å»¶è¿Ÿæ˜¯å¦ä½¿ç”¨ç™¾åˆ†ä½æ•°æ¥è·Ÿè¸ªå’Œè®¡ç®—ã€‚å¦‚æœè®¾ç½®ä¸º false, é‚£ä¹ˆæ‰€æœ‰çš„æ¦‚è¦ç»Ÿè®¡éƒ½å°†è¿”å› -1ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingPercentile.enabled&quot;, value = &quot;false&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®ç™¾åˆ†ä½ç»Ÿè®¡çš„æ»šåŠ¨çª—å£çš„æŒç»­æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingPercentile.timeInMilliseconds&quot;, value = &quot;60000&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®ç™¾åˆ†ä½ç»Ÿè®¡æ»šåŠ¨çª—å£ä¸­ä½¿ç”¨ â€œ æ¡¶ â€çš„æ•°é‡ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingPercentile.numBuckets&quot;, value = &quot;60000&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯ä¸ª â€œæ¡¶â€ ä¸­ä¿ç•™çš„æœ€å¤§æ‰§è¡Œæ¬¡æ•°ã€‚å¦‚æœåœ¨æ»šåŠ¨æ—¶é—´çª—å†…å‘ç”Ÿè¶…è¿‡è¯¥è®¾å®šå€¼çš„æ‰§è¡Œæ¬¡æ•°ï¼Œ</span></span><br><span class="line"><span class="meta">                // å°±ä»æœ€åˆçš„ä½ç½®å¼€å§‹é‡å†™ã€‚ä¾‹å¦‚ï¼Œå°†è¯¥å€¼è®¾ç½®ä¸º100, æ»šåŠ¨çª—å£ä¸º10ç§’ï¼Œè‹¥åœ¨10ç§’å†…ä¸€ä¸ª â€œæ¡¶ â€ä¸­å‘ç”Ÿäº†500æ¬¡æ‰§è¡Œï¼Œ</span></span><br><span class="line"><span class="meta">                // é‚£ä¹ˆè¯¥ â€œæ¡¶â€ ä¸­åªä¿ç•™ æœ€åçš„100æ¬¡æ‰§è¡Œçš„ç»Ÿè®¡ã€‚å¦å¤–ï¼Œå¢åŠ è¯¥å€¼çš„å¤§å°å°†ä¼šå¢åŠ å†…å­˜é‡çš„æ¶ˆè€—ï¼Œå¹¶å¢åŠ æ’åºç™¾åˆ†ä½æ•°æ‰€éœ€çš„è®¡ç®—æ—¶é—´ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingPercentile.bucketSize&quot;, value = &quot;100&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®é‡‡é›†å½±å“æ–­è·¯å™¨çŠ¶æ€çš„å¥åº·å¿«ç…§ï¼ˆè¯·æ±‚çš„æˆåŠŸã€ é”™è¯¯ç™¾åˆ†æ¯”ï¼‰çš„é—´éš”ç­‰å¾…æ—¶é—´ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.healthSnapshot.intervalinMilliseconds&quot;, value = &quot;500&quot;),</span></span><br><span class="line"><span class="meta">                // æ˜¯å¦å¼€å¯è¯·æ±‚ç¼“å­˜</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;requestCache.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // HystrixCommandçš„æ‰§è¡Œå’Œäº‹ä»¶æ˜¯å¦æ‰“å°æ—¥å¿—åˆ° HystrixRequestLog ä¸­</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;requestLog.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">        &#125;,</span></span><br><span class="line"><span class="meta">        threadPoolProperties = &#123;</span></span><br><span class="line"><span class="meta">                // è¯¥å‚æ•°ç”¨æ¥è®¾ç½®æ‰§è¡Œå‘½ä»¤çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œè¯¥å€¼ä¹Ÿå°±æ˜¯å‘½ä»¤æ‰§è¡Œçš„æœ€å¤§å¹¶å‘é‡</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;coreSize&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å‚æ•°ç”¨æ¥è®¾ç½®çº¿ç¨‹æ± çš„æœ€å¤§é˜Ÿåˆ—å¤§å°ã€‚å½“è®¾ç½®ä¸º -1 æ—¶ï¼Œçº¿ç¨‹æ± å°†ä½¿ç”¨ SynchronousQueue å®ç°çš„é˜Ÿåˆ—ï¼Œ</span></span><br><span class="line"><span class="meta">                // å¦åˆ™å°†ä½¿ç”¨ LinkedBlockingQueue å®ç°çš„é˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;maxQueueSize&quot;, value = &quot;-1&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å‚æ•°ç”¨æ¥ä¸ºé˜Ÿåˆ—è®¾ç½®æ‹’ç»é˜ˆå€¼ã€‚ é€šè¿‡è¯¥å‚æ•°ï¼Œ å³ä½¿é˜Ÿåˆ—æ²¡æœ‰è¾¾åˆ°æœ€å¤§å€¼ä¹Ÿèƒ½æ‹’ç»è¯·æ±‚ã€‚</span></span><br><span class="line"><span class="meta">                // è¯¥å‚æ•°ä¸»è¦æ˜¯å¯¹ LinkedBlockingQueue é˜Ÿåˆ—çš„è¡¥å……,å› ä¸º LinkedBlockingQueue</span></span><br><span class="line"><span class="meta">                // é˜Ÿåˆ—ä¸èƒ½åŠ¨æ€ä¿®æ”¹å®ƒçš„å¯¹è±¡å¤§å°ï¼Œè€Œé€šè¿‡è¯¥å±æ€§å°±å¯ä»¥è°ƒæ•´æ‹’ç»è¯·æ±‚çš„é˜Ÿåˆ—å¤§å°äº†ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;queueSizeRejectionThreshold&quot;, value = &quot;5&quot;),</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">strConsumer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello 2020&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">str_fallbackMethod</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;*****fall back str_fallbackMethod&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="hystrixå·¥ä½œæµç¨‹"><a href="#hystrixå·¥ä½œæµç¨‹" class="headerlink" title="hystrixå·¥ä½œæµç¨‹"></a>hystrixå·¥ä½œæµç¨‹</h2><p>Hystrixå·¥ä½œæµç¨‹ï¼š<a href="https://github.com/Netflix/Hystrix/wiki/How-it-Works">https://github.com/Netflix/Hystrix/wiki/How-it-Works</a></p><p>å®˜ç½‘å›¾ä¾‹ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070135661.png" alt="image.png"></p><p>æ­¥éª¤è¯´æ˜ï¼š</p><ul><li>åˆ›å»º HystrixCommandï¼ˆç”¨åœ¨ä¾èµ–çš„æœåŠ¡è¿”å›å•ä¸ªæ“ä½œç»“æœçš„æ—¶å€™ï¼‰ æˆ– HystrixObserableCommandï¼ˆç”¨åœ¨ä¾èµ–çš„æœåŠ¡è¿”å›å¤šä¸ªæ“ä½œç»“æœçš„æ—¶å€™ï¼‰ å¯¹è±¡</li><li>å‘½ä»¤æ‰§è¡Œã€‚å…¶ä¸­ HystrixComand å®ç°äº†ä¸‹é¢å‰ä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼›è€Œ HystrixObservableCommand å®ç°äº†åä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼šexecute()ï¼šåŒæ­¥æ‰§è¡Œï¼Œä»ä¾èµ–çš„æœåŠ¡è¿”å›ä¸€ä¸ªå•ä¸€çš„ç»“æœå¯¹è±¡ï¼Œ æˆ–æ˜¯åœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ã€‚queue()ï¼šå¼‚æ­¥æ‰§è¡Œï¼Œ ç›´æ¥è¿”å› ä¸€ä¸ªFutureå¯¹è±¡ï¼Œ å…¶ä¸­åŒ…å«äº†æœåŠ¡æ‰§è¡Œç»“æŸæ—¶è¦è¿”å›çš„å•ä¸€ç»“æœå¯¹è±¡ã€‚observe()ï¼šè¿”å› Observable å¯¹è±¡ï¼Œå®ƒä»£è¡¨äº†æ“ä½œçš„å¤šä¸ªç»“æœï¼Œå®ƒæ˜¯ä¸€ä¸ª Hot Obserableï¼ˆä¸è®º â€œäº‹ä»¶æºâ€ æ˜¯å¦æœ‰ â€œè®¢é˜…è€…â€ï¼Œéƒ½ä¼šåœ¨åˆ›å»ºåå¯¹äº‹ä»¶è¿›è¡Œå‘å¸ƒï¼Œæ‰€ä»¥å¯¹äº Hot Observable çš„æ¯ä¸€ä¸ª â€œè®¢é˜…è€…â€ éƒ½æœ‰å¯èƒ½æ˜¯ä» â€œäº‹ä»¶æºâ€ çš„ä¸­é€”å¼€å§‹çš„ï¼Œå¹¶å¯èƒ½åªæ˜¯çœ‹åˆ°äº†æ•´ä¸ªæ“ä½œçš„å±€éƒ¨è¿‡ç¨‹ï¼‰ã€‚toObservable()ï¼š åŒæ ·ä¼šè¿”å› Observable å¯¹è±¡ï¼Œä¹Ÿä»£è¡¨äº†æ“ä½œçš„å¤šä¸ªç»“æœï¼Œä½†å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªCold Observableï¼ˆæ²¡æœ‰ â€œè®¢é˜…è€…â€ çš„æ—¶å€™å¹¶ä¸ä¼šå‘å¸ƒäº‹ä»¶ï¼Œè€Œæ˜¯è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°æœ‰ â€œè®¢é˜…è€…â€ ä¹‹åæ‰å‘å¸ƒäº‹ä»¶ï¼Œæ‰€ä»¥å¯¹äº Cold Observable çš„è®¢é˜…è€…ï¼Œå®ƒå¯ä»¥ä¿è¯ä»ä¸€å¼€å§‹çœ‹åˆ°æ•´ä¸ªæ“ä½œçš„å…¨éƒ¨è¿‡ç¨‹ï¼‰</li><li>è‹¥å½“å‰å‘½ä»¤çš„è¯·æ±‚ç¼“å­˜åŠŸèƒ½æ˜¯è¢«å¯ç”¨çš„ï¼Œ å¹¶ä¸”è¯¥å‘½ä»¤ç¼“å­˜å‘½ä¸­ï¼Œ é‚£ä¹ˆç¼“å­˜çš„ç»“æœä¼šç«‹å³ä»¥ Observable å¯¹è±¡çš„å½¢å¼è¿”å›</li><li>æ£€æŸ¥æ–­è·¯å™¨æ˜¯å¦ä¸ºæ‰“å¼€çŠ¶æ€ã€‚å¦‚æœæ–­è·¯å™¨æ˜¯æ‰“å¼€çš„ï¼Œé‚£ä¹ˆHystrixä¸ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œè€Œæ˜¯è½¬æ¥åˆ° fallback å¤„ç†é€»è¾‘ï¼ˆç¬¬ 8 æ­¥ï¼‰ï¼›å¦‚æœæ–­è·¯å™¨æ˜¯å…³é—­çš„ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨èµ„æºæ¥æ‰§è¡Œå‘½ä»¤ï¼ˆç¬¬ 5 æ­¥ï¼‰</li><li>çº¿ç¨‹æ± &#x2F;è¯·æ±‚é˜Ÿåˆ—&#x2F;ä¿¡å·é‡æ˜¯å¦å æ»¡ã€‚å¦‚æœå‘½ä»¤ä¾èµ–æœåŠ¡çš„ä¸“æœ‰çº¿ç¨‹æ± å’Œè¯·æ±‚é˜Ÿåˆ—ï¼Œæˆ–è€…ä¿¡å·é‡ï¼ˆä¸ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™ï¼‰å·²ç»è¢«å æ»¡ï¼Œ é‚£ä¹ˆ Hystrix ä¹Ÿä¸ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œ è€Œæ˜¯è½¬æ¥åˆ° fallback å¤„ç†é€»è¾‘ï¼ˆç¬¬8æ­¥ï¼‰</li><li>Hystrix ä¼šæ ¹æ®æˆ‘ä»¬ç¼–å†™çš„æ–¹æ³•æ¥å†³å®šé‡‡å–ä»€ä¹ˆæ ·çš„æ–¹å¼å»è¯·æ±‚ä¾èµ–æœåŠ¡ã€‚HystrixCommand.run() ï¼šè¿”å›ä¸€ä¸ªå•ä¸€çš„ç»“æœï¼Œæˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚HystrixObservableCommand.construct()ï¼š è¿”å›ä¸€ä¸ªObservable å¯¹è±¡æ¥å‘å°„å¤šä¸ªç»“æœï¼Œæˆ–é€šè¿‡ onError å‘é€é”™è¯¯é€šçŸ¥</li><li>Hystrixä¼šå°† â€œæˆåŠŸâ€ã€â€œå¤±è´¥â€ã€â€œæ‹’ç»â€ã€â€œè¶…æ—¶â€ ç­‰ä¿¡æ¯æŠ¥å‘Šç»™æ–­è·¯å™¨ï¼Œ è€Œæ–­è·¯å™¨ä¼šç»´æŠ¤ä¸€ç»„è®¡æ•°å™¨æ¥ç»Ÿè®¡è¿™äº›æ•°æ®ã€‚æ–­è·¯å™¨ä¼šä½¿ç”¨è¿™äº›ç»Ÿè®¡æ•°æ®æ¥å†³å®šæ˜¯å¦è¦å°†æ–­è·¯å™¨æ‰“å¼€ï¼Œæ¥å¯¹æŸä¸ªä¾èµ–æœåŠ¡çš„è¯·æ±‚è¿›è¡Œ â€œç†”æ–­&#x2F;çŸ­è·¯â€</li><li>å½“å‘½ä»¤æ‰§è¡Œå¤±è´¥çš„æ—¶å€™ï¼Œ Hystrix ä¼šè¿›å…¥ fallback å°è¯•å›é€€å¤„ç†ï¼Œ æˆ‘ä»¬é€šå¸¸ä¹Ÿç§°è¯¥æ“ä½œä¸º â€œæœåŠ¡é™çº§â€ã€‚è€Œèƒ½å¤Ÿå¼•èµ·æœåŠ¡é™çº§å¤„ç†çš„æƒ…å†µæœ‰ä¸‹é¢å‡ ç§ï¼šç¬¬4æ­¥ï¼š å½“å‰å‘½ä»¤å¤„äºâ€ç†”æ–­&#x2F;çŸ­è·¯â€çŠ¶æ€ï¼Œæ–­è·¯å™¨æ˜¯æ‰“å¼€çš„æ—¶å€™ã€‚ç¬¬5æ­¥ï¼š å½“å‰å‘½ä»¤çš„çº¿ç¨‹æ± ã€ è¯·æ±‚é˜Ÿåˆ—æˆ– è€…ä¿¡å·é‡è¢«å æ»¡çš„æ—¶å€™ã€‚ç¬¬6æ­¥ï¼šHystrixObservableCommand.construct() æˆ– HystrixCommand.run() æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™</li><li>å½“Hystrixå‘½ä»¤æ‰§è¡ŒæˆåŠŸä¹‹åï¼Œ å®ƒä¼šå°†å¤„ç†ç»“æœç›´æ¥è¿”å›æˆ–æ˜¯ä»¥Observable çš„å½¢å¼è¿”å›</li></ul><p>tipsï¼šå¦‚æœæˆ‘ä»¬æ²¡æœ‰ä¸ºå‘½ä»¤å®ç°é™çº§é€»è¾‘æˆ–è€…åœ¨é™çº§å¤„ç†é€»è¾‘ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œ Hystrix ä¾ç„¶ä¼šè¿”å›ä¸€ä¸ª Observable å¯¹è±¡ï¼Œ ä½†æ˜¯å®ƒä¸ä¼šå‘å°„ä»»ä½•ç»“æœæ•°æ®ï¼Œ è€Œæ˜¯é€šè¿‡ onError æ–¹æ³•é€šçŸ¥å‘½ä»¤ç«‹å³ä¸­æ–­è¯·æ±‚ï¼Œå¹¶é€šè¿‡onError()æ–¹æ³•å°†å¼•èµ·å‘½ä»¤å¤±è´¥çš„å¼‚å¸¸å‘é€ç»™è°ƒç”¨è€…<br /><a href="https://blog.csdn.net/Mark42/article/details/123738225"><br /></a></p><h2 id="æœåŠ¡ç›‘æ§hystrixDashboard"><a href="#æœåŠ¡ç›‘æ§hystrixDashboard" class="headerlink" title="æœåŠ¡ç›‘æ§hystrixDashboard"></a>æœåŠ¡ç›‘æ§hystrixDashboard</h2><h2 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a><br />1ã€æ¦‚è¿°</h2><p><br />é™¤äº†éš”ç¦»ä¾èµ–æœåŠ¡çš„è°ƒç”¨ä»¥å¤–ï¼ŒHystrixè¿˜æä¾›äº†å‡†å®æ—¶çš„è°ƒç”¨ç›‘æ§ï¼ˆHystrix Dashboardï¼‰ï¼ŒHystrixä¼šæŒç»­åœ°è®°å½•æ‰€æœ‰é€šè¿‡Hystrixå‘èµ·çš„è¯·æ±‚çš„æ‰§è¡Œä¿¡æ¯ï¼Œå¹¶ä»¥ç»Ÿè®¡æŠ¥è¡¨å’Œå›¾å½¢çš„å½¢å¼å±•ç¤ºç»™ç”¨æˆ·ï¼ŒåŒ…æ‹¬æ¯ç§’æ‰§è¡Œå¤šå°‘è¯·æ±‚å¤šå°‘æˆåŠŸï¼Œå¤šå°‘å¤±è´¥ç­‰ã€‚Netflixé€šè¿‡hystrix-metrics-event-streamé¡¹ç›®å®ç°äº†å¯¹ä»¥ä¸ŠæŒ‡æ ‡çš„ç›‘æ§ã€‚Spring Cloudä¹Ÿæä¾›äº†Hystrix Dashboardçš„æ•´åˆï¼Œå¯¹ç›‘æ§å†…å®¹è½¬åŒ–æˆå¯è§†åŒ–ç•Œé¢ã€‚</p><h2 id="2ã€ä»ªè¡¨ç›˜9001"><a href="#2ã€ä»ªè¡¨ç›˜9001" class="headerlink" title="2ã€ä»ªè¡¨ç›˜9001"></a>2ã€ä»ªè¡¨ç›˜9001</h2><p><br />æ–°å»º<strong>cloud-consumer-hystrix-dashboard9001</strong></p><p>ï¼ˆ1ï¼‰pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>HystrixDashboardMain9001</code>+æ–°æ³¨è§£<code>@EnableHystrixDashboard</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HystrixDashboardMain9001</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(HystrixDashboardMain9001.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€: <a href="http://localhost:9001/hystrix">http://localhost:9001/hystrix</a></p><p><strong>æ‰€æœ‰Providerå¾®æœåŠ¡æä¾›</strong>ç±»(8001&#x2F;8002&#x2F;8003&#x2F;800x)éƒ½éœ€è¦ç›‘æ§ä¾èµ–é…ç½®<br />3ã€æ–­è·¯å™¨æ¼”ç¤º<br />æœåŠ¡ç›‘æ§<code>hystrixDashboard</code></p><p>ï¼ˆ1ï¼‰ä¿®æ”¹<code>hystrix-payment8001</code><br />æ³¨æ„:æ–°ç‰ˆæœ¬Hystrixéœ€è¦åœ¨ä¸»å¯åŠ¨ç±»<code>PaymentHystrixMain8001</code>ä¸­æŒ‡å®šç›‘æ§è·¯å¾„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// é€šç”¨ç†”æ–­å™¨æ³¨è§£, æœ‰äº†è¿™ä¸ªä¸‹é¢çš„`EnableHystrix`æ³¨è§£å°±ä¸éœ€è¦äº†</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="comment">//@EnableHystrix</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— å…³ï¼Œspringcloudå‡çº§åçš„å‘</span></span><br><span class="line"><span class="comment"> * ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯&quot;/hystrix.stream&quot;ï¼Œ</span></span><br><span class="line"><span class="comment"> * åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé…ç½®ä¸Šä¸‹é¢çš„servletå°±å¯ä»¥äº†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">getServlet</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">HystrixMetricsStreamServlet</span> <span class="variable">streamServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HystrixMetricsStreamServlet</span>();</span><br><span class="line"><span class="type">ServletRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(streamServlet);</span><br><span class="line">registrationBean.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">registrationBean.addUrlMappings(<span class="string">&quot;/hystrix.stream&quot;</span>);</span><br><span class="line">registrationBean.setName(<span class="string">&quot;HystrixMetricsStreamServlet&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç›‘æ§æµ‹è¯•"><a href="#ç›‘æ§æµ‹è¯•" class="headerlink" title="ç›‘æ§æµ‹è¯•"></a><br />ç›‘æ§æµ‹è¯•</h3><p>è§‚å¯Ÿç›‘æ§çª—å£</p><p>9001ç›‘æ§8001ï¼Œå¡«å†™ç›‘æ§åœ°å€ï¼š<a href="http://localhost:8001/hystrix.stream">http://localhost:8001/hystrix.stream</a><br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070135706.png" alt="image.png"></p><p>æµ‹è¯•åœ°å€ï¼š<br /><a href="http://localhost:8001/payment/circuit/1">http://localhost:8001/payment/circuit/1</a><br /><a href="http://localhost:8001/payment/circuit/-1">http://localhost:8001/payment/circuit/-1</a></p><p>ä¸Šè¿°æµ‹è¯•é€šè¿‡<br />å…ˆè®¿é—®æ­£ç¡®åœ°å€ï¼Œå†è®¿é—®é”™è¯¯åœ°å€ï¼Œå†æ­£ç¡®åœ°å€ï¼Œä¼šå‘ç°å›¾ç¤ºæ–­è·¯å™¨éƒ½æ˜¯æ…¢æ…¢æ”¾å¼€çš„<br />ç›‘æ§ç»“æœï¼ŒæˆåŠŸ<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070135446.png" alt="image.png"><br />ç›‘æ§ç»“æœï¼Œå¤±è´¥<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070136109.png" alt="image.png"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070136781.png" alt="image.png"></p><h3 id="å¦‚ä½•çœ‹ï¼Ÿ"><a href="#å¦‚ä½•çœ‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•çœ‹ï¼Ÿ"></a>å¦‚ä½•çœ‹ï¼Ÿ</h3><p><br />7è‰²ã€1åœˆã€1çº¿</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070136224.png" alt="image.png"></p><p>1åœˆï¼š<br />å®å¿ƒåœ†ï¼šå…±æœ‰ä¸¤ç§å«ä¹‰ï¼Œå®ƒé€šè¿‡é¢œè‰²çš„å˜åŒ–ä»£è¡¨äº†å®ä¾‹çš„å¥åº·ç¨‹åº¦ï¼Œå®ƒçš„å¥åº·åº¦ä»ç»¿è‰²&lt;é»„è‰²&lt;æ©™è‰²&lt;çº¢è‰²é€’å‡ã€‚è¯¥å®å¿ƒåœ†é™¤äº†é¢œè‰²çš„å˜åŒ–ä¹‹å¤–ï¼Œå®ƒçš„å¤§å°ä¹Ÿä¼šæ ¹æ®å®ä¾‹çš„è¯·æ±‚æµé‡å‘ç”Ÿå˜åŒ–ï¼Œæµé‡è¶Šå¤§è¯¥å®å¿ƒåœ†å°±è¶Šå¤§ã€‚æ‰€ä»¥é€šè¿‡è¯¥å®å¿ƒåœ†çš„å±•ç¤ºï¼Œå°±å¯ä»¥åœ¨å¤§é‡çš„å®ä¾‹ä¸­å¿«é€Ÿçš„å‘ç°æ•…éšœå®ä¾‹å’Œé«˜å‹åŠ›å®ä¾‹<br />1çº¿ï¼š<br />æ›²çº¿ï¼šç”¨æ¥è®°å½•2åˆ†é’Ÿå†…æµé‡çš„ç›¸å¯¹å˜åŒ–ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥è§‚å¯Ÿåˆ°æµé‡çš„ä¸Šå‡å’Œä¸‹é™è¶‹åŠ¿ã€‚<br />æ•´å›¾è¯´æ˜ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070136452.png" alt="image.png"><br />æ•´å›¾è¯´æ˜2ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070136245.png" alt="image.png"><br />ææ‡‚ä¸€ä¸ªæ‰èƒ½çœ‹æ‡‚å¤æ‚çš„ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070136230.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœåŠ¡é™æµ </tag>
            
            <tag> æœåŠ¡ç†”æ–­ </tag>
            
            <tag> æœåŠ¡éš”ç¦» </tag>
            
            <tag> æœåŠ¡é™çº§ </tag>
            
            <tag> hystrix </tag>
            
            <tag> ä¸æ¨è </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>08é™æµä¸ç†”æ–­ç†è®ºéƒ¨åˆ†â€”â€”sentinel(äºŒ)</title>
      <link href="/2022/11/07/02springcloud/08%E9%99%90%E6%B5%81%E4%B8%8E%E7%86%94%E6%96%AD%E7%90%86%E8%AE%BA%E9%83%A8%E5%88%86%E2%80%94%E2%80%94sentinel(%E4%BA%8C)/"/>
      <url>/2022/11/07/02springcloud/08%E9%99%90%E6%B5%81%E4%B8%8E%E7%86%94%E6%96%AD%E7%90%86%E8%AE%BA%E9%83%A8%E5%88%86%E2%80%94%E2%80%94sentinel(%E4%BA%8C)/</url>
      
        <content type="html"><![CDATA[<h1 id="feignæ•´åˆsentinel"><a href="#feignæ•´åˆsentinel" class="headerlink" title="feignæ•´åˆsentinel"></a>feignæ•´åˆsentinel</h1><p>å¤§ä½“æ­¥éª¤ï¼š</p><ol><li>å¼€å¯feignçš„sentinelåŠŸèƒ½</li><li>ç¡®å®å¤±è´¥åçš„é™çº§è§„åˆ™ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆ<ol><li>FallbackClassï¼Œæ— æ³•å¯¹è¿œç¨‹è°ƒç”¨çš„å¼‚å¸¸åšå¤„ç†</li><li>FallbackFactoryï¼Œå¯ä»¥å¯¹è¿œç¨‹è°ƒç”¨å¼‚å¸¸è¿›è¡Œå¤„ç†</li></ol></li></ol><p>é¦–å…ˆå®ç°<code>FallbackFactory</code></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœåŠ¡é™æµ </tag>
            
            <tag> æœåŠ¡ç†”æ–­ </tag>
            
            <tag> sentinel </tag>
            
            <tag> æœåŠ¡éš”ç¦» </tag>
            
            <tag> æœåŠ¡é™çº§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>07é™æµä¸ç†”æ–­ç†è®ºéƒ¨åˆ†â€”â€”sentinel(ä¸€)</title>
      <link href="/2022/11/07/02springcloud/07%E9%99%90%E6%B5%81%E4%B8%8E%E7%86%94%E6%96%AD%E7%90%86%E8%AE%BA%E9%83%A8%E5%88%86%E2%80%94%E2%80%94sentinel(%E4%B8%80)/"/>
      <url>/2022/11/07/02springcloud/07%E9%99%90%E6%B5%81%E4%B8%8E%E7%86%94%E6%96%AD%E7%90%86%E8%AE%BA%E9%83%A8%E5%88%86%E2%80%94%E2%80%94sentinel(%E4%B8%80)/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯ç†”æ–­å™¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç†”æ–­å™¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç†”æ–­å™¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç†”æ–­å™¨ï¼Ÿ</h1><blockquote><p>é™æµåœ¨å‰é¢çš„ç« èŠ‚å·²ç»çŸ¥é“äº†ï¼Œç°åœ¨è°ˆè°ˆç†”æ–­å™¨</p></blockquote><p><strong>ç†”æ–­å™¨èµ·çš„ä½œç”¨å°±æ˜¯åœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹å…³æ‰å½“å‰çš„é€šè·¯ï¼Œä»è€Œèµ·åˆ°ä¿æŠ¤æ•´ä¸ªç³»ç»Ÿçš„æ•ˆæœ</strong></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129007.png" alt="image.png"></p><blockquote><p>è¿™å¼ å›¾éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»¿è‰²è¡¨ç¤ºæ¥é€šç”µè·¯æˆ–è€…æœåŠ¡å¥åº·ï¼Œçº¢è‰²è¡¨ç¤ºç†”æ–­æˆ–è€…æœåŠ¡è´Ÿè½½</p></blockquote><p>ä¸€æ¬¡æœåŠ¡è¯·æ±‚è®¿é—®å¯èƒ½éœ€è¦æ¶‰åŠåˆ° æœåŠ¡A è€Œ æœåŠ¡A åˆéœ€è¦ æœåŠ¡Bï¼ŒCï¼ŒD ä¸‰ä¸ªæœåŠ¡å™¨æä¾›æ”¯æŒï¼ˆ<strong>å¾®æœåŠ¡é“¾è·¯</strong>ï¼‰ï¼Œå¦‚æœ æœåŠ¡D è´Ÿè½½ï¼Œè¯·æ±‚å»¶è¿Ÿè¿‡é«˜å¯¼è‡´è¯¥è¯·æ±‚é˜»å¡ç­‰å¾…æœåŠ¡Dçš„å“åº”<br />åˆè¯·æ±‚çš„çº¿ç¨‹æ˜¯çè´µèµ„æºï¼Œæœ‰é™çš„ï¼Œå¦‚æœä¸å°†æœåŠ¡Dç†”æ–­æ‰ï¼Œå¹¶ç«‹å³åé¦ˆå¤±è´¥ï¼Œçº¿ç¨‹å°†è¢«å…¨éƒ¨å ç”¨ã€‚<br />è¿™ç§æƒ…å†µå›½å†…è¾ƒé›ªå´©æ•ˆåº”ï¼ˆå»ä½ ä¸«çš„é›ªå´©æ•ˆåº”ï¼‰ï¼Œå›½å¤–å« cascading failuresï¼ˆ<strong>çº§è”æ•…éšœ</strong>ï¼‰</p><blockquote><p>åæ§½å›½å†…æŸäº›<strong>ç –å®¶</strong>åˆ«çš„ä¸ä¼šï¼Œ<strong>äº‰KPIæé«˜å¤§ä¸Šçš„åå­—æœ€ç‰›</strong> å›½å†…å¥½åƒæ˜¯2012å¹´ä¼é¹…æŸé«˜å®˜é¦–å…ˆæå‡ºçš„æ–°åå­—<br>æˆ‘å½“åˆå­¦ä¹ çš„æ—¶å€™ï¼Œå°±ä¸€ç›´çº ç»“å¾®æœåŠ¡é“¾è·¯æ•…éšœæ€ä¹ˆå°±è·Ÿé›ªå´©æ•ˆåº”è”ç³»åœ¨ä¸€èµ·äº†ï¼Ÿé›ªå´©æ•ˆåº”ä¸æ˜¯åŠ å¯†ç®—æ³•çš„ä¸€ç§ç†æƒ³å±æ€§ä¹ˆï¼Ÿ</p></blockquote><p>è€Œç†”æ–­å™¨å°±æ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°çº§è”æ•…éšœè€Œå­˜åœ¨çš„ã€‚ã€‚ã€‚</p><h1 id="åŠŸèƒ½å¯¹æ¯”"><a href="#åŠŸèƒ½å¯¹æ¯”" class="headerlink" title="åŠŸèƒ½å¯¹æ¯”"></a>åŠŸèƒ½å¯¹æ¯”</h1><p>å¸‚é¢ä¸Šçš„æ–­è·¯å™¨å°±ä¸‰ç§ï¼š Sentinelã€Hystrixã€resilience4j<br />å…¶ä¸­å‰æ–‡è¯´è¿‡çš„ï¼ŒHystrixå·²ç»è¿›å…¥ç»´æŠ¤ï¼ŒåŸºæœ¬ä¸è€ƒè™‘ä½¿ç”¨äº†<br />è€Œresilience4jå›½å¤–æ¨èçš„æ¯”è¾ƒå¤šï¼Œå›½å†…ä¸»è¦ä½¿ç”¨é˜¿é‡Œçš„Sentinel</p><table><thead><tr><th></th><th>Sentinel</th><th>Hystrix(ç»´æŠ¤çŠ¶æ€)</th><th>Resilience4jï¼ˆSpringæ¨èï¼‰</th></tr></thead><tbody><tr><td>å¼€å‘è€…</td><td>alibaba</td><td>Netflix</td><td>ç‹¬ç«‹</td></tr><tr><td>éš”ç¦»ç­–ç•¥</td><td>ä¿¡å·é‡éš”ç¦»ï¼ˆå¹¶å‘çº¿ç¨‹æ•°é™æµï¼‰</td><td>çº¿ç¨‹æ± éš”ç¦»&#x2F;ä¿¡å·é‡éš”ç¦»</td><td>ä¿¡å·é‡éš”ç¦»</td></tr><tr><td>ç†”æ–­é™çº§ç­–ç•¥</td><td>åŸºäºå“åº”æ—¶é—´ã€å¼‚å¸¸æ¯”ç‡ã€å¼‚å¸¸æ•°åŸºäºå¼‚å¸¸æ¯”ç‡</td><td>åŸºäºå¼‚å¸¸æ¯”ç‡</td><td>åŸºäºå¼‚å¸¸æ¯”ç‡ã€å“åº”æ—¶é—´</td></tr><tr><td>å®æ—¶ç»Ÿè®¡å®ç°</td><td>æ»‘åŠ¨çª—å£ï¼ˆLeapArrayï¼‰</td><td>æ»‘åŠ¨çª—å£ï¼ˆåŸºäº RxJavaï¼‰</td><td>Ring Bit Buffer</td></tr><tr><td>åŠ¨æ€è§„åˆ™é…ç½®</td><td>æ”¯æŒå¤šç§æ•°æ®æº</td><td>æ”¯æŒå¤šç§æ•°æ®æº</td><td>æœ‰é™æ”¯æŒ</td></tr><tr><td>æ‰©å±•æ€§</td><td>å¤šä¸ªæ‰©å±•ç‚¹</td><td>æ’ä»¶çš„å½¢å¼</td><td>æ¥å£çš„å½¢å¼</td></tr><tr><td>åŸºäºæ³¨è§£çš„æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>é™æµ</td><td>åŸºäº QPSï¼Œæ”¯æŒåŸºäºè°ƒç”¨å…³ç³»çš„é™æµ</td><td>æœ‰é™çš„æ”¯æŒ</td><td>Rate Limiter</td></tr><tr><td>æµé‡æ•´å½¢</td><td>æ”¯æŒé¢„çƒ­æ¨¡å¼ã€åŒ€é€Ÿå™¨æ¨¡å¼ã€é¢„çƒ­æ’é˜Ÿæ¨¡å¼</td><td>ä¸æ”¯æŒ</td><td>ç®€å•çš„ Rate Limiter æ¨¡å¼</td></tr><tr><td>ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>æ§åˆ¶å°</td><td>æä¾›å¼€ç®±å³ç”¨çš„æ§åˆ¶å°ï¼Œå¯é…ç½®è§„åˆ™ã€æŸ¥çœ‹ç§’çº§ç›‘æ§ã€æœºå™¨å‘ç°ç­‰</td><td>ç®€å•çš„ç›‘æ§æŸ¥çœ‹</td><td>ä¸æä¾›æ§åˆ¶å°ï¼Œå¯å¯¹æ¥å…¶å®ƒç›‘æ§ç³»ç»Ÿ</td></tr></tbody></table><p>æˆ‘ä»¬ä¸»è¦å­¦ä¹  sentinel<br />ä»ï¼š</p><ol><li>Sentinelæ˜¯ä»€ä¹ˆï¼Ÿ</li><li>Sentinelæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</li><li>æ€ä¹ˆç”¨sentinelï¼Ÿ</li><li>sentinelå¦‚ä½•å®ç°ï¼Ÿï¼ˆåº•å±‚å®ç°ï¼‰</li></ol><h1 id="sentinelé™æµæ¡†æ¶"><a href="#sentinelé™æµæ¡†æ¶" class="headerlink" title="sentinelé™æµæ¡†æ¶"></a>sentinelé™æµæ¡†æ¶</h1><h2 id="sentinelæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#sentinelæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="sentinelæ˜¯ä»€ä¹ˆï¼Ÿ"></a>sentinelæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Sentinel æ˜¯<strong>é¢å‘åˆ†å¸ƒå¼æœåŠ¡æ¶æ„çš„æµé‡æ§åˆ¶ç»„ä»¶</strong>ï¼Œä¸»è¦ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»é™æµã€æµé‡æ•´å½¢ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ã€çƒ­ç‚¹é˜²æŠ¤ç­‰å¤šä¸ªç»´åº¦æ¥å¸®åŠ©å¼€å‘è€…ä¿éšœå¾®æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p><h2 id="Sentinelæœ‰åŠŸèƒ½ï¼Ÿ"><a href="#Sentinelæœ‰åŠŸèƒ½ï¼Ÿ" class="headerlink" title="Sentinelæœ‰åŠŸèƒ½ï¼Ÿ"></a>Sentinelæœ‰åŠŸèƒ½ï¼Ÿ</h2><p>Hystrix ä¸»è¦æ˜¯éš”ç¦»å’Œç†”æ–­ï¼Œä½†æ˜¯ Sentinel ä¾§é‡äº</p><ul><li>å¤šæ ·åŒ–çš„æµé‡æ§åˆ¶</li><li>ç†”æ–­é™çº§</li><li>ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤</li><li>å®æ—¶ç›‘æ§å’Œæ§åˆ¶å°</li></ul><blockquote><p>è®°ä½ï¼Œé™æµå’Œé™çº§éƒ½æ˜¯ä»¥ä¿æŠ¤æ ¸å¿ƒä¸šåŠ¡ä¸ºç›®çš„çš„ç­–ç•¥ï¼Œé™¤æ ¸å¿ƒå¤–çš„ä¸šåŠ¡åœ¨ä¸€å®šé˜ˆå€¼å†…ä¿è¯å¯ç”¨ã€‚</p></blockquote><h3 id="ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶ï¼Ÿ</h3><p>å¯¹éšæœºåˆ°æ¥çš„è¯·æ±‚ï¼Œsentinelæ ¹æ®ç³»ç»Ÿå¤„ç†èƒ½åŠ›å¯¹æµé‡è¿›è¡Œè§„æ•´ã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129677.png" alt="image.png"></p><p>sentinelå°†javaåº”ç”¨çš„ä»»ä½•å†…å®¹è®¤ä¸ºæ˜¯<strong>èµ„æº</strong>ï¼ˆæ¯”å¦‚ï¼šåº”ç”¨ç¨‹åºæä¾›çš„æœåŠ¡ã€åº”ç”¨ç¨‹åºè°ƒç”¨å…¶ä»–åº”ç”¨æä¾›çš„æœåŠ¡ã€ç”šè‡³æ˜¯ä¸€æ®µä»£ç ï¼‰ï¼Œç„¶ååœ¨èµ„æºå¤–è¾¹å›´ç»•ä¸€åœˆ<strong>è§„åˆ™</strong>ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ã€ç†”æ–­é™çº§è§„åˆ™æˆ–ç³»ç»Ÿä¿æŠ¤è§„åˆ™ï¼‰ä»¥ä¿æŠ¤èµ„æºï¼Œå¹¶ä¸”æ‰€æœ‰è§„åˆ™éƒ½å¯ä»¥å®æ—¶åŠ¨æ€è°ƒæ•´ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯sentinelçš„ç†”æ–­é™çº§ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯sentinelçš„ç†”æ–­é™çº§ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯sentinelçš„ç†”æ–­é™çº§ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯sentinelçš„ç†”æ–­é™çº§ï¼Ÿ</h3><p>sentinelçš„ç†”æ–­é™çº§å®ç°æ–¹å¼å’Œ Hystrix çš„å®ç°ä¸åŒã€‚<br />Hystrixé€šè¿‡çº¿ç¨‹éš”ç¦»å®ç°å¯¹èµ„æºçš„éš”ç¦»ï¼Œè¿™æ ·çš„å¥½å¤„åœ¨äºæ¯”è¾ƒå½»åº•ï¼Œç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾çº¿ç¨‹æ± çº¿ç¨‹è¿‡å¤šå¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç¹ï¼Œè¿˜éœ€è¦é¢„å…ˆè®¾å®šçº¿ç¨‹æ± å¤§å°ã€‚<br />Sentinelçš„å®ç°æ–¹å¼å°±æœ‰ä¸¤ç§æ€è·¯ï¼š</p><ol><li>å¯¹æ¯ä¸ªèµ„æºè®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼Œå¦‚æœè¯¥èµ„æºé˜»å¡å¯¼è‡´çº¿ç¨‹æ•°é‡è¶…è¿‡è¯¥é˜ˆå€¼ï¼Œèµ„æºå°±ä¼šæ‹’ç»æ–°çš„è¯·æ±‚ï¼Œç›´åˆ°è¯¥èµ„æºçš„çº¿ç¨‹å®Œæˆä»»åŠ¡ä¹‹åï¼Œæ‰å¯ä»¥é‡æ–°æ¥å—æ–°çš„çº¿ç¨‹ã€‚è¿™ç§æ–¹å¼çš„å¥½å¤„åœ¨äºï¼Œä¸ä¼šæœ‰é¢‘ç¹çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¹Ÿä¸éœ€è¦äº‹å…ˆè®¾å®šå¥½çº¿ç¨‹æ± çš„å¤§å°ï¼Œåªè¦ç´¯è®¡å †ç§¯çº¿ç¨‹çš„æ•°é‡å°±è¡Œã€‚</li><li>å¯¹èµ„æºè¿›è¡Œå®šæ—¶ã€‚Sentinel é€šè¿‡å“åº”æ—¶é—´æ¥å¿«é€Ÿé™çº§ä¸ç¨³å®šçš„èµ„æºã€‚å½“ä¾èµ–çš„èµ„æºå‡ºç°å“åº”æ—¶é—´è¿‡é•¿åï¼Œæ‰€æœ‰å¯¹è¯¥èµ„æºçš„è®¿é—®éƒ½ä¼šè¢«ç›´æ¥æ‹’ç»ï¼Œç›´åˆ°è¿‡äº†æŒ‡å®šçš„æ—¶é—´çª—å£ä¹‹åæ‰é‡æ–°æ¢å¤ã€‚</li></ol><blockquote><p><strong>Hystrixçš„çº¿ç¨‹éš”ç¦»</strong>ï¼šé’ˆå¯¹ä¸åŒçš„èµ„æºåˆ†åˆ«åˆ›å»ºä¸åŒçš„çº¿ç¨‹æ± ï¼Œä¸åŒæœåŠ¡è°ƒç”¨éƒ½å‘ç”Ÿåœ¨ä¸åŒçš„çº¿ç¨‹æ± ä¸­ï¼Œåœ¨çº¿ç¨‹æ± æ’é˜Ÿã€è¶…æ—¶ç­‰é˜»å¡æƒ…å†µæ—¶å¯ä»¥å¿«é€Ÿå¤±è´¥ï¼Œå¹¶å¯ä»¥æä¾› fallback æœºåˆ¶ã€‚çº¿ç¨‹æ± éš”ç¦»çš„å¥½å¤„æ˜¯éš”ç¦»åº¦æ¯”è¾ƒé«˜ï¼Œå¯ä»¥é’ˆå¯¹æŸä¸ªèµ„æºçš„çº¿ç¨‹æ± å»è¿›è¡Œå¤„ç†è€Œä¸å½±å“å…¶å®ƒèµ„æºï¼Œä½†æ˜¯ä»£ä»·å°±æ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ overhead æ¯”è¾ƒå¤§ï¼Œç‰¹åˆ«æ˜¯å¯¹ä½å»¶æ—¶çš„è°ƒç”¨æœ‰æ¯”è¾ƒå¤§çš„å½±å“ã€‚</p></blockquote><h3 id="ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤"><a href="#ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤" class="headerlink" title="ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤"></a>ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤</h3><p>sentinelä¼šä¿æŒå¤–éƒ¨æµé‡å’Œå†…éƒ¨ç³»ç»Ÿå¤„ç†èƒ½åŠ›ä¹‹é—´çš„å¹³è¡¡ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¦‚æœæŸä¸ªèµ„æºå·²ç»è´Ÿè½½ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå°±ä¼šå°†è¯¥æ¬¡è¯·æ±‚è½¬å‘ç»™å…¶ä»–èµ„æºï¼Œä½†å…¶ä»–èµ„æºæ­£å¥½ä¹Ÿåœ¨è¾¹ç¼˜çŠ¶æ€ï¼Œæ­¤æ—¶å°±ä¼šå¯¼è‡´ä¸¤ä¸ªèµ„æºéƒ½ä¼šè´Ÿè½½ï¼Œå¯¼è‡´é›†ç¾¤ä¸å¯ç”¨ã€‚é’ˆå¯¹è¿™ä¸ªæƒ…å†µï¼ŒSentinel æä¾›äº†å¯¹åº”çš„ä¿æŠ¤æœºåˆ¶ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œä¿è¯ç³»ç»Ÿåœ¨èƒ½åŠ›èŒƒå›´ä¹‹å†…å¤„ç†æœ€å¤šçš„è¯·æ±‚ã€‚</p><h1 id="æ€ä¹ˆå®‰è£…sentinelæ§åˆ¶å°ï¼Ÿ"><a href="#æ€ä¹ˆå®‰è£…sentinelæ§åˆ¶å°ï¼Ÿ" class="headerlink" title="æ€ä¹ˆå®‰è£…sentinelæ§åˆ¶å°ï¼Ÿ"></a>æ€ä¹ˆå®‰è£…sentinelæ§åˆ¶å°ï¼Ÿ</h1><h2 id="ä»€ä¹ˆæ˜¯Sentinel-æ§åˆ¶å°ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Sentinel-æ§åˆ¶å°ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Sentinel æ§åˆ¶å°ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Sentinel æ§åˆ¶å°ï¼Ÿ</h2><p>Sentinel æä¾›ä¸€ä¸ªè½»é‡çº§çš„å¼€æºæ§åˆ¶å°ï¼Œå®ƒæä¾›æœºå™¨å‘ç°ä»¥åŠå¥åº·æƒ…å†µç®¡ç†ã€ç›‘æ§ï¼ˆå•æœºå’Œé›†ç¾¤ï¼‰ï¼Œè§„åˆ™ç®¡ç†å’Œæ¨é€çš„åŠŸèƒ½ã€‚</p><p>Sentinel æ§åˆ¶å°åŒ…å«å¦‚ä¸‹åŠŸèƒ½:<br />æŸ¥çœ‹æœºå™¨åˆ—è¡¨ä»¥åŠå¥åº·æƒ…å†µï¼šæ”¶é›† Sentinel å®¢æˆ·ç«¯å‘é€çš„å¿ƒè·³åŒ…ï¼Œç”¨äºåˆ¤æ–­æœºå™¨æ˜¯å¦åœ¨çº¿ã€‚<br />ç›‘æ§ (å•æœºå’Œé›†ç¾¤èšåˆ)ï¼šé€šè¿‡ Sentinel å®¢æˆ·ç«¯æš´éœ²çš„ç›‘æ§ APIï¼Œå®šæœŸæ‹‰å–å¹¶ä¸”èšåˆåº”ç”¨ç›‘æ§ä¿¡æ¯ï¼Œæœ€ç»ˆå¯ä»¥å®ç°ç§’çº§çš„å®æ—¶ç›‘æ§ã€‚<br />è§„åˆ™ç®¡ç†å’Œæ¨é€ï¼šç»Ÿä¸€ç®¡ç†æ¨é€è§„åˆ™ã€‚<br />é‰´æƒï¼šç”Ÿäº§ç¯å¢ƒä¸­é‰´æƒéå¸¸é‡è¦ã€‚è¿™é‡Œæ¯ä¸ªå¼€å‘è€…éœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè¿›è¡Œå®šåˆ¶ã€‚</p><blockquote><p>æ³¨æ„ï¼šSentinel æ§åˆ¶å°ç›®å‰ä»…æ”¯æŒå•æœºéƒ¨ç½²ã€‚Sentinel æ§åˆ¶å°é¡¹ç›®æä¾› Sentinel åŠŸèƒ½å…¨é›†ç¤ºä¾‹ï¼Œä¸ä½œä¸ºå¼€ç®±å³ç”¨çš„ç”Ÿäº§ç¯å¢ƒæ§åˆ¶å°ï¼Œä¸æä¾›å®‰å…¨å¯é ä¿éšœã€‚è‹¥å¸Œæœ›åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨è¯·æ ¹æ®æ–‡æ¡£è‡ªè¡Œè¿›è¡Œå®šåˆ¶å’Œæ”¹é€ ã€‚</p></blockquote><h2 id="å¯åŠ¨æ§åˆ¶å°"><a href="#å¯åŠ¨æ§åˆ¶å°" class="headerlink" title="å¯åŠ¨æ§åˆ¶å°"></a>å¯åŠ¨æ§åˆ¶å°</h2><ol><li>ä¸‹è½½ <code>sentinel</code>jar åŒ… <a href="https://github.com/alibaba/Sentinel/releases">sentinelç¬”è€…ä½¿ç”¨çš„æ˜¯1.8.5ç‰ˆæœ¬</a></li><li>å¯åŠ¨æ§åˆ¶å°<code>java -Dserver.port=8080 -Dcsp.sentinel.dashboard.server=localhost:8080 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard.jar</code></li><li>è®¿é—®<code>[http://localhost:8080/](http://localhost:8080/)</code></li></ol><blockquote><p>å…¶ä¸­ <code>-Dserver.port=8080</code> ç”¨äºæŒ‡å®š Sentinel æ§åˆ¶å°ç«¯å£ä¸º <code>8080</code>ã€‚<br>ä» Sentinel 1.6.0 èµ·ï¼ŒSentinel æ§åˆ¶å°å¼•å…¥åŸºæœ¬çš„ç™»å½•åŠŸèƒ½ï¼Œé»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ <code>sentinel</code>ã€‚<br>ç”¨æˆ·å¯ä»¥é€šè¿‡å¦‚ä¸‹å‚æ•°è¿›è¡Œé…ç½®ï¼š<br><code>-Dsentinel.dashboard.auth.username=sentinel</code> ç”¨äºæŒ‡å®šæ§åˆ¶å°çš„ç™»å½•ç”¨æˆ·åä¸º <code>sentinel</code>ï¼›<br><code>-Dsentinel.dashboard.auth.password=123456</code> ç”¨äºæŒ‡å®šæ§åˆ¶å°çš„ç™»å½•å¯†ç ä¸º <code>123456</code>ï¼›å¦‚æœçœç•¥è¿™ä¸¤ä¸ªå‚æ•°ï¼Œé»˜è®¤ç”¨æˆ·å’Œå¯†ç å‡ä¸º <code>sentinel</code>ï¼›<br><code>-Dserver.servlet.session.timeout=7200 </code>ç”¨äºæŒ‡å®š Spring Boot æœåŠ¡ç«¯ session çš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚ <code>7200 </code>è¡¨ç¤º <code>7200 ç§’</code>ï¼›<code>60m</code> è¡¨ç¤º <code>60 åˆ†é’Ÿ</code>ï¼Œ<strong>é»˜è®¤ä¸º 30 åˆ†é’Ÿ</strong>ï¼›<br>åŒæ ·ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ <code>Spring properties</code> æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚<br>æ³¨æ„ï¼šéƒ¨ç½²å¤šå°æ§åˆ¶å°æ—¶ï¼Œ<code>session </code>é»˜è®¤ä¸ä¼šåœ¨å„å®ä¾‹ä¹‹é—´å…±äº«ï¼Œè¿™ä¸€å—éœ€è¦è‡ªè¡Œæ”¹é€ ã€‚</p></blockquote><h2 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h2><p><code>cloudalibaba-sentinel-service8401</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8401</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.alibaba;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SentinelMainApp8401</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(SentinelMainApp8401.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.alibaba.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowLimitController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testA</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;------testA&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/testB&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testB</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;------testB&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®åï¼Œæˆ‘ä»¬ä¸ä¼šçœ‹åˆ° <code>cloudalibaba-sentinel-service</code>è¿™ä¸ªé¡¹ç›®å‡ºç°åœ¨sentinelæ§åˆ¶å°å·¦ä¾§</p><p>sentinelæ§åˆ¶å°æ˜¯æ‡’åŠ è½½çš„ï¼Œå¦‚æœä¸è®¿é—®ä¸€æ¬¡ï¼Œæ§åˆ¶å°å°±ä¸ä¼šä¸»åŠ¨å»æ•è·ä¿¡æ¯</p><p>éœ€è¦ä¸»åŠ¨ä¸€æ¬¡è®¿é—®ï¼š<a href="http://localhost:8401/testA">http://localhost:8401/testA</a></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129985.png" alt="image.png"></p><h1 id="sentinelæ§åˆ¶å°è¯¦æƒ…"><a href="#sentinelæ§åˆ¶å°è¯¦æƒ…" class="headerlink" title="sentinelæ§åˆ¶å°è¯¦æƒ…"></a>sentinelæ§åˆ¶å°è¯¦æƒ…</h1><h2 id="æµæ§è§„åˆ™"><a href="#æµæ§è§„åˆ™" class="headerlink" title="æµæ§è§„åˆ™"></a>æµæ§è§„åˆ™</h2><p><code>sentinel</code>é»˜è®¤ç›‘æ§çš„æ˜¯<code>SpringMVC</code>çš„<code>Mapping</code>ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ <code>controller</code> å±‚ï¼Œ<code>sentinel</code>å°†è¿™è§†ä¸º<strong>èµ„æº</strong>ã€‚</p><p>ç°‡ç‚¹é“¾è·¯æ˜¾ç¤ºäº†é‚£äº›è¢«sentinelè§†ä¸ºèµ„æºçš„åœ°å€ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129454.png" alt="image.png"></p><blockquote><p>æ³¨æ„: ç°‡ç‚¹é“¾è·¯ç›‘æ§æ˜¯å†…å­˜æ€çš„ä¿¡æ¯ï¼Œå®ƒä»…å±•ç¤ºå¯åŠ¨åè°ƒç”¨è¿‡çš„èµ„æºã€‚æ‰€ä»¥å¦‚æœæ‰“å¼€ <code>sentinel </code>æ§åˆ¶å°åå‘ç°è¿™é‡Œæ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„èµ„æºï¼Œæ¯”å¦‚ï¼š<code>testA</code>ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè®¿é—®ä¸€æ¬¡ï¼Œå°±ä¼šå‡ºç°äº†</p></blockquote><p>æˆ‘ä»¬å¯ä»¥ä¸º testA èµ„æºæ·»åŠ æµæ§ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129115.png" alt="image.png"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129770.png" alt="image.png"></p><p>æ¥ç€æˆ‘ä»¬ä¸‹è½½JMeterå·¥å…·ã€‚è¯¥å·¥å…·ä¸»è¦ç”¨æ¥å‘é€è¯·æ±‚ä½¿ç”¨ã€‚</p><blockquote><p>æ‰“å¼€å·¥å…·åä¼šå‘ç°å…¨æ˜¯è‹±æ–‡ï¼Œå¦‚æœé˜…è¯»æ¯”è¾ƒå›°éš¾å¯ä»¥æ‰“å¼€ã€optionã€‘â€”â€”ã€choose languageã€‘é€‰æ‹©ç®€ä½“ä¸­æ–‡å³å¯</p></blockquote><p>ç°åœ¨å¼€å§‹æ¨¡æ‹Ÿå¤šå®¢æˆ·è®¿é—®ç½‘ç«™</p><ol><li>åˆ›å»ºã€æµ‹è¯•è®¡åˆ’ã€‘ã€‚ç‚¹å‡»ã€æ–‡ä»¶ã€‘â€”â€”ã€æ–°å»ºã€‘ï¼Œè¿˜å¯ä»¥ä¿®æ”¹ä¸‹åç§°ã€sentinelæµ‹è¯•è®¡åˆ’ã€‘â€”â€”<code>ctrl+s</code>ä¿å­˜ï¼Œé€‰æ‹©å­˜å‚¨è·¯å¾„å³å¯ã€‚</li><li>å³é”®ã€sentinelæµ‹è¯•è®¡åˆ’ã€‘â€”â€”ã€æ·»åŠ ã€‘â€”â€”ã€çº¿ç¨‹ã€‘â€”â€”ã€çº¿ç¨‹ç»„ã€‘â€”â€”<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129101.png" alt="image.png"></li><li>åˆ›å»ºhttpè¯·æ±‚<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129181.png" alt="image.png"></li><li>æ·»åŠ è·¯å¾„ï¼š<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129578.png" alt="image.png"></li><li>æ·»åŠ ç»“æœæ ‘ï¼š<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129715.png" alt="image.png"></li><li>ç›´æ¥å¯åŠ¨</li><li>æ‰“å¼€ç»“æœæ ‘ï¼š<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129889.png" alt="image.png"></li></ol><blockquote><p>æˆ‘ä»¬çš„ä¸­çº¿ç¨‹æ•°ä¸ºï¼š20ï¼Œä¸¤ç§’å†…æ‰§è¡Œå®Œï¼Œqpsè®¡ç®—å¯å¾—ï¼š20&#x2F;2&#x3D;10ï¼Œæ˜æ˜¾å¤§äºæˆ‘ä»¬è®¾å®šçš„qps&#x3D;5</p></blockquote><h2 id="æµæ§è§„åˆ™çš„æ¨¡å¼"><a href="#æµæ§è§„åˆ™çš„æ¨¡å¼" class="headerlink" title="æµæ§è§„åˆ™çš„æ¨¡å¼"></a>æµæ§è§„åˆ™çš„æ¨¡å¼</h2><p>æµæ§æ¨¡å¼æœ‰ä¸‰ç§ï¼š</p><ol><li>ç›´æ¥ï¼šç»Ÿè®¡å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶é™æµï¼Œæ¯”å¦‚ä¸Šé¢æˆ‘ä»¬è®¿é—® <code>/testA</code>èµ„æºä¸€æ ·</li><li>å…³è”ï¼šç»Ÿè®¡å…³è”èµ„æº(<code>B</code>)çš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶é™æµ<code>A</code>ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯ç»Ÿè®¡<code>B</code>é™æµ<code>A</code></li><li>é“¾è·¯ï¼šç»Ÿè®¡æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼ï¼Œé™æµæ•´ä¸ªé“¾è·¯</li></ol><h3 id="å…³è”çš„ä½¿ç”¨åœºæ™¯"><a href="#å…³è”çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="å…³è”çš„ä½¿ç”¨åœºæ™¯"></a>å…³è”çš„ä½¿ç”¨åœºæ™¯</h3><p>å®ƒçš„å•å…ƒæ˜¯ æ¥å£ï¼Œè®²çš„æ˜¯ æ¥å£ä¸æ¥å£ä¹‹é—´ çš„å…³è”å…³ç³»</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129171.png" alt="image.png"><br />ç”¨æˆ·æœ‰æ— æ•°ä¸ªè¯·æ±‚è®¿é—® <code>/textA</code> å’Œ <code>/textB</code>ï¼Œä»–ä»¬ä¹‹é—´å…±åŒç«äº‰ <img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070129676.png" alt="image.png"><br />ç°åœ¨æˆ‘ä»¬è¦ä¿è¯ <code>/textB</code>èƒ½å¤Ÿå¾—åˆ°å°½é‡å¤šçš„èµ„æºè¦æ€ä¹ˆåšï¼Ÿ</p><p>éå¸¸ç®€å•ã€‚</p><ol><li>æˆ‘ä»¬å‡è®¾<code>/textB</code>æ›´åŠ é‡è¦ï¼ˆæ ¹æ®å®é™…é¡¹ç›®åˆ¤å®šé‚£ä¸ªèµ„æºæ›´åŠ é‡è¦ï¼‰</li><li>ä¹‹åå†å¯¹ <code>/textA</code>é™æµ</li><li>ç„¶åsentinelå°±ä¼šç»Ÿè®¡ <code>/textB</code>æ˜¯å¦è¶…å‡ºé˜ˆå€¼ï¼Œæ¥é™æµ<code>/textA</code>ï¼Œä»è€Œè®©å‡ºæ›´å¤šçš„<strong>æ•°æ®åº“æŸè¡¨</strong>ç»™<code>textB</code>è®¿é—®</li></ol><blockquote><p>è¶…å‡ºè¡¨ç¤º<code>/textB</code>ç°åœ¨éœ€è¦æ›´å¤šçš„èµ„æºï¼Œæ­¤æ—¶å°±éœ€è¦è®©<code>testA</code>è®©å‡ºæ›´å¤šçš„è¯·æ±‚</p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130541.png" alt="image.png"></p><p><strong>å…³è”çš„ä½¿ç”¨åœºæ™¯ï¼š</strong></p><ol><li><strong>ä¸¤ä¸ªèµ„æºæœ‰ç«äº‰å…³ç³»</strong></li><li><strong>ä¸€ä¸ªä¼˜å…ˆçº§é«˜ï¼Œä¸€ä¸ªä¼˜å…ˆçº§ä½</strong></li><li><strong>éœ€è¦ä¿è¯å…¶ä¸­ ä¸€ä¸ªé‡è¦çš„è¯·æ±‚è·å¾—æ›´å¤šçš„èµ„æº</strong></li></ol><p>æ·»åŠ ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;query&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">query</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;æŸ¥çœ‹è®¢å•æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;update&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;æ›´æ–°è®¢å•æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130379.png" alt="image.png"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130028.png" alt="image.png"></p><blockquote><p>éœ€è¦æ³¨æ„è¿™é‡Œæ˜¯<code>put</code>è¯·æ±‚ä¸æ˜¯<code>get</code></p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130712.png" alt="image.png"></p><p>è®¿é—®ï¼š<a href="http://localhost:8401/query">http://localhost:8401/query</a></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130124.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ° <code>query</code>è¯·æ±‚è¢«é™æµ</p><h3 id="é“¾è·¯çš„ä½¿ç”¨åœºæ™¯"><a href="#é“¾è·¯çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="é“¾è·¯çš„ä½¿ç”¨åœºæ™¯"></a>é“¾è·¯çš„ä½¿ç”¨åœºæ™¯</h3><p>é“¾è·¯çš„å•å…ƒæ˜¯ä¸€æ¡è°ƒç”¨é“¾ï¼Œè®²çš„æ˜¯è°ƒç”¨é“¾ä¹‹é—´çš„å…³ç³»</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130416.png" alt="image.png"></p><p>åœ¨ä¸Šé¢çš„è°ƒç”¨é“¾è·¯ä¸­ï¼Œä½œä¸ºå…¥å£çš„ <code>testA</code>å’Œ<code>testC </code>æœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ°<code>goods</code>èµ„æº</p><p>ç°åœ¨çš„é—®é¢˜æ˜¯å“ªä¸ªè°ƒç”¨é“¾è·¯çš„é‡è¦æ€§è¾ƒé«˜ï¼Œå‡è®¾ <code>testC </code>è°ƒç”¨é“¾è·¯é‡è¦æ€§æ›´åŠ é‡è¦<br />é‚£ä¹ˆå°±éœ€è¦åœ¨ sentinel æ§åˆ¶å°ä¸­æ·»åŠ ä»¥ <code>testA</code>ä½œä¸ºå…¥å£çš„è°ƒç”¨é“¾è·¯<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130316.png" alt="image.png"></p><ol><li><strong>ä¸¤ä¸ªé“¾è·¯ï¼ˆæˆ–è€…å¤šæ¡ï¼‰</strong></li><li><strong>ä¸€ä¸ªé“¾è·¯ä¼˜å…ˆçº§é«˜ï¼Œå¦ä¸€ä¸ªé“¾è·¯ä¼˜å…ˆçº§ä½</strong></li><li><strong>ä¸¤ä¸ªé“¾è·¯æœ‰ç›¸äº¤çš„èµ„æº</strong></li></ol><p>è¿˜æ˜¯æ”¯ä»˜å’ŒæŸ¥è¯¢è®¢å•ï¼Œè¿™ä¸¤ä¸ªä¸šåŠ¡éƒ½éœ€è¦åœ¨åº•å±‚è°ƒç”¨<code>OrderService</code>çš„æŸ¥è¯¢è®¢å•ä¿¡æ¯æ–¹æ³•ã€‚<br />ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ sentinel é»˜è®¤ç›‘æ§ SpringMVC çš„ <code>Mapping</code><br />æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨<code>OrderService</code>æ–¹æ³•ä¸Šé¢æ·»åŠ <code>SentinelResource</code>æ³¨è§£ï¼Œå°†æ–¹æ³•æ ‡è®°ä¸º <strong>èµ„æº</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">queryOrder</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;goods&quot;)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryOrder</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;æŸ¥è¯¢è®¢å•&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;query&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">query</span><span class="params">()</span> &#123;</span><br><span class="line">orderService.queryOrder();</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;æŸ¥çœ‹è®¢å•æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;update&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">orderService.queryOrder();</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;æ›´æ–°è®¢å•æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬è®¿é—®ä¸‹é“¾æ¥</p><p>ä½†æ˜¯æˆ‘ä»¬å‘ç°è¿˜æ˜¯åªæœ‰ä¸€ä¸ªé“¾è·¯ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130339.png" alt="image.png"></p><p>è¿™æ˜¯æœ‰é—®é¢˜çš„ï¼Œå®˜ç½‘ä¹Ÿè¯´äº†ï¼Œ<code>application.yml</code>éœ€è¦æ·»åŠ ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">web-context-unify:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡è¯•è¯•</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130641.png" alt="image.png"><br />è¿™æ ·æˆ‘ä»¬å°±èƒ½çœ‹åˆ°ä¸¤æ£µä¸åŒçš„æ ‘</p><p>æ¥ç€æˆ‘ä»¬ç»™ goods èµ„æºæ·»åŠ æµæ§</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130781.png" alt="image.png"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130670.png" alt="image.png"></p><blockquote><p>æ³¨æ„è¿™é‡Œçš„qpsæ˜¯2</p></blockquote><p>æ·»åŠ jmeter<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130231.png" alt="image.png"> <br /><code>qps=4</code><br />ç„¶åæ·»åŠ ä¸¤ä¸ª http è¯·æ±‚ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130303.png" alt="image.png"></p><p>è®¿é—®ï¼š<a href="http://localhost:8401/query">http://localhost:8401/query</a><br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130130.png" alt="image.png"></p><p>jmeterä¹ŸæŠ¥é”™ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130309.png" alt="image.png"></p><h2 id="æµæ§æ•ˆæœ"><a href="#æµæ§æ•ˆæœ" class="headerlink" title="æµæ§æ•ˆæœ"></a>æµæ§æ•ˆæœ</h2><p>æµæ§æ•ˆæœæ˜¯è¯·æ±‚è¾¾åˆ°æµé‡é˜ˆå€¼æ˜¯æ‰€é‡‡å–çš„ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>å¿«é€Ÿå¤±è´¥ï¼šè¾¾åˆ°é˜ˆå€¼ï¼Œæ–°çš„è¯·æ±‚å°†è¢«æ‹’ç»å¹¶æŠ›å‡ºFlowExceptionå¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰</li><li>é¢„çƒ­æ¨¡å¼ï¼ˆwarm upï¼‰ï¼šå¯¹è¶…å‡ºé˜ˆå€¼çš„è¯·æ±‚ä¹Ÿä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯è¿™ç§é»˜è®¤çš„é˜ˆå€¼æ˜¯åŠ¨æ€çš„ï¼Œä¼šæ…¢æ…¢çš„å°†é˜ˆå€¼è°ƒé«˜ç›´åˆ°æœ€å¤§é˜ˆå€¼ä¸ºæ­¢</li><li>æ’é˜Ÿç­‰å¾…ï¼šè®©æ‰€æœ‰çš„è¯·æ±‚æŒ‰ç…§å…ˆåé¡ºåºæ’åºï¼Œæ¯ä¸ªè¯·æ±‚çš„é—´éš”ä¸èƒ½å°äºæŒ‡å®šæ—¶é—´</li></ul><h3 id="é¢„çƒ­æ¨¡å¼"><a href="#é¢„çƒ­æ¨¡å¼" class="headerlink" title="é¢„çƒ­æ¨¡å¼"></a>é¢„çƒ­æ¨¡å¼</h3><p>é¢„çƒ­æ¨¡å¼ä¸‹ï¼Œéœ€è¦è®¾ç½®<strong>qpsé˜ˆå€¼</strong>å’Œ<strong>é¢„çƒ­æ—¶é•¿</strong><br />è¿™é‡Œæˆ‘ä»¬è®¾ç½® qps &#x3D; 10 é¢„çƒ­æ—¶é•¿ &#x3D; 5<br />è¿™æ · sentinel å°†åœ¨ä¸éœ€è¦é¢„çƒ­æ˜¯ qps ä¿æŒä¸º 10 &#x2F; 3 &#x3D; 3<br />è¿™é‡Œçš„é™¤æ•°æ˜¯ sentinel å†…éƒ¨é»˜è®¤å€¼ 3 <br />é¢„çƒ­è¯·æ±‚è¶…å‡ºqps &#x3D; 3 åˆ™ sentinel ä¼šé€æ­¥é¢„çƒ­ï¼Œç›´åˆ°5ç§’åçš„æœ€å¤§å€¼ï¼Œä¸­é—´ä¼šæ‹’ç»æ‰éƒ¨åˆ†è¯·æ±‚</p><p>è¿™å°±æ˜¯é¢„çƒ­æ¨¡å¼</p><blockquote><p>threshold &#x2F; coldFactor &#x3D; åˆå§‹qps<br>coldFactoré»˜è®¤å€¼ä¸º 3<br>thresholdæ˜¯æœ€å¤§qps</p></blockquote><p>è®¾ç½®jmeterï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070130001.png" alt="image.png"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131980.png" alt="image.png"></p><p>èµ·æ­¥å°±æ˜¯ 3 qps</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131769.png" alt="image.png"><br />å¯ä»¥çœ‹åˆ°æˆåŠŸçš„è¯·æ±‚é€æ¸å˜é«˜</p><h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>é¢„çƒ­æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯ä¸€èˆ¬æ˜¯ç§’æ€æ´»åŠ¨</p><h2 id="çƒ­ç‚¹å‚æ•°é™æµ"><a href="#çƒ­ç‚¹å‚æ•°é™æµ" class="headerlink" title="çƒ­ç‚¹å‚æ•°é™æµ"></a>çƒ­ç‚¹å‚æ•°é™æµ</h2><p>çƒ­ç‚¹ï¼šç»Ÿè®¡è®¿é—®æ•°é‡è¾ƒå¤§çš„èŠ‚ç‚¹<br />å‚æ•°ï¼šé’ˆå¯¹å‚æ•°<br />é™æµï¼šä½¿ç”¨çš„æ“ä½œ</p><p>è¯´ç™½äº†ï¼Œå°±æ˜¯<strong>åˆ†åˆ«ç»Ÿè®¡å‚æ•°å€¼ç›¸åŒçš„è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦è¶…å‡ºQPSé˜ˆå€¼ã€‚</strong></p><p>å¦‚æœä¸æ‡‚ï¼Œè¿˜å¯ä»¥çœ‹ä¸‹ä¸‹é¢è¿™å¼ å›¾ç¤º</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131993.png" alt="image.png"></p><p>sentinelå¯¹çƒ­ç‚¹å‚æ•°é™æµä¸º QPS &#x3D; 5ï¼Œç„¶åæ€»å…±å‘äº† 18 ä¸ªè¯·æ±‚ï¼Œå…¶ä¸­10ä¸ªè¯·æ±‚æ˜¯éçƒ­ç‚¹æ¥å£çš„ï¼Œæ‰€ä»¥å¯ä»¥ä¸çœ‹</p><p>çƒ­ç‚¹è¯·æ±‚æœ‰8ä¸ª<br />å‚æ•° axb çš„è¯·æ±‚åœ¨ä¸€ç§’é’Ÿå‘ç”Ÿäº†5æ¬¡ï¼Œå¤§äºç­‰äºqpsé˜ˆå€¼5ï¼Œæ‰€ä»¥å°†è¢«é˜»å¡<br />å‚æ•° abc çš„è¯·æ±‚åœ¨ä¸€ç§’å†…å‘ç”Ÿäº†3æ¬¡ï¼Œæ²¡æœ‰è¶…å‡ºé˜ˆå€¼ï¼Œè¯·æ±‚é€šè¿‡ã€‚</p><p>è¿˜å¯ä»¥ä½¿ç”¨ sentinelæ§åˆ¶å°å†æ¬¡è¯´æ˜ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131543.png" alt="image.png"><br />å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬è®¾ç½®äº†èµ„æº<code>hot</code><br />å‚æ•°ç´¢å¼•ä¸º 0 è¡¨ç¤º <code>hot</code>æ¥å£çš„ç¬¬ä¸€ä¸ªå‚æ•°<br />å•æœºé˜ˆå€¼ä¸º5ï¼Œç»Ÿè®¡çª—å£æ—¶é•¿ä¸º1ï¼Œè¡¨ç¤º1ç§’å†…<strong>ç›¸åŒå‚æ•°</strong>é¢è¯·æ±‚æ•°ä¸èƒ½è¶…è¿‡5ä¸ª</p><p>æ¯”å¦‚ <code>hot?id=1</code>è¯·æ±‚åœ¨ä¸€ç§’çš„æ—¶é—´å†…å‘èµ·äº†10æ¬¡ï¼Œé‚£ä¹ˆè¯·æ±‚å°±ä¼šè¢«é˜»å¡</p><blockquote><p>æ­¤æ—¶å‰é¢çš„é‚£ä¸€ç§’æ—¶é—´å¯èƒ½è¿˜å‘èµ·äº†åˆ«çš„è¯·æ±‚ï¼Œæ¯”å¦‚<code>hot?id=2</code>å‘èµ·äº†3æ¬¡ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šé˜»å¡ï¼Œè™½ç„¶æ¥å£ç›¸åŒï¼Œä½†å‚æ•°ä¸åŒ<br>çƒ­ç‚¹å‚æ•°é™æµé’ˆå¯¹çš„é¢—ç²’åº¦æ˜¯ æ¥å£+å‚æ•°ï¼Œæ¥å£ç›¸åŒï¼Œå‚æ•°ä¸åŒï¼Œæ„å‘³ç€ä¸åŒçš„è¯·æ±‚ï¼Œä¸ä¼šè¢« çƒ­ç‚¹å‚æ•°é™æµè§„åˆ™ ç»Ÿè®¡</p></blockquote><h3 id="åœ¨springbootä¸­è¯•è¯•"><a href="#åœ¨springbootä¸­è¯•è¯•" class="headerlink" title="åœ¨springbootä¸­è¯•è¯•"></a>åœ¨springbootä¸­è¯•è¯•</h3><p>æ·»åŠ ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;hot&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hot</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;çƒ­ç‚¹å‚æ•°: &quot;</span> + id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè®¾ç½® jmeterï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131898.png" alt="image.png"></p><p><code>id=1</code>é…ç½®çš„çº¿ç¨‹ç»„æ˜¯<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131199.png" alt="image.png"></p><p><code>id=2</code>é…ç½®çš„çº¿ç¨‹ç»„æ˜¯<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131808.png" alt="image.png"></p><p>åŒæ—¶å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ç»„ï¼Œç»“æœå‘ç°å…¨éƒ¨éƒ½æ˜¯æˆåŠŸï¼Œæ²¡æœ‰é™æµæ•ˆæœï¼Ÿ<br />é™æµä¸æˆåŠŸï¼Ÿ</p><p>å…¶åŸå› å¾ˆç®€å•ï¼ŒSpringMVCçš„<code>@Controller</code>æ³¨è§£çš„èµ„æºä¸è¢«<strong>çƒ­ç‚¹æµé‡é™æµ</strong>å‘ç°<br />éœ€è¦ä¸»åŠ¨ç»™ä»–ä»¬æ·»åŠ æ³¨è§£<code>@SentinelResource(&quot;hot&quot;)</code></p><blockquote><p>æ³¨æ„äº†ã€‚çƒ­ç‚¹å‚æ•°é™æµé»˜è®¤å¯¹SpringMVCèµ„æºæ— æ•ˆã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;hot&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(&quot;hot&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hot</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;çƒ­ç‚¹å‚æ•°: &quot;</span> + id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131783.png" alt="image.png"><br />æ·»åŠ ã€çƒ­ç‚¹è§„åˆ™ã€‘</p><p><code>id=1</code>ç»“æœ<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131438.png" alt="image.png">ï¼Œéƒ¨åˆ†æˆåŠŸ</p><p><code>id=2</code>ç»“æœ<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131533.png" alt="image.png">ï¼Œå…¨éƒ¨æˆåŠŸ</p><p>è¯´æ˜ <code>id=1</code>å’Œ <code>id=2</code>åŒæ—¶å¯åŠ¨ï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•çš„ç›¸äº’å½±å“</p><h3 id="å‚æ•°ä¾‹å¤–é¡¹"><a href="#å‚æ•°ä¾‹å¤–é¡¹" class="headerlink" title="å‚æ•°ä¾‹å¤–é¡¹"></a>å‚æ•°ä¾‹å¤–é¡¹</h3><p>çƒ­ç‚¹é™æµï¼Œå¯¹è¯¥æ¥å£çš„çƒ­ç‚¹å‚æ•°è¿›è¡Œé™æµï¼Œä½†éœ€è¦æœ‰ä¾‹å¤–æƒ…å†µã€‚<br />ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå‚æ•°éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œå³ä¾¿å®ƒæ˜¯çƒ­ç‚¹å‚æ•°ï¼Œä½†ä¸èƒ½ä¹Ÿä¸éœ€è¦é™æµã€‚</p><p>æ¯”å¦‚ï¼šæŸæ¬¾åŒ…æ¬¾çƒ­å–åˆ©æ¶¦æå…¶é«˜çš„å•†å“ï¼Œæˆ‘ä»¬å°±ä¸èƒ½è¿›è¡Œçƒ­ç‚¹å‚æ•°é™æµã€‚<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131094.png" alt="image.png"></p><p>ä¸Šå›¾æˆ‘ä»¬é‡æ–°è®¾ç½®äº† <code>id=10</code>çš„è¿™æ¬¾çƒ­ç‚¹å•†å“çš„ä¾‹å¤–é¡¹ï¼Œå°†å…¶<code>qps</code>ä¸Šè°ƒåˆ°æ¯ç§’10ä¸ªè¯·æ±‚ã€‚</p><p>æ·»åŠ jmeteræµ‹è¯•ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131787.png" alt="image.png"><br /><a href="http://localhost:8401/hot?id=10">http://localhost:8401/hot?id=10</a></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131109.png" alt="image.png"></p><h2 id="â€œå®æ—¶ç›‘æ§â€æ±‡æ€»èµ„æºä¿¡æ¯ï¼ˆé›†ç¾¤èšåˆï¼‰"><a href="#â€œå®æ—¶ç›‘æ§â€æ±‡æ€»èµ„æºä¿¡æ¯ï¼ˆé›†ç¾¤èšåˆï¼‰" class="headerlink" title="â€œå®æ—¶ç›‘æ§â€æ±‡æ€»èµ„æºä¿¡æ¯ï¼ˆé›†ç¾¤èšåˆï¼‰"></a>â€œå®æ—¶ç›‘æ§â€æ±‡æ€»èµ„æºä¿¡æ¯ï¼ˆé›†ç¾¤èšåˆï¼‰</h2><p>åŒæ—¶ï¼ŒåŒä¸€ä¸ªæœåŠ¡ä¸‹çš„æ‰€æœ‰æœºå™¨çš„ç°‡ç‚¹ä¿¡æ¯ä¼šè¢«æ±‡æ€»ï¼Œå¹¶ä¸”ç§’çº§åœ°å±•ç¤ºåœ¨â€å®æ—¶ç›‘æ§â€ä¸‹ã€‚<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131064.png" alt="image.png"></p><blockquote><p>æ³¨æ„: å®æ—¶ç›‘æ§ä»…å­˜å‚¨ 5 åˆ†é’Ÿä»¥å†…çš„æ•°æ®ï¼Œå¦‚æœéœ€è¦æŒä¹…åŒ–ï¼Œéœ€è¦é€šè¿‡è°ƒç”¨<a href="https://github.com/alibaba/Sentinel/wiki/%E5%AE%9E%E6%97%B6%E7%9B%91%E6%8E%A7">å®æ—¶ç›‘æ§æ¥å£</a>æ¥å®šåˆ¶ã€‚</p></blockquote><blockquote><p>æ³¨æ„ï¼šè¯·ç¡®ä¿ Sentinel æ§åˆ¶å°æ‰€åœ¨çš„æœºå™¨æ—¶é—´ä¸è‡ªå·±åº”ç”¨çš„æœºå™¨æ—¶é—´ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ‹‰ä¸åˆ°å®æ—¶çš„ç›‘æ§æ•°æ®ã€‚</p></blockquote><h2 id="è§„åˆ™ç®¡ç†åŠæ¨é€"><a href="#è§„åˆ™ç®¡ç†åŠæ¨é€" class="headerlink" title="è§„åˆ™ç®¡ç†åŠæ¨é€"></a>è§„åˆ™ç®¡ç†åŠæ¨é€</h2><blockquote><p>æœ¬é¡µé¢ç›¸å…³æ–‡æ¡£åœ¨ ï¼š</p></blockquote><blockquote><p>sentinelé»˜è®¤ä½¿ç”¨çš„æ˜¯åŸå§‹æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼çš„é…ç½®åªä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒå¯ä»¥ç”¨ç”¨ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒå°±ä¸èƒ½è¿™ä¹ˆç©äº†</p></blockquote><p>Sentinel æ§åˆ¶å°åŒæ—¶æä¾›ç®€å•çš„è§„åˆ™ç®¡ç†ä»¥åŠæ¨é€çš„åŠŸèƒ½ã€‚è§„åˆ™æ¨é€åˆ†ä¸º 3 ç§æ¨¡å¼ï¼ŒåŒ…æ‹¬ â€œåŸå§‹æ¨¡å¼â€ã€â€Pull æ¨¡å¼â€ å’Œâ€Push æ¨¡å¼â€ã€‚<br />è¿™é‡Œå…ˆç®€å•çš„ä»‹ç»â€åŸå§‹æ¨¡å¼â€ã€‚</p><p>sentinelé»˜è®¤æ˜¯åŸå§‹æ¨¡å¼ï¼Œè¯¥æ¨¡å¼API å°†è§„åˆ™æ¨é€è‡³å®¢æˆ·ç«¯å¹¶ç›´æ¥æ›´æ–°åˆ°å†…å­˜ä¸­ï¼Œç®€å•ï¼Œæ— ä»»ä½•ä¾èµ–ï¼Œä½†ä¸ä¿è¯ä¸€è‡´æ€§ï¼›<strong>è§„åˆ™ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé‡å¯å³æ¶ˆå¤±ã€‚ä¸¥é‡ä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒ</strong></p><p>DataSource æ¥å£ç»™æˆ‘ä»¬æä¾›äº†å¯¹æ¥ä»»æ„é…ç½®æºçš„èƒ½åŠ›ã€‚ç›¸æ¯”ç›´æ¥é€šè¿‡ API ä¿®æ”¹è§„åˆ™ï¼Œå®ç° DataSource æ¥å£æ˜¯æ›´åŠ å¯é çš„åšæ³•ã€‚<br />æˆ‘ä»¬æ¨èé€šè¿‡æ§åˆ¶å°è®¾ç½®è§„åˆ™åå°†è§„åˆ™æ¨é€åˆ°ç»Ÿä¸€çš„è§„åˆ™ä¸­å¿ƒï¼Œå®¢æˆ·ç«¯å®ç° ReadableDataSource æ¥å£ç«¯ç›‘å¬è§„åˆ™ä¸­å¿ƒå®æ—¶è·å–å˜æ›´ï¼Œæµç¨‹å¦‚ä¸‹ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131832.png" alt="image.png"><br />DataSource æ‰©å±•å¸¸è§çš„å®ç°æ–¹å¼æœ‰:</p><ul><li>æ‹‰æ¨¡å¼ï¼šå®¢æˆ·ç«¯ä¸»åŠ¨å‘æŸä¸ªè§„åˆ™ç®¡ç†ä¸­å¿ƒå®šæœŸè½®è¯¢æ‹‰å–è§„åˆ™ï¼Œè¿™ä¸ªè§„åˆ™ä¸­å¿ƒå¯ä»¥æ˜¯ RDBMSã€æ–‡ä»¶ï¼Œç”šè‡³æ˜¯ VCS ç­‰ã€‚è¿™æ ·åšçš„æ–¹å¼æ˜¯ç®€å•ï¼Œç¼ºç‚¹æ˜¯æ— æ³•åŠæ—¶è·å–å˜æ›´ï¼›</li><li>æ¨æ¨¡å¼ï¼šè§„åˆ™ä¸­å¿ƒç»Ÿä¸€æ¨é€ï¼Œå®¢æˆ·ç«¯é€šè¿‡æ³¨å†Œç›‘å¬å™¨çš„æ–¹å¼æ—¶åˆ»ç›‘å¬å˜åŒ–ï¼Œæ¯”å¦‚ä½¿ç”¨ Nacosã€Zookeeper ç­‰é…ç½®ä¸­å¿ƒã€‚è¿™ç§æ–¹å¼æœ‰æ›´å¥½çš„å®æ—¶æ€§å’Œä¸€è‡´æ€§ä¿è¯ã€‚</li></ul><p>Sentinel ç›®å‰æ”¯æŒä»¥ä¸‹æ•°æ®æºæ‰©å±•ï¼š</p><ul><li>Pull-based: åŠ¨æ€æ–‡ä»¶æ•°æ®æºã€Consul, Eureka</li><li>Push-based: ZooKeeper, Redis, Nacos, Apollo, etcd</li></ul><h2 id="æ‹‰æ¨¡å¼"><a href="#æ‹‰æ¨¡å¼" class="headerlink" title="æ‹‰æ¨¡å¼"></a>æ‹‰æ¨¡å¼</h2><p>pull æ¨¡å¼çš„æ•°æ®æºï¼ˆå¦‚æœ¬åœ°æ–‡ä»¶ã€RDBMS ç­‰ï¼‰ä¸€èˆ¬æ˜¯å¯å†™å…¥çš„ã€‚ä½¿ç”¨æ—¶éœ€è¦åœ¨å®¢æˆ·ç«¯æ³¨å†Œæ•°æ®æºï¼šå°†å¯¹åº”çš„è¯»æ•°æ®æºæ³¨å†Œè‡³å¯¹åº”çš„ RuleManagerï¼Œå°†å†™æ•°æ®æºæ³¨å†Œè‡³ transport çš„ WritableDataSourceRegistry ä¸­ã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070131305.webp"></p><p>é¦–å…ˆ Sentinel æ§åˆ¶å°é€šè¿‡ API å°†è§„åˆ™æ¨é€è‡³å®¢æˆ·ç«¯å¹¶æ›´æ–°åˆ°å†…å­˜ä¸­ï¼Œæ¥ç€æ³¨å†Œçš„å†™æ•°æ®æºä¼šå°†æ–°çš„è§„åˆ™ä¿å­˜åˆ°æœ¬åœ°çš„æ–‡ä»¶ä¸­ã€‚ä½¿ç”¨ pull æ¨¡å¼çš„æ•°æ®æºæ—¶ä¸€èˆ¬ä¸éœ€è¦å¯¹ Sentinel æ§åˆ¶å°è¿›è¡Œæ”¹é€ ã€‚è¿™ç§å®ç°æ–¹æ³•å¥½å¤„æ˜¯ç®€å•ï¼Œåå¤„æ˜¯æ— æ³•ä¿è¯ç›‘æ§æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><p>å®ç°æ‹‰æ¨¡å¼çš„æ•°æ®æºæœ€ç®€å•çš„æ–¹å¼æ˜¯ç»§æ‰¿ <code>AutoRefreshDataSource </code>æŠ½è±¡ç±»ï¼Œç„¶åå®ç° <code>readSource()</code> æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•é‡Œä»æŒ‡å®šæ•°æ®æºè¯»å–å­—ç¬¦ä¸²æ ¼å¼çš„é…ç½®æ•°æ®ã€‚æ¯”å¦‚ <a href="https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-dynamic-file-rule/src/main/java/com/alibaba/csp/sentinel/demo/file/rule/FileDataSourceDemo.java">åŸºäºæ–‡ä»¶çš„æ•°æ®æº</a>ã€‚</p><h1 id="éš”ç¦»å’Œé™çº§"><a href="#éš”ç¦»å’Œé™çº§" class="headerlink" title="éš”ç¦»å’Œé™çº§"></a>éš”ç¦»å’Œé™çº§</h1><p>æœåŠ¡ä¹‹é—´æ˜¯ç›¸äº’ä¾èµ–çš„ï¼Œè™½ç„¶é™æµå¯ä»¥ä¿è¯æœåŠ¡ä¸ä¼šå› é«˜å¹¶å‘äº§ç”Ÿå¼‚å¸¸ï¼Œä½†æ— æ³•ä¿è¯æœåŠ¡ä¸ä¼šå› ä¸ºå…¶ä»–åŸå› è€Œäº§ç”Ÿæ•…éšœã€‚æ‰€ä»¥éœ€è¦å…¶ä»–æ‰‹æ®µå°†è¿™äº›æ•…éšœæ§åˆ¶å°ä¸€å®šçš„èŒƒå›´å†…ï¼Œé˜²æ­¢æœåŠ¡çº§è”æ•…éšœï¼ˆæœåŠ¡é›ªå´©ï¼‰ã€‚</p><p>è€Œè¿™äº›æ‰‹æ®µå¤§ä½“ä¸ŠåŒ…æ‹¬è¿™å‡ ç§ï¼š</p><ul><li>çº¿ç¨‹éš”ç¦»ï¼šç»™æ¯ä¸ªæœåŠ¡ä¸“é—¨æä¾›ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± çº¿ç¨‹æ•°é‡ä¸èƒ½å¤ªé«˜ã€‚è¿™æ ·å‡ºç°é—®é¢˜ ï¼Œä¹Ÿä»…ä»…åªä¼šæœ‰éƒ¨åˆ†çº¿ç¨‹è¢«é˜»å¡ã€‚ä¸ä¼šå¯¼è‡´æœåŠ¡çº§è”æ•…éšœã€‚</li><li>ç†”æ–­ï¼šåˆ¤æ–­æœåŠ¡çš„æ•…éšœç‡ï¼Œæ ¹æ®æ•…éšœæƒ…å†µï¼Œå¯¹è¯¥æœåŠ¡è¿›è¡Œç†”æ–­ã€‚ä¸‹æ¬¡è¯·æ±‚å†æ¬¡è®¿é—®åˆ°è¯¥æœåŠ¡æ—¶ï¼Œå°±ä¼šè¢«ç«‹å³è¿”å›ã€‚</li><li>é™æµï¼šé€šè¿‡å¯¹å¹¶å‘è®¿é—®è¿›è¡Œé™é€Ÿï¼Œä¿è¯å…¶ä»–åŠŸèƒ½æ‹¿åˆ°æ›´å¤šçš„ç³»ç»Ÿèµ„æºã€‚</li></ul><blockquote><p>éœ€è¦æ³¨æ„ï¼šé™çº§æ˜¯é™æµçš„ä¸€ç§è¡Œä¸ºï¼ˆæ–¹æ¡ˆï¼‰</p></blockquote><p>é™æµçš„æ–¹æ¡ˆï¼š</p><ul><li>æ‹’ç»æœåŠ¡ï¼šæœ€ç®€å•çš„æ–¹å¼ï¼ŒæŠŠå¤šä½™çš„è¯·æ±‚ç›´æ¥æ‹’ç»æ‰ã€‚åšçš„é«˜å¤§ä¸Šä¸€äº›ï¼Œå¯ä»¥æ ¹æ®ä¸€å®šçš„ç”¨æˆ·è§„åˆ™è¿›è¡Œæ‹’ç»ç­–ç•¥ã€‚</li><li>æœåŠ¡é™çº§ï¼šé™çº§ç”šè‡³å…³æ‰åå°çš„æŸäº›æœåŠ¡ã€‚åœ¨æœåŠ¡å¿…å®šå‡ºç°é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚åŒ11ã€‚å¯ä»¥é¢„å…ˆåœæ­¢æ‰éƒ¨åˆ†ä¸é‡è¦çš„æœåŠ¡ï¼Œå¹¶å°†éƒ¨åˆ†å¼ºä¸€è‡´æ€§çš„æœåŠ¡ä¿®æ”¹ä¸ºæœ€ç»ˆä¸€è‡´æ€§ã€‚ï¼ˆéœ€è¦å¯¹ä¸šåŠ¡æœ‰ä¸€å®šçš„äº†è§£ï¼‰ã€å¼ƒå’ä¿å¸…ã€‘</li><li>ç‰¹æƒè¯·æ±‚ï¼š åœ¨å¤šç§Ÿæˆ·æˆ–è€…å¯¹ç”¨æˆ·è¿›è¡Œåˆ†çº§æ—¶ï¼Œå¯ä»¥è€ƒè™‘è®©ä¸€äº›ç‰¹æ®Šçš„ç”¨æˆ·æœ‰é™å¤„ç†ï¼Œå…¶ä»–çš„å¯ä»¥è€ƒè™‘å¹²æ‰</li><li>å»¶è¿Ÿå¤„ç†ï¼šå¯ä»¥åˆ©ç”¨é˜Ÿåˆ—æŠŠè¯·æ±‚ç¼“å­˜ä½ã€‚å‰Šå³°å¡«è°·ã€‚</li></ul><blockquote><p>ä»ä¸Šé¢æä¾›çš„æ–¹æ¡ˆæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œéƒ½æ˜¯å¯¹æœåŠ¡çš„è°ƒç”¨æ–¹è¿›è¡ŒæŸç§æ“ä½œä»¥ä¿è¯æœåŠ¡é«˜å¯ç”¨ã€‚æœåŠ¡çš„è°ƒç”¨æ–¹ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯åœ¨springcloudä¸­ä¸€èˆ¬ä½¿ç”¨feignè¿›è¡Œè°ƒç”¨ï¼Œæ‰€ä»¥å¯¹äºSpringCloudæ•´åˆSentinelï¼Œå°±éœ€è¦å¯¹feignè¿›è¡Œæ“ä½œ</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœåŠ¡é™æµ </tag>
            
            <tag> æœåŠ¡ç†”æ–­ </tag>
            
            <tag> sentinel </tag>
            
            <tag> æœåŠ¡éš”ç¦» </tag>
            
            <tag> æœåŠ¡é™çº§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>06é™æµä¸ç†”æ–­ç†è®ºéƒ¨åˆ†</title>
      <link href="/2022/11/07/02springcloud/06%E9%99%90%E6%B5%81%E4%B8%8E%E7%86%94%E6%96%AD%E7%90%86%E8%AE%BA%E9%83%A8%E5%88%86/"/>
      <url>/2022/11/07/02springcloud/06%E9%99%90%E6%B5%81%E4%B8%8E%E7%86%94%E6%96%AD%E7%90%86%E8%AE%BA%E9%83%A8%E5%88%86/</url>
      
        <content type="html"><![CDATA[<h1 id="é™æµçš„ç›®çš„ï¼ˆä½œç”¨ï¼‰"><a href="#é™æµçš„ç›®çš„ï¼ˆä½œç”¨ï¼‰" class="headerlink" title="é™æµçš„ç›®çš„ï¼ˆä½œç”¨ï¼‰"></a>é™æµçš„ç›®çš„ï¼ˆä½œç”¨ï¼‰</h1><p>é™æµæ˜¯ä¿è¯æœ€å¤§é™åº¦ä¸ºç”¨æˆ·æä¾›æœåŠ¡çš„æ‰‹æ®µä¹‹ä¸€</p><p>é™æµé€šè¿‡é™åˆ¶å¹¶å‘è®¿é—®é‡æˆ–è€…ä¸€å®šçª—å£æœŸå†…å…è®¸çš„è¯·æ±‚é‡æ¥ä¿æŠ¤ç³»ç»Ÿï¼Œä¸€æ—¦è¾¾åˆ°é™æµé‡å°†ä¼šèµ°ç›¸åº”çš„æ‹’ç»ç­–ç•¥ï¼Œæ¯”å¦‚ï¼šè·³è½¬çš„ç›¸å¯¹æ¸©å’Œçš„æ‹’ç»é¡µé¢æ‹’ç»è¯·æ±‚ã€è¿›å…¥æ’é˜Ÿç³»ç»Ÿã€é™çº§ç­‰</p><p>æ€»è€Œè¨€ä¹‹ï¼Œ<strong>é™æµå°±æ˜¯æŸå¤±éƒ¨åˆ†ç”¨æˆ·çš„å¯ç”¨æ€§ï¼Œä¸ºç»å¤§å¤šæ•°ç”¨æˆ·æä¾›ç¨³å®šçš„æœåŠ¡ã€‚</strong></p><blockquote><p><strong>é™æµçš„æ ¸å¿ƒï¼šä¿æŠ¤å…¨éƒ¨æ ¸å¿ƒä¸šåŠ¡ï¼ŒæŸå¤±éƒ¨åˆ†ä¸€èˆ¬ä¸šåŠ¡ã€‚</strong></p></blockquote><h1 id="é™æµçš„å®ç°æ–¹æ³•"><a href="#é™æµçš„å®ç°æ–¹æ³•" class="headerlink" title="é™æµçš„å®ç°æ–¹æ³•"></a>é™æµçš„å®ç°æ–¹æ³•</h1><p>ç°åœ¨å‡ ä¹æ— å¤„ä¸åœ¨ï¼š</p><ul><li>åœ¨Nginxå±‚æ·»åŠ é™æµæ¨¡å—ï¼Œé™åˆ¶å¹³å‡è®¿é—®é€Ÿåº¦</li><li>é€šè¿‡è®¾ç½®æ•°æ®åº“è¿æ¥æ± çš„å¤§å°æ€»å¹¶å‘é‡</li><li>é€šè¿‡Guavaæä¾›çš„Ratelimiteré™åˆ¶æ¥å£çš„è®¿é—®é€Ÿåº¦</li><li>TCPé€šè®¯åè®®çš„é™æµæ•´å½¢</li></ul><p>ä»¥æ­¤è¯ç”Ÿå’Œå¾ˆå¤šéå¸¸ä¼˜ç§€çš„é™æµæ–¹æ³•</p><h2 id="è®¡æ•°å™¨å›ºå®šçª—å£ç®—æ³•"><a href="#è®¡æ•°å™¨å›ºå®šçª—å£ç®—æ³•" class="headerlink" title="è®¡æ•°å™¨å›ºå®šçª—å£ç®—æ³•"></a>è®¡æ•°å™¨å›ºå®šçª—å£ç®—æ³•</h2><p>åœ¨æ‰§è¡Œæ—¶é—´å‘¨æœŸå†…ï¼Œæ¯å‘ç”Ÿä¸€æ¬¡è®¿é—®å°±ç´¯è®¡ä¸€æ¬¡ï¼Œç›´åˆ°ç´¯è®¡å€¼è¾¾åˆ°é™æµä¸Šé™ï¼Œè§¦å‘é™æµæ‹’ç»ç­–ç•¥ï¼Œå½“è¿›å…¥ä¸‹ä¸€æ¬¡æ—¶é—´å‘¨æœŸæ—¶ï¼Œé‡ç½®é™æµè®¡æ•°ç´¯è®¡å€¼ã€‚</p><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p>ä½†è¿™ç§é™æµç®—æ³•å­˜åœ¨é—®é¢˜ã€‚ã€‚ã€‚</p><p>å‡è®¾æˆ‘ä»¬çš„æ—¶é’Ÿå‘¨æœŸæ˜¯ 2s ï¼Œé™æµæ˜¯ 100</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070125860.png" alt="image.png"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨çŸ­çŸ­ä¸åˆ° 1s çš„æ—¶é—´å†…è¿ç»­å‘ç”Ÿäº† 200 æ¬¡çªç„¶çš„è®¿é—®</p><p>è¶…å‡ºç³»ç»Ÿèƒ½å¤Ÿæä¾›çš„å¹¶å‘è¯·æ±‚é‡</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>ä¸ºäº†æ›´å¥½çš„è§‚å¯Ÿåˆ°é™æµçš„æƒ…å†µï¼Œæˆ‘ä»¬å¯¹é™æµéœ€æ±‚è¿›è¡Œäº†ä¿®æ”¹</p><p>2s åªèƒ½é€šè¿‡ 2æ¬¡ è¯·æ±‚ï¼Œå…±æœ‰10ä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚é—´éš” 250ms </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.simplewindow;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalTime;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¡ç®—å™¨å›ºå®šçª—å£ç®—æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimiterSimpleWindow</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¯ç§’é˜ˆå€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">QPS</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ—¶é—´çª—å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">TIME_WINDOWS</span> <span class="operator">=</span> <span class="number">2000</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¡æ•°å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">REQ_COUNT</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çª—å£è®¡ç®—å¼€å§‹æ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="variable">START_TIME</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span> ((System.currentTimeMillis() - START_TIME) &gt; TIME_WINDOWS) &#123;</span><br><span class="line">REQ_COUNT.set(<span class="number">0</span>);</span><br><span class="line">START_TIME = System.currentTimeMillis();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> REQ_COUNT.incrementAndGet() &lt;= QPS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">TimeUnit.MILLISECONDS.sleep(<span class="number">250</span>);</span><br><span class="line"><span class="type">LocalTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalTime.now();</span><br><span class="line"><span class="keyword">if</span> (tryAcquire()) &#123;</span><br><span class="line">System.out.println(now + <span class="string">&quot; do something&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(now + <span class="string">&quot; è¢«é™æµäº†&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">18:48:32.459501800 <span class="keyword">do</span> something</span><br><span class="line">18:48:32.743208100 <span class="keyword">do</span> something</span><br><span class="line">18:48:32.999056300 è¢«é™æµäº†</span><br><span class="line">18:48:33.251895600 è¢«é™æµäº†</span><br><span class="line">18:48:33.504932600 è¢«é™æµäº†</span><br><span class="line">18:48:33.756792300 è¢«é™æµäº†</span><br><span class="line">18:48:34.009640500 è¢«é™æµäº†</span><br><span class="line">18:48:34.262830700 <span class="keyword">do</span> something</span><br><span class="line">18:48:34.523701700 <span class="keyword">do</span> something</span><br><span class="line">18:48:34.791088100 è¢«é™æµäº†</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ»‘åŠ¨çª—å£ç®—æ³•"><a href="#æ»‘åŠ¨çª—å£ç®—æ³•" class="headerlink" title="æ»‘åŠ¨çª—å£ç®—æ³•"></a>æ»‘åŠ¨çª—å£ç®—æ³•</h2><p>æ»‘åŠ¨çª—å£ç®—æ³•<strong>é™ä½äº†</strong>è®¡ç®—å™¨å›ºå®šçª—å£ç®—æ³•çš„ä¸¤å€_é˜ˆå€¼_é—®é¢˜ã€‚</p><p>å¤§ä½“æ€è·¯å¾ˆç®€å•ï¼Œå°† 1s çš„æ—¶é—´åˆ†æ®µï¼Œåˆ†æˆæ›´ç»†é¢—ç²’åº¦çš„æ—¶é—´å•ä½ï¼Œæ¯”å¦‚åˆ†æˆ 4 åˆ†ï¼Œå¦‚æ­¤åŸæœ¬çš„ 1s é™æµ 100 æ¬¡ï¼Œå˜æˆ 0.25s é™æµ 25æ¬¡</p><p>å³ä¾¿å‡ºç°äº†_é˜ˆå€¼_é—®é¢˜ï¼Œä¹Ÿä»…ä»…æ˜¯å¤šäº† 25 æ¬¡è¯·æ±‚ã€‚125æ¬¡è¯·æ±‚ä¹Ÿæ¯”200æ¬¡è¯·æ±‚è¦å¥½å¾—å¤š</p><p>ç¼–ç å¯ä»¥å‚è€ƒè¿™å¼ å›¾ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070125498.png"><br />æ ¹æ®è¿™å¼ å›¾ä»¥åŠå¯¹æ»‘åŠ¨çª—å£ç®—æ³•çš„ç†è§£ï¼Œå°±å¯ä»¥å†™å‡ºä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.simplewindow;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ»‘åŠ¨çª—å£ç®—æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimiterSlidingWindow</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çª—å£å¤§å°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">Long</span> <span class="variable">windowSize</span> <span class="operator">=</span> <span class="number">1000L</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†åŒº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">partition</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é˜ˆå€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">qps</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å­˜æ”¾å­çª—å£çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> WindowInfo[] windowsArray = <span class="keyword">new</span> <span class="title class_">WindowInfo</span>[partition];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">RateLimiterSlidingWindow</span><span class="params">(Integer qps)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.qps = qps;</span><br><span class="line"><span class="type">long</span> <span class="variable">currentTimeMillis</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; windowsArray.length; i++) &#123;</span><br><span class="line">windowsArray[i] = <span class="keyword">new</span> <span class="title class_">WindowInfo</span>(currentTimeMillis, <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">long</span> <span class="variable">currentTimeMillis</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"><span class="type">long</span> <span class="variable">curIndex</span> <span class="operator">=</span> currentTimeMillis % windowSize / (windowSize / partition);</span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; windowsArray.length; i++) &#123;</span><br><span class="line"><span class="type">WindowInfo</span> <span class="variable">windowInfo</span> <span class="operator">=</span> windowsArray[i];</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹æ—¶é—´çš„åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯å¦è¶…æ—¶</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œæ¯ä¸ªå­çª—å£çš„æ—¶é—´éƒ½æ˜¯ä¸€æ ·çš„ å› ä¸º currentTimeMillis æ¯æ¬¡ tryAcquire è®¾ç½®çš„éƒ½æ˜¯ç›¸åŒä¸€ä¸ªå€¼</span></span><br><span class="line"><span class="comment"> * æ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥è·Ÿ windowSize åˆ¤æ–­ï¼Œè€Œä¸æ˜¯ å­çª—å£çš„ windowSize / partition å•ä½æ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> ((currentTimeMillis - windowInfo.time) &gt; windowSize) &#123;</span><br><span class="line">windowInfo.time = currentTimeMillis;</span><br><span class="line">windowInfo.getCount().set(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­å­çª—å£çš„è®¡æ•°æ˜¯å¦è¶…è¿‡ qps ï¼Œ å¦‚æœæ²¡æœ‰è¶…è¿‡ï¼Œåˆ™è‡ªå¢</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> (curIndex == i &amp;&amp; windowInfo.getCount().get() &lt; qps) &#123;</span><br><span class="line">windowInfo.getCount().incrementAndGet();</span><br><span class="line">&#125;</span><br><span class="line">sum += windowInfo.getCount().get();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æœ€ç»ˆåœ¨è¿™é‡Œåˆ¤æ–­æ‰€æœ‰å­çª—å£ç´¯è®¡çš„æ¬¡æ•°å’Œæ˜¯å¦è¶…è¿‡ qps çš„æ¬¡æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">return</span> sum &lt;= qps;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">WindowInfo</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Long time;</span><br><span class="line"><span class="keyword">private</span> AtomicInteger count;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">WindowInfo</span><span class="params">(Long time, AtomicInteger count)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.time = time;</span><br><span class="line"><span class="built_in">this</span>.count = count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Long <span class="title function_">getTime</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> time;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTime</span><span class="params">(Long time)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.time = time;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> AtomicInteger <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">success</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">RateLimiterSlidingWindow</span> <span class="variable">limiterSlidingWindow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RateLimiterSlidingWindow</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">Thread.sleep(<span class="number">300</span>);</span><br><span class="line"><span class="keyword">if</span> (limiterSlidingWindow.tryAcquire()) &#123;</span><br><span class="line">success++;</span><br><span class="line">System.err.println(<span class="string">&quot;è®¿é—®æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;è®¿é—®å¤±è´¥&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;å®æµ‹æˆåŠŸæ¬¡æ•°ï¼š&quot;</span> + success);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçœ‹ä»£ç å¯ä»¥è®¡ç®—å‡ºå¤§è‡´çš„æˆåŠŸæ¬¡æ•°ï¼š<br />20 æ¬¡è¯·æ±‚ï¼Œ æ¯æ¬¡è¯·æ±‚éœ€è¦ç­‰å¾… 300ms æ‰€ä»¥éœ€è¦ 6000 ms ä¹Ÿå°±æ˜¯ 6s<br />è€Œæ¯æ¬¡çš„ qps çš„æ¬¡æ•°æ˜¯ 2ï¼Œ æ‰€ä»¥å¤§è‡´å¯ä»¥è®¿é—® 12 æ¬¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">è®¿é—®æˆåŠŸ</span><br><span class="line">è®¿é—®æˆåŠŸ</span><br><span class="line">è®¿é—®å¤±è´¥</span><br><span class="line">è®¿é—®æˆåŠŸ</span><br><span class="line">è®¿é—®æˆåŠŸ</span><br><span class="line">è®¿é—®å¤±è´¥</span><br><span class="line">è®¿é—®å¤±è´¥</span><br><span class="line">è®¿é—®æˆåŠŸ</span><br><span class="line">è®¿é—®æˆåŠŸ</span><br><span class="line">è®¿é—®å¤±è´¥</span><br><span class="line">è®¿é—®å¤±è´¥</span><br><span class="line">è®¿é—®æˆåŠŸ</span><br><span class="line">è®¿é—®æˆåŠŸ</span><br><span class="line">è®¿é—®å¤±è´¥</span><br><span class="line">è®¿é—®å¤±è´¥</span><br><span class="line">è®¿é—®æˆåŠŸ</span><br><span class="line">è®¿é—®æˆåŠŸ</span><br><span class="line">è®¿é—®å¤±è´¥</span><br><span class="line">è®¿é—®å¤±è´¥</span><br><span class="line">è®¿é—®æˆåŠŸ</span><br><span class="line">å®æµ‹æˆåŠŸæ¬¡æ•°ï¼š11</span><br><span class="line"></span><br><span class="line">è¿›ç¨‹å·²ç»“æŸ,é€€å‡ºä»£ç 0</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>sentinel å°±æ˜¯ä½¿ç”¨çš„è¿™ç§ç®—æ³•å®ç°çš„é™æµ</p></blockquote><p>ç¼ºç‚¹ï¼š<br />è¿™ç§æ–¹å¼æ— æ³•å¤„ç†çªå‘æƒ…å†µï¼Œæ¯”å¦‚æ®µæ—¶é—´å†…çˆ†å‘å¤§é‡çš„æµé‡ï¼Œæ­¤æ—¶å°†ä¼šæœ‰å¤§é‡è¯·æ±‚è¢«æ‹’ç»</p><h2 id="æ»‘åŠ¨æ—¥å¿—ç®—æ³•"><a href="#æ»‘åŠ¨æ—¥å¿—ç®—æ³•" class="headerlink" title="æ»‘åŠ¨æ—¥å¿—ç®—æ³•"></a>æ»‘åŠ¨æ—¥å¿—ç®—æ³•</h2><p>æ»‘åŠ¨æ—¥å¿—çš„æ–¹å¼æ˜¯ï¼šä½¿ç”¨æ—¥å¿—è®°å½•ä¸‹ç”¨æˆ·æ‰€æœ‰è¯·æ±‚çš„æ—¶é—´ï¼Œæ–°è¯·æ±‚åˆ°æ¥æ—¶å…ˆåˆ¤æ–­æœ€è¿‘æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„è¯·æ±‚æ•°é‡æ˜¯å¦è¶…è¿‡æŒ‡å®šé˜ˆå€¼ï¼Œç”±æ­¤æ¥ç¡®å®šæ˜¯å¦è¾¾åˆ°é™æµï¼Œè¿™ç§æ–¹å¼æ²¡æœ‰äº†æ—¶é—´çª—å£çªå˜çš„é—®é¢˜ï¼Œé™æµæ¯”è¾ƒå‡†ç¡®ï¼Œä½†æ˜¯å› ä¸ºè¦è®°å½•ä¸‹æ¯æ¬¡è¯·æ±‚çš„æ—¶é—´ç‚¹ï¼Œæ‰€ä»¥<strong>å ç”¨çš„å†…å­˜è¾ƒå¤š</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.simplewindow;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalTime;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ»‘åŠ¨æ—¥å¿—æ–¹å¼é™æµ</span></span><br><span class="line"><span class="comment"> * è®¾ç½® QPS ä¸º 2.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimiterSildingLog</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é˜ˆå€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">qps</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®°å½•è¯·æ±‚çš„æ—¶é—´æˆ³,å’Œæ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> TreeMap&lt;Long, Long&gt; treeMap = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¸…ç†è¯·æ±‚è®°å½•é—´éš”, 60 ç§’</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">claerTime</span> <span class="operator">=</span> <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RateLimiterSildingLog</span><span class="params">(Integer qps)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.qps = qps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// æ¸…ç†è¿‡æœŸçš„æ•°æ®è€æ•°æ®ï¼Œæœ€é•¿ 60 ç§’æ¸…ç†ä¸€æ¬¡</span></span><br><span class="line">        <span class="keyword">if</span> (!treeMap.isEmpty() &amp;&amp; (now - treeMap.firstKey()) &gt; claerTime) &#123;</span><br><span class="line">            Set&lt;Long&gt; keySet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(treeMap.subMap(<span class="number">0L</span>, now - <span class="number">1000</span>).keySet());</span><br><span class="line">            <span class="keyword">for</span> (Long key : keySet) &#123;</span><br><span class="line">                treeMap.remove(key);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è®¡ç®—å½“å‰è¯·æ±‚æ¬¡æ•°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Long value : treeMap.subMap(now - <span class="number">1000</span>, now).values()) &#123;</span><br><span class="line">            sum += value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¶…è¿‡QPSé™åˆ¶ï¼Œç›´æ¥è¿”å› false</span></span><br><span class="line">        <span class="keyword">if</span> (sum + <span class="number">1</span> &gt; qps) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è®°å½•æœ¬æ¬¡è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">if</span> (treeMap.containsKey(now)) &#123;</span><br><span class="line">            treeMap.compute(now, (k, v) -&gt; v + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            treeMap.put(now, <span class="number">1L</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum &lt;= qps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">RateLimiterSildingLog</span> <span class="variable">rateLimiterSildingLog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RateLimiterSildingLog</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            Thread.sleep(<span class="number">250</span>);</span><br><span class="line">            <span class="type">LocalTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalTime.now();</span><br><span class="line">            <span class="keyword">if</span> (rateLimiterSildingLog.tryAcquire()) &#123;</span><br><span class="line">                System.out.println(now + <span class="string">&quot; åšç‚¹ä»€ä¹ˆ&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(now + <span class="string">&quot; è¢«é™æµ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä»¤ç‰Œæ¡¶é™æµç®—æ³•"><a href="#ä»¤ç‰Œæ¡¶é™æµç®—æ³•" class="headerlink" title="ä»¤ç‰Œæ¡¶é™æµç®—æ³•"></a>ä»¤ç‰Œæ¡¶é™æµç®—æ³•</h2><h3 id="æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ä»¤ç‰Œæ¡¶é™æµç®—æ³•ï¼šç³»ç»Ÿä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿåº¦å¾€æ¡¶é‡Œæ”¾å…¥ä»¤ç‰Œï¼Œè€Œè¯·æ±‚éœ€è¦ä¸€ä¸ªä»¤ç‰Œï¼Œå¦‚æœæ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œï¼Œåˆ™æ‹’ç»æœåŠ¡ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070125272.png"><br />ä»¤ç‰Œæ¡¶æ˜¯ç½‘ç»œæµé‡æ•´å½¢ï¼ˆTraffic Shapingï¼‰å’Œé€Ÿç‡é™åˆ¶ï¼ˆRate Limitingï¼‰ä¸­æœ€å¸¸ä½¿ç”¨çš„ä¸€ç§ç®—æ³•</p><ul><li>é‚£ä»€ä¹ˆæ˜¯ç½‘ç»œæµé‡æ•´å½¢å’Œé€Ÿç‡é™åˆ¶ï¼Ÿ</li></ul><p>ç½‘ç»œæµé‡æ•´å½¢å€ŸåŠ©ç¼“å†²åŒºå’Œä»¤ç‰Œæ¡¶å®ç°ï¼Œä¿è¯æŠ¥æ–‡èƒ½å¤Ÿä»¥ä¸€å®šçš„é€Ÿç‡å‘å‡ºï¼Œå¤§ä½“çš„å·¥ä½œæ–¹å¼å¯ä»¥å€ŸåŠ©ä¸‹å›¾å®ç°<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070126826.png" alt="image.png"><br />å¦‚å›¾æ‰€ç¤ºï¼Œå°†æŠ¥æ–‡çš„åŒ…æ”¾åœ¨ä¸‹é¢ç¼“å­˜åŒºï¼Œè€Œä¸Šé¢çš„ä»¤ç‰Œæ¡¶ä»¥ä¸€å®šçš„æ•ˆç‡ç”Ÿæˆä»¤ç‰Œï¼Œæ¯æ¬¡æŠ¥æ–‡æƒ³è¦å‘é€å‰ï¼Œéœ€è¦è·å¾—ä¸€ä¸ªä»¤ç‰Œï¼Œè¿™æ ·ï¼Œä»¤ç‰Œæ¡¶å°±å†³å®šäº†æŠ¥æ–‡çš„å‘é€æ•ˆç‡</p><p>å‡è®¾ä»¤ç‰Œç”Ÿæˆçš„æ•ˆç‡æ˜¯æ¯ç§’ 10 ä¸ªï¼Œä¹Ÿå°±æ˜¯ QPS &#x3D; 10ï¼Œæ­¤æ—¶è¯·æ±‚è·å–ä»¤ç‰Œæ—¶å­˜åœ¨è¿™ä¹ˆä¸‰ç§æƒ…å†µï¼š</p><ul><li>è¯·æ±‚é€Ÿåº¦å¤§äºä»¤ç‰Œç”Ÿæˆé€Ÿåº¦ï¼šé‚£ä¹ˆä»¤ç‰Œå°±è¢«å¾ˆå¿«ç”¨å®Œï¼Œåç»­å†æœ‰è¯·æ±‚å‘ç”Ÿï¼Œå°±ä¼šè¢«é™æµ</li><li>è¯·æ±‚é€Ÿåº¦ç­‰äºä»¤ç‰Œç”Ÿæˆé€Ÿåº¦ï¼šæ­¤æ—¶æµé‡å¤„äºç¨³å®šçŠ¶æ€</li><li>è¯·æ±‚å°äºä»¤ç‰Œç”Ÿæˆé€Ÿåº¦ï¼šè¯´æ˜æ­¤æ—¶ç³»ç»Ÿè¯·æ±‚è¾ƒå°‘ï¼Œè¯·æ±‚å°†è¢«ç¨³å®šå¤„ç†ï¼Œè€Œä»¤ç‰Œçš„æ•°é‡å°†ä¼šè¢«é™åˆ¶åœ¨ max æœ€å¤§å€¼</li></ul><p>ä»¤ç‰Œæ¡¶å¯ä»¥å¤„ç†çªå‘è¯·æ±‚ï¼šä»¤ç‰Œæ¡¶æ˜¯å¯ä»¥ç´¯ç§¯çš„ï¼Œæ‰€ä»¥çŸ­æ—¶é—´å†…çªç„¶æ–°å¢å¤§é‡çš„è¯·æ±‚è¿™ç§æƒ…å†µå¯ä»¥è¢«ä»¤ç‰Œæ¡¶ç§¯ç´¯çš„ä»¤ç‰Œå¤„ç†</p><blockquote><p>éœ€è¦æ³¨æ„ï¼šä»¤ç‰Œæ¡¶é™æµç®—æ³•å®¹æ˜“å’Œæ¼æ¡¶ç®—æ³•æ··æ·†ã€‚ä¸»è¦çš„åŒºåˆ«åœ¨äºä»¤ç‰Œæ¡¶å¯ä»¥ç§¯ç´¯ä»¤ç‰Œï¼Œå¯¹ä»˜çªå‘æµé‡ï¼Œä¹Ÿèƒ½ä¿è¯å¤„ç†çš„å¹³å‡æ•ˆç‡ï¼Œè€Œæ¼æ¡¶ç®—æ³•åªèƒ½å¤Ÿå¼ºåˆ¶é™æµ</p></blockquote><p>ä»£ç å¯ä»¥å€ŸåŠ©è¿™å¼ å›¾ç¼–å†™ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070126470.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.simplewindow;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ScheduledExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenBucketSmoothBursty</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»¤ç‰Œæ¡¶çš„å®¹é‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> Integer capacity;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆä»¤ç‰Œçš„æ•ˆç‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> rate;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“å‰ä»¤ç‰Œçš„æ•°é‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> tokenAmount;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">request.setHandleTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">System.out.println(request.getCode() + <span class="string">&quot;å·è¯·æ±‚è¢«å¤„ç†ï¼Œè¯·æ±‚å‘èµ·æ—¶é—´:&quot;</span> + request.getLaunchTime() + <span class="string">&quot;,è¯·æ±‚å¤„ç†æ—¶é—´: &quot;</span> + request.getHandleTime() + <span class="string">&quot;, å¤„ç†è€—æ—¶:&quot;</span> + (request.getHandleTime().getTime() - request.getLaunchTime().getTime()) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">TokenBucketSmoothBursty</span><span class="params">(Integer capacity, <span class="type">long</span> rate)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.capacity = capacity;</span><br><span class="line"><span class="built_in">this</span>.rate = rate;</span><br><span class="line"><span class="type">ScheduledExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line">pool.scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (tokenAmount &lt; <span class="built_in">this</span>.capacity) &#123;</span><br><span class="line"><span class="built_in">this</span>.tokenAmount++;</span><br><span class="line">System.out.println(<span class="string">&quot;tokenAmount: &quot;</span> + tokenAmount);</span><br><span class="line">&#125;</span><br><span class="line">&#125;, <span class="number">0</span>, rate, TimeUnit.MILLISECONDS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="type">TokenBucketSmoothBursty</span> <span class="variable">tokenBucketSmoothBursty</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TokenBucketSmoothBursty</span>(<span class="number">5</span>, <span class="number">200</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">TimeUnit.MILLISECONDS.sleep(<span class="number">100</span>);</span><br><span class="line"><span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>(i, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"><span class="keyword">if</span> (tokenBucketSmoothBursty.tryAcquire(request, TokenBucketSmoothBursty::handleRequest)) &#123;</span><br><span class="line">System.out.println(i + <span class="string">&quot;å·è¯·æ±‚è¢«æ¥å—&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.err.println(i + <span class="string">&quot;å·è¯·æ±‚è¢«æ‹’ç»&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">(Request request, Consumer&lt;Request&gt; consumer)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (tokenAmount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">tokenAmount--;</span><br><span class="line">consumer.accept(request);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Request</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line"><span class="keyword">private</span> Date launchTime;</span><br><span class="line"><span class="keyword">private</span> Date handleTime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Request</span><span class="params">(<span class="type">int</span> code, Date launchTime)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.code = code;</span><br><span class="line"><span class="built_in">this</span>.launchTime = launchTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Request</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.code = code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Date <span class="title function_">getLaunchTime</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> launchTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLaunchTime</span><span class="params">(Date launchTime)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.launchTime = launchTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Date <span class="title function_">getHandleTime</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> handleTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHandleTime</span><span class="params">(Date handleTime)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.handleTime = handleTime;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ä½¿ç”¨ guava çš„ <code>RateLimiter</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®ä»¤ç‰Œæ¡¶çš„å®¹é‡ä¸º 2ï¼Œ æ„å‘³ç€ 1 ç§’é’Ÿåªèƒ½è®¿é—® 2 æ¬¡</span></span><br><span class="line">    <span class="type">RateLimiter</span> <span class="variable">limiter</span> <span class="operator">=</span> RateLimiter.create(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);</span><br><span class="line">        <span class="comment">// äº§ç”Ÿäº†ä¸€ä¸ªä»¤ç‰Œ</span></span><br><span class="line">        System.out.println(time + <span class="string">&quot; : &quot;</span> + limiter.tryAcquire());</span><br><span class="line">        TimeUnit.MILLISECONDS.sleep(<span class="number">250</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¼æ¡¶é™æµæ³•"><a href="#æ¼æ¡¶é™æµæ³•" class="headerlink" title="æ¼æ¡¶é™æµæ³•"></a>æ¼æ¡¶é™æµæ³•</h2><h3 id="æ˜¯ä»€ä¹ˆï¼Ÿ-1"><a href="#æ˜¯ä»€ä¹ˆï¼Ÿ-1" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>æ¼æ¡¶é™æµç®—æ³•çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼š<br />æ§åˆ¶æ•°æ®æ³¨å…¥ç½‘ç»œçš„é€Ÿåº¦ï¼Œä»¥ä¸€ç§å‡é€Ÿå°†æ¡¶å†…çš„è¯·æ±‚ä¸€ç‚¹ç‚¹çš„æ”¾å‡ºæ¥ï¼Œå¹³æ»‘ç½‘ç»œä¸Šçš„çªå‘è¯·æ±‚ã€‚<br />å½“è¯·æ±‚è¶…å‡ºæ¡¶çš„å¤§å°æ—¶ï¼Œè¯·æ±‚å°†è¢«æ‹’ç»ï¼Œèµ°å†³ç»ç­–ç•¥ã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070126931.png" alt="image.png"></p><blockquote><p>æ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•çš„åŒºåˆ«åœ¨äºæ¼æ¡¶é™æµç®—æ³•èƒ½å¤Ÿæ‹¦æˆªè¯·æ±‚ï¼Œä¹Ÿèƒ½å¤Ÿæ‹¦æˆªçªå‘è¯·æ±‚ï¼Œä½†æ— æ³•å¤„ç†çªå‘çš„å¤šä½™è¯·æ±‚ï¼Œå®ƒåªèƒ½å¤ŸæŒ‰ç…§ç¨‹åºå‘˜è§„å®šçš„é€Ÿåº¦ä¸€ç‚¹ç‚¹å¤„ç†è¯·æ±‚ï¼Œè€Œå¤šä½™æ¡¶å®¹é‡çš„è¯·æ±‚å°†è¢«æŠ›å¼ƒæˆ–è€…èµ°å…¶ä»–æ‹’ç»ç­–ç•¥</p></blockquote><p>è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨ guava æä¾›çš„æ¼æ¡¶ç®—æ³•</p><h2 id="å„ä¸ªé™æµç®—æ³•çš„æ¯”è¾ƒ"><a href="#å„ä¸ªé™æµç®—æ³•çš„æ¯”è¾ƒ" class="headerlink" title="å„ä¸ªé™æµç®—æ³•çš„æ¯”è¾ƒ"></a>å„ä¸ªé™æµç®—æ³•çš„æ¯”è¾ƒ</h2><table><thead><tr><th>ç®—æ³•</th><th>ç¡®å®šå‚æ•°</th><th>ç©ºé—´å¤æ‚åº¦</th><th>æ—¶é—´å¤æ‚åº¦</th><th>é™åˆ¶çªå‘æµé‡</th><th>å¹³æ»‘é™æµ</th><th>åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å®ç°éš¾åº¦</th></tr></thead><tbody><tr><td>å›ºå®šçª—å£</td><td>è®¡æ•°å‘¨æœŸTã€<br />å‘¨æœŸå†…æœ€å¤§è®¿é—®æ•°N</td><td>ä½O(1)<br />ï¼ˆè®°å½•å‘¨æœŸå†…è®¿é—®æ¬¡æ•°åŠå‘¨æœŸå¼€å§‹æ—¶é—´ï¼‰</td><td>ä½O(1)</td><td>å¦</td><td>å¦</td><td>ä½</td></tr><tr><td>æ»‘åŠ¨çª—å£</td><td>è®¡æ•°å‘¨æœŸTã€<br />å‘¨æœŸå†…æœ€å¤§è®¿é—®æ•°N</td><td>é«˜O(N)<br />ï¼ˆè®°å½•æ¯ä¸ªå°å‘¨æœŸä¸­çš„è®¿é—®æ•°é‡ï¼‰</td><td>ä¸­O(N)</td><td>æ˜¯</td><td>ç›¸å¯¹å®ç°ã€‚æ»‘åŠ¨çª—å£çš„æ ¼å­åˆ’åˆ†çš„è¶Šå¤šï¼Œé‚£ä¹ˆæ»‘åŠ¨çª—å£çš„æ»šåŠ¨å°±è¶Šå¹³æ»‘</td><td>ä¸­</td></tr><tr><td>æ¼æ¡¶</td><td>æ¼æ¡¶æµå‡ºé€Ÿåº¦rã€æ¼æ¡¶å®¹é‡N</td><td>ä½O(1)<br />ï¼ˆè®°å½•å½“å‰æ¼æ¡¶ä¸­å®¹é‡ï¼‰</td><td>é«˜O(N)</td><td>æ˜¯</td><td>æ˜¯</td><td>é«˜</td></tr><tr><td>ä»¤ç‰Œæ¡¶</td><td>ä»¤ç‰Œäº§ç”Ÿé€Ÿåº¦rã€ä»¤ç‰Œæ¡¶å®¹é‡N</td><td>ä½O(1)<br />ï¼ˆè®°å½•å½“å‰ä»¤ç‰Œæ¡¶ä¸­ä»¤ç‰Œæ•°ï¼‰</td><td>é«˜O(N)</td><td>æ˜¯</td><td>æ˜¯</td><td>é«˜</td></tr></tbody></table><h2 id="æœåŠ¡çš„ç†”æ–­å’Œé™ä½"><a href="#æœåŠ¡çš„ç†”æ–­å’Œé™ä½" class="headerlink" title="æœåŠ¡çš„ç†”æ–­å’Œé™ä½"></a>æœåŠ¡çš„ç†”æ–­å’Œé™ä½</h2><h3 id="ä»€ä¹ˆæ˜¯æœåŠ¡çš„ç†”æ–­ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æœåŠ¡çš„ç†”æ–­ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æœåŠ¡çš„ç†”æ–­ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æœåŠ¡çš„ç†”æ–­ï¼Ÿ</h3><p>æˆ‘ä»¬åœ¨å„ç§åœºæ™¯ä¸‹éƒ½ä¼šæ¥è§¦åˆ°ç†”æ–­è¿™ä¸¤ä¸ªå­—ã€‚é«˜å‹ç”µè·¯ä¸­ï¼Œå¦‚æœæŸå¤„ç”µå‹è¿‡é«˜ï¼Œç†”æ–­å™¨å°±ä¼šç†”æ–­ï¼Œå¯¹ç”µè·¯è¿›è¡Œä¿æŠ¤ã€‚è‚¡ç¥¨äº¤æ˜“ä¸­ï¼Œå¦‚æœè‚¡ç¥¨æ¶¨è·Œå¹…è¿‡å¤§ï¼Œä¹Ÿä¼šé‡‡ç”¨ç†”æ–­æœºåˆ¶ï¼Œæš‚åœäº¤æ˜“ï¼Œæ¥æ§åˆ¶äº¤æ˜“é£é™©ã€‚</p><p>åŒæ ·ï¼Œåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œç†”æ–­æœºåˆ¶ä¹Ÿæ˜¯èµ·ç€ç±»ä¼¼çš„ä½œç”¨ã€‚<strong>å½“è°ƒç”¨é“¾è·¯ä¸­çš„æŸä¸ªå¾®æœåŠ¡é•¿æ—¶é—´ä¸å¯ç”¨æˆ–è€…æœ‰å»¶è¿Ÿï¼Œå“åº”è¿‡æ…¢ï¼Œç³»ç»Ÿå°±ä¼šç†”æ–­å¯¹è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œå¿«é€Ÿè¿”å›é”™è¯¯ä¿¡æ¯ã€‚å½“ç›‘æ§åˆ°è¯¥å¾®æœåŠ¡æ­£å¸¸å·¥ä½œåï¼Œå†æ¬¡æ¢å¤è¯¥è°ƒç”¨é“¾è·¯ã€‚</strong></p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡çš„ç†”æ–­ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡çš„ç†”æ–­ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡çš„ç†”æ–­ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡çš„ç†”æ–­ï¼Ÿ</h3><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070126325.png" alt="image.png"></p><p>æœåŠ¡A éœ€è¦ æœåŠ¡ B C D </p><p>ä½†æ˜¯ æœåŠ¡D å‡ºç°äº†è¿‡è½½æˆ–è€…ä¸å¯ç”¨çš„æƒ…å†µï¼Œå¯¼è‡´ æœåŠ¡A çš„è¯·æ±‚é˜»å¡ç­‰å¾… æœåŠ¡D çš„å“åº”ï¼Œè¿å¸¦ç€ æœåŠ¡A ä¹Ÿå‡ºç°é—®é¢˜ã€‚</p><p>å¦‚æœè¿˜æœ‰å…¶ä»–æœåŠ¡éœ€è¦ç”¨åˆ° æœåŠ¡A é‚£ä¹ˆä¹Ÿè·Ÿç€å‡ºé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„æœåŠ¡é›ªå´©æ•ˆåº”</p><p>æ­¤æ—¶å¦‚æœæˆ‘ä»¬ç»™æ¯ä¸€ä¸ªæœåŠ¡å¤–å›´åŒ…è£¹ä¸€ä¸ªç†”æ–­å™¨ï¼Œ<strong>åœ¨æœåŠ¡å¯ç”¨æ—¶ï¼Œé—­åˆç†”æ–­å™¨ï¼Œåœ¨ä¸å¯ä»¥ä½¿ç”¨æ—¶æ–­å¼€ç†”æ–­å™¨ï¼Œç«‹å³å‘ŠçŸ¥è°ƒç”¨æ–¹æœåŠ¡å¤„äºä¸å¯ç”¨çŠ¶æ€</strong>ã€‚</p><h2 id="ç†”æ–­å™¨éƒ½æœ‰ä»€ä¹ˆè½åœ°å®ç°ï¼Ÿ"><a href="#ç†”æ–­å™¨éƒ½æœ‰ä»€ä¹ˆè½åœ°å®ç°ï¼Ÿ" class="headerlink" title="ç†”æ–­å™¨éƒ½æœ‰ä»€ä¹ˆè½åœ°å®ç°ï¼Ÿ"></a>ç†”æ–­å™¨éƒ½æœ‰ä»€ä¹ˆè½åœ°å®ç°ï¼Ÿ</h2><h3 id="Hystrixç†”æ–­å™¨"><a href="#Hystrixç†”æ–­å™¨" class="headerlink" title="Hystrixç†”æ–­å™¨"></a>Hystrixç†”æ–­å™¨</h3><p>Hystrixæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„<strong>å»¶è¿Ÿå’Œå®¹é”™</strong>çš„å¼€æºåº“,åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œè®¸å¤šä¾èµ–ä¸å¯é¿å…çš„ä¼šè°ƒç”¨å¤±è´¥,æ¯”å¦‚è¶…æ—¶ã€å¼‚å¸¸ç­‰,<strong>Hystrixèƒ½å¤Ÿä¿è¯åœ¨ä¸€ä¸ªä¾èµ–å‡ºé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œ ä¸ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å¤±è´¥ï¼Œé¿å…çº§è”æ•…éšœ,ä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§</strong>ã€‚<strong>â€æ–­è·¯å™¨â€æœ¬èº«æ˜¯ä¸€ç§å¼€å…³è£…ç½®,å½“æŸä¸ªæœåŠ¡å•å…ƒå‘ç”Ÿæ•…éšœä¹‹å, é€šè¿‡æ–­è·¯å™¨çš„æ•…éšœç›‘æ§ (ç±»ä¼¼ç†”æ–­ä¿é™©ä¸),å‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªç¬¦åˆé¢„æœŸçš„ã€å¯å¤„ç†çš„å¤‡é€‰å“åº” (FallBack) ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…æˆ–è€…æŠ›å‡ºè°ƒç”¨æ–¹æ— æ³•å¤„ç†çš„å¼‚å¸¸ï¼Œè¿™æ ·å°±ä¿è¯äº†æœåŠ¡è°ƒç”¨æ–¹çš„çº¿ç¨‹ä¸ä¼šè¢«é•¿æ—¶é—´ã€ä¸å¿…è¦åœ°å ç”¨,ä»è€Œé¿å…äº†æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è”“å»¶ï¼Œä¹ƒè‡³é›ªå´©ã€‚</strong></p><blockquote><p>è¿™ä¸€æ®µæ—¢è¯´æ˜äº† hystrix çš„ä½œç”¨ï¼Œä¹Ÿè¯´å‡ºäº†ç†”æ–­å™¨çš„ä½œç”¨</p></blockquote><h4 id="hystrixå­˜åœ¨çš„é—®é¢˜"><a href="#hystrixå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="hystrixå­˜åœ¨çš„é—®é¢˜"></a>hystrixå­˜åœ¨çš„é—®é¢˜</h4><p>2018 å¹´å‰åNetflixå…¬å¸å®£å¸ƒå…¶<strong>æ ¸å¿ƒç»„ä»¶Hystrixã€Ribbonã€Zuulã€Eurekaç­‰è¿›å…¥ç»´æŠ¤çŠ¶æ€ï¼Œä¸å†è¿›è¡Œæ–°ç‰¹æ€§å¼€å‘ï¼Œåªä¿® BUG</strong>ã€‚<br />è¿™ç›´æ¥å½±å“äº†Spring Cloudé¡¹ç›®çš„å‘å±•è·¯çº¿ï¼ŒSpring å®˜æ–¹ä¸å¾—ä¸é‡‡å–äº†åº”å¯¹æªæ–½ï¼Œåœ¨ 2019 å¹´çš„åœ¨ SpringOne 2019 å¤§ä¼šä¸­ï¼ŒSpring Cloudå®£å¸ƒ Spring Cloud Netflix é¡¹ç›®è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œå¹¶<strong>åœ¨ 2020 å¹´ç§»é™¤ç›¸å…³çš„Netflix OSSç»„ä»¶</strong>ã€‚</p><p>å¦‚ä»ŠNetflix OSSåœ¨Spring Cloudä½“ç³»çš„æ—¶ä»£å·²ç»è½å¹•äº†ã€‚åœ¨æœ¬æ¬¡çš„æ›´æ–°ä¸­ä»¥ä¸‹ç»„ä»¶è¢«ä»Spring Cloud Netflixä¸­ç§»é™¤äº†<br />Spring Cloudæœ¬æ¬¡ç§»é™¤çš„Netflixç»„ä»¶<br /><strong>Spring Cloudå®˜æ–¹å°¤å…¶ç€é‡æŒ‡å‡ºribbonã€hystrix å’Œ zuulä»Spring Cloud 2020.0æ­£å¼ç‰ˆå‘å¸ƒåå°†ä¸å†è¢«Spring Cloudæ”¯æŒ</strong>ã€‚åœ¨ç›®å‰<strong>æœ€æ–°çš„Spring Cloud 2020.0ä¸­ä»…ä»…å‰©ä¸‹äº†Eurekaã€‚ä½†æ˜¯ç•™ç»™Eurekaçš„æ—¶é—´ä¹Ÿä¸å¤šäº†</strong>ã€‚<br /><strong>Feign è™½ç„¶æ˜¯Netflixå…¬å¸å¼€æºçš„ï¼Œä½†ä» 9.x ç‰ˆæœ¬å¼€å§‹å°±ç§»äº¤ç»™OpenFeignç»„ç»‡ç®¡ç†ï¼Œä¸ä»å±äºNetflix OSSèŒƒç•´</strong>ã€‚</p><blockquote><p>æ‰€ä»¥ hystrix å…¥ä¸ªé—¨å°±è¡Œäº†ï¼Œå¯èƒ½ä¼šæœ‰äº›å…¬å¸è¿˜åœ¨ç”¨ï¼Œä½†å·²æ·˜æ±°ï¼Œæ¯•ç«Ÿ spring-cloud-alibaba ç³»åˆ—å®åœ¨å¤ªé¦™äº†</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœåŠ¡é™æµ </tag>
            
            <tag> æœåŠ¡ç†”æ–­ </tag>
            
            <tag> hystrix </tag>
            
            <tag> é™æµ </tag>
            
            <tag> ç†”æ–­ </tag>
            
            <tag> æ»‘åŠ¨çª—å£ç®—æ³• </tag>
            
            <tag> æ»‘åŠ¨æ—¥å¿—ç®—æ³• </tag>
            
            <tag> æ¼æ¡¶é™æµç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>05OpenFeignæœåŠ¡æ¥å£è°ƒç”¨</title>
      <link href="/2022/11/07/02springcloud/05OpenFeign%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8/"/>
      <url>/2022/11/07/02springcloud/05OpenFeign%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="OpenFeignæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#OpenFeignæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="OpenFeignæ˜¯ä»€ä¹ˆï¼Ÿ"></a>OpenFeignæ˜¯ä»€ä¹ˆï¼Ÿ</h1><blockquote><p><a href="https://github.com/OpenFeign/feign">Feign</a> is a declarative web service client. It makes writing web service clients easier. To use Feign create an interface and annotate it. It has pluggable annotation support including Feign annotations and JAX-RS annotations. Feign also supports pluggable encoders and decoders. Spring Cloud adds support for Spring MVC annotations and for using the same HttpMessageConverters used by default in Spring Web. Spring Cloud integrates Eureka, Spring Cloud CircuitBreaker, as well as Spring Cloud LoadBalancer to provide a load-balanced http client when using Feign.</p></blockquote><p>feignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„webæœåŠ¡å®¢æˆ·ç«¯ã€‚å®ƒä½¿å¾—ç¼–å†™webæœåŠ¡å®¢æˆ·ç«¯æ›´åŠ å®¹æ˜“ã€‚è¦ä½¿ç”¨ feign åˆ™éœ€è¦åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ç»™æ¥å£æ·»åŠ ä¸Šæ³¨è§£å³å¯ã€‚<br />å®ƒå…·æœ‰å¯æ’å…¥å¼çš„æ³¨è§£æ”¯æŒï¼ŒåŒ…å«feignæ³¨è§£å’ŒJAX-RSæ³¨è§£ã€‚feignä¹Ÿæ”¯æŒå¯æ’å…¥çš„ç¼–ç å’Œè§£ç ã€‚Spring Cloudå¢åŠ äº†å¯¹Spring MVCæ³¨é‡Šçš„æ”¯æŒï¼Œå¹¶æ”¯æŒä½¿ç”¨Spring Webä¸­é»˜è®¤ä½¿ç”¨çš„HttpMessageConvertersã€‚å½“ä½¿ç”¨ Feign æ—¶ï¼ŒSpring Cloud æ•´åˆäº† Eurekaï¼ŒSpring Cloud CircuitBreaker(æ–­è·¯å™¨)ä»¥åŠSpring Cloud LoadBalancerï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ä»¥æä¾›è´Ÿè½½å‡è¡¡çš„http clientã€‚</p><blockquote><p>è¯´ç™½äº†, openFeignå°±æ˜¯ä¸ªé’ˆå¯¹æœåŠ¡ç«¯æ˜ å°„(controller)çš„å®¢æˆ·ç«¯å·¥å…·, ä¸»è¦ç›®çš„æ˜¯<strong>è®© å®¢æˆ·ç«¯ èƒ½å¤Ÿä»¥ç±»ä¼¼ è°ƒç”¨serviceçš„æ–¹å¼ è°ƒç”¨åˆ° æœåŠ¡ç«¯ çš„ controller</strong></p></blockquote><h2 id="Feignå’ŒOpenFeignçš„åŒºåˆ«"><a href="#Feignå’ŒOpenFeignçš„åŒºåˆ«" class="headerlink" title="Feignå’ŒOpenFeignçš„åŒºåˆ«"></a>Feignå’ŒOpenFeignçš„åŒºåˆ«</h2><table><thead><tr><th>Feign</th><th>openFiegn</th></tr></thead><tbody><tr><td>Feignæ˜¯SpringCloudç»„ä»¶ä¸­ä¸€ä¸ªè½»é‡çº§RESTfulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯ï¼ŒFeignå†…ç½®äº†Ribbonï¼Œç”¨æ¥åšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚Feignçš„ä½¿ç”¨æ–¹å¼æ˜¯ï¼šä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡</td><td>OpenFeign æ˜¯SpringCloudåœ¨Feignçš„åŸºç¡€ä¸Šæ”¯æŒäº†SpringMVCçš„æ³¨è§£ï¼Œå¦‚@RequestMappingç­‰ã€‚OpenFeign çš„@FeignClientå¯ä»¥è§£æSpringMVCçš„@RequestMappingæ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡ã€‚</td></tr></tbody></table><h1 id="æ€ä¹ˆç”¨ï¼Ÿ"><a href="#æ€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="æ€ä¹ˆç”¨ï¼Ÿ"></a>æ€ä¹ˆç”¨ï¼Ÿ</h1><blockquote><p>openFeign ä¹Ÿæ˜¯é’ˆå¯¹å®¢æˆ·ç«¯è®¾è®¡çš„, æ‰€ä»¥ä»£ç ä¸€èˆ¬å¸è½½å®¢æˆ·ç«¯ä¸Š</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--ä¸€èˆ¬åŸºç¡€é€šç”¨é…ç½®--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment">## æŒ‡å®šæœåŠ¡åç§°ï¼Œåœ¨nacosä¸­çš„åå­—</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-order-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line"><span class="comment">#        register-enabled: true</span></span><br><span class="line"><span class="comment">#        watch:</span></span><br><span class="line"><span class="comment">#          enabled: true</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="comment">## ymlæ–‡ä»¶ä¸­å­˜åœ¨ç‰¹æ®Šå­—ç¬¦ï¼Œå¿…é¡»ç”¨å•å¼•å·åŒ…å«ï¼Œå¦åˆ™å¯åŠ¨æŠ¥é”™</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignMain80</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(OrderFeignMain80.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.utils.CommonResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒºåˆ†å¤§å°å†™</span></span><br><span class="line"><span class="comment">// è¿™é‡Œéœ€è¦å’ŒæœåŠ¡æä¾›æ–¹çš„ spring.application.name çš„å€¼ç›¸åŒ</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;cloud-payment-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentFeignService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;create&quot;)</span></span><br><span class="line">    CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> Payment payment)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.service.PaymentFeignService;</span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.utils.CommonResult;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentFeignService paymentFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> paymentFeignService.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š<code>CommonResult create(@RequestBody Payment payment);</code> openFeigné»˜è®¤çš„ä¼ å‚æ–¹å¼å°±æ˜¯JSONä¼ å‚ï¼ˆ@RequestBodyï¼‰ï¼Œå› æ­¤å®šä¹‰æ¥å£çš„æ—¶å€™å¯ä»¥ä¸ç”¨@RequestBodyæ³¨è§£æ ‡æ³¨ï¼Œä¸è¿‡ä¸ºäº†è§„èŒƒï¼Œä¸€èˆ¬éƒ½å¡«ä¸Šã€‚</p></blockquote><blockquote><p>æ³¨æ„ï¼šå› ä¸º <code>openFeign</code>é»˜è®¤ä½¿ç”¨<code>JSON</code>ä¼ å‚æ–¹å¼ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¡¨å•ä¼ å‚æ–¹å¼åˆ™æ”¹ä¸º<code>@SpringQueryMap</code><br><code>CommonResult create(@SpringQueryMap Payment payment);</code></p></blockquote><h2 id="OpenFeignè¶…æ—¶è®¾ç½®"><a href="#OpenFeignè¶…æ—¶è®¾ç½®" class="headerlink" title="OpenFeignè¶…æ—¶è®¾ç½®"></a>OpenFeignè¶…æ—¶è®¾ç½®</h2><p>openFeignåº•å±‚é»˜è®¤è¶…æ—¶åˆ¤å®šæ—¶é—´æ˜¯ 1ç§’ , å¦‚æœè¶…å‡º 1ç§’å°±ä¼šæŠ›å‡ºå¼‚å¸¸</p><p>æ‰€ä»¥åœ¨æœ‰å¿…è¦çš„æƒ…å†µä¸‹, å¯ä»¥è‡ªè¡Œä¿®æ”¹è¶…æ—¶æ—¶é—´</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="comment">## default è®¾ç½®çš„å…¨å±€è¶…æ—¶æ—¶é—´ï¼ŒæŒ‡å®šæœåŠ¡åç§°å¯ä»¥è®¾ç½®å•ä¸ªæœåŠ¡çš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">connectTimeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">readTimeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">basic</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœéœ€è¦è°ƒç”¨æ¶‰åŠåˆ°å¤šä¸ªopenFeignæ¥å£çš„è°ƒç”¨å‘¢ï¼Ÿ</p><p>æ¯”å¦‚ä¸‹å›¾çš„æƒ…å†µï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070123530.png" alt="image.png"></p><p>å¾ˆæ˜æ˜¾ï¼Œ<code>ServiceA </code>å’Œ <code>ServiceB </code>èƒ½å¤Ÿé€šè¿‡ï¼Œä½† <code>ServiceC </code>ä¸èƒ½å¤Ÿé€šè¿‡</p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å•ç‹¬ç»™ <code>serviceC </code>è®¾ç½®è¶…æ—¶æ—¶é—´ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="comment">## default è®¾ç½®çš„å…¨å±€è¶…æ—¶æ—¶é—´ï¼ŒæŒ‡å®šæœåŠ¡åç§°å¯ä»¥è®¾ç½®å•ä¸ªæœåŠ¡çš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">connectTimeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">readTimeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">basic</span></span><br><span class="line">      <span class="attr">cloud-order-service:</span></span><br><span class="line">        <span class="attr">connectTimeout:</span> <span class="number">50000</span></span><br><span class="line">        <span class="attr">readTimeout:</span> <span class="number">50000</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">basic</span></span><br></pre></td></tr></table></figure><blockquote><p>å•ç‹¬è®¾ç½®çš„ä¼˜å…ˆçº§å¤§äº <code>default</code> </p></blockquote><h2 id="å¦‚ä½•å¼€å¯æ—¥å¿—å¢å¼ºï¼Ÿ"><a href="#å¦‚ä½•å¼€å¯æ—¥å¿—å¢å¼ºï¼Ÿ" class="headerlink" title="å¦‚ä½•å¼€å¯æ—¥å¿—å¢å¼ºï¼Ÿ"></a>å¦‚ä½•å¼€å¯æ—¥å¿—å¢å¼ºï¼Ÿ</h2><p><code>openFeign</code>è™½ç„¶æä¾›äº†æ—¥å¿—å¢å¼ºåŠŸèƒ½ï¼Œä½†æ˜¯é»˜è®¤æ˜¯ä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—çš„ï¼Œä¸è¿‡å¼€å‘è€…åœ¨è°ƒè¯•é˜¶æ®µå¯ä»¥è‡ªå·±é…ç½®æ—¥å¿—çš„çº§åˆ«ã€‚<br /><code>openFeign</code>çš„æ—¥å¿—çº§åˆ«å¦‚ä¸‹ï¼š</p><ul><li><code>**NONE**</code>ï¼šé»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—;</li><li><code>**BASIC**</code>ï¼šä»…è®°å½•è¯·æ±‚æ–¹æ³•ã€<code>URL</code>ã€å“åº”çŠ¶æ€ç åŠæ‰§è¡Œæ—¶é—´;</li><li><code>**HEADERS**</code>ï¼šé™¤äº†<code>BASIC</code>ä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯;</li><li><code>**FULL**</code>ï¼šé™¤äº†<code>HEADERS</code>ä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®ã€‚</li></ul><p>é…ç½®èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> feign.Logger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenfeignConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Logger.Level <span class="title function_">feignLoggerLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong>ï¼šè¿™é‡Œçš„<code>logger</code>æ˜¯<code>feign</code>åŒ…é‡Œçš„ã€‚åŒæ—¶è®°ä½æŠŠ <code>application.yml</code>ä¸­çš„é…ç½®<code>loggerLevel: basic</code>æ³¨é‡Šæ‰</p></blockquote><p>æ¥ç€åœ¨ <code>application.yml</code>æ–‡ä»¶ä¸­æ·»åŠ ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.zhazha.springcloud.service:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure><p><code>FULL</code>æ˜¾ç¤ºå‡ºæ¥çš„æ—¥å¿—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2022-08-08 20:20:28.650 DEBUG 8752 --- [p-nio-80-exec-2] c.z.s.service.PaymentFeignService        : [PaymentFeignService<span class="comment">#getPaymentById] ---&gt; GET http://cloud-payment-service/payment/get/1 HTTP/1.1</span></span><br><span class="line">2022-08-08 20:20:28.651 DEBUG 8752 --- [p-nio-80-exec-2] c.z.s.service.PaymentFeignService        : [PaymentFeignService<span class="comment">#getPaymentById] ---&gt; END HTTP (0-byte body)</span></span><br><span class="line">2022-08-08 20:20:28.664 DEBUG 8752 --- [p-nio-80-exec-2] c.z.s.service.PaymentFeignService        : [PaymentFeignService<span class="comment">#getPaymentById] &lt;--- HTTP/1.1 200 (12ms)</span></span><br><span class="line">2022-08-08 20:20:28.664 DEBUG 8752 --- [p-nio-80-exec-2] c.z.s.service.PaymentFeignService        : [PaymentFeignService<span class="comment">#getPaymentById] connection: keep-alive</span></span><br><span class="line">2022-08-08 20:20:28.664 DEBUG 8752 --- [p-nio-80-exec-2] c.z.s.service.PaymentFeignService        : [PaymentFeignService<span class="comment">#getPaymentById] content-type: application/json</span></span><br><span class="line">2022-08-08 20:20:28.665 DEBUG 8752 --- [p-nio-80-exec-2] c.z.s.service.PaymentFeignService        : [PaymentFeignService<span class="comment">#getPaymentById] date: Mon, 08 Aug 2022 12:20:28 GMT</span></span><br><span class="line">2022-08-08 20:20:28.665 DEBUG 8752 --- [p-nio-80-exec-2] c.z.s.service.PaymentFeignService        : [PaymentFeignService<span class="comment">#getPaymentById] keep-alive: timeout=60</span></span><br><span class="line">2022-08-08 20:20:28.665 DEBUG 8752 --- [p-nio-80-exec-2] c.z.s.service.PaymentFeignService        : [PaymentFeignService<span class="comment">#getPaymentById] transfer-encoding: chunked</span></span><br><span class="line">2022-08-08 20:20:28.665 DEBUG 8752 --- [p-nio-80-exec-2] c.z.s.service.PaymentFeignService        : [PaymentFeignService<span class="comment">#getPaymentById] </span></span><br><span class="line">2022-08-08 20:20:28.665 DEBUG 8752 --- [p-nio-80-exec-2] c.z.s.service.PaymentFeignService        : [PaymentFeignService<span class="comment">#getPaymentById] &#123;&quot;code&quot;:200,&quot;message&quot;:&quot;æŸ¥è¯¢æˆåŠŸ port: 8001&quot;,&quot;data&quot;:&#123;&quot;id&quot;:1,&quot;serial&quot;:&quot;zhazha01&quot;&#125;&#125;</span></span><br><span class="line">2022-08-08 20:20:28.665 DEBUG 8752 --- [p-nio-80-exec-2] c.z.s.service.PaymentFeignService        : [PaymentFeignService<span class="comment">#getPaymentById] &lt;--- END HTTP (84-byte body)</span></span><br></pre></td></tr></table></figure><h1 id="OpenFeignå·¥ä½œåŸç†"><a href="#OpenFeignå·¥ä½œåŸç†" class="headerlink" title="OpenFeignå·¥ä½œåŸç†"></a>OpenFeignå·¥ä½œåŸç†</h1><p>å¤§è‡´åŸç†å›¾ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070123276.png" alt="image.png"></p><p>åˆ†ä¸ºåˆå§‹åŒ–å’Œæ‹¦æˆªä¸¤ä¸ªéƒ¨åˆ†</p><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><p>åœ¨åˆ†æä»£ç å‰ï¼Œæ·»åŠ ä¸Š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070123345.png" alt="image.png"><br /><code>basePackages</code>ï¼Œå½“ç„¶ä¸åŠ ä¹Ÿè¡Œ</p><p>ä»<code>@EnableFeignClients</code>æ³¨è§£å…¥æ‰‹åˆ†æ</p><p>çœ‹åˆ°<code>@Import</code>æ³¨è§£ï¼Œç¬¬ä¸€æ—¶é—´åº”å½“æƒ³åˆ°<code>ImportBeanDefinitionRegistrar</code>æ¥å£</p><blockquote><p>è¿˜éœ€è¦æƒ³åˆ°<code>ImportSelector</code></p></blockquote><p>åŒæ—¶å°±éœ€è¦äº†è§£æ”¹æ¥å£çš„ä½œç”¨ä¸»è¦ç›®çš„å°±æ˜¯ï¼šåˆ©ç”¨<code>registerBeanDefinitions</code>å‡½æ•°çš„<code>AnnotationMetadata importingClassMetadata</code>å‚æ•°è·å–<code>@EnableFeignClients(basePackages = &quot;com.zhazha.springcloud.service&quot;)</code>æ³¨è§£çš„å±æ€§ï¼Œç„¶åä½¿ç”¨<code>BeanDefinitionRegistry registry</code>å»æ³¨å†Œ <code>Bean Definition</code></p><blockquote><p>åœ¨æœ¬ä¾‹å­ä¸­<code>AnnotationMetadata importingClassMetadata</code>å‚æ•°è§£æçš„æ˜¯æ³¨è§£<code>EnableFeignClients</code>ï¼Œåœ¨å…¶ä»–ç»„ä»¶ä¸­ï¼Œæ¯”å¦‚æœåŠ¡çš„å‘ç°ä¸æ³¨å†Œä¸­å¯»æ‰¾çš„æ˜¯<code>@EnableDiscoveryClient</code>æ³¨è§£</p></blockquote><blockquote><p><code>AnnotationMetadata importingClassMetadata</code>å¯ä»¥è·å¾—<code>com.zhazha.springcloud.OrderFeignMain80</code>å¯åŠ¨ç±»ä¸Šçš„æ³¨è§£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry,</span></span><br><span class="line"><span class="params">BeanNameGenerator importBeanNameGenerator)</span> &#123;</span><br><span class="line"></span><br><span class="line">registerBeanDefinitions(importingClassMetadata, registry);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Register bean definitions as necessary based on the given annotation metadata of</span></span><br><span class="line"><span class="comment"> * the importing &#123;<span class="doctag">@code</span> <span class="doctag">@Configuration</span>&#125; class.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note that &#123;<span class="doctag">@link</span> BeanDefinitionRegistryPostProcessor&#125; types may &lt;em&gt;not&lt;/em&gt; be</span></span><br><span class="line"><span class="comment"> * registered here, due to lifecycle constraints related to &#123;<span class="doctag">@code</span> <span class="doctag">@Configuration</span>&#125;</span></span><br><span class="line"><span class="comment"> * class processing.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The default implementation is empty.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> importingClassMetadata annotation metadata of the importing class</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> registry current bean definition registry</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <br />åœ¨æœ¬æ¡ˆä¾‹ä¸­ï¼ŒOpenFeignä½¿ç”¨<code>@Import</code>å¯¼å…¥çš„æ˜¯<code>FeignClientsRegistrar</code>ç±»<br />ä»ä¸‹é¢å‡½æ•°å…¥æ‰‹åˆ†æï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">registerDefaultConfiguration(metadata, registry);</span><br><span class="line">registerFeignClients(metadata, registry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ®µä»£ç ä¸»è¦åˆ†æåˆ°çš„æ˜¯<code>defaultConfiguration</code>å±æ€§ï¼Œè¯¥å±æ€§ç”¨æ¥è‡ªå®šä¹‰æ‰€æœ‰Feignå®¢æˆ·ç«¯çš„é…ç½®ï¼Œä½¿ç”¨<code>@Configuration</code>è¿›è¡Œé…ç½®ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä¸ºæŸä¸€ä¸ªFeignå®¢æˆ·ç«¯è¿›è¡Œé…ç½®ã€‚å…·ä½“é…ç½®æ–¹æ³•è§<code>@FeignClient</code>çš„<code>configuration</code>å±æ€§ã€‚</p><blockquote><p>æ²¡ç”¨åˆ°ä¸è¿‡ä¹Ÿæ³¨å†Œäº†ä¸€ä¸ªBeanï¼Œä½†ä¸åˆ†æï¼ˆæ‡’ï¼‰</p></blockquote><p>æ ¸å¿ƒä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerFeignClients</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line"></span><br><span class="line">LinkedHashSet&lt;BeanDefinition&gt; candidateComponents = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">// è·å¾—å¯åŠ¨ç±»ä¸Šçš„æ³¨è§£EnableFeignClients</span></span><br><span class="line">Map&lt;String, Object&gt; attrs = metadata.getAnnotationAttributes(EnableFeignClients.class.getName());</span><br><span class="line">       <span class="comment">// è·å–è¯¥æ³¨è§£çš„ clients å±æ€§ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰è¢«@feignClient æ³¨è§£æ ‡è®°çš„ç±»</span></span><br><span class="line">       <span class="comment">// æˆ‘ä»¬é¡¹ç›®ä¸­å¹¶æœªä½¿ç”¨è¯¥æ³¨è§£çš„clientså±æ€§ï¼Œæ‰€ä»¥è·å–ä¸º clients.length é•¿åº¦ä¸º 0</span></span><br><span class="line"><span class="keyword">final</span> Class&lt;?&gt;[] clients = attrs == <span class="literal">null</span> ? <span class="literal">null</span> : (Class&lt;?&gt;[]) attrs.get(<span class="string">&quot;clients&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (clients == <span class="literal">null</span> || clients.length == <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="comment">// è¿™æ®µä»£ç ä¸»è¦ç›®çš„å°±æ˜¯æ‰«æ basePackages æ³¨è§£çš„åŒ…è·¯å¾„ï¼Œæœ¬æ¡ˆä¾‹ä¸­æˆ‘ä¸»åŠ¨æ·»åŠ äº† com.zhazha.springcloud.service</span></span><br><span class="line">           <span class="comment">// è·¯å¾„ï¼Œæ‰€ä»¥ä¼šæ‰«æè¯¥è·¯å¾„ä¸‹çš„æ‰€æœ‰ FeignClient æ³¨è§£æ ‡è®°çš„ç±»</span></span><br><span class="line"><span class="type">ClassPathScanningCandidateComponentProvider</span> <span class="variable">scanner</span> <span class="operator">=</span> getScanner();</span><br><span class="line">scanner.setResourceLoader(<span class="built_in">this</span>.resourceLoader);</span><br><span class="line">scanner.addIncludeFilter(<span class="keyword">new</span> <span class="title class_">AnnotationTypeFilter</span>(FeignClient.class));</span><br><span class="line">           <span class="comment">// æºç åœ¨ä¸‹é¢æ ‡è®° â‘  çš„åœ°æ–¹</span></span><br><span class="line">Set&lt;String&gt; basePackages = getBasePackages(metadata);</span><br><span class="line"><span class="keyword">for</span> (String basePackage : basePackages) &#123;</span><br><span class="line">               <span class="comment">// å°†æ‰«æå‡ºæ¥çš„ç±»éƒ½æ·»åŠ åˆ° Set é›†åˆä¸­</span></span><br><span class="line">               <span class="comment">// åœ¨æœ¬æ¡ˆä¾‹ä¸­åªèƒ½æ‰«æåˆ° PaymentFeignService ç±»</span></span><br><span class="line">               <span class="comment">// åªæœ‰ä»–æ·»åŠ äº† @FeignClient(value = &quot;cloud-payment-service&quot;) æ³¨è§£</span></span><br><span class="line">candidateComponents.addAll(scanner.findCandidateComponents(basePackage));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (Class&lt;?&gt; clazz : clients) &#123;</span><br><span class="line">candidateComponents.add(<span class="keyword">new</span> <span class="title class_">AnnotatedGenericBeanDefinition</span>(clazz));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (BeanDefinition candidateComponent : candidateComponents) &#123;</span><br><span class="line"><span class="keyword">if</span> (candidateComponent <span class="keyword">instanceof</span> AnnotatedBeanDefinition) &#123;</span><br><span class="line"><span class="comment">// verify annotated class is an interface</span></span><br><span class="line"><span class="type">AnnotatedBeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> (AnnotatedBeanDefinition) candidateComponent;</span><br><span class="line"><span class="type">AnnotationMetadata</span> <span class="variable">annotationMetadata</span> <span class="operator">=</span> beanDefinition.getMetadata();</span><br><span class="line">               <span class="comment">// @FeignClient æ³¨è§£çš„ç±»åªèƒ½æ˜¯æ¥å£</span></span><br><span class="line">Assert.isTrue(annotationMetadata.isInterface(), <span class="string">&quot;@FeignClient can only be specified on an interface&quot;</span>);</span><br><span class="line">               <span class="comment">// æ‹¿åˆ° FeignClient æ³¨è§£çš„æ‰€æœ‰å±æ€§ä¿¡æ¯</span></span><br><span class="line">               <span class="comment">// è¿™é‡Œåªèƒ½æ‹¿åˆ°value = &quot;cloud-payment-service&quot; çš„å€¼ï¼Œå…¶ä»–éƒ½æ˜¯é»˜è®¤çš„</span></span><br><span class="line">Map&lt;String, Object&gt; attributes = annotationMetadata</span><br><span class="line">.getAnnotationAttributes(FeignClient.class.getCanonicalName());</span><br><span class="line">               <span class="comment">// æ­¤å¤„ name = cloud-payment-service</span></span><br><span class="line">               <span class="comment">// æ­¤å¤„æºç ï¼šçœ‹ â‘¡</span></span><br><span class="line">               <span class="comment">// å¯ä»¥æ˜æ˜¾çœ‹åˆ°ä¼˜å…ˆçº§</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> getClientName(attributes);</span><br><span class="line">               <span class="comment">// è·å– FeignClient æ³¨è§£configurationå±æ€§çš„å€¼</span></span><br><span class="line">               <span class="comment">// æˆ‘ä»¬ä»€ä¹ˆéƒ½æ²¡å¡«ï¼Œä½†è¿˜æ˜¯æ³¨å…¥äº†ä¸€ä¸ª bean</span></span><br><span class="line">registerClientConfiguration(registry, name, attributes.get(<span class="string">&quot;configuration&quot;</span>));</span><br><span class="line">               <span class="comment">// æ ¸å¿ƒä»£ç  çœ‹ â‘¢</span></span><br><span class="line">registerFeignClient(registry, annotationMetadata, attributes);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘ <code>getBasePackages</code>æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Set&lt;String&gt; <span class="title function_">getBasePackages</span><span class="params">(AnnotationMetadata importingClassMetadata)</span> &#123;</span><br><span class="line">Map&lt;String, Object&gt; attributes = importingClassMetadata</span><br><span class="line">.getAnnotationAttributes(EnableFeignClients.class.getCanonicalName());</span><br><span class="line"></span><br><span class="line">Set&lt;String&gt; basePackages = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (String pkg : (String[]) attributes.get(<span class="string">&quot;value&quot;</span>)) &#123;</span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasText(pkg)) &#123;</span><br><span class="line">basePackages.add(pkg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (String pkg : (String[]) attributes.get(<span class="string">&quot;basePackages&quot;</span>)) &#123;</span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasText(pkg)) &#123;</span><br><span class="line">basePackages.add(pkg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (Class&lt;?&gt; clazz : (Class[]) attributes.get(<span class="string">&quot;basePackageClasses&quot;</span>)) &#123;</span><br><span class="line">basePackages.add(ClassUtils.getPackageName(clazz));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (basePackages.isEmpty()) &#123;</span><br><span class="line">basePackages.add(ClassUtils.getPackageName(importingClassMetadata.getClassName()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> basePackages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¡ <code>getClientName</code>æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">getClientName</span><span class="params">(Map&lt;String, Object&gt; client)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (client == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> (String) client.get(<span class="string">&quot;contextId&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!StringUtils.hasText(value)) &#123;</span><br><span class="line">value = (String) client.get(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!StringUtils.hasText(value)) &#123;</span><br><span class="line">value = (String) client.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!StringUtils.hasText(value)) &#123;</span><br><span class="line">value = (String) client.get(<span class="string">&quot;serviceId&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasText(value)) &#123;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(</span><br><span class="line"><span class="string">&quot;Either &#x27;name&#x27; or &#x27;value&#x27; must be provided in @&quot;</span> + FeignClient.class.getSimpleName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¢<code>registerFeignClient</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯æ³¨å†Œç±»æœ¬ä½“</span></span><br><span class="line"><span class="comment">// ç¬¬äºŒä¸ªæ˜¯ PaymentService ä¸Šçš„æ³¨è§£å…ƒä¿¡æ¯ï¼Œåœ¨registerFeignClientæ–¹æ³•ä½“ä¸­åªåšäº† getClassName è¿™ä¸€é¡¹æ“ä½œ</span></span><br><span class="line"><span class="comment">// æ³¨è§£ @FeignClient çš„å±æ€§ key value æˆ‘ä»¬åªé…ç½®äº† value -&gt; cloud-payment-service</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">registerFeignClient</span><span class="params">(BeanDefinitionRegistry registry, AnnotationMetadata annotationMetadata,</span></span><br><span class="line"><span class="params">Map&lt;String, Object&gt; attributes)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å– PaymentService çš„ç±»å com.zhazha.springcloud.service.PaymentFeignService</span></span><br><span class="line"><span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> annotationMetadata.getClassName();</span><br><span class="line">        <span class="comment">// PaymentService çš„ç±»åŠ è½½å™¨</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> ClassUtils.resolveClassName(className, <span class="literal">null</span>);</span><br><span class="line"><span class="type">ConfigurableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> registry <span class="keyword">instanceof</span> ConfigurableBeanFactory</span><br><span class="line">? (ConfigurableBeanFactory) registry : <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// contextId = cloud-payment-service</span></span><br><span class="line"><span class="type">String</span> <span class="variable">contextId</span> <span class="operator">=</span> getContextId(beanFactory, attributes);</span><br><span class="line">        <span class="comment">// name = cloud-payment-service</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> getName(attributes);</span><br><span class="line"><span class="type">FeignClientFactoryBean</span> <span class="variable">factoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FeignClientFactoryBean</span>();</span><br><span class="line">factoryBean.setBeanFactory(beanFactory);</span><br><span class="line">factoryBean.setName(name);</span><br><span class="line">factoryBean.setContextId(contextId);</span><br><span class="line">factoryBean.setType(clazz);</span><br><span class="line">        <span class="comment">// åˆ¤æ–­application.ymlæ˜¯å¦è®¾ç½®äº† feign.client.refresh-enabled é…ç½®é¡¹ï¼Œæˆ‘ä»¬è¿™é‡Œæ²¡é…ç½®</span></span><br><span class="line">factoryBean.setRefreshableClient(isClientRefreshEnabled());</span><br><span class="line"><span class="type">BeanDefinitionBuilder</span> <span class="variable">definition</span> <span class="operator">=</span> BeanDefinitionBuilder.genericBeanDefinition(clazz, () -&gt; &#123;</span><br><span class="line">factoryBean.setUrl(getUrl(beanFactory, attributes));</span><br><span class="line">factoryBean.setPath(getPath(beanFactory, attributes));</span><br><span class="line">factoryBean.setDecode404(Boolean.parseBoolean(String.valueOf(attributes.get(<span class="string">&quot;decode404&quot;</span>))));</span><br><span class="line"><span class="type">Object</span> <span class="variable">fallback</span> <span class="operator">=</span> attributes.get(<span class="string">&quot;fallback&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (fallback != <span class="literal">null</span>) &#123;</span><br><span class="line">factoryBean.setFallback(fallback <span class="keyword">instanceof</span> Class ? (Class&lt;?&gt;) fallback</span><br><span class="line">: ClassUtils.resolveClassName(fallback.toString(), <span class="literal">null</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Object</span> <span class="variable">fallbackFactory</span> <span class="operator">=</span> attributes.get(<span class="string">&quot;fallbackFactory&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (fallbackFactory != <span class="literal">null</span>) &#123;</span><br><span class="line">factoryBean.setFallbackFactory(fallbackFactory <span class="keyword">instanceof</span> Class ? (Class&lt;?&gt;) fallbackFactory</span><br><span class="line">: ClassUtils.resolveClassName(fallbackFactory.toString(), <span class="literal">null</span>));</span><br><span class="line">&#125;</span><br><span class="line">            <span class="comment">// éœ€è¦æ³¨æ„çš„ FeignClientFactoryBean å®ç°äº† FactoryBeanï¼Œæ‰€ä»¥å¦‚æœéœ€è¦å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ—¶</span></span><br><span class="line">            <span class="comment">// å°†ä¼šè°ƒç”¨ FactoryBean æ¥å£çš„ getObject æ–¹æ³•ï¼Œ ç”¨äºå®šä¹‰ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">            <span class="comment">// ä½†è¿™æ®µä»£ç å¹¶æ²¡æœ‰è¢«ç«‹å³è°ƒç”¨</span></span><br><span class="line"><span class="keyword">return</span> factoryBean.getObject();</span><br><span class="line">&#125;);</span><br><span class="line">definition.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_BY_TYPE);</span><br><span class="line">definition.setLazyInit(<span class="literal">true</span>);</span><br><span class="line">validate(attributes);</span><br><span class="line"></span><br><span class="line"><span class="type">AbstractBeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> definition.getBeanDefinition();</span><br><span class="line">beanDefinition.setAttribute(FactoryBean.OBJECT_TYPE_ATTRIBUTE, className);</span><br><span class="line">        <span class="comment">// æ³¨æ„çœ‹è¿™ä¸€è¡Œï¼Œæˆ‘ä»¬ feign ä¿®é¥°çš„å¯¹è±¡ PaymentService å¹¶æ²¡æœ‰è¢«æ³¨å…¥ï¼ŒFactoryBeanä¹Ÿæ²¡æœ‰è°ƒç”¨ getObject</span></span><br><span class="line">beanDefinition.setAttribute(<span class="string">&quot;feignClientsRegistrarFactoryBean&quot;</span>, factoryBean);</span><br><span class="line"></span><br><span class="line"><span class="comment">// has a default, won&#x27;t be null</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">primary</span> <span class="operator">=</span> (Boolean) attributes.get(<span class="string">&quot;primary&quot;</span>);</span><br><span class="line"></span><br><span class="line">beanDefinition.setPrimary(primary);</span><br><span class="line"></span><br><span class="line">String[] qualifiers = getQualifiers(attributes);</span><br><span class="line"><span class="keyword">if</span> (ObjectUtils.isEmpty(qualifiers)) &#123;</span><br><span class="line">qualifiers = <span class="keyword">new</span> <span class="title class_">String</span>[] &#123; contextId + <span class="string">&quot;FeignClient&quot;</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">// è¿™é‡Œå°† PaymentSercice æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­</span></span><br><span class="line"><span class="type">BeanDefinitionHolder</span> <span class="variable">holder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionHolder</span>(beanDefinition, className, qualifiers);</span><br><span class="line">BeanDefinitionReaderUtils.registerBeanDefinition(holder, registry);</span><br><span class="line">        <span class="comment">// è¿™é‡Œè¿˜æ˜¯åˆ¤æ–­æ˜¯å¦å¼€å¯ feign.client.refresh-enabled </span></span><br><span class="line">        <span class="comment">// è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰é…ç½®ï¼Œæ‰€ä»¥ä¸èµ°</span></span><br><span class="line">        <span class="comment">// ä½†å®é™…ä¸Šæ³¨å…¥äº† key = feign.Request.Options-cloud-payment-service çš„ paymentService</span></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ refreshScope åˆ›å»ºRequest.Options bean å®šä¹‰</span></span><br><span class="line">registerOptionsBeanDefinition(registry, contextId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæ³¨å†Œå®Œæˆï¼Œæ³¨æ„æ­¤æ—¶ä»…ä»…åªæ˜¯æ³¨å†Œåˆ° <code>DefaultListableBeanFactory</code>å®¹å™¨çš„ <code>beanDefinitionMap</code>ä¸­ï¼Œå¹¶æ²¡æœ‰å®ä¾‹åŒ–ï¼<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070124495.png" alt="image.png"></p><blockquote><p>ä»è¿™è¡Œä»£ç åˆ¤æ–­å‡ºæ¥çš„ï¼Œå¹¶æ²¡æœ‰å®ä¾‹åŒ–å®ƒï¼Œå®ä¾‹åŒ–çš„è¯éœ€è¦å»æ‹¿åˆ°è¿œç¨‹çš„å®ç°å¯¹è±¡</p></blockquote><p>è€Œå®ä¾‹åŒ–çš„è¿‡ç¨‹éœ€è¦å…³æ³¨ Spring å¼‚å¸¸ç†Ÿæ‚‰çš„<code>org.springframework.context.support.AbstractApplicationContext#refresh</code>æ–¹æ³•</p><p>æˆ‘ä»¬æ¥æ€»ç»“ä¸‹ï¼Œæ•´ä¸ªæµç¨‹ï¼š</p><ol><li>ä½¿ç”¨<code>@Import</code>å°†<code>FeignClientsRegistrar</code>å¯¹è±¡æ³¨å…¥åˆ°Springå®¹å™¨</li><li>ä½¿ç”¨<code>ClassPathScanningCandidateComponentProvider</code>æ‰«æ<code>FeignClient</code>æ³¨è§£çš„<code>BasePackages</code>å±æ€§æ‰€å¯¹åº”çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶å°†å…¶å­˜å…¥<code>candidateComponents</code>å®¹å™¨ä¸­</li><li>éå†<code>candidateComponents</code>å¯¹è±¡è·å–<code>FeignClient</code>æ³¨è§£çš„å±æ€§ä¿¡æ¯</li><li>åˆ›å»º<code>FeignClientFactoryBean</code>å¯¹è±¡ï¼Œå¹¶å¡«å……è¿™äº›å±æ€§ä¿¡æ¯ï¼Œè¯¥å¯¹è±¡å®ç°äº†<code>FactoryBean</code>ä¸ºä»¥åç”¨äºå®¹å™¨åœ¨åˆå§‹åŒ–å•ä¾‹å¯¹è±¡æ—¶è°ƒç”¨è¯¥æ¥å£çš„<code>getObject</code>å‡½æ•°</li><li>åˆ›å»º<code>holder</code>å¯¹è±¡ï¼Œå¹¶ä»¥ key &#x3D; <code>com.zhazha.springcloud.service.PaymentFeignService</code>ï¼Œvalue &#x3D; <code>PaymentFeignService</code>çš„ <code>beanDefinition</code>å¯¹è±¡</li><li>è¿™é‡Œè™½ç„¶å¾€å®¹å™¨ä¸­å­˜å…¥å¯¹è±¡ï¼Œä½†æ˜æ‘†ç€è¯¥<code>Bean</code>æ— æ³•è¢«ä½¿ç”¨ï¼Œæ¯•ç«Ÿåªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†</li></ol><h2 id="å®ä¾‹åŒ–è¿‡ç¨‹"><a href="#å®ä¾‹åŒ–è¿‡ç¨‹" class="headerlink" title="å®ä¾‹åŒ–è¿‡ç¨‹"></a>å®ä¾‹åŒ–è¿‡ç¨‹</h2><p>ä»<code>OrderFeignController</code>å¼€å§‹å…¥æ‰‹æ¥ç€å»è§£æ<code>controller</code>ä¸‹é¢çš„<code>PaymentService</code>ä¾èµ–</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070124176.png" alt="image.png"></p><p>æ¥ç€ä» <code>BeanFactory</code>é‡Œé¢æ‹¿åˆ°<code>PaymentService</code>æ¥å£</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070124388.png" alt="image.png"></p><p>æœ€ç»ˆä»–ä¼šå›åˆ°ä¸Šé¢æˆ‘ä»¬åˆ†äº«è¿‡çš„æºç ç‰‡æ®µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BeanDefinitionBuilder</span> <span class="variable">definition</span> <span class="operator">=</span> BeanDefinitionBuilder.genericBeanDefinition(clazz, () -&gt; &#123;</span><br><span class="line">    factoryBean.setUrl(getUrl(beanFactory, attributes));</span><br><span class="line">    factoryBean.setPath(getPath(beanFactory, attributes));</span><br><span class="line">    factoryBean.setDecode404(Boolean.parseBoolean(String.valueOf(attributes.get(<span class="string">&quot;decode404&quot;</span>))));</span><br><span class="line">    <span class="type">Object</span> <span class="variable">fallback</span> <span class="operator">=</span> attributes.get(<span class="string">&quot;fallback&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (fallback != <span class="literal">null</span>) &#123;</span><br><span class="line">        factoryBean.setFallback(fallback <span class="keyword">instanceof</span> Class ? (Class&lt;?&gt;) fallback</span><br><span class="line">                                : ClassUtils.resolveClassName(fallback.toString(), <span class="literal">null</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">fallbackFactory</span> <span class="operator">=</span> attributes.get(<span class="string">&quot;fallbackFactory&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (fallbackFactory != <span class="literal">null</span>) &#123;</span><br><span class="line">        factoryBean.setFallbackFactory(fallbackFactory <span class="keyword">instanceof</span> Class ? (Class&lt;?&gt;) fallbackFactory</span><br><span class="line">                                       : ClassUtils.resolveClassName(fallbackFactory.toString(), <span class="literal">null</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> factoryBean.getObject(); <span class="comment">// ä¼šåœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ¥ç€å°±èƒ½çœ‹åˆ°æ ¸å¿ƒä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> getTarget();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; the target type of the Feign client</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a &#123;<span class="doctag">@link</span> Feign&#125; client created with the specified data and the context</span></span><br><span class="line"><span class="comment"> * information</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&lt;T&gt; T <span class="title function_">getTarget</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">// FeignContext åœ¨ org.springframework.cloud.openfeign.FeignAutoConfiguration#feignContext ä¸­</span></span><br><span class="line">       <span class="comment">// è¢«æ³¨å…¥åˆ° Springå®¹å™¨ä¸­</span></span><br><span class="line">       <span class="comment">// å¯¹äº FeignContext çš„è¯´æ˜ï¼šâ‘ </span></span><br><span class="line"><span class="type">FeignContext</span> <span class="variable">context</span> <span class="operator">=</span> beanFactory != <span class="literal">null</span> ? beanFactory.getBean(FeignContext.class)</span><br><span class="line">: applicationContext.getBean(FeignContext.class);</span><br><span class="line">Feign.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> feign(context);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!StringUtils.hasText(url)) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (LOG.isInfoEnabled()) &#123;</span><br><span class="line">LOG.info(<span class="string">&quot;For &#x27;&quot;</span> + name + <span class="string">&quot;&#x27; URL not provided. Will try picking an instance via load-balancing.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!name.startsWith(<span class="string">&quot;http&quot;</span>)) &#123;</span><br><span class="line">url = <span class="string">&quot;http://&quot;</span> + name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">url = name;</span><br><span class="line">&#125;</span><br><span class="line">url += cleanPath();</span><br><span class="line">           <span class="comment">// è¿™é‡Œå°†ä¼šåˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ â‘¡</span></span><br><span class="line"><span class="keyword">return</span> (T) loadBalance(builder, context, <span class="keyword">new</span> <span class="title class_">HardCodedTarget</span>&lt;&gt;(type, name, url));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasText(url) &amp;&amp; !url.startsWith(<span class="string">&quot;http&quot;</span>)) &#123;</span><br><span class="line">url = <span class="string">&quot;http://&quot;</span> + url;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="built_in">this</span>.url + cleanPath();</span><br><span class="line"><span class="type">Client</span> <span class="variable">client</span> <span class="operator">=</span> getOptional(context, Client.class);</span><br><span class="line"><span class="keyword">if</span> (client != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (client <span class="keyword">instanceof</span> FeignBlockingLoadBalancerClient) &#123;</span><br><span class="line"><span class="comment">// not load balancing because we have a url,</span></span><br><span class="line"><span class="comment">// but Spring Cloud LoadBalancer is on the classpath, so unwrap</span></span><br><span class="line">client = ((FeignBlockingLoadBalancerClient) client).getDelegate();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (client <span class="keyword">instanceof</span> RetryableFeignBlockingLoadBalancerClient) &#123;</span><br><span class="line"><span class="comment">// not load balancing because we have a url,</span></span><br><span class="line"><span class="comment">// but Spring Cloud LoadBalancer is on the classpath, so unwrap</span></span><br><span class="line">client = ((RetryableFeignBlockingLoadBalancerClient) client).getDelegate();</span><br><span class="line">&#125;</span><br><span class="line">builder.client(client);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">applyBuildCustomizers(context, builder);</span><br><span class="line"></span><br><span class="line"><span class="type">Targeter</span> <span class="variable">targeter</span> <span class="operator">=</span> get(context, Targeter.class);</span><br><span class="line"><span class="keyword">return</span> (T) targeter.target(<span class="built_in">this</span>, builder, context, <span class="keyword">new</span> <span class="title class_">HardCodedTarget</span>&lt;&gt;(type, name, url));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘ <code>FeignContext</code>ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070124287.png" alt="image.png"></p><p><code>FeignContext</code>ç»§æ‰¿äº†<code>NameContextFactory</code>æŠ½è±¡ç±»</p><p>å®ƒçš„åŠŸèƒ½ä¸»è¦æ˜¯ä¸ºæ¯ä¸€ä¸ª<code>contextId</code>åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„<code>ApplicationContext</code><br />è¯¥å¯¹è±¡åœ¨<code>FeignAutoConfiguration</code>é…ç½®ç±»ä¸­å°†<code>FeignContext</code>æ³¨å…¥åˆ°Springå®¹å™¨ä¸­</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070124564.png" alt="image.png"></p><p>â‘¡ <code>feign.ReflectiveFeign#newInstance</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">newInstance</span><span class="params">(Target&lt;T&gt; target)</span> &#123;</span><br><span class="line">  Map&lt;String, MethodHandler&gt; nameToHandler = targetToHandlersByName.apply(target);</span><br><span class="line">  Map&lt;Method, MethodHandler&gt; methodToHandler = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;Method, MethodHandler&gt;();</span><br><span class="line">  List&lt;DefaultMethodHandler&gt; defaultMethodHandlers = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;DefaultMethodHandler&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (Method method : target.type().getMethods()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (method.getDeclaringClass() == Object.class) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Util.isDefault(method)) &#123;</span><br><span class="line">      <span class="type">DefaultMethodHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMethodHandler</span>(method);</span><br><span class="line">      defaultMethodHandlers.add(handler);</span><br><span class="line">      methodToHandler.put(method, handler);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      methodToHandler.put(method, nameToHandler.get(Feign.configKey(target.type(), method)));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> factory.create(target, methodToHandler);</span><br><span class="line">  <span class="type">T</span> <span class="variable">proxy</span> <span class="operator">=</span> (T) Proxy.newProxyInstance(target.type().getClassLoader(),</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[] &#123;target.type()&#125;, handler);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (DefaultMethodHandler defaultMethodHandler : defaultMethodHandlers) &#123;</span><br><span class="line">    defaultMethodHandler.bindTo(proxy);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤å®ä¾‹åŒ–ç»“æŸ</p><h2 id="OpenFeignè´Ÿè½½å‡è¡¡æºç åˆ†æ"><a href="#OpenFeignè´Ÿè½½å‡è¡¡æºç åˆ†æ" class="headerlink" title="OpenFeignè´Ÿè½½å‡è¡¡æºç åˆ†æ"></a>OpenFeignè´Ÿè½½å‡è¡¡æºç åˆ†æ</h2><p>å‰é¢çš„åˆ›å»ºå’Œå®ä¾‹åŒ–éƒ½ç»“æŸäº†ï¼Œç°åœ¨æ˜¯ä½¿ç”¨è¿‡ç¨‹</p><p><code>feign.SynchronousMethodHandler#invoke</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object[] argv)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">  <span class="type">RequestTemplate</span> <span class="variable">template</span> <span class="operator">=</span> buildTemplateFromArgs.create(argv);</span><br><span class="line">  <span class="type">Options</span> <span class="variable">options</span> <span class="operator">=</span> findOptions(argv);</span><br><span class="line">  <span class="type">Retryer</span> <span class="variable">retryer</span> <span class="operator">=</span> <span class="built_in">this</span>.retryer.clone();</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// æ ¸å¿ƒä»£ç  â‘ </span></span><br><span class="line">      <span class="keyword">return</span> executeAndDecode(template, options);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RetryableException e) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        retryer.continueOrPropagate(e);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (RetryableException th) &#123;</span><br><span class="line">        <span class="type">Throwable</span> <span class="variable">cause</span> <span class="operator">=</span> th.getCause();</span><br><span class="line">        <span class="keyword">if</span> (propagationPolicy == UNWRAP &amp;&amp; cause != <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> cause;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> th;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (logLevel != Logger.Level.NONE) &#123;</span><br><span class="line">        logger.logRetry(metadata.configKey(), logLevel);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€ä¼šå»è¿™ä¸ªå‡½æ•°ï¼š<code>feign.SynchronousMethodHandler#executeAndDecode</code></p><p>æ ¸å¿ƒä»£ç æ˜¯ï¼š<code>response = client.execute(request, options);</code></p><p>æ¥ç€è¿›å…¥è¿™é‡Œï¼š<code>org.springframework.cloud.openfeign.loadbalancer.FeignBlockingLoadBalancerClient#execute</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Response <span class="title function_">execute</span><span class="params">(Request request, Request.Options options)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="keyword">final</span> <span class="type">URI</span> <span class="variable">originalUri</span> <span class="operator">=</span> URI.create(request.url());</span><br><span class="line"><span class="type">String</span> <span class="variable">serviceId</span> <span class="operator">=</span> originalUri.getHost();</span><br><span class="line">Assert.state(serviceId != <span class="literal">null</span>, <span class="string">&quot;Request URI does not contain a valid hostname: &quot;</span> + originalUri);</span><br><span class="line"><span class="type">String</span> <span class="variable">hint</span> <span class="operator">=</span> getHint(serviceId);</span><br><span class="line">DefaultRequest&lt;RequestDataContext&gt; lbRequest = <span class="keyword">new</span> <span class="title class_">DefaultRequest</span>&lt;&gt;(</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">RequestDataContext</span>(buildRequestData(request), hint));</span><br><span class="line">Set&lt;LoadBalancerLifecycle&gt; supportedLifecycleProcessors = LoadBalancerLifecycleValidator</span><br><span class="line">.getSupportedLifecycleProcessors(</span><br><span class="line">loadBalancerClientFactory.getInstances(serviceId, LoadBalancerLifecycle.class),</span><br><span class="line">RequestDataContext.class, ResponseData.class, ServiceInstance.class);</span><br><span class="line">supportedLifecycleProcessors.forEach(lifecycle -&gt; lifecycle.onStart(lbRequest));</span><br><span class="line">       <span class="comment">// æ ¸å¿ƒä»£ç </span></span><br><span class="line"><span class="type">ServiceInstance</span> <span class="variable">instance</span> <span class="operator">=</span> loadBalancerClient.choose(serviceId, lbRequest);</span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>è¿›å…¥æœåŠ¡é€‰æ‹©å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; ServiceInstance <span class="title function_">choose</span><span class="params">(String serviceId, Request&lt;T&gt; request)</span> &#123;</span><br><span class="line">       <span class="comment">// è·å– loadbalancerç­–ç•¥ â‘ </span></span><br><span class="line">ReactiveLoadBalancer&lt;ServiceInstance&gt; loadBalancer = loadBalancerClientFactory.getInstance(serviceId);</span><br><span class="line"><span class="keyword">if</span> (loadBalancer == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">       <span class="comment">// æ ¸å¿ƒä»£ç  â‘¡</span></span><br><span class="line">Response&lt;ServiceInstance&gt; loadBalancerResponse = Mono.from(loadBalancer.choose(request)).block();</span><br><span class="line"><span class="keyword">if</span> (loadBalancerResponse == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> loadBalancerResponse.getServer();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘ ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070124233.png" alt="image.png"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070124671.png" alt="image.png"></p><p>æœ€ç»ˆå‘ç°è´Ÿè½½å‡è¡¡ç­–ç•¥æ˜¯<code>RoundRobinLoadBalancer</code>è½®è¯¢</p><p>â‘¡<code>org.springframework.cloud.loadbalancer.core.RoundRobinLoadBalancer#choose</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;Response&lt;ServiceInstance&gt;&gt; <span class="title function_">choose</span><span class="params">(Request request)</span> &#123;</span><br><span class="line"><span class="type">ServiceInstanceListSupplier</span> <span class="variable">supplier</span> <span class="operator">=</span> serviceInstanceListSupplierProvider</span><br><span class="line">.getIfAvailable(NoopServiceInstanceListSupplier::<span class="keyword">new</span>);</span><br><span class="line"><span class="keyword">return</span> supplier.get(request).next()</span><br><span class="line">.map(serviceInstances -&gt; processInstanceResponse(supplier, serviceInstances));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç†Ÿæ‚‰çš„æ¥å£ï¼š<code>org.springframework.cloud.loadbalancer.core.ReactorLoadBalancer</code><br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070124706.png" alt="image.png"></p><p>å›åˆ°<code>org.springframework.cloud.openfeign.loadbalancer.FeignBlockingLoadBalancerClient#execute</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Response <span class="title function_">execute</span><span class="params">(Request request, Request.Options options)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="keyword">final</span> <span class="type">URI</span> <span class="variable">originalUri</span> <span class="operator">=</span> URI.create(request.url());</span><br><span class="line"><span class="type">String</span> <span class="variable">serviceId</span> <span class="operator">=</span> originalUri.getHost();</span><br><span class="line"><span class="type">String</span> <span class="variable">hint</span> <span class="operator">=</span> getHint(serviceId);</span><br><span class="line">DefaultRequest&lt;RequestDataContext&gt; lbRequest = <span class="keyword">new</span> <span class="title class_">DefaultRequest</span>&lt;&gt;(</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">RequestDataContext</span>(buildRequestData(request), hint));</span><br><span class="line">Set&lt;LoadBalancerLifecycle&gt; supportedLifecycleProcessors = LoadBalancerLifecycleValidator</span><br><span class="line">.getSupportedLifecycleProcessors(</span><br><span class="line">loadBalancerClientFactory.getInstances(serviceId, LoadBalancerLifecycle.class),</span><br><span class="line">RequestDataContext.class, ResponseData.class, ServiceInstance.class);</span><br><span class="line">supportedLifecycleProcessors.forEach(lifecycle -&gt; lifecycle.onStart(lbRequest));</span><br><span class="line">       <span class="comment">// è´Ÿè½½å‡è¡¡ï¼Œä»å¤šä¸ªæœåŠ¡æä¾›è€…åˆ—è¡¨ä¸­é€‰å–ä¸€ä¸ª</span></span><br><span class="line"><span class="type">ServiceInstance</span> <span class="variable">instance</span> <span class="operator">=</span> loadBalancerClient.choose(serviceId, lbRequest);</span><br><span class="line">org.springframework.cloud.client.loadbalancer.Response&lt;ServiceInstance&gt; lbResponse = <span class="keyword">new</span> <span class="title class_">DefaultResponse</span>(</span><br><span class="line">instance);</span><br><span class="line">       <span class="comment">// æœ‰é»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæ‰€ä»¥è¯¥åˆ†æ”¯ä¸èµ°</span></span><br><span class="line"><span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">       <span class="comment">// è®¡ç®—å‡ºç›®æ ‡ ip åœ°å€ â‘ </span></span><br><span class="line"><span class="type">String</span> <span class="variable">reconstructedUrl</span> <span class="operator">=</span> loadBalancerClient.reconstructURI(instance, originalUri).toString();</span><br><span class="line">       <span class="comment">// åˆ›å»ºè¯·æ±‚</span></span><br><span class="line"><span class="type">Request</span> <span class="variable">newRequest</span> <span class="operator">=</span> buildRequest(request, reconstructedUrl);</span><br><span class="line"><span class="type">LoadBalancerProperties</span> <span class="variable">loadBalancerProperties</span> <span class="operator">=</span> loadBalancerClientFactory.getProperties(serviceId);</span><br><span class="line">       <span class="comment">// æœ€åç©è¿™é‡Œèµ°ï¼Œè¿›è¡Œè¯·æ±‚å¤„ç†</span></span><br><span class="line"><span class="keyword">return</span> executeWithLoadBalancerLifecycleProcessing(delegate, options, newRequest, lbRequest, lbResponse,</span><br><span class="line">supportedLifecycleProcessors, loadBalancerProperties.isUseRawStatusCodeInResponseData());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯ ip ä»å“ªé‡Œè·å¾—ï¼Ÿ<br />ä»è´Ÿè½½å‡è¡¡è¿™è¡Œ<code>ServiceInstance instance = loadBalancerClient.choose(serviceId, lbRequest);</code>è·å–äº†ç›®æ ‡æœåŠ¡çš„IPåœ°å€</p><p>æ¥ç€åœ¨<br /><code>String reconstructedUrl = loadBalancerClient.reconstructURI(instance, originalUri).toString();</code></p><p>â‘ <code>reconstructURI</code>æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> URI <span class="title function_">doReconstructURI</span><span class="params">(ServiceInstance serviceInstance, URI original)</span> &#123;</span><br><span class="line">       <span class="comment">// host = 192.168.19.1 è¿™æ˜¯æˆ‘ä»¬æä¾›æœåŠ¡çš„æœåŠ¡å™¨ ip ä¹‹ä¸€</span></span><br><span class="line"><span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> serviceInstance.getHost();</span><br><span class="line">       <span class="comment">// scheme = http</span></span><br><span class="line"><span class="type">String</span> <span class="variable">scheme</span> <span class="operator">=</span> Optional.ofNullable(serviceInstance.getScheme())</span><br><span class="line">.orElse(computeScheme(original, serviceInstance));</span><br><span class="line">       <span class="comment">// port = 8002</span></span><br><span class="line"><span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> computePort(serviceInstance.getPort(), scheme);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Objects.equals(host, original.getHost()) &amp;&amp; port == original.getPort()</span><br><span class="line">&amp;&amp; Objects.equals(scheme, original.getScheme())) &#123;</span><br><span class="line"><span class="keyword">return</span> original;</span><br><span class="line">&#125;</span><br><span class="line">       <span class="comment">// false</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">encoded</span> <span class="operator">=</span> containsEncodedParts(original);</span><br><span class="line">       <span class="comment">// ç»„åˆå®Œæ¯•ï¼šhttp://192.168.19.1:8002/payment/get/1</span></span><br><span class="line"><span class="keyword">return</span> UriComponentsBuilder.fromUri(original).scheme(scheme).host(host).port(port).build(encoded).toUri();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆåœ¨è¿™é‡Œå¤„ç†è¯·æ±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> Response <span class="title function_">executeWithLoadBalancerLifecycleProcessing</span><span class="params">(Client feignClient, Request.Options options,</span></span><br><span class="line"><span class="params">Request feignRequest, org.springframework.cloud.client.loadbalancer.Request lbRequest,</span></span><br><span class="line"><span class="params">org.springframework.cloud.client.loadbalancer.Response&lt;ServiceInstance&gt; lbResponse,</span></span><br><span class="line"><span class="params">Set&lt;LoadBalancerLifecycle&gt; supportedLifecycleProcessors, <span class="type">boolean</span> loadBalanced, <span class="type">boolean</span> useRawStatusCodes)</span></span><br><span class="line"><span class="keyword">throws</span> IOException &#123;</span><br><span class="line">supportedLifecycleProcessors.forEach(lifecycle -&gt; lifecycle.onStartRequest(lbRequest, lbResponse));</span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œå¤§ä½“ä¸Šçš„æºç åˆ†æå®Œæ¯•</p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœåŠ¡å‘ç° </tag>
            
            <tag> openFeign </tag>
            
            <tag> feign </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>04è´Ÿè½½å‡è¡¡</title>
      <link href="/2022/11/07/02springcloud/04%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
      <url>/2022/11/07/02springcloud/04%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ï¼Ÿ</h1><p><strong>å°†å·¥ä½œè´Ÿè½½åˆ†å¸ƒåˆ°å¤šä¸ªæœåŠ¡å™¨æ¥æé«˜ç½‘ç«™ã€åº”ç”¨ã€æ•°æ®åº“æˆ–å…¶ä»–æœåŠ¡çš„æ€§èƒ½å’Œå¯é æ€§</strong></p><blockquote><p><strong>å°†å¤„ç†åˆ†å‘ç»™å¤šä¸ªæœåŠ¡</strong></p></blockquote><br /><h1 id="å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡"><a href="#å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡" class="headerlink" title="å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡"></a>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡</h1><p>å¸¸è§çš„è´Ÿè½½å‡è¡¡æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ul><li>æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡</li><li>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</li></ul><h2 id="æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡"><a href="#æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡" class="headerlink" title="æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡"></a>æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡</h2><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070119910.png" alt="image.png"></p><p>æ‰€æœ‰å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½å‘é€ç»™ä¸€ä¸ªç»„ä»¶ï¼Œè¯¥ç»„ä»¶å­˜æ”¾ç€æ‰€æœ‰æœåŠ¡ç«¯æ¸…å•ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½ä¼šè¢«æ”¹ç»„ä»¶æŒ‰ç…§ä¸€å®šçš„ç­–ç•¥è½¬å‘ç»™å®ƒæ‰€ç†ŸçŸ¥çš„æœåŠ¡ç«¯</p><h2 id="å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡"><a href="#å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡" class="headerlink" title="å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡"></a>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</h2><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070119278.png" alt="image.png"></p><p>å®¢æˆ·ç«¯ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡åˆ—è¡¨æ¸…å•ï¼Œå®¢æˆ·ç«¯åœ¨éœ€è¦å‘é€è¯·æ±‚æ—¶æ‹¦æˆªï¼Œæ¥ç€æŒ‰ç…§ä¸€å®šçš„ç­–ç•¥é€‰å–ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œå°†è¯·æ±‚å‘é€ç»™å®ƒ</p><h2 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h2><table><thead><tr><th>ä¸åŒç‚¹</th><th>æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡</th><th>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</th></tr></thead><tbody><tr><td>æ˜¯å¦éœ€è¦å»ºç«‹è´Ÿè½½å‡è¡¡æœåŠ¡å™¨</td><td>éœ€è¦åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ã€‚</td><td>å°†è´Ÿè½½å‡è¡¡çš„é€»è¾‘ä»¥ä»£ç çš„å½¢å¼å°è£…åˆ°å®¢æˆ·ç«¯ä¸Šï¼Œå› æ­¤ä¸éœ€è¦å•ç‹¬å»ºç«‹è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ã€‚</td></tr><tr><td>æ˜¯å¦éœ€è¦æœåŠ¡æ³¨å†Œä¸­å¿ƒ</td><td>ä¸éœ€è¦æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚</td><td>éœ€è¦æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚ Â åœ¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸­ï¼Œæ‰€æœ‰çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½éœ€è¦å°†å…¶æä¾›çš„æœåŠ¡æ³¨å†Œåˆ°æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸Šã€‚</td></tr><tr><td>å¯ç”¨æœåŠ¡æ¸…å•å­˜å‚¨çš„ä½ç½®</td><td>å¯ç”¨æœåŠ¡æ¸…å•å­˜å‚¨åœ¨ä½äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ä¸Šã€‚</td><td>æ‰€æœ‰çš„å®¢æˆ·ç«¯éƒ½ç»´æŠ¤äº†ä¸€ä»½å¯ç”¨æœåŠ¡æ¸…å•ï¼Œè¿™äº›æ¸…å•éƒ½æ˜¯ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·å–çš„ã€‚</td></tr><tr><td>è´Ÿè½½å‡è¡¡çš„æ—¶æœº</td><td>å…ˆå°†è¯·æ±‚å‘é€åˆ°è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œç„¶åç”±è´Ÿè½½å‡è¡¡æœåŠ¡å™¨é€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåœ¨å¤šä¸ªæœåŠ¡ç«¯ä¹‹é—´é€‰æ‹©ä¸€ä¸ªè¿›è¡Œè®¿é—®ï¼›å³åœ¨æœåŠ¡å™¨ç«¯å†è¿›è¡Œè´Ÿè½½å‡è¡¡ç®—æ³•åˆ†é…ã€‚ Â ç®€å•ç‚¹è¯´å°±æ˜¯ï¼Œå…ˆå‘é€è¯·æ±‚ï¼Œå†è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚</td><td>åœ¨å‘é€è¯·æ±‚å‰ï¼Œç”±ä½äºå®¢æˆ·ç«¯çš„æœåŠ¡è´Ÿè½½å‡è¡¡å™¨ï¼ˆä¾‹å¦‚ Ribbonï¼‰é€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç„¶åè¿›è¡Œè®¿é—®ã€‚ Â ç®€å•ç‚¹è¯´å°±æ˜¯ï¼Œå…ˆè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå†å‘é€è¯·æ±‚ã€‚</td></tr><tr><td>å®¢æˆ·ç«¯æ˜¯å¦äº†è§£æœåŠ¡æä¾›æ–¹ä¿¡æ¯</td><td>ç”±äºè´Ÿè½½å‡è¡¡æ˜¯åœ¨å®¢æˆ·ç«¯å‘é€è¯·æ±‚åè¿›è¡Œçš„ï¼Œå› æ­¤å®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“åˆ°åº•æ˜¯å“ªä¸ªæœåŠ¡ç«¯æä¾›çš„æœåŠ¡ã€‚</td><td>è´Ÿè½½å‡è¡¡æ˜¯åœ¨å®¢æˆ·ç«¯å‘é€è¯·æ±‚å‰è¿›è¡Œçš„ï¼Œå› æ­¤å®¢æˆ·ç«¯æ¸…æ¥šçš„çŸ¥é“æ˜¯å“ªä¸ªæœåŠ¡ç«¯æä¾›çš„æœåŠ¡ã€‚</td></tr></tbody></table><blockquote><p>è®°ä½ï¼Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ä¸éƒ½æ˜¯ä»£æ›¿å…³ç³»ï¼Œä¹Ÿå¯ä»¥æ˜¯é…åˆå…³ç³»ã€‚ä»ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬çŸ¥é“å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡æœ‰ä¸ªå‰æï¼šéœ€è¦å®¢æˆ·ç«¯ï¼ˆæ¶ˆè´¹è€…ï¼‰æŒæœ‰æœåŠ¡ç«¯ï¼ˆç”Ÿäº§è€…ï¼‰çš„åˆ—è¡¨ï¼Œæ˜¯å¯¹æœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡ï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä¹Ÿå¯èƒ½å¡é¡¿ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦nginxè´Ÿè½½å‡è¡¡ã€‚</p></blockquote><h1 id="è´Ÿè½½å‡è¡¡å¼€å§‹å‰"><a href="#è´Ÿè½½å‡è¡¡å¼€å§‹å‰" class="headerlink" title="è´Ÿè½½å‡è¡¡å¼€å§‹å‰"></a>è´Ÿè½½å‡è¡¡å¼€å§‹å‰</h1><p>åˆ›å»ºæ–°çš„é¡¹ç›®<code>cloud-provider-payment8002</code>å¤åˆ¶ <code>cloud-provider-payment8001</code>çš„æºç å’Œé…ç½®æ–‡ä»¶</p><p>ä¿®æ”¹ï¼š</p><p><code>application.yml</code>: </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8002</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span>            <span class="comment"># å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span>             <span class="comment"># mysqlé©±åŠ¨åŒ…</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.zhazha.springcloud.entities</span>    <span class="comment"># æ‰€æœ‰Entityåˆ«åç±»æ‰€åœ¨åŒ…</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Eurekaé…ç½®</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment"># è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServerï¼Œé»˜è®¤ä¸º true</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸º true ã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œ</span></span><br><span class="line">    <span class="comment"># é›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆ ribbon ä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># EurekaServerçš„åœ°å€</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä»…éœ€è¦ä¿®æ”¹ç«¯å£ 8001 -ã€‹ 8002 å…¶ä»–é…ç½®ä¸éœ€è¦ä¿®æ”¹</p><p>æ¥ç€å…ˆå¯åŠ¨ 7001 å’Œ 7002 è€Œåå¯åŠ¨ 8001  8002 é¡¹ç›® æœ€åå¯åŠ¨ 80 ç«¯å£é¡¹ç›®</p><p>æ‰“å¼€ç½‘é¡µï¼š<a href="http://eureka7001.com:7001/">http://eureka7001.com:7001/</a></p><p>å°±èƒ½çœ‹åˆ°ä¸‹åˆ—æƒ…å†µï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070120312.png" alt="image.png"></p><p>å‡ºç°ä¸¤ä¸ªæœåŠ¡çš„æä¾›è€…</p><blockquote><p>æœ‰æ²¡æœ‰è§‰å¾—è¿™åå­—å¤ªé•¿äº†ï¼Ÿ<br>ä¿®æ”¹ä¸‹å§ï¼<br>ç»™ 8001 é¡¹ç›®çš„ <code>application.yml</code>æ·»åŠ <code>eureka.instance.instance-id=payment8001</code><br>ä¸ºäº†æ›´å¥½çš„æ˜¾ç¤ºå‡º ip è¿˜å¯ä»¥æ·»åŠ ï¼š<code>eureka.instance.prefer-ip-address=true</code><br>ç»™8002é¡¹ç›®ä¹Ÿæ”¹ä¸Š<code>eureka.instance.instance-id=payment8002</code> <code>eureka.instance.prefer-ip-address=true</code><br>é‡å¯é¡¹ç›®å°±å¯ä»¥çœ‹åˆ°ï¼š<br><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070120705.png" alt="image.png"></p></blockquote><p>è®¿é—®ï¼š<a href="http://localhost/order/payment/get/1">http://localhost/order/payment/get/1</a></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070120994.png" alt="image.png"></p><p>ä¸ç®¡æ€ä¹ˆåˆ·æ–°éƒ½æ˜¯ 8001 æ²¡æœ‰è¾¾åˆ°è´Ÿè½½å‡è¡¡çš„åœ°æ­¥</p><p>ä¸ºä»€ä¹ˆï¼Ÿ</p><p>æ ¹æºåœ¨ order80 é¡¹ç›® <br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070120332.png" alt="image.png"><br />è¿™é‡Œå·²ç»å®šæ­»äº†åªèƒ½è®¿é—® <code>8001</code></p><p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"><span class="comment">//å®šä¹‰æœåŠ¡ç«¯URL</span></span><br><span class="line"><span class="comment">//public static final String PAYMENT_URL = &quot;http://localhost:8001&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å¾®æœåŠ¡çš„åå­—</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://CLOUD-PAYMENT-SERVICE&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®¢æˆ·ç«¯é€šè¿‡RestTemplateè°ƒç”¨æœåŠ¡ç«¯</span></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;payment/create&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> restTemplate.postForObject(PAYMENT_URL + <span class="string">&quot;/payment/create&quot;</span>, payment, CommonResult.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹<code>public static final String PAYMENT_URL = &quot;http://CLOUD-PAYMENT-SERVICE&quot;;</code>è¿™æ®µ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain80</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(OrderMain80.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ <code>@LoadBalanced</code>æ³¨è§£</p></blockquote><p>é‡å¯é¡¹ç›®</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070120220.png" alt="image.png"></p><p>æ­¤æ—¶æµ‹è¯•å‘ç°æ˜¯<code>è½®è¯¢ç­–ç•¥</code>ï¼Œè´Ÿè½½å‡è¡¡æˆåŠŸ~~~</p><p>è¿™æ ·ä¿®æ”¹ï¼Œè™½ç„¶å®ç°äº†è´Ÿè½½å‡è¡¡ï¼Œä½†å´éœ€è¦ <code>CLOUD-PAYMENT-SERVICE</code>å¾®æœåŠ¡åå­—ï¼Œå°†å¾®æœåŠ¡å½»åº•å†™æ­»äº†</p><p>æ‰€ä»¥éœ€è¦æ”¹é€ </p><h1 id="Ribbonè´Ÿè½½å‡è¡¡"><a href="#Ribbonè´Ÿè½½å‡è¡¡" class="headerlink" title="Ribbonè´Ÿè½½å‡è¡¡"></a>Ribbonè´Ÿè½½å‡è¡¡</h1><blockquote><p>åŸºæœ¬å·²ç»è¢«<code>LoadBalancer</code>ä»£æ›¿ï¼Œä½†ç†è®ºå¤§äºå®é™…ï¼Œæ‰€ä»¥ç†è®ºéƒ¨åˆ†è¿˜æ˜¯å¾—è¿‡è¿‡</p></blockquote><h2 id="Ribbonæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Ribbonæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Ribbonæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Ribbonæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Netflix Ribbon æ˜¯ Netflix å…¬å¸å‘å¸ƒçš„å¼€æºç»„ä»¶ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯<strong>æä¾›å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨</strong>ã€‚</p><blockquote><p>è®°ä½ï¼šè¿™æ˜¯<strong>å®¢æˆ·ç«¯</strong>è´Ÿè½½å‡è¡¡ç®—æ³•</p></blockquote><h2 id="Ribbonæœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#Ribbonæœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="Ribbonæœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a>Ribbonæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h2><p>é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥<strong>å°†é¢å‘æœåŠ¡çš„ REST æ¨¡æ¿ï¼ˆRestTemplateï¼‰è¯·æ±‚è½¬æ¢ä¸ºå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„æœåŠ¡è°ƒç”¨</strong>ã€‚</p><blockquote><p>è¯´ç™½äº†ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯æ‹¿åˆ°å‡ ä¸ªæœåŠ¡çš„åˆ—è¡¨ï¼ŒæŒ‰ç…§ä¸€å®šçš„ç­–ç•¥é€‰å–ä¸€ä¸ªæœåŠ¡ï¼Œå°†è¯·æ±‚è½¬å‘ç»™è¯¥æœåŠ¡ã€‚å°±è¿™ä¹ˆç®€å•<br>è´Ÿè½½å‡è¡¡çš„æ ¸å¿ƒåœ¨äºä¸æŠŠæ‰€æœ‰çš„è¯·æ±‚éƒ½è½¬å‘ç»™ä¸€ä¸ªæœåŠ¡ï¼Œè€Œæ˜¯æŒ‰ç…§ä¸€å®šçš„ç­–ç•¥å°†è¯·æ±‚åˆ†å‘å‡ºå»</p></blockquote><h2 id="Ribbonå·¥ä½œåŸç†"><a href="#Ribbonå·¥ä½œåŸç†" class="headerlink" title="Ribbonå·¥ä½œåŸç†"></a>Ribbonå·¥ä½œåŸç†</h2><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070120784.png" alt="image.png"></p><ul><li>ç¬¬ä¸€æ­¥ï¼šRibbon æ‹¦æˆªæ‰€æœ‰æ ‡æ³¨@loadBalanceæ³¨è§£çš„ RestTemplateã€‚RestTemplate æ˜¯ç”¨æ¥å‘é€ HTTP è¯·æ±‚çš„ã€‚</li><li>ç¬¬äºŒæ­¥ï¼šå°† Ribbon é»˜è®¤çš„æ‹¦æˆªå™¨ LoadBalancerInterceptor æ·»åŠ åˆ° RestTemplate çš„æ‰§è¡Œé€»è¾‘ä¸­ï¼Œå½“ RestTemplate æ¯æ¬¡å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œéƒ½ä¼šè¢« Ribbon æ‹¦æˆªã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼šæ‹¦æˆªåï¼ŒRibbon ä¼šåˆ›å»ºä¸€ä¸ª ILoadBalancer å®ä¾‹ã€‚</li><li>ç¬¬å››æ­¥ï¼šILoadBalancer å®ä¾‹ä¼šä½¿ç”¨ RibbonClientConfiguration å®Œæˆè‡ªåŠ¨é…ç½®ã€‚å°±ä¼šé…ç½®å¥½ IRuleï¼ŒIPingï¼ŒServerListã€‚</li><li>ç¬¬äº”æ­¥ï¼š<strong>Ribbon ä¼šä»æœåŠ¡åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªæœåŠ¡ï¼Œå°†è¯·æ±‚è½¬å‘ç»™è¿™ä¸ªæœåŠ¡</strong>ã€‚</li></ul><blockquote><p>æ‹¦æˆª + é…ç½® + é€‰å– + è½¬å‘</p></blockquote><p>åŒæ—¶è¿™å¼ å›¾ç‰‡æˆ‘ä»¬å¯ä»¥å†æ¬¡ä½¿ç”¨<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070120348.png" alt="image.png"></p><p>ä»è¿™é‡Œå¯ä»¥æˆ‘ä»¬å¯ä»¥çŸ¥é“<br />Ribbon ä¼šå…ˆä» Eureka Serverï¼ˆæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼‰å»è·å–æœåŠ¡ç«¯åˆ—è¡¨ï¼Œç„¶åé€šè¿‡è´Ÿè½½å‡è¡¡ç­–ç•¥å°†è¯·æ±‚åˆ†æ‘Šç»™å¤šä¸ªæœåŠ¡ç«¯ï¼Œä»è€Œè¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„</p><p>åŒæ—¶å‰é¢è¯´çš„ <code>IRule</code> æ¥å£æ˜¯ Ribbon æä¾›çš„è´Ÿè½½å‡è¡¡ç­–ç•¥</p><p>å®ƒæœ‰ 7 ä¸­é»˜è®¤çš„å®ç°ç±»ï¼Œæ¯ä¸ªç±»éƒ½æ˜¯ä¸€ç§è´Ÿè½½å‡è¡¡ç­–ç•¥</p><table><thead><tr><th>åºå·</th><th>å®ç°ç±»</th><th>è´Ÿè½½å‡è¡¡ç­–ç•¥</th></tr></thead><tbody><tr><td>1</td><td>RoundRobinRule</td><td>æŒ‰ç…§<strong>çº¿æ€§è½®è¯¢</strong>ç­–ç•¥ï¼Œå³æŒ‰ç…§ä¸€å®šçš„é¡ºåºä¾æ¬¡é€‰å–æœåŠ¡å®ä¾‹</td></tr><tr><td>2</td><td>RandomRule</td><td><strong>éšæœº</strong>é€‰å–ä¸€ä¸ªæœåŠ¡å®ä¾‹</td></tr><tr><td>3</td><td>RetryRule</td><td>æŒ‰ç…§ RoundRobinRuleï¼ˆ<strong>è½®è¯¢</strong>ï¼‰çš„ç­–ç•¥æ¥è·å–æœåŠ¡ï¼Œå¦‚æœè·å–çš„æœåŠ¡å®ä¾‹ä¸º null æˆ–å·²ç»å¤±æ•ˆï¼Œåˆ™åœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹å†…<strong>ä¸æ–­åœ°è¿›è¡Œé‡è¯•</strong>ï¼ˆé‡è¯•æ—¶è·å–æœåŠ¡çš„ç­–ç•¥è¿˜æ˜¯ RoundRobinRule ä¸­å®šä¹‰çš„ç­–ç•¥ï¼‰ï¼Œ<strong>å¦‚æœè¶…è¿‡æŒ‡å®šæ—¶é—´ä¾ç„¶æ²¡è·å–åˆ°æœåŠ¡å®ä¾‹åˆ™è¿”å› null</strong> ã€‚</td></tr><tr><td>4</td><td>WeightedResponseTimeRule</td><td>WeightedResponseTimeRule æ˜¯ RoundRobinRule çš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒå¯¹ RoundRobinRule çš„åŠŸèƒ½è¿›è¡Œäº†æ‰©å±•ã€‚ Â <strong>æ ¹æ®å¹³å‡å“åº”æ—¶é—´ï¼Œæ¥è®¡ç®—æ‰€æœ‰æœåŠ¡å®ä¾‹çš„æƒé‡ï¼Œå“åº”æ—¶é—´è¶ŠçŸ­çš„æœåŠ¡å®ä¾‹æƒé‡è¶Šé«˜ï¼Œè¢«é€‰ä¸­çš„æ¦‚ç‡è¶Šå¤§</strong>ã€‚åˆšå¯åŠ¨æ—¶ï¼Œå¦‚æœç»Ÿè®¡ä¿¡æ¯ä¸è¶³ï¼Œåˆ™ä½¿ç”¨çº¿æ€§è½®è¯¢ç­–ç•¥ï¼Œç­‰ä¿¡æ¯è¶³å¤Ÿæ—¶ï¼Œå†åˆ‡æ¢åˆ° WeightedResponseTimeRuleã€‚</td></tr><tr><td>5</td><td>BestAvailableRule</td><td>ç»§æ‰¿è‡ª ClientConfigEnabledRoundRobinRuleã€‚<strong>å…ˆè¿‡æ»¤ç‚¹æ•…éšœæˆ–å¤±æ•ˆçš„æœåŠ¡å®ä¾‹ï¼Œç„¶åå†é€‰æ‹©å¹¶å‘é‡æœ€å°çš„æœåŠ¡å®ä¾‹</strong>ã€‚</td></tr><tr><td>6</td><td>AvailabilityFilteringRule</td><td><strong>å…ˆè¿‡æ»¤æ‰æ•…éšœæˆ–å¤±æ•ˆçš„æœåŠ¡å®ä¾‹ï¼Œç„¶åå†é€‰æ‹©å¹¶å‘é‡è¾ƒå°çš„æœåŠ¡å®ä¾‹</strong>ã€‚</td></tr><tr><td>7</td><td>ZoneAvoidanceRule</td><td>é»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œ<strong>ç»¼åˆåˆ¤æ–­æœåŠ¡æ‰€åœ¨åŒºåŸŸï¼ˆzoneï¼‰çš„æ€§èƒ½å’ŒæœåŠ¡ï¼ˆserverï¼‰çš„å¯ç”¨æ€§ï¼Œæ¥é€‰æ‹©æœåŠ¡å®ä¾‹</strong>ã€‚<strong>åœ¨æ²¡æœ‰åŒºåŸŸçš„ç¯å¢ƒä¸‹ï¼Œè¯¥ç­–ç•¥ä¸è½®è¯¢ï¼ˆRandomRuleï¼‰ç­–ç•¥ç±»ä¼¼</strong>ã€‚</td></tr></tbody></table><h2 id="Ribbonæ€ä¹ˆç©ï¼Ÿ-çœ‹çœ‹å°±å¥½-ä¸éœ€è¦è‡ªå·±å®ç°"><a href="#Ribbonæ€ä¹ˆç©ï¼Ÿ-çœ‹çœ‹å°±å¥½-ä¸éœ€è¦è‡ªå·±å®ç°" class="headerlink" title="Ribbonæ€ä¹ˆç©ï¼Ÿ(çœ‹çœ‹å°±å¥½, ä¸éœ€è¦è‡ªå·±å®ç°)"></a>Ribbonæ€ä¹ˆç©ï¼Ÿ(çœ‹çœ‹å°±å¥½, ä¸éœ€è¦è‡ªå·±å®ç°)</h2><blockquote><p>æ³¨æ„ï¼Œç°åœ¨ä¸šç•Œ<code>Eureka</code>åŸºæœ¬å¾ˆå°‘ä½¿ç”¨äº†ï¼Œæ‰€ä»¥æœ¬ç¯‡è®²çš„ <code>Ribbonï¼ˆæ‰©å±•ç‰ˆï¼‰</code>ç°é˜¶æ®µåªæœ‰ <code>Nacos</code>åœ¨ä½¿ç”¨ï¼ˆè€Œä¸”æ–°ç‰ˆæœ¬nacosä¹Ÿæ”¾å¼ƒä½¿ç”¨Ribbonï¼‰<br>æœ¬ç¯‡ä¹Ÿå°±ç¨å¾®è®²è®²åŸºäº zookeeper åšæœåŠ¡çš„æ³¨å†Œå’Œå‘ç°ä¸­å¿ƒ çš„æ–¹å¼å§, è€Œä¸æ˜¯ eureka</p></blockquote><p>é¦–å…ˆ, ç¬¬ä¸€æ­¥å°±æ˜¯é™çº§</p><p>å°† springboot é™çº§, ä¿®æ”¹ parent é¡¹ç›®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring boot 2.2.2--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--spring cloud Hoxton.SR1--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å†åˆ›å»ºä¸€ä¸ªé¡¹ç›®<code>cloud-provider-payment8001</code> å’Œ <code>8002</code></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070120715.png" alt="image.png"></p><p>æä¾›æ–¹çš„ pom</p><blockquote><p>è¿™é‡Œåªæä¾› 8002 çš„é…ç½®å’Œæºç , 8001 åŸºæœ¬ç›¸åŒ, åªéœ€è¦æ”¹ä¸‹ server.port ç«¯å£å°±è¡Œ</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- SpringBootæ•´åˆzookeeperå®¢æˆ·ç«¯,è¿™é‡Œä¸å†ä½¿ç”¨Eurekaè¿›è¡ŒæœåŠ¡æ³¨å†Œï¼Œæ‰€ä»¥è¿™é‡Œå¯¼å…¥çš„æ˜¯Zookeeperçš„ç›¸å…³ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- å…ˆæ’é™¤è‡ªå¸¦çš„zookeeper --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ·»åŠ zookeeper3.8.0ç‰ˆæœ¬ï¼Œæ³¨æ„è¿™é‡Œè¦å’Œ zookeeper åº”ç”¨å¯åŠ¨çš„ç‰ˆæœ¬ä¸€è‡´ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>application</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8002</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-payment</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">zookeeper:</span></span><br><span class="line">      <span class="attr">connect-string:</span> <span class="string">localhost:2181</span></span><br></pre></td></tr></table></figure><p>æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8002</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(PaymentMain8002.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfo</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;springcloud: &quot;</span> + serverPort + <span class="string">&quot;\t\t&quot;</span> + UUID.randomUUID();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯ä¿®æ”¹ <code>cloud-consumer-order80</code></p><p>pomå”¯ä¸€çš„åŒºåˆ«:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&lt;dependency&gt;</span></span><br><span class="line">    <span class="string">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span><br><span class="line">    <span class="string">&lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt;</span></span><br><span class="line">    <span class="string">&lt;!--</span> <span class="string">å…ˆæ’é™¤è‡ªå¸¦çš„zookeeper</span> <span class="string">--&gt;</span></span><br><span class="line">    <span class="string">&lt;exclusions&gt;</span></span><br><span class="line">        <span class="string">&lt;exclusion&gt;</span></span><br><span class="line">            <span class="string">&lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span></span><br><span class="line">            <span class="string">&lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span></span><br><span class="line">        <span class="string">&lt;/exclusion&gt;</span></span><br><span class="line">        <span class="string">&lt;!--</span> <span class="string">æ’é™¤å’Œä¸æ’é™¤éƒ½ä¸€æ ·,</span> <span class="string">ä½ç‰ˆæœ¬çš„</span> <span class="string">springcloud</span> <span class="string">åº•å±‚é»˜è®¤å°±ä½¿ç”¨</span> <span class="string">ribbon</span> <span class="string">--&gt;</span></span><br><span class="line">        <span class="string">&lt;exclusion&gt;</span></span><br><span class="line">            <span class="string">&lt;artifactId&gt;spring-cloud-starter-loadbalancer&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="string">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span><br><span class="line">        <span class="string">&lt;/exclusion&gt;</span></span><br><span class="line">    <span class="string">&lt;/exclusions&gt;</span></span><br><span class="line"><span class="string">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderConsulController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INVOKE_URL</span> <span class="operator">=</span> <span class="string">&quot;http://cloud-provider-payment&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> restTemplate.getForObject(INVOKE_URL + <span class="string">&quot;/payment/&quot;</span>, String.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…è°ƒç”¨æ”¯ä»˜æœåŠ¡(consule)---&gt;result:&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éå¸¸ç®€å•</p><p>å”¯ä¸€éœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯åˆ«å¿˜äº†<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070120564.png" alt="image.png"></p><p>ç„¶åå°±æœ‰ ribbon è´Ÿè½½å‡è¡¡äº†</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070120311.png" alt="image.png"></p><p>å¯ä»¥çœ‹çš„å‡ºæ¥è¿™æ˜¯è½®è¯¢ç­–ç•¥</p><h2 id="ribbonåˆ‡æ¢ç­–ç•¥æ¨¡å¼"><a href="#ribbonåˆ‡æ¢ç­–ç•¥æ¨¡å¼" class="headerlink" title="ribbonåˆ‡æ¢ç­–ç•¥æ¨¡å¼"></a>ribbonåˆ‡æ¢ç­–ç•¥æ¨¡å¼</h2><p>å”¯ä¸€éœ€è¦æ³¨æ„çš„ä¸€ç‚¹ï¼š</p><blockquote><p>æ³¨æ„ï¼šThe CustomConfiguration clas must be a @Configuration class, but take care that it is not in a @ComponentScan for the main application context. Otherwise, it is shared by all the @RibbonClients. If you use @ComponentScan (or @SpringBootApplication), you need to take steps to avoid it being included (for instance, you can put it in a separate, non-overlapping package or specify the packages to scan explicitly in the @ComponentScan).</p></blockquote><p>å¤§æ„æ˜¯è¯´ï¼Œ<code>ribbon</code>è‡ªå®šä¹‰çš„ é…ç½®å¿…é¡»æ”¾åœ¨ <code>@SpringBootApplication</code>æ³¨è§£æˆ–è€…è¯´<code>@ComponentScan</code>æ³¨è§£<strong>èƒ½æ‰«æåˆ°çš„åŒ…ä¹‹å¤–</strong>ï¼Œå¦åˆ™ä½ è‡ªå®šä¹‰çš„é…ç½®å°†è¢«æ‰€æœ‰<code>@RibbonClients</code>æ³¨è§£å…±äº«</p><blockquote><p>ç”±äº ribbon æ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡è½åœ°æ–¹å¼çš„ä¸€ç§, æ‰€ä»¥ä»£ç çš„æ”¹é€ ä¸»è¦æ˜¯åœ¨ <code>order80(å®¢æˆ·ç«¯)</code>  é¡¹ç›®ä¸Šè¿›è¡Œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.rule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.IRule;</span><br><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.RandomRule;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySelfRule</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">myRule</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è®°ä½, ç­–ç•¥å¿…é¡»æ”¾åœ¨ springboot ä¸èƒ½æ‰«æåˆ°çš„åŒ…</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RibbonClient(value = &quot;cloud-provider-payment&quot;, configuration = &#123;MySelfRule.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain80</span></span><br></pre></td></tr></table></figure><blockquote><p><code>cloud-provider-payment</code> å°±æ˜¯ <code>8001</code> å’Œ <code>8002</code> çš„  <code>spring.application.name</code>, ä¸»è¦çš„ç›®çš„å°±æ˜¯é™å®š <code>MySelfRule</code>è´Ÿè½½å‡è¡¡ç­–ç•¥åªé’ˆå¯¹ <code>cloud-provider-payment</code> çš„æœåŠ¡æä¾›æ–¹</p></blockquote><h3 id="è¿˜æœ‰å“ªäº›è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è¿˜æœ‰å“ªäº›è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è¿˜æœ‰å“ªäº›è´Ÿè½½å‡è¡¡ç­–ç•¥?"></a>è¿˜æœ‰å“ªäº›è´Ÿè½½å‡è¡¡ç­–ç•¥?</h3><table><thead><tr><th>ç­–ç•¥åç§°</th><th>ç­–ç•¥å¯¹åº”çš„ç±»å</th><th>å®ç°åŸç†</th></tr></thead><tbody><tr><td>è½®è¯¢ç­–ç•¥ï¼ˆé»˜è®¤ï¼‰</td><td>RoundRobinRule</td><td>è½®è¯¢ç­–ç•¥è¡¨ç¤ºæ¯æ¬¡éƒ½é¡ºåºå–ä¸‹ä¸€ä¸ª providerï¼Œæ¯”å¦‚ä¸€å…±æœ‰ 5 ä¸ªproviderï¼Œç¬¬ 1 æ¬¡å–ç¬¬ 1 ä¸ªï¼Œç¬¬ 2æ¬¡å–ç¬¬ 2 ä¸ªï¼Œç¬¬ 3 æ¬¡å–ç¬¬ 3 ä¸ªï¼Œä»¥æ­¤ç±»æ¨</td></tr><tr><td>æƒé‡è½®è¯¢ç­–ç•¥</td><td>WeightedResponseTimeRule</td><td>1.æ ¹æ®æ¯ä¸ª provider çš„å“åº”æ—¶é—´åˆ†é…ä¸€ä¸ªæƒé‡ï¼Œå“åº”æ—¶é—´è¶Šé•¿ï¼Œæƒé‡è¶Šå°ï¼Œè¢«é€‰ä¸­çš„å¯èƒ½æ€§è¶Šä½ã€‚2.åŸç†ï¼šä¸€å¼€å§‹ä¸ºè½®è¯¢ç­–ç•¥ï¼Œå¹¶å¼€å¯ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œæ¯ 30 ç§’æ”¶é›†ä¸€æ¬¡æ¯ä¸ª provider çš„å¹³å‡å“åº”æ—¶é—´ï¼Œå½“ä¿¡æ¯è¶³å¤Ÿæ—¶ï¼Œç»™æ¯ä¸ª provideré™„ä¸Šä¸€ä¸ªæƒé‡ï¼Œå¹¶æŒ‰æƒé‡éšæœºé€‰æ‹©providerï¼Œé«˜æƒè¶Šé‡çš„ providerä¼šè¢«é«˜æ¦‚ç‡é€‰ä¸­ã€‚</td></tr><tr><td>éšæœºç­–ç•¥</td><td>RandomRule</td><td>ä» provider åˆ—è¡¨ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªprovider</td></tr><tr><td>æœ€å°‘å¹¶å‘æ•°ç­–ç•¥</td><td>BestAvailableRule</td><td>é€‰æ‹©æ­£åœ¨è¯·æ±‚ä¸­çš„å¹¶å‘æ•°æœ€å°çš„ providerï¼Œé™¤éè¿™ä¸ªprovider åœ¨ç†”æ–­ä¸­ã€‚</td></tr><tr><td>åœ¨â€œé€‰å®šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥â€åŸºç¡€ä¸Šè¿›è¡Œé‡è¯•æœºåˆ¶</td><td>RetryRule</td><td>1.â€œé€‰å®šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥â€è¿™ä¸ªç­–ç•¥æ˜¯è½®è¯¢ç­–ç•¥RoundRobinRule2.è¯¥é‡è¯•ç­–ç•¥å…ˆè®¾å®šä¸€ä¸ªé˜ˆå€¼æ—¶é—´æ®µï¼Œå¦‚æœåœ¨è¿™ä¸ªé˜ˆå€¼æ—¶é—´æ®µå†…å½“é€‰æ‹© provider ä¸æˆåŠŸï¼Œåˆ™ä¸€ç›´å°è¯•é‡‡ç”¨â€œé€‰å®šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼šè½®è¯¢ç­–ç•¥â€æœ€åé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„provider</td></tr><tr><td>å¯ç”¨æ€§æ•æ„Ÿç­–ç•¥</td><td>AvailabilityFilteringRule</td><td>è¿‡æ»¤æ€§èƒ½å·®çš„ provider,æœ‰ 2ç§ï¼šç¬¬ä¸€ç§ï¼šè¿‡æ»¤æ‰åœ¨ eureka ä¸­å¤„äºä¸€ç›´è¿æ¥å¤±è´¥ provider ç¬¬äºŒç§ï¼šè¿‡æ»¤æ‰é«˜å¹¶å‘çš„ provider</td></tr><tr><td>åŒºåŸŸæ•æ„Ÿæ€§ç­–ç•¥</td><td>ZoneAvoidanceRule</td><td>1.ä»¥ä¸€ä¸ªåŒºåŸŸä¸ºå•ä½è€ƒå¯Ÿå¯ç”¨æ€§ï¼Œå¯¹äºä¸å¯ç”¨çš„åŒºåŸŸæ•´ä¸ªä¸¢å¼ƒï¼Œä»å‰©ä¸‹åŒºåŸŸä¸­é€‰å¯ç”¨çš„provider2.å¦‚æœè¿™ä¸ª ip åŒºåŸŸå†…æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå®ä¾‹ä¸å¯è¾¾æˆ–å“åº”å˜æ…¢ï¼Œéƒ½ä¼šé™ä½è¯¥ ip åŒºåŸŸå†…å…¶ä»– ip è¢«é€‰ä¸­çš„æƒé‡ã€‚</td></tr></tbody></table><blockquote><p>å®é™…ä¸Šè¿˜æœ‰ä¸€éƒ¨åˆ†ç”¨äº åšæ³¨å†Œä¸­å¿ƒä¸“å±çš„è´Ÿè½½å‡è¡¡ç­–ç•¥. æ¯”å¦‚ zookeepper çš„ <img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070121861.png" alt="image.png"><br>æ¯”å¦‚ æ—§ç‰ˆæœ¬çš„ nacos ä¹Ÿæœ‰å±äºè‡ªå·±çš„ ribbon è´Ÿè½½å‡è¡¡ç­–ç•¥</p></blockquote><h1 id="LoadBalancerè´Ÿè½½å‡è¡¡"><a href="#LoadBalancerè´Ÿè½½å‡è¡¡" class="headerlink" title="LoadBalancerè´Ÿè½½å‡è¡¡"></a>LoadBalancerè´Ÿè½½å‡è¡¡</h1><h2 id="éœ€è¦çŸ¥é“ä»€ä¹ˆï¼Ÿ"><a href="#éœ€è¦çŸ¥é“ä»€ä¹ˆï¼Ÿ" class="headerlink" title="éœ€è¦çŸ¥é“ä»€ä¹ˆï¼Ÿ"></a>éœ€è¦çŸ¥é“ä»€ä¹ˆï¼Ÿ</h2><p>æ–°ç‰ˆæœ¬SpringCloudé»˜è®¤ä½¿ç”¨<code>LoadBalancer</code>çš„è´Ÿè½½å‡è¡¡ï¼Œä¸”æ˜¯é»˜è®¤ä½¿ç”¨çš„</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070121044.png" alt="image.png"></p><p>å¯åŠ¨è¿™å‡ ä¸ªé¡¹ç›®ï¼Œç„¶åè®¿é—®ï¼š<a href="http://localhost/order/payment/get/1">http://localhost/order/payment/get/1</a><br />å°±ä¼šçœ‹åˆ°<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070121547.png" alt="image.png"></p><p>ä¸Šé¢çš„ç«¯å£ä¸æ–­åœ¨ 8001 å’Œ 8002 ä¹‹é—´æ¥å› åˆ‡æ¢</p><p>å¯ä»¥å‘ç°å…¶é»˜è®¤ä½¿ç”¨çš„ä¹Ÿæ˜¯ <strong>è½®è¯¢</strong></p><p>è€Œä»–æœ¬èº«ä¹Ÿå°±æä¾›äº†ä¸¤ç§è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼š<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070121752.png" alt="image.png"></p><p>é»˜è®¤æ˜¯<code>RoundRobinLoadBalancer</code>è½®è¯¢</p><blockquote><p>å¦‚æœå¼•å…¥ nacosï¼Œè¿˜æ˜¯å¤šä¸ª <code>NacosLoadBalancer</code>æ–¹æ¡ˆ</p></blockquote><h2 id="æºç å¤§ä½“æ€è·¯"><a href="#æºç å¤§ä½“æ€è·¯" class="headerlink" title="æºç å¤§ä½“æ€è·¯"></a>æºç å¤§ä½“æ€è·¯</h2><blockquote><p>å¯ä»¥ä½¿ç”¨ idea çš„è¦†ç›–è¿è¡Œæ–¹å¼å…ˆå°† <code>order80</code>é¡¹ç›®è¿è¡Œèµ·æ¥ï¼Œç„¶åè®¿é—®ä¸‹ç½‘å€ï¼š<a href="http://localhost/order/payment/get/1">http://localhost/order/payment/get/1</a> æœ€ååœ¨å…³é—­å¾®æœåŠ¡ã€‚<br>è¿™æ ·å¯ä»¥å€ŸåŠ©<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070121281.png" alt="image.png"><br>å¯ä»¥æ›´åŠ æ–¹ä¾¿æŸ¥çœ‹æºç </p></blockquote><ol><li>ä½¿ç”¨<code>LoadBalancerInterceptorConfig</code> é…ç½®<code>LoadBalancerInterceptor</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> LoadBalancerInterceptor <span class="title function_">loadBalancerInterceptor</span><span class="params">(LoadBalancerClient loadBalancerClient,</span></span><br><span class="line"><span class="params">                                                       LoadBalancerRequestFactory requestFactory)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoadBalancerInterceptor</span>(loadBalancerClient, requestFactory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><code>ClientHttpRequestInterceptor</code>å®ç°çš„<code>LoadBalancerInterceptor</code>æ‹¦æˆªå™¨æ‹¦æˆªä¸‹è¯·æ±‚</li><li><code>LoadBalancerInterceptor</code>æ¥å£ä¼šæ‹¦æˆªå®¢æˆ·ç«¯ http è¯·æ±‚</li><li><code>LoadBalancerInterceptor</code>å†…çš„æ‹¦æˆªå™¨æºç ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ClientHttpResponse <span class="title function_">intercept</span><span class="params">(<span class="keyword">final</span> HttpRequest request, <span class="keyword">final</span> <span class="type">byte</span>[] body,</span></span><br><span class="line"><span class="params">                                    <span class="keyword">final</span> ClientHttpRequestExecution execution)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">URI</span> <span class="variable">originalUri</span> <span class="operator">=</span> request.getURI();</span><br><span class="line">    <span class="type">String</span> <span class="variable">serviceName</span> <span class="operator">=</span> originalUri.getHost();</span><br><span class="line">    Assert.state(serviceName != <span class="literal">null</span>, <span class="string">&quot;Request URI does not contain a valid hostname: &quot;</span> + originalUri);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.loadBalancer.execute(serviceName, <span class="built_in">this</span>.requestFactory.createRequest(request, body, execution));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>æœ€ç»ˆä»£ç èµ°åˆ°æ ¸å¿ƒæ¥å£<code>LoadBalancerClient</code>ï¼Œæ ¸å¿ƒç±»<code>BlockingLoadBalancerClient</code></li><li>ç„¶åæ˜¯æ ¸å¿ƒä»£ç æ®µï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(String serviceId, LoadBalancerRequest&lt;T&gt; request)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">hint</span> <span class="operator">=</span> getHint(serviceId);</span><br><span class="line">    LoadBalancerRequestAdapter&lt;T, TimedRequestContext&gt; lbRequest = <span class="keyword">new</span> <span class="title class_">LoadBalancerRequestAdapter</span>&lt;&gt;(request,</span><br><span class="line">                                                                                                    buildRequestContext(request, hint));</span><br><span class="line">    Set&lt;LoadBalancerLifecycle&gt; supportedLifecycleProcessors = getSupportedLifecycleProcessors(serviceId);</span><br><span class="line">    supportedLifecycleProcessors.forEach(lifecycle -&gt; lifecycle.onStart(lbRequest));</span><br><span class="line">    <span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> choose(serviceId, lbRequest);</span><br><span class="line">    <span class="keyword">return</span> execute(serviceId, serviceInstance, lbRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€ä¹ˆè‡ªå®šä¹‰ï¼Ÿ"><a href="#æ€ä¹ˆè‡ªå®šä¹‰ï¼Ÿ" class="headerlink" title="æ€ä¹ˆè‡ªå®šä¹‰ï¼Ÿ"></a>æ€ä¹ˆè‡ªå®šä¹‰ï¼Ÿ</h2><p>é¦–å…ˆå¦‚æœéœ€è¦è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œéœ€è¦æŸ¥çœ‹ï¼š<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070121173.png" alt="image.png"></p><p>æˆ‘ä»¬å¯ä»¥æ•ˆä»¿ä¸Šé¢ä¸¤ä¸ªå·²ç»å®ç°çš„ç±»è‡ªå®šä¹‰ä¸€ä¸ªæ–°çš„è´Ÿè½½å‡è¡¡ç­–ç•¥</p><p>ç›´æ¥å¤åˆ¶<code>RandomLoadBalancer</code>ç„¶åè¿›è¡Œä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySelfRule</span> <span class="keyword">implements</span> <span class="title class_">ReactorServiceInstanceLoadBalancer</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> String serviceId;</span><br><span class="line">ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MySelfRule</span><span class="params">(String serviceId, ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.serviceId = serviceId;</span><br><span class="line"><span class="built_in">this</span>.serviceInstanceListSupplierProvider = serviceInstanceListSupplierProvider;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Response&lt;ServiceInstance&gt;&gt; <span class="title function_">choose</span><span class="params">(Request request)</span> &#123;</span><br><span class="line"><span class="type">ServiceInstanceListSupplier</span> <span class="variable">supplier</span> <span class="operator">=</span> serviceInstanceListSupplierProvider</span><br><span class="line">.getIfAvailable(NoopServiceInstanceListSupplier::<span class="keyword">new</span>);</span><br><span class="line"><span class="keyword">return</span> supplier.get(request).next()</span><br><span class="line">.map(serviceInstances -&gt; processInstanceResponse(supplier, serviceInstances));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Response&lt;ServiceInstance&gt; <span class="title function_">processInstanceResponse</span><span class="params">(ServiceInstanceListSupplier supplier,</span></span><br><span class="line"><span class="params">  List&lt;ServiceInstance&gt; serviceInstances)</span> &#123;</span><br><span class="line">Response&lt;ServiceInstance&gt; serviceInstanceResponse = getInstanceResponse(serviceInstances);</span><br><span class="line"><span class="keyword">if</span> (supplier <span class="keyword">instanceof</span> SelectedInstanceCallback &amp;&amp; serviceInstanceResponse.hasServer()) &#123;</span><br><span class="line">((SelectedInstanceCallback) supplier).selectedServiceInstance(serviceInstanceResponse.getServer());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> serviceInstanceResponse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>[] arr = &#123;<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">5</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Response&lt;ServiceInstance&gt; <span class="title function_">getInstanceResponse</span><span class="params">(List&lt;ServiceInstance&gt; instances)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (instances.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">if</span> (log.isWarnEnabled()) &#123;</span><br><span class="line">log.warn(<span class="string">&quot;No servers available for service: &quot;</span> + serviceId);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmptyResponse</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> ThreadLocalRandom.current().nextInt(arr.length);</span><br><span class="line"><span class="type">ServiceInstance</span> <span class="variable">instance</span> <span class="operator">=</span> instances.get(arr[index] % instances.size());</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultResponse</span>(instance);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒç®—æ³•éšä¾¿å†™çš„ï¼Œå°±ä¸‰è¡Œä»£ç <br /><code>private int[] arr = &#123;3, 1, 4, 1, 5, 9, 2, 6, 5&#125;;</code><br /><code>int index = ThreadLocalRandom.current().nextInt(arr.length);</code><br /><code>ServiceInstance instance = instances.get(arr[index] % instances.size());</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRuleConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ReactorServiceInstanceLoadBalancer <span class="title function_">reactorServiceInstanceLoadBalancer</span><span class="params">(Environment environment, LoadBalancerClientFactory loadBalancerClientFactory)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MySelfRule</span>(name, loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è®°ä½ï¼šè¿™é‡Œä¸è¦æ·»åŠ æ³¨è§£ <code>@Configuration</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@LoadBalancerClient(name = &quot;CLOUD-PAYMENT-SERVICE&quot;, configuration = MyRuleConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain80</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(OrderMain80.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="nacoså’Œloadbalancer"><a href="#nacoså’Œloadbalancer" class="headerlink" title="nacoså’Œloadbalancer"></a>nacoså’Œloadbalancer</h2><h3 id="æœåŠ¡çš„æä¾›è€…"><a href="#æœåŠ¡çš„æä¾›è€…" class="headerlink" title="æœåŠ¡çš„æä¾›è€…"></a>æœåŠ¡çš„æä¾›è€…</h3><p>åˆ›å»ºä¸¤ä¸ªé¡¹ç›®ï¼š<code>cloud-provider02-payment8001</code>å’Œ<code>cloud-provider02-payment8002</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>application.yml</code>: <code>8001</code>é¡¹ç›®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span>            <span class="comment"># å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span>             <span class="comment"># mysqlé©±åŠ¨åŒ…</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line"><span class="comment">#        namespace: public</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.zhazha.springcloud.entities</span>    <span class="comment"># æ‰€æœ‰Entityåˆ«åç±»æ‰€åœ¨åŒ…</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p><code>application.yml</code>: <code>8002</code>é¡¹ç›®çš„é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8002</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span>            <span class="comment"># å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span>             <span class="comment"># mysqlé©±åŠ¨åŒ…</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line"><span class="comment">#        namespace: public</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.zhazha.springcloud.entities</span>    <span class="comment"># æ‰€æœ‰Entityåˆ«åç±»æ‰€åœ¨åŒ…</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(value = &quot;com.zhazha.springcloud.dao&quot;)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8001_2</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(PaymentMain8001_2.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.springcloud.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.SelectProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentDao</span> &#123;</span><br><span class="line"><span class="meta">@Insert(&quot;insert into payment(serial) values (#&#123;serial&#125;)&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">create</span><span class="params">(Payment payment)</span>;</span><br><span class="line"><span class="comment">//@Select(&quot;select * from payment p where p.id = #&#123;id&#125;&quot;)</span></span><br><span class="line">Payment <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SelectProvider(type = PaymentProvider.class, method = &quot;getAll&quot;)</span></span><br><span class="line">List&lt;Payment&gt; <span class="title function_">getAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.springcloud.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.jdbc.SQL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentProvider</span> &#123;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getAll</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>().SELECT(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">.FROM(<span class="string">&quot;payment&quot;</span>).toString();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.entities.Payment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="title function_">create</span><span class="params">(Payment payment)</span>;</span><br><span class="line">Payment <span class="title function_">getPaymentById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.springcloud.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.dao.PaymentDao;</span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> PaymentDao paymentDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> paymentDao.create(payment);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Payment <span class="title function_">getPaymentById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> paymentDao.getPaymentById(id);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.utils.CommonResult;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.ServiceInstance;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.DiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;payment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›ç»™å‰ç«¯çš„ç»“æœé›†</span></span><br><span class="line"><span class="comment"> * ä¸‹é¢çš„ RequestBody æ³¨è§£å¦‚æœä¸åŠ ä¸Šï¼Œ restTemplate çš„ postForObject å°†æ— æ³•ä¿å­˜å‚æ•°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> payment</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(value = &quot;create&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> Payment payment)</span> &#123;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.create(payment);</span><br><span class="line">log.info(<span class="string">&quot;******æ’å…¥ç»“æœï¼š&quot;</span> + result);</span><br><span class="line"><span class="keyword">if</span> (result &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;æ’å…¥æ•°æ®åº“æˆåŠŸ port: &quot;</span> + serverPort, result);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;æ’å…¥æ•°æ®åº“å¤±è´¥&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;get/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">getPaymentByID</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line"><span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> paymentService.getPaymentById(id);</span><br><span class="line">log.info(<span class="string">&quot;******æ’å…¥ç»“æœï¼š&quot;</span> + payment);</span><br><span class="line"><span class="keyword">if</span> (payment != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;æŸ¥è¯¢æˆåŠŸ port: &quot;</span> + serverPort, payment);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;æ²¡æœ‰æŸ¥è¯¢è®°å½•&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;discovery&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">discovery</span><span class="params">()</span> &#123;</span><br><span class="line">List&lt;String&gt; services = <span class="built_in">this</span>.discoveryClient.getServices();</span><br><span class="line"><span class="keyword">for</span> (String service : services) &#123;</span><br><span class="line">log.info(<span class="string">&quot;*********** service: &quot;</span> + service);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (ServiceInstance instance : instances) &#123;</span><br><span class="line">log.info(<span class="string">&quot;service application host = &#123;&#125;, port = &#123;&#125;, uri = &#123;&#125;&quot;</span>, instance.getHost(), instance.getPort(), instance.getUri());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.discoveryClient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.zhazha.springcloud.dao.PaymentDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;payment&quot;</span> <span class="attr">id</span>=<span class="string">&quot;PaymentMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;serial&quot;</span> <span class="attr">column</span>=<span class="string">&quot;serial&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getPaymentById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;PaymentMap&quot;</span>&gt;</span></span><br><span class="line">        select * from payment p where p.id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡çš„æ¶ˆè´¹è€…"><a href="#æœåŠ¡çš„æ¶ˆè´¹è€…" class="headerlink" title="æœåŠ¡çš„æ¶ˆè´¹è€…"></a>æœåŠ¡çš„æ¶ˆè´¹è€…</h3><p>åˆ›å»ºé¡¹ç›®ï¼š<code>cloud-consumer02-order80</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>application.yml</code>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-order-service02</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">&#x27;127.0.0.1:8848&#x27;</span></span><br><span class="line"><span class="comment">#      server-addr: 192.168.133.128:8847  #é›†ç¾¤ nginx è´Ÿè½½å‡è¡¡è®¿é—® nacos</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line"><span class="comment">#        namespace: public</span></span><br><span class="line"><span class="comment">#    loadbalancer:</span></span><br><span class="line"><span class="comment">#      enabled: true</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.rule.LoadBalancerConfig;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.loadbalancer.annotation.LoadBalancerClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@LoadBalancerClient(configuration = LoadBalancerConfig.class, value = &quot;cloud-payment-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain80_2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        SpringApplication.run(OrderMain80_2.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.zhazha.springcloud.utils.CommonResult;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"><span class="comment">//å®šä¹‰æœåŠ¡ç«¯URL</span></span><br><span class="line"><span class="comment">//public static final String PAYMENT_URL = &quot;http://localhost:8001&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å¾®æœåŠ¡çš„åå­—</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://cloud-payment-service&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®¢æˆ·ç«¯é€šè¿‡RestTemplateè°ƒç”¨æœåŠ¡ç«¯</span></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;payment/create&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> restTemplate.postForObject(PAYMENT_URL + <span class="string">&quot;/payment/create&quot;</span>, payment, CommonResult.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰<code>Rule</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.rule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.loadbalancer.core.RandomLoadBalancer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.loadbalancer.core.ReactorServiceInstanceLoadBalancer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.loadbalancer.core.ServiceInstanceListSupplier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.loadbalancer.support.LoadBalancerClientFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoadBalancerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ReactorServiceInstanceLoadBalancer <span class="title function_">loadBalancer</span><span class="params">(Environment environment, LoadBalancerClientFactory loadBalancerClientFactory)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomLoadBalancer</span>(loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070121863.png" alt="image.png"></p><p>æˆåŠŸäº†</p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è´Ÿè½½å‡è¡¡ </tag>
            
            <tag> nacos </tag>
            
            <tag> Ribbon </tag>
            
            <tag> LoadBalancer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>03spring-cloudæ•´åˆdubboä½¿ç”¨nacosåšæ³¨å†Œä¸­å¿ƒ</title>
      <link href="/2022/11/07/02springcloud/03spring-cloud%E6%95%B4%E5%90%88dubbo%E4%BD%BF%E7%94%A8nacos%E5%81%9A%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"/>
      <url>/2022/11/07/02springcloud/03spring-cloud%E6%95%B4%E5%90%88dubbo%E4%BD%BF%E7%94%A8nacos%E5%81%9A%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/</url>
      
        <content type="html"><![CDATA[<h1 id="nacoså®‰è£…å’Œå…¥é—¨"><a href="#nacoså®‰è£…å’Œå…¥é—¨" class="headerlink" title="nacoså®‰è£…å’Œå…¥é—¨"></a>nacoså®‰è£…å’Œå…¥é—¨</h1><p><a href="https://juejin.cn/post/7119484969621127205">nacosç®€å•å…¥ä¸ªé—¨</a></p><h1 id="nacos-éœ€è¦å‡†å¤‡çš„åœ°æ–¹"><a href="#nacos-éœ€è¦å‡†å¤‡çš„åœ°æ–¹" class="headerlink" title="nacos éœ€è¦å‡†å¤‡çš„åœ°æ–¹"></a>nacos éœ€è¦å‡†å¤‡çš„åœ°æ–¹</h1><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070118320.png" alt="image.png"></p><h1 id="åˆ›å»ºçˆ¶å·¥ç¨‹"><a href="#åˆ›å»ºçˆ¶å·¥ç¨‹" class="headerlink" title="åˆ›å»ºçˆ¶å·¥ç¨‹"></a>åˆ›å»ºçˆ¶å·¥ç¨‹</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-nacos-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>spring-cloud-nacos-dubbo-producer<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>spring-cloud-nacos-dubbo-api<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>spring-cloud-nacos-dubbo-consumer<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>nacos-discovery-spring-boot-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="åˆ›å»º-api-é¡¹ç›®"><a href="#åˆ›å»º-api-é¡¹ç›®" class="headerlink" title="åˆ›å»º api é¡¹ç›®"></a>åˆ›å»º api é¡¹ç›®</h1><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070118652.png" alt="image.png"></p><p>è¿™ä¸ªé¡¹ç›®ä¸»è¦æ˜¯ç»™æœåŠ¡çš„æä¾›æ–¹å’Œæ¶ˆè´¹æ–¹æä¾›ä¸€ä¸ªå…¬å…±çš„æ¥å£åè®®ï¼ˆæ¥å£å‚æ•°ï¼‰</p><h1 id="æœåŠ¡çš„æä¾›æ–¹"><a href="#æœåŠ¡çš„æä¾›æ–¹" class="headerlink" title="æœåŠ¡çš„æä¾›æ–¹"></a>æœåŠ¡çš„æä¾›æ–¹</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-nacos-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-nacos-dubbo-producer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-nacos-dubbo-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>bootstrap.yml</code> è¿™ä¸ªæ–‡ä»¶ä¸»è¦ç»™åæœŸå°†æˆ‘ä»¬çš„ <code>application.yml</code>é…ç½®ä¸Šä¼ åˆ° <code>nacos</code>ä¸Š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br></pre></td></tr></table></figure><p><code>application.yml</code> </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">allow-bean-definition-overriding:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">allow-circular-references:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-producer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="comment"># è¿™ä¸ªåªèƒ½ä¿®æ”¹ dubbo-producer æ³¨å†Œåˆ° nacosçš„åˆ†ç»„ï¼Œä¸ä¼šä¿®æ”¹ dubbo æ³¨å†Œåˆ° nacos çš„åˆ†ç»„</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br><span class="line">        <span class="comment"># è¿™ä¸ªåªèƒ½ä¿®æ”¹ dubbo-producer æ³¨å†Œåˆ° nacos çš„åˆ†ç»„ï¼Œä¸ä¼šä¿®æ”¹dubboæ³¨å†Œåˆ° nacos çš„åˆ†ç»„</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">spring-cloud</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">scan:</span></span><br><span class="line">    <span class="attr">base-packages:</span> <span class="string">com.zhazha.producer.service.impl</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="comment"># dubbo åè®®åç§°</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span></span><br><span class="line">    <span class="comment"># dubbo åè®®ç«¯å£ï¼ˆ -1 è¡¨ç¤ºè‡ªå¢ç«¯å£ï¼Œä» 20880 å¼€å§‹ï¼‰</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">-1</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">nacos://127.0.0.1:8848</span></span><br><span class="line">    <span class="comment"># ä¿®æ”¹ dubbo åœ¨ nacos ä¸Šçš„å‘½åç©ºé—´</span></span><br><span class="line">    <span class="string">parameters[namespace]:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br><span class="line">    <span class="comment"># ä¿®æ”¹ dubbo åœ¨ nacos ä¸Šçš„åˆ†ç»„</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">spring-cloud</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># å…³é—­ dubbo åœ¨çº¿è¿ç»´åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½ä¸»è¦é€šè¿‡ telnet æ–¹å¼è¿›è¡ŒæœåŠ¡çš„æƒé‡è°ƒæ•´</span></span><br><span class="line">    <span class="attr">qos-enable:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„çœ‹æ³¨é‡Šçš„åœ°æ–¹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.producer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosDubboProducerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(NacosDubboProducerApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.producer.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.api.HelloService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.DubboService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DubboService</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">sayHi</span><span class="params">()</span> &#123;</span><br><span class="line">log.info(<span class="string">&quot;nacos-dubbo-producer&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;nacos-dubbo-producer&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡çš„æä¾›æ–¹æ­¥éª¤ç»“æŸ</p><h1 id="æœåŠ¡çš„æ¶ˆè´¹æ–¹"><a href="#æœåŠ¡çš„æ¶ˆè´¹æ–¹" class="headerlink" title="æœåŠ¡çš„æ¶ˆè´¹æ–¹"></a>æœåŠ¡çš„æ¶ˆè´¹æ–¹</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-nacos-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-nacos-dubbo-consumer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-nacos-dubbo-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>bootstrap.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br></pre></td></tr></table></figure><p><code>application.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">allow-bean-definition-overriding:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">allow-circular-references:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="comment"># è¿™ä¸ªåªèƒ½ä¿®æ”¹ dubbo-producer æ³¨å†Œåˆ° nacosçš„åˆ†ç»„ï¼Œä¸ä¼šä¿®æ”¹ dubbo æ³¨å†Œåˆ° nacos çš„åˆ†ç»„</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br><span class="line">        <span class="comment"># è¿™ä¸ªåªèƒ½ä¿®æ”¹ dubbo-producer æ³¨å†Œåˆ° nacos çš„åˆ†ç»„ï¼Œä¸ä¼šä¿®æ”¹dubboæ³¨å†Œåˆ° nacos çš„åˆ†ç»„</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">spring-cloud</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line"><span class="attr">dubbo:</span></span><br><span class="line"><span class="comment">#  scan:</span></span><br><span class="line"><span class="comment">#    base-packages: com.zhazha.producer.service.impl</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="comment"># dubbo åè®®åç§°</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span></span><br><span class="line">    <span class="comment"># dubbo åè®®ç«¯å£ï¼ˆ -1 è¡¨ç¤ºè‡ªå¢ç«¯å£ï¼Œä» 20880 å¼€å§‹ï¼‰</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">-1</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">nacos://127.0.0.1:8848</span></span><br><span class="line">    <span class="comment"># ä¿®æ”¹ dubbo åœ¨ nacos ä¸Šçš„å‘½åç©ºé—´</span></span><br><span class="line">    <span class="string">parameters[namespace]:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br><span class="line">    <span class="comment"># ä¿®æ”¹ dubbo åœ¨ nacos ä¸Šçš„åˆ†ç»„</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">spring-cloud</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># å…³é—­ dubbo åœ¨çº¿è¿ç»´åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½ä¸»è¦é€šè¿‡ telnet æ–¹å¼è¿›è¡ŒæœåŠ¡çš„æƒé‡è°ƒæ•´</span></span><br><span class="line">    <span class="attr">qos-enable:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ä¸Šé¢æ³¨é‡Šçš„åœ°æ–¹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosDubboConsumerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(NacosDubboConsumerApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.consumer.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhazha.api.HelloService;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.DubboReference;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DubboController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DubboReference</span></span><br><span class="line"><span class="keyword">private</span> HelloService helloService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;sayHi&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">sayHi</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> helloService.sayHi();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¡¹ç›®éœ€è¦å‡†å¤‡çš„å°±è¿™äº›äº†</p><p>è°ƒç”¨æˆåŠŸï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070118727.png" alt="image.png"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070119107.png" alt="image.png"></p><p>åŒæ—¶ <code>dubbo </code>ä¹Ÿä¼šåœ¨ é…ç½®ä¸­å¿ƒè®°å½•ä¸€äº›æ•°æ®</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070119972.png" alt="image.png"></p><h1 id="é…ç½®ä¸Šä¼ åˆ°-nacos"><a href="#é…ç½®ä¸Šä¼ åˆ°-nacos" class="headerlink" title="é…ç½®ä¸Šä¼ åˆ° nacos"></a>é…ç½®ä¸Šä¼ åˆ° <code>nacos</code></h1><p>ç°åœ¨å°†<code>application.yml</code>å†…çš„å†…å®¹ä¸Šä¼ åˆ° <code>nacos</code>é…ç½®ä¸­å¿ƒä¸Š</p><h2 id="åˆ›å»ºä¸“ç”¨äºé…ç½®çš„å‘½åç©ºé—´"><a href="#åˆ›å»ºä¸“ç”¨äºé…ç½®çš„å‘½åç©ºé—´" class="headerlink" title="åˆ›å»ºä¸“ç”¨äºé…ç½®çš„å‘½åç©ºé—´"></a>åˆ›å»ºä¸“ç”¨äºé…ç½®çš„å‘½åç©ºé—´</h2><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070119619.png" alt="image.png"></p><h2 id="æä¾›æ–¹é…ç½®ä¿®æ”¹"><a href="#æä¾›æ–¹é…ç½®ä¿®æ”¹" class="headerlink" title="æä¾›æ–¹é…ç½®ä¿®æ”¹"></a>æä¾›æ–¹é…ç½®ä¿®æ”¹</h2><blockquote><p>å¿˜è®° <code>dubbo</code> ä¼šå ç”¨é…ç½®ä¸­å¿ƒäº†ï¼Œæ‰€ä»¥å¦å¤–æ–°å»ºä¸€ä¸ªï¼Œ</p></blockquote><p><code>bootstrap.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-producer</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">allow-bean-definition-overriding:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">allow-circular-references:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">de98a7a1-8814-44c5-a635-e19872132371</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br></pre></td></tr></table></figure><p><code>application.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><p>å»æ–°å»ºé…ç½®ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070119938.png" alt="image.png"></p><p><code>dubbo-producer.yaml</code>å¡«å…¥å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-producer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="comment"># è¿™ä¸ªåªèƒ½ä¿®æ”¹ dubbo-producer æ³¨å†Œåˆ° nacosçš„åˆ†ç»„ï¼Œä¸ä¼šä¿®æ”¹ dubbo æ³¨å†Œåˆ° nacos çš„åˆ†ç»„</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br><span class="line">        <span class="comment"># è¿™ä¸ªåªèƒ½ä¿®æ”¹ dubbo-producer æ³¨å†Œåˆ° nacos çš„åˆ†ç»„ï¼Œä¸ä¼šä¿®æ”¹dubboæ³¨å†Œåˆ° nacos çš„åˆ†ç»„</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">spring-cloud</span></span><br><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">scan:</span></span><br><span class="line">    <span class="attr">base-packages:</span> <span class="string">com.zhazha.producer.service.impl</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="comment"># dubbo åè®®åç§°</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span></span><br><span class="line">    <span class="comment"># dubbo åè®®ç«¯å£ï¼ˆ -1 è¡¨ç¤ºè‡ªå¢ç«¯å£ï¼Œä» 20880 å¼€å§‹ï¼‰</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">-1</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">nacos://127.0.0.1:8848</span></span><br><span class="line">    <span class="comment"># ä¿®æ”¹ dubbo åœ¨ nacos ä¸Šçš„å‘½åç©ºé—´</span></span><br><span class="line">    <span class="string">parameters[namespace]:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br><span class="line">    <span class="comment"># ä¿®æ”¹ dubbo åœ¨ nacos ä¸Šçš„åˆ†ç»„</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">spring-cloud</span></span><br></pre></td></tr></table></figure><h2 id="æ¶ˆè´¹æ–¹é…ç½®ä¿®æ”¹"><a href="#æ¶ˆè´¹æ–¹é…ç½®ä¿®æ”¹" class="headerlink" title="æ¶ˆè´¹æ–¹é…ç½®ä¿®æ”¹"></a>æ¶ˆè´¹æ–¹é…ç½®ä¿®æ”¹</h2><p><code>bootstrap.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-consumer</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">allow-bean-definition-overriding:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">allow-circular-references:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">de98a7a1-8814-44c5-a635-e19872132371</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br></pre></td></tr></table></figure><p><code>application.yml</code> </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure><p>åœ¨nacosä¸Šåˆ›å»º<code>dubbo-consumer.yaml</code></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070119750.png" alt="image.png"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="comment"># è¿™ä¸ªåªèƒ½ä¿®æ”¹ dubbo-producer æ³¨å†Œåˆ° nacosçš„åˆ†ç»„ï¼Œä¸ä¼šä¿®æ”¹ dubbo æ³¨å†Œåˆ° nacos çš„åˆ†ç»„</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br><span class="line">        <span class="comment"># è¿™ä¸ªåªèƒ½ä¿®æ”¹ dubbo-producer æ³¨å†Œåˆ° nacos çš„åˆ†ç»„ï¼Œä¸ä¼šä¿®æ”¹dubboæ³¨å†Œåˆ° nacos çš„åˆ†ç»„</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">spring-cloud</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line"><span class="attr">dubbo:</span></span><br><span class="line"><span class="comment">#  scan:</span></span><br><span class="line"><span class="comment">#    base-packages: com.zhazha.producer.service.impl</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="comment"># dubbo åè®®åç§°</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span></span><br><span class="line">    <span class="comment"># dubbo åè®®ç«¯å£ï¼ˆ -1 è¡¨ç¤ºè‡ªå¢ç«¯å£ï¼Œä» 20880 å¼€å§‹ï¼‰</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">-1</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">nacos://127.0.0.1:8848</span></span><br><span class="line">    <span class="comment"># ä¿®æ”¹ dubbo åœ¨ nacos ä¸Šçš„å‘½åç©ºé—´</span></span><br><span class="line">    <span class="string">parameters[namespace]:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br><span class="line">    <span class="comment"># ä¿®æ”¹ dubbo åœ¨ nacos ä¸Šçš„åˆ†ç»„</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">spring-cloud</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># å…³é—­ dubbo åœ¨çº¿è¿ç»´åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½ä¸»è¦é€šè¿‡ telnet æ–¹å¼è¿›è¡ŒæœåŠ¡çš„æƒé‡è°ƒæ•´</span></span><br><span class="line">    <span class="attr">qos-enable:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>æœ€å<br /><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070119984.png" alt="image.png"></p><blockquote><p>å‰é¢çš„å…¥é—¨ç¯‡å·²ç»è®²è¿‡äº†ï¼Œnacosé…ç½®ä¸­å¿ƒçš„åå­—å¿…é¡»æ€æ ·ï¼Œå›åˆ°å…¥é—¨ç¯‡å»çœ‹<br><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070119862.png" alt="image.png"></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœåŠ¡å‘ç° </tag>
            
            <tag> æ³¨å†Œä¸­å¿ƒ </tag>
            
            <tag> æœåŠ¡æ³¨å†Œ </tag>
            
            <tag> nacos </tag>
            
            <tag> CAP </tag>
            
            <tag> æœåŠ¡æ¶ˆè´¹æ–¹ </tag>
            
            <tag> æœåŠ¡æä¾›æ–¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02-nacoså…¥é—¨</title>
      <link href="/2022/11/07/02springcloud/02-nacos%E5%85%A5%E9%97%A8/"/>
      <url>/2022/11/07/02springcloud/02-nacos%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="nacoså­¦ä¹ "><a href="#nacoså­¦ä¹ " class="headerlink" title="nacoså­¦ä¹ "></a><code>nacos</code>å­¦ä¹ </h1><h2 id="ä¸€ã€nacosæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€nacosæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€nacosæ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€<code>nacos</code>æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><code>Nacos</code> è‹±æ–‡å…¨ç§°ä¸º <code>Dynamic Naming and Configuration Service</code>ï¼Œæ˜¯ä¸€ä¸ªç”±é˜¿é‡Œå·´å·´å›¢é˜Ÿä½¿ç”¨ Java è¯­è¨€å¼€å‘çš„å¼€æºé¡¹ç›®ã€‚</p><p><code>Nacos</code> æ˜¯ä¸€ä¸ªæ›´æ˜“äºå¸®åŠ©æ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€<strong>æœåŠ¡å‘ç°</strong>ã€<strong>é…ç½®ç®¡ç†</strong>å’Œ<strong>æœåŠ¡ç®¡ç†</strong>å¹³å°ï¼ˆå‚è€ƒè‡ª <a href="https://nacos.io/zh-cn/index.html">Nacos å®˜ç½‘</a>ï¼‰ã€‚</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070115461.png" alt="image.png"></p><blockquote><p>æ€»ç»“ä¸‹æ¥ä¸»è¦åšä¸‰ä»¶äº‹ï¼š</p><ol><li>åŠ¨æ€æœåŠ¡å‘ç°</li><li>æœåŠ¡ç®¡ç†</li><li>é…ç½®ç®¡ç†</li></ol></blockquote><h3 id="nacos-åå­—çš„ç”±æ¥ï¼ˆäº†è§£ï¼‰"><a href="#nacos-åå­—çš„ç”±æ¥ï¼ˆäº†è§£ï¼‰" class="headerlink" title="nacos åå­—çš„ç”±æ¥ï¼ˆäº†è§£ï¼‰"></a><code>nacos </code>åå­—çš„ç”±æ¥ï¼ˆäº†è§£ï¼‰</h3><p><code>Nacos</code> çš„å‘½åæ˜¯ç”± 3 éƒ¨åˆ†ç»„æˆï¼š</p><table><thead><tr><th>ç»„æˆéƒ¨åˆ†</th><th>å…¨ç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>Na</code></td><td><code>naming/nameServer</code></td><td>å³æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œä¸ <code>Spring Cloud Eureka</code><br /> çš„åŠŸèƒ½ç±»ä¼¼ã€‚</td></tr><tr><td><code>co</code></td><td><code>configuration</code></td><td>å³é…ç½®ä¸­å¿ƒï¼Œä¸ <code>Spring Cloud Config</code><br />+<code>Spring Cloud Bus</code><br /> çš„åŠŸèƒ½ç±»ä¼¼ã€‚</td></tr><tr><td><code>s</code></td><td><code>service</code></td><td>å³æœåŠ¡ï¼Œè¡¨ç¤º <code>Nacos</code><br /> å®ç°çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒéƒ½æ˜¯ä»¥æœåŠ¡ä¸ºæ ¸å¿ƒçš„ã€‚</td></tr></tbody></table><p>æˆ‘ä»¬å¯ä»¥å°† <code>Nacos</code> ç†è§£æˆæœåŠ¡æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒçš„ç»„åˆä½“ï¼Œå®ƒå¯ä»¥æ›¿æ¢ <a href="http://m.biancheng.net/springcloud/eureka.html">Eureka</a> ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œå®ç°æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ï¼›è¿˜å¯ä»¥æ›¿æ¢ <a href="http://m.biancheng.net/springcloud/config.html">Spring Cloud Config</a> ä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œå®ç°é…ç½®çš„åŠ¨æ€åˆ·æ–°ã€‚</p><p><code>Nacos</code> ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒç»å†äº†åå¹´â€œåŒåä¸€â€çš„æ´ªå³°è€ƒéªŒï¼Œå…·æœ‰ç®€å•æ˜“ç”¨ã€ç¨³å®šå¯é ã€æ€§èƒ½å“è¶Šç­‰ä¼˜ç‚¹ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´æ•æ·ã€å®¹æ˜“åœ°æ„å»ºå’Œç®¡ç†å¾®æœåŠ¡åº”ç”¨ã€‚</p><p><code>Nacos</code> æ”¯æŒå‡ ä¹æ‰€æœ‰ä¸»æµç±»å‹â€œæœåŠ¡â€çš„å‘ç°ã€é…ç½®å’Œç®¡ç†ï¼š</p><ul><li><a href="https://kubernetes.io/docs/concepts/services-networking/service/">Kubernetes Service</a></li><li><a href="https://grpc.io/docs/what-is-grpc/core-concepts#service-definition">gRPC </a>&amp; <a href="https://dubbo.apache.org/zh/">Dubbo RPC Service</a></li><li><code>Spring Cloud RESTful Service</code></li></ul><p>è½¬è½½è‡ªï¼š<a href="http://m.biancheng.net/springcloud/nacos.html">Nacosï¼šSpring Cloud AlibabaæœåŠ¡æ³¨å†Œä¸é…ç½®ä¸­å¿ƒï¼ˆéå¸¸è¯¦ç»†ï¼‰ (biancheng.net)</a></p><p><img src="https://nacos.io/img/nacosMap.jpg#crop=0&crop=0&crop=1&crop=1&id=BJikK&originHeight=1198&originWidth=1880&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="></p><h2 id="äºŒã€ä¸ºä»€ä¹ˆä½¿ç”¨Nacosï¼Ÿ"><a href="#äºŒã€ä¸ºä»€ä¹ˆä½¿ç”¨Nacosï¼Ÿ" class="headerlink" title="äºŒã€ä¸ºä»€ä¹ˆä½¿ç”¨Nacosï¼Ÿ"></a>äºŒã€ä¸ºä»€ä¹ˆä½¿ç”¨<code>Nacos</code>ï¼Ÿ</h2><blockquote><p>æˆ–è€…è¯´ <code>nacos</code> æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</p></blockquote><ol><li><code>eureka 2.0</code>é—­æº </li><li>å¼€ç®±å³ç”¨ï¼Œä¸Šæ‰‹ç®€æ´ï¼Œæš‚æ—¶ä¹Ÿæ²¡å‘ç°æœ‰å¤ªå¤§çš„å‘ </li><li><code>nacos</code>ä½¿ç”¨çš„<code>raft</code>åè®®,<code>nacos</code>é›†ç¾¤çš„ä¸€è‡´æ€§è¦è¿œå¤§äº<code>eureka</code>é›†ç¾¤ </li><li>å› ä¸º<code>nacos</code>åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œç¤¾åŒºæ›´åŠ æ´»è·ƒ </li><li>èƒŒé å›½å†…å¤§å‚ï¼ˆç»å—åŒåä¸€çš„è€ƒéªŒï¼‰ï¼Œä¸­è‹±æ–‡æ–‡æ¡£ </li><li>ç•Œé¢ç¾è§‚ </li><li>æ”¯æŒ <code>k8s</code></li></ol><h2 id="ä¸‰ã€nacosçš„æ¶æ„"><a href="#ä¸‰ã€nacosçš„æ¶æ„" class="headerlink" title="ä¸‰ã€nacosçš„æ¶æ„"></a>ä¸‰ã€<code>nacos</code>çš„æ¶æ„</h2><h3 id="åŸºæœ¬æ¶æ„åŠæ¦‚å¿µï¼ˆäº†è§£ï¼‰"><a href="#åŸºæœ¬æ¶æ„åŠæ¦‚å¿µï¼ˆäº†è§£ï¼‰" class="headerlink" title="åŸºæœ¬æ¶æ„åŠæ¦‚å¿µï¼ˆäº†è§£ï¼‰"></a>åŸºæœ¬æ¶æ„åŠæ¦‚å¿µï¼ˆäº†è§£ï¼‰</h3><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070116664.jpeg"></p><p>è¿™å¼ å›¾é€šè¿‡ä¸‰ä¸ªéƒ¨åˆ†æŸ¥çœ‹</p><p>ç¬¬ä¸€ä¸ªéƒ¨åˆ†æ˜¯ <code>Multi-Datacenter Nacos Cluster</code> çš„ <code>Nacos Server</code> è¿™æ˜¯ <code>Nacos</code> çš„æ ¸å¿ƒ</p><p>ç¬¬äºŒéƒ¨åˆ†æ˜¯ <code>Nacos</code> çš„ <code>Console</code> æ§åˆ¶ä¸­å¿ƒ</p><p>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯å¤–éƒ¨çš„ <code>Provider</code>ã€<code>Consumer</code></p><ul><li><code>Nameserver</code>ï¼šè§£å†³<code>namespace</code>åˆ°<code>clusterid</code>çš„è·¯ç”±é—®é¢˜ï¼Œè§£å†³ç”¨æˆ·ç¯å¢ƒä¸<code>nacos</code>ç‰©ç†ç¯å¢ƒæ˜ å°„é—®é¢˜</li><li><code>Provider APP</code>ï¼šæ˜¯æŒ‡æä¾›å¯å¤ç”¨å’Œå¯è°ƒç”¨æœåŠ¡çš„åº”ç”¨æ–¹ã€‚</li><li><code>Comsumer APP</code>ï¼šæ˜¯æŒ‡ä¼šå‘èµ·å¯¹æŸä¸ªæœåŠ¡è°ƒç”¨çš„åº”ç”¨æ–¹ã€‚</li><li><code>OpenAPI</code>ï¼šæš´éœ²æ ‡å‡†<code>Rest</code>é£æ ¼<code>HTTP</code>æ¥å£ï¼Œç®€å•æ˜“ç”¨ï¼Œæ–¹ä¾¿å¤šè¯­è¨€é›†æˆ</li><li><code>Naming Service</code>ï¼šæä¾›åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ‰€æœ‰å¯¹è±¡(<code>Object</code>)ã€å®ä½“(<code>Entity</code>)çš„â€œåå­—â€åˆ°å…³è”çš„å…ƒæ•°æ®ä¹‹é—´çš„æ˜ å°„ç®¡ç†æœåŠ¡ï¼Œä¾‹å¦‚ <code>ServiceName</code> -&gt; <code>Endpoints Info, Distributed Lock Name</code> -&gt; <code>Lock Owner/Status Info</code>, <code>DNS Domain Name</code> -&gt; <code>IP List</code>, æœåŠ¡å‘ç°å’Œ <code>DNS</code> å°±æ˜¯åå­—æœåŠ¡çš„2å¤§åœºæ™¯ã€‚</li><li><code>Configuration Service</code>ï¼šåœ¨æœåŠ¡æˆ–è€…åº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæä¾›åŠ¨æ€é…ç½®æˆ–è€…å…ƒæ•°æ®ä»¥åŠé…ç½®ç®¡ç†çš„æœåŠ¡æä¾›è€…ã€‚</li><li>ä¸€è‡´æ€§åè®®ï¼šè§£å†³ä¸åŒæ•°æ®ï¼Œä¸åŒä¸€è‡´æ€§è¦æ±‚æƒ…å†µä¸‹ï¼Œä¸åŒä¸€è‡´æ€§æœºåˆ¶</li><li><code>Console</code>ï¼šæ˜“ç”¨æ§åˆ¶å°ï¼ŒåšæœåŠ¡ç®¡ç†ã€é…ç½®ç®¡ç†ç­‰æ“ä½œ</li></ul><h3 id="é€»è¾‘æ¶æ„åŠç»„ä»¶ä»‹ç»ï¼ˆäº†è§£ï¼‰"><a href="#é€»è¾‘æ¶æ„åŠç»„ä»¶ä»‹ç»ï¼ˆäº†è§£ï¼‰" class="headerlink" title="é€»è¾‘æ¶æ„åŠç»„ä»¶ä»‹ç»ï¼ˆäº†è§£ï¼‰"></a>é€»è¾‘æ¶æ„åŠç»„ä»¶ä»‹ç»ï¼ˆäº†è§£ï¼‰</h3><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070116388.png"></p><ul><li>æœåŠ¡ç®¡ç†ï¼šå®ç°æœåŠ¡<code>CRUD</code>ï¼ŒåŸŸå<code>CRUD</code>ï¼ŒæœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥ï¼ŒæœåŠ¡æƒé‡ç®¡ç†ç­‰åŠŸèƒ½</li><li>é…ç½®ç®¡ç†ï¼šå®ç°é…ç½®ç®¡<code>CRUD</code>ï¼Œç‰ˆæœ¬ç®¡ç†ï¼Œç°åº¦ç®¡ç†ï¼Œç›‘å¬ç®¡ç†ï¼Œæ¨é€è½¨è¿¹ï¼Œèšåˆæ•°æ®ç­‰åŠŸèƒ½</li><li>å…ƒæ•°æ®ç®¡ç†ï¼šæä¾›å…ƒæ•°æ®<code>CURD</code> å’Œæ‰“æ ‡èƒ½åŠ›</li><li>æ’ä»¶æœºåˆ¶ï¼šå®ç°ä¸‰ä¸ªæ¨¡å—å¯åˆ†å¯åˆèƒ½åŠ›ï¼Œå®ç°æ‰©å±•ç‚¹<code>SPI</code>æœºåˆ¶</li><li>äº‹ä»¶æœºåˆ¶ï¼šå®ç°å¼‚æ­¥åŒ–äº‹ä»¶é€šçŸ¥ï¼Œ<code>sdk</code>æ•°æ®å˜åŒ–å¼‚æ­¥é€šçŸ¥ç­‰é€»è¾‘</li><li>æ—¥å¿—æ¨¡å—ï¼šç®¡ç†æ—¥å¿—åˆ†ç±»ï¼Œæ—¥å¿—çº§åˆ«ï¼Œæ—¥å¿—å¯ç§»æ¤æ€§ï¼ˆå°¤å…¶é¿å…å†²çªï¼‰ï¼Œæ—¥å¿—æ ¼å¼ï¼Œå¼‚å¸¸ç +å¸®åŠ©æ–‡æ¡£</li><li>å›è°ƒæœºåˆ¶ï¼š<code>sdk</code>é€šçŸ¥æ•°æ®ï¼Œé€šè¿‡ç»Ÿä¸€çš„æ¨¡å¼å›è°ƒç”¨æˆ·å¤„ç†ã€‚æ¥å£å’Œæ•°æ®ç»“æ„éœ€è¦å…·å¤‡å¯æ‰©å±•æ€§</li><li>å¯»å€æ¨¡å¼ï¼šè§£å†³<code>ip</code>ï¼ŒåŸŸåï¼Œ<code>nameserver</code>ã€å¹¿æ’­ç­‰å¤šç§å¯»å€æ¨¡å¼ï¼Œéœ€è¦å¯æ‰©å±•</li><li>æ¨é€é€šé“ï¼šè§£å†³serverä¸å­˜å‚¨ã€<code>server</code>é—´ã€<code>server</code>ä¸<code>sdk</code>é—´æ¨é€æ€§èƒ½é—®é¢˜</li><li>å®¹é‡ç®¡ç†ï¼šç®¡ç†æ¯ä¸ªç§Ÿæˆ·ï¼Œåˆ†ç»„ä¸‹çš„å®¹é‡ï¼Œé˜²æ­¢å­˜å‚¨è¢«å†™çˆ†ï¼Œå½±å“æœåŠ¡å¯ç”¨æ€§</li><li>æµé‡ç®¡ç†ï¼šæŒ‰ç…§ç§Ÿæˆ·ï¼Œåˆ†ç»„ç­‰å¤šä¸ªç»´åº¦å¯¹è¯·æ±‚é¢‘ç‡ï¼Œé•¿é“¾æ¥ä¸ªæ•°ï¼ŒæŠ¥æ–‡å¤§å°ï¼Œè¯·æ±‚æµæ§è¿›è¡Œæ§åˆ¶</li><li>ç¼“å­˜æœºåˆ¶ï¼šå®¹ç¾ç›®å½•ï¼Œæœ¬åœ°ç¼“å­˜ï¼Œ<code>server</code>ç¼“å­˜æœºåˆ¶ã€‚å®¹ç¾ç›®å½•ä½¿ç”¨éœ€è¦å·¥å…·</li><li>å¯åŠ¨æ¨¡å¼ï¼šæŒ‰ç…§å•æœºæ¨¡å¼ï¼Œé…ç½®æ¨¡å¼ï¼ŒæœåŠ¡æ¨¡å¼ï¼Œ<code>dns</code>æ¨¡å¼ï¼Œæˆ–è€…<code>all</code>æ¨¡å¼ï¼Œå¯åŠ¨ä¸åŒçš„ç¨‹åº<code>+UI</code></li><li>ä¸€è‡´æ€§åè®®ï¼šè§£å†³ä¸åŒæ•°æ®ï¼Œä¸åŒä¸€è‡´æ€§è¦æ±‚æƒ…å†µä¸‹ï¼Œä¸åŒä¸€è‡´æ€§æœºåˆ¶</li><li>å­˜å‚¨æ¨¡å—ï¼šè§£å†³æ•°æ®æŒä¹…åŒ–ã€éæŒä¹…åŒ–å­˜å‚¨ï¼Œè§£å†³æ•°æ®åˆ†ç‰‡é—®é¢˜</li><li><code>Nameserver</code>ï¼šè§£å†³<code>namespace</code>åˆ°<code>clusterid</code>çš„è·¯ç”±é—®é¢˜ï¼Œè§£å†³ç”¨æˆ·ç¯å¢ƒä¸<code>nacos</code>ç‰©ç†ç¯å¢ƒæ˜ å°„é—®é¢˜</li><li><code>CMDB</code>ï¼šè§£å†³å…ƒæ•°æ®å­˜å‚¨ï¼Œä¸ä¸‰æ–¹<code>cmdb</code>ç³»ç»Ÿå¯¹æ¥é—®é¢˜ï¼Œè§£å†³åº”ç”¨ï¼Œäººï¼Œèµ„æºå…³ç³»</li><li><code>Metrics</code>ï¼šæš´éœ²æ ‡å‡†<code>metrics</code>æ•°æ®ï¼Œæ–¹ä¾¿ä¸ä¸‰æ–¹ç›‘æ§ç³»ç»Ÿæ‰“é€š</li><li><code>Trace</code>ï¼šæš´éœ²æ ‡å‡†<code>trace</code>ï¼Œæ–¹ä¾¿ä¸<code>SLA</code>ç³»ç»Ÿæ‰“é€šï¼Œæ—¥å¿—ç™½å¹³åŒ–ï¼Œæ¨é€è½¨è¿¹ç­‰èƒ½åŠ›ï¼Œå¹¶ä¸”å¯ä»¥å’Œè®¡é‡è®¡è´¹ç³»ç»Ÿæ‰“é€š</li><li>æ¥å…¥ç®¡ç†ï¼šç›¸å½“äºé˜¿é‡Œäº‘å¼€é€šæœåŠ¡ï¼Œåˆ†é…èº«ä»½ã€å®¹é‡ã€æƒé™è¿‡ç¨‹</li><li>ç”¨æˆ·ç®¡ç†ï¼šè§£å†³ç”¨æˆ·ç®¡ç†ï¼Œç™»å½•ï¼Œ<code>sso</code>ç­‰é—®é¢˜</li><li>æƒé™ç®¡ç†ï¼šè§£å†³èº«ä»½è¯†åˆ«ï¼Œè®¿é—®æ§åˆ¶ï¼Œè§’è‰²ç®¡ç†ç­‰é—®é¢˜</li><li>å®¡è®¡ç³»ç»Ÿï¼šæ‰©å±•æ¥å£æ–¹ä¾¿ä¸ä¸åŒå…¬å¸å®¡è®¡ç³»ç»Ÿæ‰“é€š</li><li>é€šçŸ¥ç³»ç»Ÿï¼šæ ¸å¿ƒæ•°æ®å˜æ›´ï¼Œæˆ–è€…æ“ä½œï¼Œæ–¹ä¾¿é€šè¿‡<code>SMS</code>ç³»ç»Ÿæ‰“é€šï¼Œé€šçŸ¥åˆ°å¯¹åº”äººæ•°æ®å˜æ›´</li><li><code>OpenAPI</code>ï¼šæš´éœ²æ ‡å‡†<code>Rest</code>é£æ ¼<code>HTTP</code>æ¥å£ï¼Œç®€å•æ˜“ç”¨ï¼Œæ–¹ä¾¿å¤šè¯­è¨€é›†æˆ</li><li><code>Console</code>ï¼šæ˜“ç”¨æ§åˆ¶å°ï¼ŒåšæœåŠ¡ç®¡ç†ã€é…ç½®ç®¡ç†ç­‰æ“ä½œ</li><li><code>SDK</code>ï¼šå¤šè¯­è¨€<code>sdk</code></li><li><code>Agent</code>ï¼š<code>dns-f</code>ç±»ä¼¼æ¨¡å¼ï¼Œæˆ–è€…ä¸<code>mesh</code>ç­‰æ–¹æ¡ˆé›†æˆ</li><li><code>CLI</code>ï¼šå‘½ä»¤è¡Œå¯¹äº§å“è¿›è¡Œè½»é‡åŒ–ç®¡ç†ï¼Œåƒ<code>git</code>ä¸€æ ·å¥½ç”¨</li></ul><h3 id="nacos-ç›®å‰çš„åŠŸèƒ½"><a href="#nacos-ç›®å‰çš„åŠŸèƒ½" class="headerlink" title="nacos ç›®å‰çš„åŠŸèƒ½"></a><code>nacos</code> ç›®å‰çš„åŠŸèƒ½</h3><p><a href="https://nacos.io/zh-cn/docs/feature-list.html">feature-list (nacos.io)</a></p><h3 id="nacosä¸¤å¤§ç»„ä»¶"><a href="#nacosä¸¤å¤§ç»„ä»¶" class="headerlink" title="nacosä¸¤å¤§ç»„ä»¶"></a><code>nacos</code>ä¸¤å¤§ç»„ä»¶</h3><p>ä¸ <code>Eureka</code> ç±»ä¼¼ï¼Œ<code>Nacos</code> ä¹Ÿé‡‡ç”¨ <code>CS</code>ï¼ˆ<code>Client/Server</code>ï¼Œå®¢æˆ·ç«¯&#x2F;æœåŠ¡å™¨ï¼‰æ¶æ„ï¼Œå®ƒåŒ…å«ä¸¤å¤§ç»„ä»¶ï¼Œå¦‚ä¸‹è¡¨ã€‚</p><table><thead><tr><th>ç»„ä»¶</th><th>æè¿°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>Nacos Server</code></td><td><code>Nacos</code><br /> æœåŠ¡ç«¯ï¼Œä¸ <code>Eureka Server</code><br /> ä¸åŒï¼Œ<code>Nacos Server</code><br /> ç”±é˜¿é‡Œå·´å·´å›¢é˜Ÿä½¿ç”¨ <code>Java</code><br /> è¯­è¨€ç¼–å†™å¹¶å°† <code>Nacos Server</code><br /> çš„ä¸‹è½½åœ°å€ç»™ç”¨æˆ·ï¼Œç”¨æˆ·åªéœ€è¦ç›´æ¥ä¸‹è½½å¹¶è¿è¡Œå³å¯ã€‚</td><td><code>Nacos Server</code><br /> å¯ä»¥ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œå¸®åŠ© <code>Nacos Client</code><br /> å®ç°æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚</td></tr><tr><td></td><td></td><td><code>Nacos Server</code><br /> å¯ä»¥ä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œå¸®åŠ© <code>Nacos Client</code><br /> åœ¨ä¸é‡å¯çš„æƒ…å†µä¸‹ï¼Œå®ç°é…ç½®çš„åŠ¨æ€åˆ·æ–°ã€‚</td></tr><tr><td><code>Nacos Client</code></td><td><code>Nacos</code><br /> å®¢æˆ·ç«¯ï¼Œé€šå¸¸æŒ‡çš„æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„å„ä¸ªæœåŠ¡ï¼Œç”±ç”¨æˆ·è‡ªå·±æ­å»ºï¼Œå¯ä»¥ä½¿ç”¨å¤šç§è¯­è¨€ç¼–å†™ã€‚</td><td><code>Nacos Client</code><br /> é€šè¿‡æ·»åŠ ä¾èµ– <code>spring-cloud-starter-alibaba-nacos-discovery</code><br />ï¼Œåœ¨æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆ<code>Nacos Server</code><br />ï¼‰ä¸­å®ç°æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚</td></tr><tr><td></td><td></td><td><code>Nacos Client</code><br /> é€šè¿‡æ·»åŠ ä¾èµ– <code>spring-cloud-starter-alibaba-nacos-config</code><br />ï¼Œåœ¨é…ç½®ä¸­å¿ƒï¼ˆ<code>Nacos Server</code><br />ï¼‰ä¸­å®ç°é…ç½®çš„åŠ¨æ€åˆ·æ–°ã€‚</td></tr></tbody></table><h3 id="CAPåŸåˆ™"><a href="#CAPåŸåˆ™" class="headerlink" title="CAPåŸåˆ™"></a><code>CAP</code>åŸåˆ™</h3><p><code>CAP</code>åŸç†ä¸»è¦è®²çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§ï¼ˆ<code>Consistency</code>ï¼‰ï¼Œå¯ç”¨æ€§ï¼ˆ<code>Availability</code>ï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆä¹Ÿç§°åˆ†åŒºå®¹é”™æ€§ï¼‰ï¼ˆ<code>Partition tolerance</code>ï¼‰ï¼Œè¿™ä¸‰ç‚¹åªèƒ½æ»¡è¶³ä¸¤ç‚¹</p><p>å…¶ä¸­</p><p>â‘ ä¸€è‡´æ€§ï¼šå¯¹äºå®¢æˆ·ç«¯çš„æ¯æ¬¡è¯»æ“ä½œï¼Œè¦ä¹ˆè¯»åˆ°çš„æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œè¦ä¹ˆè¯»å–å¤±è´¥ã€‚æ¢å¥è¯è¯´ï¼Œä¸€è‡´æ€§æ˜¯ç«™åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„è§’åº¦ï¼Œå¯¹è®¿é—®æœ¬ç³»ç»Ÿçš„å®¢æˆ·ç«¯çš„ä¸€ç§æ‰¿è¯ºï¼šè¦ä¹ˆæˆ‘ç»™æ‚¨è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œè¦ä¹ˆæˆ‘ç»™ä½ è¿”å›ç»å¯¹ä¸€è‡´çš„æœ€æ–°æ•°æ®ï¼Œä¸éš¾çœ‹å‡ºï¼Œå…¶å¼ºè°ƒçš„æ˜¯æ•°æ®æ­£ç¡®ã€‚</p><p>â‘¡å¯ç”¨æ€§ï¼šä»»ä½•å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½èƒ½å¾—åˆ°å“åº”æ•°æ®ï¼Œä¸ä¼šå‡ºç°å“åº”é”™è¯¯ã€‚æ¢å¥è¯è¯´ï¼Œå¯ç”¨æ€§æ˜¯ç«™åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„è§’åº¦ï¼Œå¯¹è®¿é—®æœ¬ç³»ç»Ÿçš„å®¢æˆ·çš„å¦ä¸€ç§æ‰¿è¯ºï¼šæˆ‘ä¸€å®šä¼šç»™æ‚¨è¿”å›æ•°æ®ï¼Œä¸ä¼šç»™ä½ è¿”å›é”™è¯¯ï¼Œä½†ä¸ä¿è¯æ•°æ®æœ€æ–°ï¼Œå¼ºè°ƒçš„æ˜¯ä¸å‡ºé”™ã€‚</p><p>â‘¢åˆ†åŒºå®¹å¿æ€§ï¼šç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿé€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ï¼Œç½‘ç»œæ˜¯ä¸å¯é çš„ã€‚å½“ä»»æ„æ•°é‡çš„æ¶ˆæ¯ä¸¢å¤±æˆ–å»¶è¿Ÿåˆ°è¾¾æ—¶ï¼Œç³»ç»Ÿä»ä¼šç»§ç»­æä¾›æœåŠ¡ï¼Œä¸ä¼šæŒ‚æ‰ã€‚æ¢å¥è¯è¯´ï¼Œåˆ†åŒºå®¹å¿æ€§æ˜¯ç«™åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„è§’åº¦ï¼Œå¯¹è®¿é—®æœ¬ç³»ç»Ÿçš„å®¢æˆ·ç«¯çš„å†ä¸€ç§æ‰¿è¯ºï¼šæˆ‘ä¼šä¸€ç›´è¿è¡Œï¼Œä¸ç®¡æˆ‘çš„å†…éƒ¨å‡ºç°ä½•ç§æ•°æ®åŒæ­¥é—®é¢˜ï¼Œå¼ºè°ƒçš„æ˜¯ä¸æŒ‚æ‰ã€‚</p><p>å¯ä»¥çœ‹å‡ºè¿™ä¸‰ç‚¹ä¸­æœ‰ä¸€ç‚¹å¿…é¡»æ»¡è¶³ï¼Œ<code>åˆ†åŒºå®¹å¿æ€§Partition tolerance</code>ï¼Œå¦åˆ™ç³»ç»Ÿåªè¦ä¸¢å¤±æ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿéƒ½å°†æ— æ³•å·¥ä½œ</p><p>æ‰€ä»¥å¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼ç»„ä»¶æ¥è¯´ï¼Œè¦ä¹ˆæ»¡è¶³<code>AP</code>ï¼Œè¦ä¹ˆæ»¡è¶³<code>CP</code></p><p>è€Œä¼—æ‰€å‘¨çŸ¥çš„ <code>zookeeper</code> æ»¡è¶³äº† <code>CP</code>ï¼ŒæŠ›å¼ƒäº† <code>A</code></p><p><code>Eurake</code>æ»¡è¶³äº† <code>AP</code>ï¼Œä¿è¯äº† <code>C</code> çš„æœ€ç»ˆä¸€è‡´æ€§</p><p>è€Œæœ¬æ–‡ çš„ <code>nacos</code> é»˜è®¤å¯åŠ¨ <code>AP</code>ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ<code>CP</code></p><h3 id="nacoså’Œä¸€è‡´æ€§ç®—æ³•"><a href="#nacoså’Œä¸€è‡´æ€§ç®—æ³•" class="headerlink" title="nacoså’Œä¸€è‡´æ€§ç®—æ³•"></a><code>nacos</code>å’Œä¸€è‡´æ€§ç®—æ³•</h3><h4 id="ä¸ºä»€ä¹ˆ-nacos-éœ€è¦ä¸€è‡´æ€§ç®—æ³•ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-nacos-éœ€è¦ä¸€è‡´æ€§ç®—æ³•ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ nacos éœ€è¦ä¸€è‡´æ€§ç®—æ³•ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ <code>nacos</code> éœ€è¦ä¸€è‡´æ€§ç®—æ³•ï¼Ÿ</h4><p><code>nacos</code> ä¸ºäº†å°½é‡å‡å°‘ç”¨æˆ·çš„éƒ¨ç½²å’Œè¿è¥æˆæœ¬ï¼Œåšåˆ°ç”¨æˆ·åªéœ€è¦ä¸€ä¸ªåŒ…å°±å¯ä»¥å¿«é€Ÿå¯åŠ¨<code>nacos</code>å•æœºæˆ–è€…é›†ç¾¤ï¼Œå› æ­¤ <code>nacos</code> éœ€è¦å­˜å‚¨ä¸€äº›æ•°æ®ã€‚</p><p><code>nacos</code>åœ¨å•æœºä¸‹å­˜å‚¨æ•°æ®é—®é¢˜ä¸å¤§ï¼Œä½†æ˜¯åœ¨é›†ç¾¤ä¸‹å°±éœ€è¦ä¸€äº›ä¸€è‡´æ€§ç®—æ³•å¸®åŠ©å„ä¸ªèŠ‚ç‚¹è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œå°±ä¸å¾—ä¸å¼•å…¥ç°å­˜çš„ä¸€äº›å…±è¯†ç®—æ³•å’¯</p><h3 id="ä¸ºä»€ä¹ˆ-nacos-é€‰æ‹©raftä»¥åŠdistroï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-nacos-é€‰æ‹©raftä»¥åŠdistroï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ nacos é€‰æ‹©raftä»¥åŠdistroï¼Ÿ"></a>ä¸ºä»€ä¹ˆ <code>nacos</code> é€‰æ‹©<code>raft</code>ä»¥åŠ<code>distro</code>ï¼Ÿ</h3><h4 id="raftå…±è¯†ç®—æ³•"><a href="#raftå…±è¯†ç®—æ³•" class="headerlink" title="raftå…±è¯†ç®—æ³•"></a>raftå…±è¯†ç®—æ³•</h4><p><code>raft</code> åè®®ç®€å•å…¥é—¨çœ‹è¿™é‡Œï¼šï¼ˆäº†è§£ï¼‰</p><p><a href="https://juejin.cn/post/7116445621082390565">https://juejin.cn/post/7116445621082390565</a></p><ul><li><code>nacos</code>ä½œä¸º<strong>æœåŠ¡å‘ç°æ³¨å†Œä¸­å¿ƒ</strong>è€Œè¨€ï¼š</li></ul><p>è€ŒæœåŠ¡å‘ç°æ³¨å†Œä¸­å¿ƒ<strong>å¿…é¡»è¦ä¿è¯å¯ç”¨æ€§</strong>ï¼Œè€Œ<strong>å¼ºä¸€è‡´æ€§åè®®çš„æƒ…å†µä¸‹ï¼Œå¦‚æœé›†ç¾¤å¯ç”¨çš„èŠ‚ç‚¹æ•°æ²¡æœ‰è¿‡åŠçš„è¯ï¼Œå¯èƒ½å¯¼è‡´æ³¨å†Œä¸­å¿ƒåœ¨éƒ¨åˆ†æ—¶é—´å†…ä¸å¯ç”¨</strong></p><p>æ‰€ä»¥æœ€ç»ˆ<code>nacos</code>é€‰æ‹©äº† <code>AP</code> å¹¶é…åˆ <strong>æœ€ç»ˆä¸€è‡´æ€§</strong> ä½œä¸º æœåŠ¡å‘ç°æ³¨å†Œä¸­å¿ƒ çš„åº•å±‚å…±è¯†ç®—æ³•</p><blockquote><p>ä»¥ä¸Šé’ˆå¯¹ <code>nacos</code> éæŒä¹…åŒ–æ•°æ®è€Œè¨€ï¼Œå¯¹äºæŒä¹…åŒ–æ•°æ®æ¥è¯´ï¼Œå°±ä¸éœ€è¦é€‰æ‹©<code>AP</code>ï¼Œå¯ä»¥é…åˆå¼ºä¸€è‡´æ€§å…±è¯†ç®—æ³•</p></blockquote><ul><li><code>nacos</code> ä½œä¸ºé…ç½®ä¸­å¿ƒçš„è€Œè¨€ï¼š</li></ul><p>é…ç½®æ•°æ®ä¸­å¿ƒå¿…é¡»ä¿è¯ç»å¤§å¤šæ•°èŠ‚ç‚¹çš„é…ç½®éƒ½æ˜¯ä¸€è‡´çš„ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´é…ç½®ä¸åŒæˆ–è€…é…ç½®ä¸¢å¤±å¼•èµ·åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹å‡ºç°ä¸¥é‡çš„é—®é¢˜ï¼Œæ‰€ä»¥å¯¹äºé…ç½®æ•°æ®ä¸­å¿ƒè€Œè¨€ï¼Œé…ç½®å¿…é¡»ä½¿ç”¨å¼ºä¸€è‡´æ€§</p><p>æ‰€ä»¥ <code>nacos</code> åŒæ—¶æ”¯æŒ <code>AP</code> å’Œ <code>CP</code></p><p>é‚£ä¸ºä»€ä¹ˆ <code>nacos</code> é€‰æ‹© <code>raft</code> å’Œ <code>distro</code> å‘¢ï¼Ÿ</p><p>é¦–å…ˆ <code>raft</code> æ˜¯å¼ºä¸€è‡´æ€§å…±è¯†ç®—æ³•ï¼Œè€Œä¸”å¾ˆå¥½ç†è§£ï¼Œå…¶æ¬¡ <code>nacos</code> èƒŒé é˜¿é‡Œï¼Œå®ç°äº†å¦ä¸€å¥—åŸºäº<code>raft</code>çš„ç®—æ³• <code>JRaft</code></p><p><code>JRaft</code>æ”¯æŒå¤š <code>RaftGroup</code>, ä¹Ÿå¯ä»¥ä¸º <code>nacos</code> åé¢æä¾›å¤šæ•°æ®åˆ†ç‰‡å¸¦æ¥äº†å¯èƒ½</p><h4 id="distroåè®®"><a href="#distroåè®®" class="headerlink" title="distroåè®®"></a><code>distro</code>åè®®</h4><p><code>**distro**</code>** åè®®æ˜¯é˜¿é‡Œå·´å·´è‡ªç ”çš„â¼€ä¸ªæœ€ç»ˆâ¼€è‡´æ€§åè®®<strong>ï¼Œè€Œæœ€ç»ˆâ¼€è‡´æ€§åè®®æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ <code>Gossip</code>ã€ <code>Eureka</code> å†…çš„æ•°æ®åŒæ­¥ç®—æ³•ã€‚è€Œ <code>distro</code> ç®—æ³•æ˜¯é›† <code>Gossip</code> ä»¥åŠ <code>Eureka</code> åè®®çš„ä¼˜ç‚¹å¹¶åŠ ä»¥ä¼˜åŒ–è€Œå‡ºæ¥çš„ï¼Œå¯¹äºåŸç”Ÿçš„ <code>Gossip</code>ï¼Œ</strong>ç”±äºéšæœºé€‰å–å‘é€æ¶ˆæ¯çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±ä¸å¯é¿å…çš„å­˜åœ¨æ¶ˆæ¯é‡å¤å‘é€ç»™åŒâ¼€èŠ‚ç‚¹çš„æƒ…å†µï¼Œå¢åŠ äº†ç½‘ç»œçš„ä¼ è¾“çš„å‹åŠ›ï¼Œä¹Ÿç»™æ¶ˆæ¯èŠ‚ç‚¹å¸¦æ¥é¢å¤–çš„å¤„ç†è´Ÿè½½<strong>ï¼Œè€Œ <code>distro</code> ç®—æ³•å¼•å…¥äº† <code>Server</code> çš„æ¦‚å¿µï¼Œ</strong>æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£â¼€éƒ¨åˆ†æ•°æ®ä»¥åŠå°†è‡ªå·±çš„æ•°æ®åŒæ­¥ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œæœ‰æ•ˆçš„é™ä½äº†æ¶ˆæ¯å†—ä½™çš„é—®é¢˜**ã€‚</p><h2 id="å››ã€æ€ä¹ˆè£…ï¼Ÿ"><a href="#å››ã€æ€ä¹ˆè£…ï¼Ÿ" class="headerlink" title="å››ã€æ€ä¹ˆè£…ï¼Ÿ"></a>å››ã€æ€ä¹ˆè£…ï¼Ÿ</h2><p>å» <code>git</code> ä¸Šä¸‹è½½</p><p><a href="https://github.com/alibaba/nacos/releases/tag/2.1.0">Release 2.1.0 (Apr 29, 2022) Â· alibaba&#x2F;nacos (github.com)</a></p><h3 id="Linux-Unix-Macä¸‹å¯åŠ¨æ–¹å¼"><a href="#Linux-Unix-Macä¸‹å¯åŠ¨æ–¹å¼" class="headerlink" title="Linux/Unix/Macä¸‹å¯åŠ¨æ–¹å¼"></a><code>Linux/Unix/Mac</code>ä¸‹å¯åŠ¨æ–¹å¼</h3><p>å¯åŠ¨å‘½ä»¤(<code>standalone</code>ä»£è¡¨ç€å•æœºæ¨¡å¼è¿è¡Œï¼Œéé›†ç¾¤æ¨¡å¼):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh startup.sh -m standalone</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯<code>ubuntu</code>ç³»ç»Ÿï¼Œæˆ–è€…è¿è¡Œè„šæœ¬æŠ¥é”™æç¤º[[ç¬¦å·æ‰¾ä¸åˆ°ï¼Œå¯å°è¯•å¦‚ä¸‹è¿è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash startup.sh -m standalone</span><br></pre></td></tr></table></figure><h3 id="windowä¸‹å¯åŠ¨"><a href="#windowä¸‹å¯åŠ¨" class="headerlink" title="windowä¸‹å¯åŠ¨"></a><code>window</code>ä¸‹å¯åŠ¨</h3><p>è¯·è¿›å…¥ç›®å½• <code>D:\programs\env\nacos-server-2.1.0_2\nacos\bin</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./startup.cmd -m standalone</span><br></pre></td></tr></table></figure><p>å•æœºå¯åŠ¨</p><p>å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070116516.png" alt="image.png"></p><blockquote><p>è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ <code>docker</code> å®‰è£…çš„ <code>nacos</code>ï¼Œåé¢ä¼šè®²</p></blockquote><blockquote><p><del>è¿™é‡Œæœ‰ä¸ªå‘ï¼Œ</del><code>~~application.properties~~</code><del>é‡Œé¢çš„å‡ ä¸ªå±æ€§éƒ½æ˜¯æ— æ•ˆçš„ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æˆ‘æ²¡å¼„æ¸…æ¥šä»€ä¹ˆã€‚ã€‚ã€‚</del></p></blockquote><blockquote><p>å¯ä»¥åœ¨<code>bootstrap.yml</code>ä¸­é…ç½®</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nacos.config.data-id</span>=<span class="string">example</span></span><br><span class="line"><span class="attr">nacos.config.group</span>=<span class="string">DEFAULT_GROUP</span></span><br><span class="line"><span class="attr">nacos.config.auto-refresh</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><p><a href="http://localhost:8080/config/get"><br /></a></p><h3 id="dockerä¸Šå®‰è£…nacosçš„å‘"><a href="#dockerä¸Šå®‰è£…nacosçš„å‘" class="headerlink" title="dockerä¸Šå®‰è£…nacosçš„å‘"></a><code>docker</code>ä¸Šå®‰è£…<code>nacos</code>çš„å‘</h3><p>å¦‚æœä½ é€‰æ‹©åœ¨ <code>docker</code> ä¸Šå®‰è£… <code>nacos</code> ï¼Œ ä½ åªéœ€è¦ä¸‹è½½ <code>nacos/nacos-server</code> è¿™ä¸ªé•œåƒåŒ…</p><p>ç„¶åä½ ä¼šçœ‹åˆ° <code>docker hub</code> ä¸Šçš„ <code>quick start</code>:</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070116274.png" alt="image.png"></p><p>ä½ è·Ÿç€åšï¼Œä½ ä¼šå‘ç° <code>nacos</code> å¯åŠ¨æˆåŠŸäº†ï¼Œä½†ä½  <code>spring-boot</code> é¡¹ç›®æ€ä¹ˆéƒ½æ— æ³•å¯åŠ¨æˆåŠŸ</p><p>å¦‚æœä½ å›åˆ° <code>nacos</code> å®˜æ–¹æ–‡æ¡£ï¼Œåˆä¼šçœ‹åˆ°å¦ä¸€ä¸ªæ–¹å¼ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070116906.png" alt="image.png"></p><p>éœ€è¦ä½ å» <code>github</code> ä¸Š <code>clone</code> é¡¹ç›®</p><p>å¦‚æœä½ æ²¡æ¢¯å­ï¼Œä¼šå¾ˆéº»çƒ¦ï¼Œè€Œä¸”ä¹Ÿå¾ˆå¤æ‚</p><p>é‚£æˆ‘åªæƒ³è¦ <code>docker hub</code> ä¸Šçš„ <code>nacos</code> æ€ä¹ˆåŠï¼Ÿ</p><p><a href="https://github.com/nacos-group/nacos-docker">nacos-group&#x2F;nacos-docker: This project contains a Docker image meant to facilitate the deployment of Nacos . (github.com)</a></p><p>çœ‹ä¸Šé¢ç½‘å€</p><p>è¿™é‡Œä¼šæœ‰ä¸ª <code>quick start</code>ï¼š</p><p><code>docker run --name nacos-quick -e MODE=standalone -p 8848:8848 -p 9848:9848 -d nacos/nacos-server:2.0.2</code></p><p>ä½ ä¼šå‘ç°é—®é¢˜</p><p>å¤šäº†ä¸ªç«¯å£ <code>9848</code></p><p>å¯¹ï¼Œ è¿™æ‰æ˜¯å¯¹çš„ã€‚ã€‚ã€‚</p><p>ç„¶åä½ å›å»çœ‹ <code>nacos</code> çš„é•œåƒé…ç½®</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070116314.png" alt="image.png"></p><p>å’¦ï¼Œä¸æ˜¯åªæš´éœ²äº†ä¸€ä¸ªç«¯å£ä¹ˆï¼Ÿ æ€ä¹ˆè¿˜è¦å¦ä¸€ä¸ªç«¯å£ï¼Ÿ</p><p>ç­”æ¡ˆåœ¨è¿™é‡Œï¼š</p><p><a href="https://nacos.io/zh-cn/docs/2.0.0-compatibility.html">Nacos 2.0.0 å…¼å®¹æ€§æ–‡æ¡£</a></p><p><code>Nacos2.0</code>ç‰ˆæœ¬ç›¸æ¯”<code>1.X</code>æ–°å¢äº†<code>gRPC</code>çš„é€šä¿¡æ–¹å¼ï¼Œå› æ­¤éœ€è¦å¢åŠ <code>2ä¸ªç«¯å£</code>ã€‚æ–°å¢ç«¯å£æ˜¯åœ¨é…ç½®çš„ä¸»ç«¯å£<code>(server.port)</code>åŸºç¡€ä¸Šï¼Œè¿›è¡Œä¸€å®šåç§»é‡è‡ªåŠ¨ç”Ÿæˆã€‚</p><table><thead><tr><th>ç«¯å£</th><th>ä¸ä¸»ç«¯å£çš„åç§»é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>9848</code></td><td><code>1000</code></td><td>å®¢æˆ·ç«¯<code>gRPC</code><br />è¯·æ±‚æœåŠ¡ç«¯ç«¯å£ï¼Œç”¨äºå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¿æ¥å’Œè¯·æ±‚</td></tr><tr><td><code>9849</code></td><td><code>1001</code></td><td>æœåŠ¡ç«¯<code>gRPC</code><br />è¯·æ±‚æœåŠ¡ç«¯ç«¯å£ï¼Œç”¨äºæœåŠ¡é—´åŒæ­¥ç­‰</td></tr></tbody></table><blockquote><p>å¥½å§ï¼Œæˆ‘ç›´æ¥ <code>nacos 2.1</code> çš„ï¼Œè°ä¼šæ²¡äº‹å»å…³æ³¨å…¼å®¹é—®é¢˜ï¼Œå®³~ æˆ‘æ²¡è¯è¯´äº†ï¼Œä¸‹æ¬¡ä¸€å®šè·Ÿå®˜ç½‘èµ°ã€‚ã€‚ã€‚</p></blockquote><h3 id="github-ä¸Š-nacos-docker-éœ€è¦æ³¨æ„çš„åœ°æ–¹"><a href="#github-ä¸Š-nacos-docker-éœ€è¦æ³¨æ„çš„åœ°æ–¹" class="headerlink" title="github ä¸Š nacos-docker éœ€è¦æ³¨æ„çš„åœ°æ–¹"></a><code>github </code>ä¸Š <code>nacos-docker</code> éœ€è¦æ³¨æ„çš„åœ°æ–¹</h3><p>åœ¨<code>github</code>ä¸Šçš„ <code>nacos-docker</code> è¿™ä¸ªé¡¹ç›®ä¼šä¸‰ç§æ–¹å¼å‘Šè¯‰ä½ å¦‚ä½•å¯åŠ¨ <code>nacos</code></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070116364.png" alt="image.png"></p><ul><li>å•æœºæ¨¡å¼ <code>Derby</code>:     è¿™ç§æ¨¡å¼æ˜¯æç®€æ¨¡å¼ï¼Œæ•°æ®æ²¡æ³•æŒä¹…åŒ–å­˜å‚¨ï¼Œé€‚åˆå¼€å‘ç¯å¢ƒã€‚</li><li>å•æœºæ¨¡å¼ <code>MySQL</code>:(æ”¯æŒ<code>MySQL5.7</code>å’Œ<code>MySQL8.0</code>ï¼Œæˆ‘ä»¬è¿™é‡Œå­¦ä¹ <code>MySQL5.7</code>å®‰è£…æ¨¡å¼ï¼Œå› ä¸ºå½“å‰ä¸»æµè¿˜æ˜¯<code>MySQL5.7</code>)     è¿™ç§æ¨¡å¼æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œæ•°æ®ä¼šå­˜å‚¨åˆ°MySQLä¸­ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒã€‚</li><li>é›†ç¾¤æ¨¡å¼:     è¿™ç§æ¨¡å¼é€‚åˆç”Ÿäº§ç¯å¢ƒå¹¶ä¸”æœåŠ¡èŠ‚ç‚¹ä¸ªæ•°è¾ƒå¤šï¼Œä¸å­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜ã€‚</li></ul><blockquote><p>æ³¨æ„ä¸Šé¢ä½¿ç”¨ <code>mysql </code>çš„æ–¹å¼å¯åŠ¨éœ€è¦ <code>mysql </code>è¡¨ç»“æ„ï¼Œè€Œè¡¨ç»“æ„åœ¨ <code>nacos </code>å®˜æ–¹çš„é¡¹ç›®ä¸­<br><a href="https://github.com/alibaba/nacos/blob/develop/config/src/main/resources/META-INF/nacos-db.sql">https://github.com/alibaba/nacos/blob/develop/config/src/main/resources/META-INF/nacos-db.sql</a></p></blockquote><h2 id="å››ã€springbootæ•´åˆnacos"><a href="#å››ã€springbootæ•´åˆnacos" class="headerlink" title="å››ã€springbootæ•´åˆnacos"></a>å››ã€<code>springboot</code>æ•´åˆ<code>nacos</code></h2><h3 id="nacosé…ç½®ä¸­å¿ƒ"><a href="#nacosé…ç½®ä¸­å¿ƒ" class="headerlink" title="nacosé…ç½®ä¸­å¿ƒ"></a><code>nacos</code>é…ç½®ä¸­å¿ƒ</h3><p>nacosä¸Šé¢éœ€è¦è¿™æ ·ï¼š</p><ol><li>æ–°å»ºå‘½åç©ºé—´</li></ol><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070116206.png" alt="image.png"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070116668.png" alt="image.png"></p><p>é…ç½®åˆ—è¡¨çš„å†…å®¹æ˜¯ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070116453.png" alt="image.png"></p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070116119.png" alt="image.png"></p><p>é¦–å…ˆåˆ›å»º <code>springboot</code> <code>maven</code>é¡¹ç›®</p><p><code>pom.xml</code> å¦‚ä¸‹ï¼šï¼ˆè¿™é‡Œæ˜¯ <code>maven pom</code> é¡¹ç›®ï¼Œæ³¨æ„è‡ªå·±å»åˆ›å»ºä¸€ä¸ªæ–°æ¨¡å— å¯¼å…¥ <code>dependencyManagement</code> å†…çš„ä¾èµ–ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-nacos-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>spring-boot-nacos-config<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>nacos-config-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>nacos-discovery-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>application.yml</code>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nacos:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">f4d95375-72ac-4197-9314-87b7fc0d0530</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå‘½åç©ºé—´éœ€è¦å¡«å…¥ <img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070117698.png" alt="image.png"><br>è€Œä¸æ˜¯ <code>namespace: spring-boot</code> </p></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.spring.context.<span class="keyword">annotation</span>.config.NacosPropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@NacosPropertySource(dataId = <span class="string">&quot;nacos-config.properties&quot;</span>, groupId = <span class="string">&quot;spring-boot-config&quot;</span>, autoRefreshed = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosConfigApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> static void main(String[] args) throws Exception &#123;</span><br><span class="line">SpringApplication.run(NacosConfigApplication.<span class="keyword">class</span>, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.config.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.api.config.<span class="keyword">annotation</span>.NacosValue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RestController;</span><br><span class="line"><span class="keyword">import</span> static org.springframework.web.bind.<span class="keyword">annotation</span>.RequestMethod.GET;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NacosValue(value = <span class="string">&quot;<span class="subst">$&#123;useLocalCache:false&#125;</span>&quot;</span>, autoRefreshed = true)</span></span><br><span class="line"><span class="keyword">private</span> boolean useLocalCache;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(value = <span class="string">&quot;/get&quot;</span>, method = GET)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> boolean <span class="keyword">get</span>() &#123;</span><br><span class="line"><span class="keyword">return</span> useLocalCache;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070117555.png" alt="image.png"></p><p>æˆäº†</p><blockquote><p>æ³¨æ„ <code>autoRefreshed = true</code> ï¼Œè¿™æ ·å¾®æœåŠ¡æ‰éšæ—¶èƒ½æ„ŸçŸ¥ <code>nacos </code>é…ç½®çš„å˜åŒ–</p></blockquote><h3 id="nacosæœåŠ¡å‘ç°"><a href="#nacosæœåŠ¡å‘ç°" class="headerlink" title="nacosæœåŠ¡å‘ç°"></a><code>nacos</code>æœåŠ¡å‘ç°</h3><h4 id="æœåŠ¡æä¾›ç«¯"><a href="#æœåŠ¡æä¾›ç«¯" class="headerlink" title="æœåŠ¡æä¾›ç«¯"></a>æœåŠ¡æä¾›ç«¯</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-nacos-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-nacos-discovery-producer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>nacos-discovery-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.spring<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.spring<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>nacos-discovery-spring-boot-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å·¨å‘ï¼š<code>nacos </code>çš„ <code>springboot </code>åŒ…ä¸­çš„<code>spring-context-support</code>ä¾èµ–ä¸å‘å‰å…¼å®¹ï¼Œå¯¼è‡´é¡¹ç›®å¯åŠ¨æŠ¥é”™ï¼š<br><code>com.sun.proxy.$Proxy27 cannot be cast to class java.util.Map (com.sun.proxy.$Proxy27 is in unnamed module of loader &#39;app&#39;; java.util.Map is in module java.base of loader &#39;bootstrap&#39;)</code><br>çœ‹äº†ä¸‹ï¼Œå°±å·®äº†ä¸€ä¸ªç‰ˆæœ¬ï¼š<code>1.0.10</code> äººéƒ½å‚»äº†</p></blockquote><p><code>application.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-producer</span></span><br><span class="line"><span class="attr">nacos:</span></span><br><span class="line">  <span class="attr">discovery:</span></span><br><span class="line">    <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">*</span></span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosDiscoveryApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> static void main(String[] args) throws Exception &#123;</span><br><span class="line">SpringApplication.run(NacosDiscoveryApplication.<span class="keyword">class</span>, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.api.<span class="keyword">annotation</span>.NacosInjected;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.api.exception.NacosException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.api.naming.NamingService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NacosInjected</span></span><br><span class="line"><span class="keyword">private</span> NamingService namingService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(<span class="string">&quot;/register&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> boolean getServiceName() throws NacosException &#123;</span><br><span class="line">namingService.registerInstance(<span class="string">&quot;example&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8080</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡ï¼Œè®¿é—® <a href="http://127.0.0.1:8080/register">http://127.0.0.1:8080/register</a> æ³¨å†ŒæœåŠ¡</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070117299.png" alt="image.png"></p><h4 id="æœåŠ¡æ¶ˆè´¹ç«¯"><a href="#æœåŠ¡æ¶ˆè´¹ç«¯" class="headerlink" title="æœåŠ¡æ¶ˆè´¹ç«¯"></a>æœåŠ¡æ¶ˆè´¹ç«¯</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-nacos-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-nacos-dicovery-consumer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>nacos-discovery-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.spring<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.spring<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>nacos-discovery-spring-boot-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-consumer</span></span><br><span class="line"><span class="attr">nacos:</span></span><br><span class="line">  <span class="attr">discovery:</span></span><br><span class="line">    <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">*</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosDiscoveryApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(NacosDiscoveryApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.consumer.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.api.annotation.NacosInjected;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.api.exception.NacosException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.api.naming.NamingService;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.api.naming.pojo.Instance;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DiscoveryController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NacosInjected</span></span><br><span class="line"><span class="keyword">private</span> NamingService namingService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/get&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Instance&gt; <span class="title function_">get</span><span class="params">(<span class="meta">@RequestParam</span> String serviceName)</span> <span class="keyword">throws</span> NacosException &#123;</span><br><span class="line"><span class="keyword">return</span> namingService.getAllInstances(serviceName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070117210.png" alt="image.png"></p><p>æˆåŠŸäº†</p><h2 id="äº”ã€springcloud-æ•´åˆ-nacos"><a href="#äº”ã€springcloud-æ•´åˆ-nacos" class="headerlink" title="äº”ã€springcloud æ•´åˆ nacos"></a>äº”ã€<code>springcloud</code> æ•´åˆ <code>nacos</code></h2><h3 id="é…ç½®ä¸­å¿ƒ"><a href="#é…ç½®ä¸­å¿ƒ" class="headerlink" title="é…ç½®ä¸­å¿ƒ"></a>é…ç½®ä¸­å¿ƒ</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-nacos-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-nacos-config-center<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„æ·»åŠ ï¼š<code>spring-cloud-starter-bootstrap</code>ï¼Œè¿™ä¸€ç‚¹å®˜ç½‘æ²¡è¯´ï¼Œç»™çš„ä¾‹å­ä¹Ÿæ˜¯è¾ƒä¸ºä½çš„ <code>spring-boot </code>ç‰ˆæœ¬ï¼Œè¿™ç‚¹éœ€è¦æ³¨æ„</p><p><code>nacos </code>å®˜æ–¹éƒ½è¯´äº† è¦ç”¨åˆ° <code>bootstrap.yml </code>é…ç½®æ–‡ä»¶</p><p>æ–°å»º <code>bootstrap.yml </code>æ–‡ä»¶ï¼Œå¡«å…¥ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">properties</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">spring-cloud-config</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br></pre></td></tr></table></figure><blockquote><p><code>namespace </code>åœ¨è¿™é‡Œèƒ½çœ‹åˆ°ï¼š <img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070117620.png" alt="image.png"></p></blockquote><p>åœ¨ <code>application.yml</code> æ–‡ä»¶ä¸­å¡«å…¥ä»£ç ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringCloudNacosConfigApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(SpringCloudNacosConfigApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.config.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.context.config.annotation.RefreshScope;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;user.id:&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;user.password:&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;get&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> String.format(<span class="string">&quot;username = %s, password = %s\n&quot;</span>, username, password);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œåªèƒ½ä½¿ç”¨<code>@Value</code>ï¼Œå¦‚æœä½¿ç”¨<code>@NacosValue</code>æ³¨è§£ï¼Œæ— æ•ˆ</p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070117864.png" alt="image.png"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070117924.png" alt="image.png"></p><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼šé…ç½®æ–‡ä»¶åå¿…é¡»æ˜¯ <code>spring.application.name</code>+ <code>spring.profiles.active</code> + <code>.</code> + <code>spring.cloud.nacos.config.file-extension</code><br>æ¯”å¦‚ä½ çš„ <code>application</code>åå­—æ˜¯ <code>zhazha</code>ï¼Œç„¶å <code>active </code>å†™æˆ <code>dev</code>ï¼Œæœ€å<code>file-extension</code> å†™ä¸Š <code>yaml</code> æˆ–è€… <code>properties </code>(ç›®å‰åªæ”¯æŒè¿™ä¸¤ç§)</p></blockquote><p>ç„¶åä½ ä¼šå‘ç°ä¸æˆåŠŸ</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070117840.png" alt="image.png"></p><p>ä¸ºä»€ä¹ˆï¼Ÿ</p><blockquote><p>å¦‚æœä½ æ˜¯æ–°æ‰‹å¯ä»¥ç›´æ¥æœç´¢ï¼šâ€œspringcloud nacos é…ç½®ä¸­å¿ƒ å‘â€è°ƒæ•´ä¸‹æ—¶é—´ï¼Œè¿‘æœŸä¸€å¹´çš„æœç´¢å°±ä¼šæ‰¾åˆ°è§£å†³æ–¹æ³•</p></blockquote><p>é—®é¢˜å¾ˆç®€å•ï¼Œ<code>spring-boot </code>ä» ç‰ˆæœ¬å¼€å§‹å°±å°† <code>bootstrap.yml </code>å‰¥ç¦»å‡ºå»äº†ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ · <code>bootstrap.yml </code>é…ç½®æ–‡ä»¶æ‰ä¼šç”Ÿæ•ˆ</p><p>é‡æ–°å¯åŠ¨ï¼Œå°±å¯ä»¥äº†</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070117207.png" alt="image.png"></p><blockquote><p>å¾ˆå¤šæ—¶å€™ä¸è¦å»å˜²è®½é‚£äº›å®ˆæ—§çš„äººï¼Œç‰¹åˆ«æ˜¯<code>java8</code>ç¨‹åºå‘˜ï¼Œä»–ä»¬åƒè¿‡çš„ç›æ¯”æˆ‘ä»¬åƒè¿‡çš„é¥­è¿˜å¤šã€‚å“ˆå“ˆå“ˆ</p></blockquote><h3 id="nacosæœåŠ¡å‘ç°-1"><a href="#nacosæœåŠ¡å‘ç°-1" class="headerlink" title="nacosæœåŠ¡å‘ç°"></a><code>nacos</code>æœåŠ¡å‘ç°</h3><h4 id="æœåŠ¡æä¾›ç«¯-1"><a href="#æœåŠ¡æä¾›ç«¯-1" class="headerlink" title="æœåŠ¡æä¾›ç«¯"></a>æœåŠ¡æä¾›ç«¯</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-nacos-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-nacos-discovery-producer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>application.yml</code> </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><p><code>bootstrap.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-producer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">spring-cloud</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.producer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringCloudNacosProducerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(SpringCloudNacosProducerApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;get&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">sayHi</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;producer: &quot;</span> + name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®åå°†ä¼šåœ¨è¿™é‡Œçœ‹åˆ°ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070117652.png" alt="image.png"></p><p>å¯ä»¥è®¿é—®ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070118429.png" alt="image.png"></p><h4 id="æœåŠ¡çš„æ¶ˆè´¹ç«¯"><a href="#æœåŠ¡çš„æ¶ˆè´¹ç«¯" class="headerlink" title="æœåŠ¡çš„æ¶ˆè´¹ç«¯"></a>æœåŠ¡çš„æ¶ˆè´¹ç«¯</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-nacos-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zhazha<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-nacos-discovery-consumer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>application.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure><p><code>bootstrap.yml</code> </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">edc7dbc5-31bb-4bb6-bbe7-b76e0828e918</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">spring-cloud</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhazha.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosConsumerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(NacosConsumerApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zhazha.consumer.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ConsumerController</span><span class="params">(RestTemplate restTemplate)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.restTemplate = restTemplate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;consumer/&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">consumer</span><span class="params">(<span class="meta">@PathVariable</span> String name)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> restTemplate.getForObject(<span class="string">&quot;http://localhost:8080/get?name=&#123;name&#125;&quot;</span>, String.class, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070118463.png" alt="image.png"></p><p>æˆåŠŸäº†</p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœåŠ¡å‘ç° </tag>
            
            <tag> æ³¨å†Œä¸­å¿ƒ </tag>
            
            <tag> æœåŠ¡æ³¨å†Œ </tag>
            
            <tag> nacos </tag>
            
            <tag> CAP </tag>
            
            <tag> ä¸€è‡´æ€§ç®—æ³• </tag>
            
            <tag> å…±è¯†ç®—æ³• </tag>
            
            <tag> raft </tag>
            
            <tag> paxos </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01Eurekaå’Œå…¶ä»–æ–¹æ¡ˆ</title>
      <link href="/2022/11/07/02springcloud/01-Eureka%E5%92%8C%E5%85%B6%E4%BB%96%E6%96%B9%E6%A1%88/"/>
      <url>/2022/11/07/02springcloud/01-Eureka%E5%92%8C%E5%85%B6%E4%BB%96%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä»…ç”¨äºå½“å­—å…¸æŸ¥</p><h1 id="Eurekaçš„ç†è®ºéƒ¨åˆ†"><a href="#Eurekaçš„ç†è®ºéƒ¨åˆ†" class="headerlink" title="Eurekaçš„ç†è®ºéƒ¨åˆ†"></a>Eurekaçš„ç†è®ºéƒ¨åˆ†</h1><h2 id="æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Eurekaæ˜¯ä¸€ä¸ªæœåŠ¡æ³¨å†Œå’Œå‘ç°çš„<strong>æ³¨å†Œä¸­å¿ƒ</strong></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070112403.png"></p><p>éœ€è¦æ³¨æ„ä¸Šå›¾åœ¨ Eureka Server å’Œ Service Provider è¿™ä¸¤ä¸ªéƒ¨åˆ†å¯ä»¥åšé›†ç¾¤</p><p>Service Provider å…ˆå°†è‡ªå·±çš„æœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ Eureka Server ä¸­ï¼Œæ¥ç€ Service Consumer ä¹Ÿæ³¨å†Œåˆ° æ³¨å†Œä¸­å¿ƒä¸­ï¼Œç„¶åæ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©æœåŠ¡</p><p>æ³¨å†Œä¸­å¿ƒå°†æœåŠ¡æä¾›è€…çš„åœ°å€å‘é€ç»™ Service Consumer ä¸­ï¼ŒService Consumeråœ¨æ ¹æ®åœ°å€è¿œç¨‹è°ƒç”¨ Service Provider</p><h2 id="Eureka-Server-å’Œ-Eureka-Client-çš„æ•…äº‹"><a href="#Eureka-Server-å’Œ-Eureka-Client-çš„æ•…äº‹" class="headerlink" title="Eureka Server å’Œ Eureka Client çš„æ•…äº‹"></a>Eureka Server å’Œ Eureka Client çš„æ•…äº‹</h2><p>æˆ‘ä»¬ä»¥æˆ¿ä¸œå’Œç§Ÿæˆ·ä¹‹é—´çš„å…³ç³»æ¥å¯¹ç…§ Eureka Server å’Œ Eureka Client ä¹‹é—´çš„å…³ç³»</p><table><thead><tr><th>ç§Ÿæˆ·æ¯ 30 å¤©éœ€è¦äº¤æˆ¿ç§Ÿç»™æˆ¿ä¸œ</th><th>Eureka Client æ¯ 30 ç§’å¯¹ Eureka Server å‘é€ä¸€æ¬¡å¿ƒè·³åŒ…</th></tr></thead><tbody><tr><td>ç§Ÿæˆ·å¦‚æœ90å¤©ï¼ˆä¹Ÿå°±æ˜¯3ä¸ªæœˆï¼‰æ²¡äº¤æˆ¿ç§Ÿï¼Œæˆ¿å­å’ŒæŠ¼é‡‘éƒ½ä¼šè¢«æˆ¿ä¸œæ”¶å›</td><td>Eureka Server å‘ç°æŸä¸ª Eureka Client è¶…è¿‡ 90 ç§’éƒ½æ²¡å‘é€å¿ƒè·³åŒ…ï¼ŒEureka Serverä¼šä»æ³¨å†Œè¡¨ä¸­æŠŠè¯¥ Eureka Client åˆ é™¤</td></tr></tbody></table><h1 id="æ•´åˆEurekaï¼ˆå•æœºï¼‰"><a href="#æ•´åˆEurekaï¼ˆå•æœºï¼‰" class="headerlink" title="æ•´åˆEurekaï¼ˆå•æœºï¼‰"></a>æ•´åˆEurekaï¼ˆå•æœºï¼‰</h1><h2 id="çˆ¶é¡¹ç›®"><a href="#çˆ¶é¡¹ç›®" class="headerlink" title="çˆ¶é¡¹ç›®"></a>çˆ¶é¡¹ç›®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.zhazha.springcloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springcloud_study_parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;cloud-provider-payment8001&lt;/module&gt;</span><br><span class="line">    &lt;/modules&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.7.1&lt;/version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2021.0.3&lt;/version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2021.1&lt;/version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;8.0.29&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;1.2.11&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.2.2&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;4.13.1&lt;/version&gt;</span><br><span class="line">                &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.17.2&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;1.18.24&lt;/version&gt;</span><br><span class="line">                &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">        &lt;/dependencies&gt;</span><br><span class="line">    &lt;/dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;finalName&gt;springcloud_study_parent&lt;/finalName&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.7.1&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;fork&gt;true&lt;/fork&gt;</span><br><span class="line">                    &lt;addResources&gt;true&lt;/addResources&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-api-é¡¹ç›®"><a href="#åˆ›å»º-api-é¡¹ç›®" class="headerlink" title="åˆ›å»º api é¡¹ç›®"></a>åˆ›å»º api é¡¹ç›®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;springcloud_study_parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.zhazha&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-api-common&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.18.22&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;cn.hutool&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.8.4&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud.entities;</span><br><span class="line"></span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Payment implements Serializable &#123;</span><br><span class="line">private Long id;</span><br><span class="line">private String serial;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.zhazha.springcloud.utils;</span><br><span class="line"></span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">public class CommonResult&lt;T&gt; implements Serializable &#123;</span><br><span class="line">private Integer code;</span><br><span class="line">private String message;</span><br><span class="line">private T data;</span><br><span class="line"></span><br><span class="line">public CommonResult(Integer code, String message) &#123;</span><br><span class="line">this.code = code;</span><br><span class="line">this.message = message;</span><br><span class="line">this.data = null;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºæ³¨å†Œä¸­å¿ƒé¡¹ç›®"><a href="#åˆ›å»ºæ³¨å†Œä¸­å¿ƒé¡¹ç›®" class="headerlink" title="åˆ›å»ºæ³¨å†Œä¸­å¿ƒé¡¹ç›®"></a>åˆ›å»ºæ³¨å†Œä¸­å¿ƒé¡¹ç›®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;springcloud_study_parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.zhazha&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-eureka-server7001&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.zhazha&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cloud-api-common&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 7001</span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: localhost</span><br><span class="line">  client:</span><br><span class="line">    register-with-eureka: false # falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span><br><span class="line">    fetch-registry: false # falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">@EnableEurekaServer</span><br><span class="line">public class EurekaMain7001 &#123;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">SpringApplication.run(EurekaMain7001.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡æä¾›è€…"><a href="#æœåŠ¡æä¾›è€…" class="headerlink" title="æœåŠ¡æä¾›è€…"></a>æœåŠ¡æä¾›è€…</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;springcloud_study_parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.zhazha&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-provider-payment8001&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.zhazha&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cloud-api-common&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8001</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-payment-service</span><br><span class="line">  datasource:</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource            # å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver             # mysqlé©±åŠ¨åŒ…</span><br><span class="line">    url: jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span><br><span class="line">    username: root</span><br><span class="line">    password: 123456</span><br><span class="line"></span><br><span class="line">mybatis:</span><br><span class="line">  mapperLocations: classpath:mapper/*.xml</span><br><span class="line">  type-aliases-package: com.zhazha.springcloud.entities    # æ‰€æœ‰Entityåˆ«åç±»æ‰€åœ¨åŒ…</span><br><span class="line">  configuration:</span><br><span class="line">    map-underscore-to-camel-case: true</span><br><span class="line"></span><br><span class="line">#Eurekaé…ç½®</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    # è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServerï¼Œé»˜è®¤ä¸º true</span><br><span class="line">    register-with-eureka: true</span><br><span class="line">    # æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸º true ã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œ</span><br><span class="line">    # é›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆ ribbon ä½¿ç”¨è´Ÿè½½å‡è¡¡</span><br><span class="line">    fetch-registry: true</span><br><span class="line">    # EurekaServerçš„åœ°å€</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://localhost:7001/eureka</span><br></pre></td></tr></table></figure><p>mybatisçš„Mapper xml</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.zhazha.springcloud.dao.PaymentDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;resultMap type=&quot;payment&quot; id=&quot;PaymentMap&quot;&gt;</span><br><span class="line">        &lt;result property=&quot;id&quot; column=&quot;id&quot; jdbcType=&quot;BIGINT&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;serial&quot; column=&quot;serial&quot; jdbcType=&quot;VARCHAR&quot;/&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;getPaymentById&quot; resultMap=&quot;PaymentMap&quot;&gt;</span><br><span class="line">        select * from payment p where p.id = #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud;</span><br><span class="line"></span><br><span class="line">import org.mybatis.spring.annotation.MapperScan;</span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">@MapperScan(value = &quot;com.zhazha.springcloud.dao&quot;)</span><br><span class="line">@EnableEurekaClient</span><br><span class="line">public class PaymentMain8001 &#123;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">SpringApplication.run(PaymentMain8001.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud.dao;</span><br><span class="line"></span><br><span class="line">import com.zhazha.springcloud.entities.Payment;</span><br><span class="line">import org.apache.ibatis.annotations.Insert;</span><br><span class="line">import org.apache.ibatis.annotations.Param;</span><br><span class="line">import org.apache.ibatis.annotations.SelectProvider;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public interface PaymentDao &#123;</span><br><span class="line">@Insert(&quot;insert into payment(serial) values (#&#123;serial&#125;)&quot;)</span><br><span class="line">int create(Payment payment);</span><br><span class="line">//@Select(&quot;select * from payment p where p.id = #&#123;id&#125;&quot;)</span><br><span class="line">Payment getPaymentById(@Param(&quot;id&quot;) Long id);</span><br><span class="line"></span><br><span class="line">@SelectProvider(type = PaymentProvider.class, method = &quot;getAll&quot;)</span><br><span class="line">List&lt;Payment&gt; getAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud.dao;</span><br><span class="line"></span><br><span class="line">import org.apache.ibatis.jdbc.SQL;</span><br><span class="line"></span><br><span class="line">public class PaymentProvider &#123;</span><br><span class="line">public String getAll() &#123;</span><br><span class="line">return new SQL().SELECT(&quot;*&quot;)</span><br><span class="line">.FROM(&quot;payment&quot;).toString();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„ <code>public String getAll()</code>å‡½æ•°å¿…é¡»æ˜¯ <code>public</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud.service;</span><br><span class="line"></span><br><span class="line">import com.zhazha.springcloud.entities.Payment;</span><br><span class="line"></span><br><span class="line">public interface PaymentService &#123;</span><br><span class="line">int create(Payment payment);</span><br><span class="line">Payment getPaymentById(Long id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud.service.impl;</span><br><span class="line"></span><br><span class="line">import com.zhazha.springcloud.dao.PaymentDao;</span><br><span class="line">import com.zhazha.springcloud.entities.Payment;</span><br><span class="line">import com.zhazha.springcloud.service.PaymentService;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class PaymentServiceImpl implements PaymentService &#123;</span><br><span class="line">@Resource</span><br><span class="line">private PaymentDao paymentDao;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public int create(Payment payment) &#123;</span><br><span class="line">return paymentDao.create(payment);</span><br><span class="line">&#125;</span><br><span class="line">@Override</span><br><span class="line">public Payment getPaymentById(Long id) &#123;</span><br><span class="line">return paymentDao.getPaymentById(id);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud.controller;</span><br><span class="line"></span><br><span class="line">import com.zhazha.springcloud.entities.Payment;</span><br><span class="line">import com.zhazha.springcloud.service.PaymentService;</span><br><span class="line">import com.zhazha.springcloud.utils.CommonResult;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">@RequestMapping(&quot;payment&quot;)</span><br><span class="line">public class PaymentController &#123;</span><br><span class="line">@Resource</span><br><span class="line">private PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è¿”å›ç»™å‰ç«¯çš„ç»“æœé›†</span><br><span class="line"> * ä¸‹é¢çš„ RequestBody æ³¨è§£å¦‚æœä¸åŠ ä¸Šï¼Œ restTemplate çš„ postForObject å°†æ— æ³•ä¿å­˜å‚æ•°</span><br><span class="line"> * @param payment</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@PostMapping(value = &quot;create&quot;)</span><br><span class="line">public CommonResult create(@RequestBody Payment payment) &#123;</span><br><span class="line">Integer result = paymentService.create(payment);</span><br><span class="line">log.info(&quot;******æ’å…¥ç»“æœï¼š&quot; + result);</span><br><span class="line">if (result &gt; 0) &#123;</span><br><span class="line">return new CommonResult(200, &quot;æ’å…¥æ•°æ®åº“æˆåŠŸ&quot;, result);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">return new CommonResult(444, &quot;æ’å…¥æ•°æ®åº“å¤±è´¥&quot;, null);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@GetMapping(value = &quot;get/&#123;id&#125;&quot;)</span><br><span class="line">public CommonResult getPaymentByID(@PathVariable(&quot;id&quot;) Long id) &#123;</span><br><span class="line">Payment payment = paymentService.getPaymentById(id);</span><br><span class="line">log.info(&quot;******æ’å…¥ç»“æœï¼š&quot; + payment);</span><br><span class="line">if (payment != null) &#123;</span><br><span class="line">return new CommonResult(200, &quot;æŸ¥è¯¢æˆåŠŸ&quot;, payment);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">return new CommonResult(444, &quot;æ²¡æœ‰æŸ¥è¯¢è®°å½•&quot;, null);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<code>@RequestBody</code>å’Œ<code>@ResponseBody</code>çš„åŠŸèƒ½</p><p>å¦‚æœä¸ä½¿ç”¨ <code>@RequestBody</code>æ¯ä¸ªå±æ€§å¯¹åº”ä¸€ä¸ªå‚æ•°ï¼Œå‚æ•°åœ¨è¯·æ±‚çš„URLä¸­</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070112109.png"></p><p>å¦‚æœä½¿ç”¨ <code>@RequestBody</code>çš„è¯ï¼Œä¸€ä¸ªå®ä½“å¯¹åº”ä¸€ä¸ªå‚æ•°ï¼Œå‚æ•°ä¸åœ¨è¯·æ±‚çš„URLä¸­</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070112323.png"></p><ul><li><code>@RequestBody</code>çš„ä½œç”¨æ˜¯ï¼šè¯»å–<code>Request</code>è¯·æ±‚çš„<code>body</code>éƒ¨åˆ†æ•°æ®ï¼Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤é…ç½®çš„<code>HttpMessageConverter</code>è¿›è¡Œè§£æï¼Œç„¶åæŠŠç›¸åº”çš„æ•°æ®ç»‘å®šåˆ°è¦è¿”å›çš„å¯¹è±¡ä¸Šï¼Œå†æŠŠ<code>HttpMessageConverter</code>è¿”å›çš„å¯¹è±¡æ•°æ®ç»‘å®šåˆ° <code>controller</code>ä¸­æ–¹æ³•çš„å‚æ•°ä¸Šï¼›</li><li><code>@ResponseBody</code>çš„ä½œç”¨æ˜¯ï¼šç”¨äºå°†<code>Controller</code>çš„æ–¹æ³•è¿”å›çš„å¯¹è±¡ï¼Œé€šè¿‡é€‚å½“çš„<code>HttpMessageConverter</code>è½¬æ¢ä¸ºæŒ‡å®šæ ¼å¼åï¼Œå†™å…¥åˆ°Responseå¯¹è±¡çš„bodyæ•°æ®åŒºã€‚è¿”å›çš„æ•°æ®ä¸æ˜¯<code>html</code>æ ‡ç­¾çš„é¡µé¢ï¼Œè€Œæ˜¯å…¶ä»–æŸç§æ ¼å¼çš„æ•°æ®æ—¶ï¼ˆå¦‚<code>json</code>ã€<code>xml</code>ç­‰ï¼‰ä½¿ç”¨</li></ul><p>æ·»åŠ æ—¥å¿—æ˜¾ç¤º mybatis sql:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">logging:</span><br><span class="line">  file:</span><br><span class="line">  # æ—¥å¿—ä¿å­˜ä½ç½®</span><br><span class="line">    path: D:\programs\codes\java\springcloud_study_parent\logs</span><br><span class="line">  level:</span><br><span class="line">    # æŸåŒ…ä¸‹æ—¥å¿—æ‰“å° level</span><br><span class="line">    com:</span><br><span class="line">      zhazha:</span><br><span class="line">        springcloud:</span><br><span class="line">          dao: debug</span><br></pre></td></tr></table></figure><p>è®¿é—®ï¼š <a href="http://localhost:7001/">http://localhost:7001/</a></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070112524.png"></p><p>å°±èƒ½å¤Ÿçœ‹åˆ°ä¸Šé¢å·²ç»å‘ç°äº†æˆ‘ä»¬çš„ 8001 é¡¹ç›®</p><p>å¯ä»¥è®¿é—®ï¼š</p><p><a href="http://localhost:8001/payment/get/2">http://localhost:8001/payment/get/2</a></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070112312.png"></p><h2 id="åˆ›å»ºæ¶ˆè´¹è€…"><a href="#åˆ›å»ºæ¶ˆè´¹è€…" class="headerlink" title="åˆ›å»ºæ¶ˆè´¹è€…"></a>åˆ›å»ºæ¶ˆè´¹è€…</h2><p>maven pom.xml:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;springcloud_study_parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.zhazha.springcloud&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-consumer-order80&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--eureka-client--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.zhazha.springcloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--boot web actuator--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--ä¸€èˆ¬é€šç”¨é…ç½®--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><p>application.yml:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 80</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-order-service</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚</span><br><span class="line">    register-with-eureka: true</span><br><span class="line">    #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span><br><span class="line">    fetchRegistry: true</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://localhost:7001/eureka</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line">import org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">@EnableEurekaClient</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class MainApp80 &#123;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">SpringApplication.run(MainApp80.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">@LoadBalanced</span><br><span class="line">public RestTemplate restTemplate() &#123;</span><br><span class="line">return new RestTemplate();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.zhazha.springcloud.controller;</span><br><span class="line"></span><br><span class="line">import com.zhazha.springcloud.dto.CommonResult;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">@RequestMapping(&quot;consumer&quot;)</span><br><span class="line">public class OrderController &#123;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">public static final String INVOKE_URL = &quot;http://CLOUD-PAYMENT-SERVICE&quot;;</span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;payment/get/&#123;id&#125;&quot;)</span><br><span class="line">public CommonResult get(@PathVariable(&quot;id&quot;) Long id) &#123;</span><br><span class="line">return restTemplate.getForObject(INVOKE_URL + &quot;/payment/get/&#123;id&#125;&quot;, CommonResult.class, id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;payment/eureka&quot;)</span><br><span class="line">public String orderEureka() &#123;</span><br><span class="line">return &quot;order80: &quot; + restTemplate.getForObject(INVOKE_URL + &quot;/payment/eureka&quot;, String.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®: <a href="http://localhost:8080/consumer/payment/get/2">http://localhost:8080/consumer/payment/get/2</a></p><h1 id="æ•´åˆEurekaï¼ˆé›†ç¾¤ï¼‰"><a href="#æ•´åˆEurekaï¼ˆé›†ç¾¤ï¼‰" class="headerlink" title="æ•´åˆEurekaï¼ˆé›†ç¾¤ï¼‰"></a>æ•´åˆ<code>Eureka</code>ï¼ˆé›†ç¾¤ï¼‰</h1><h2 id="eureka-serveré›†ç¾¤"><a href="#eureka-serveré›†ç¾¤" class="headerlink" title="eureka serveré›†ç¾¤"></a>eureka serveré›†ç¾¤</h2><p>æ•´åˆ<code>Eureka</code>é›†ç¾¤çš„å¤§ä½“æ€è·¯æ˜¯ï¼š</p><p><code>Eureka</code>çš„æ³¨å†Œä¸­å¿ƒæ˜¯æ— æ³•è‡ªå·±ç»™è‡ªå·±æ³¨å†Œçš„ï¼Œä½†æ˜¯å¤šä¸ªæ³¨å†Œä¸­å¿ƒæ˜¯å¯ä»¥ç›¸äº’æ³¨å†Œçš„</p><p>æ¯”å¦‚ <code>æ³¨å†Œä¸­å¿ƒA</code> ä¸èƒ½å°†è‡ªå·±æ³¨å†Œåˆ°<code>æ³¨å†Œä¸­å¿ƒA</code>ï¼Œä½†æ˜¯å¯ä»¥å°†è‡ªå·±æ³¨å†Œåˆ° <code>æ³¨å†Œä¸­å¿ƒB</code>ï¼Œè€Œ<code>æ³¨å†Œä¸­å¿ƒB</code>ä¹Ÿå¯ä»¥å°†è‡ªå·±æ³¨å†Œç»™<code>æ³¨å†Œä¸­å¿ƒA</code></p><p>ç°åœ¨æˆ‘ä»¬å…ˆæ–°å»ºä¸¤ä¸ªé¡¹ç›®è¯•è¯•</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070112315.png"></p><p>å°† 7001 é¡¹ç›®ä¸­çš„é…ç½®å’Œæºç å¤åˆ¶åˆ° 7002 ä¸­</p><p>æ¥ç€åªè¦ä¿®æ”¹ï¼š</p><p>port <strong>:</strong> 7001</p><p>hostname <strong>:</strong> eureka7001.com</p><p>defaultZone <strong>: http:&#x2F;&#x2F;</strong> eureka7002.com:7002&#x2F;eureka&#x2F;</p><p>è¿™ä¸‰ä¸ªå°±å¯ä»¥äº†</p><p>7001ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 7001</span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: eureka7001.com #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span><br><span class="line">  client:</span><br><span class="line">    # falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    # falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span><br><span class="line">    fetch-registry: false</span><br><span class="line">    service-url:</span><br><span class="line">      # è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span><br><span class="line">      # defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span><br><span class="line">      defaultZone: http://eureka7002.com:7002/eureka/</span><br></pre></td></tr></table></figure><p>7002:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 7002</span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: eureka7002.com #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span><br><span class="line">  client:</span><br><span class="line">    # falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    # falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span><br><span class="line">    fetch-registry: false</span><br><span class="line">    service-url:</span><br><span class="line">      # è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span><br><span class="line">      # defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span><br><span class="line">      defaultZone: http://eureka7001.com:7001/eureka/</span><br></pre></td></tr></table></figure><h2 id="eurekaæœåŠ¡æä¾›æ–¹é›†ç¾¤"><a href="#eurekaæœåŠ¡æä¾›æ–¹é›†ç¾¤" class="headerlink" title="eurekaæœåŠ¡æä¾›æ–¹é›†ç¾¤"></a>eurekaæœåŠ¡æä¾›æ–¹é›†ç¾¤</h2><p>æœ€åæœåŠ¡çš„æ³¨å†Œé¡¹ç›®ï¼š 8001 <img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070112022.png">éœ€è¦ä¿®æ”¹ä¸€éƒ¨åˆ†é…ç½®ï¼š</p><p>defaultZone <strong>: http:&#x2F;&#x2F;</strong> eureka7001.com:7001&#x2F;eureka&#x2F;,<a href="http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/">http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</a> <em>#å°†æœåŠ¡æ³¨å†Œåˆ° Eureka Server é›†ç¾¤</em></p><p>ç„¶åå†åˆ›å»ºä¸€ä¸ª<code>cloud-provider-payment8002</code>, é…ç½®åŸºæœ¬ä¸€æ ·</p><p>**</p><p>å®Œæ•´ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8001</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-payment-service</span><br><span class="line">  datasource:</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    username: root</span><br><span class="line">    password: 123456</span><br><span class="line">    url: jdbc:mysql://localhost:3306/springcloud2022?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span><br><span class="line">#Eurekaé…ç½®</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    # è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServerï¼Œé»˜è®¤ä¸º true</span><br><span class="line">    register-with-eureka: true</span><br><span class="line">    # æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸º true ã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œ</span><br><span class="line">    # é›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆ ribbon ä½¿ç”¨è´Ÿè½½å‡è¡¡</span><br><span class="line">    fetch-registry: true</span><br><span class="line">    # EurekaServerçš„åœ°å€</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://eureka7001.com:7001/eureka,http://eureka7001.com:7002/eureka</span><br><span class="line">mybatis:</span><br><span class="line">  configuration:</span><br><span class="line">    map-underscore-to-camel-case: true</span><br><span class="line">  mapper-locations: classpath:mapper/*.xml</span><br><span class="line">logging:</span><br><span class="line">  file:</span><br><span class="line">    path: D:\programs\codes\java\springcloud_study_parent\logs</span><br><span class="line">  level:</span><br><span class="line">    com:</span><br><span class="line">      zhazha:</span><br><span class="line">        springcloud:</span><br><span class="line">          dao: debug</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8002</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-payment-service</span><br><span class="line">  datasource:</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    username: root</span><br><span class="line">    password: 123456</span><br><span class="line">    url: jdbc:mysql://localhost:3306/springcloud2022?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span><br><span class="line">#Eurekaé…ç½®</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    # è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServerï¼Œé»˜è®¤ä¸º true</span><br><span class="line">    register-with-eureka: true</span><br><span class="line">    # æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸º true ã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œ</span><br><span class="line">    # é›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆ ribbon ä½¿ç”¨è´Ÿè½½å‡è¡¡</span><br><span class="line">    fetch-registry: true</span><br><span class="line">    # EurekaServerçš„åœ°å€</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://eureka7001.com:7001/eureka,http://eureka7001.com:7002/eureka</span><br><span class="line">mybatis:</span><br><span class="line">  configuration:</span><br><span class="line">    map-underscore-to-camel-case: true</span><br><span class="line">  mapper-locations: classpath:mapper/*.xml</span><br><span class="line">logging:</span><br><span class="line">  file:</span><br><span class="line">    path: D:\programs\codes\java\springcloud_study_parent\logs</span><br><span class="line">  level:</span><br><span class="line">    com:</span><br><span class="line">      zhazha:</span><br><span class="line">        springcloud:</span><br><span class="line">          dao: debug</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>hosts </code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 eureka7001.com</span><br><span class="line">127.0.0.1 eureka7002.com</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„</p><p><code>@LoadBalanced</code>è¿™ä¸ªæ³¨è§£, å¼€å¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡. è¿™ä¸ªä¹‹åä¼šè®²</p><p>æ¥ç€è®¿é—®: <a href="http://localhost/consumer/payment/eureka">http://localhost/consumer/payment/eureka</a> å°±èƒ½çœ‹åˆ° 8001 å’Œ 8002 è½®è¯¢å‡ºç°</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070113018.png"></p><p>è¿™é‡Œå°±æ²¡æˆªå›¾ 8002 äº†</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070113433.png"></p><p>æˆåŠŸäº†ï¼Œè€Œä¸”æ˜¯ä¸¤ä¸ª<code>Eureka Server</code> éƒ½æœ‰</p><p>è¿™é‡Œå°±ä¸ç²˜è´´ <code>eureka02.com</code>çš„ç•Œé¢äº†</p><p>ä»å›¾ä¸­éœ€è¦çŸ¥é“çš„ä¿¡æ¯ï¼š</p><p><code>eureka.instance.hostname=eureka7001.com</code>è¿™ä¸ªé…ç½®æœ€åä¼šæ˜¾ç¤ºåœ¨</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070113724.png"></p><p><code>spring.application.name=cloud-payment-service</code>è¿™ä¸ªé…ç½®æœ€åä¼šæ˜¾ç¤ºåœ¨<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070113624.png"></p><h2 id="Eurekaçš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶"><a href="#Eurekaçš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶" class="headerlink" title="Eurekaçš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶"></a>Eurekaçš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶</h2><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070113420.png"></p><p>ç´§æ€¥æƒ…å†µï¼ EUREKA å¯èƒ½ä¸æ­£ç¡®åœ°å£°ç§°å®ä¾‹å·²å¯åŠ¨ï¼Œä½†å®é™…ä¸Šå¹¶æœªå¯åŠ¨ã€‚ç»­è®¢å°‘äºé˜ˆå€¼ï¼Œå› æ­¤ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå®ä¾‹ä¸ä¼šè¿‡æœŸã€‚</p><p>æœ‰æ—¶å€™æˆ‘ä»¬èƒ½å¤Ÿåœ¨ Eureka æ³¨å†Œä¸­å¿ƒé¡µé¢ä¸Šçœ‹åˆ°ä¸Šé¢è¿™æ ·çš„è­¦å‘Š</p><p>è¿™è¡¨æ˜æ³¨å†Œä¸­å¿ƒï¼ˆ7001ï¼‰æ²¡æœ‰æ”¶åˆ°æœåŠ¡çš„æä¾›è€…ï¼ˆ8001ï¼‰çš„å¿ƒè·³åŒ…ï¼Œä½†å®é™…çš„æœåŠ¡è¿˜ä¼šæ˜¾ç¤ºåœ¨ æ³¨å†Œä¸­å¿ƒé¡µé¢ä¸­</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070113814.png"></p><p>Eureka æ³¨å†Œä¸­å¿ƒçš„è™½ç„¶è®°å½•ä¸‹æœåŠ¡æä¾›è€…çš„ä¿¡æ¯ï¼Œä½†å®é™…ä¸Šå·²ç»æ— æ³•ç»§ç»­æä¾›æœåŠ¡äº†</p><p>è¿™æ˜¯ Eureka è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶çš„ç­–ç•¥ï¼šâ€œå¥½æ­»ä¸å¦‚èµ–æ´»â€</p><p>è¿™ç§æƒ…å†µå­˜åœ¨å¼Šç«¯ï¼ŒæœåŠ¡çš„æ¶ˆè´¹ç«¯å¯èƒ½ä¼šæ­£å·§éœ€è¦è·å¾—è¯¥æœåŠ¡ï¼Œå¯¼è‡´æœåŠ¡è°ƒç”¨å¤±è´¥ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯çš„å®¹é”™æœºåˆ¶æ¥è§£å†³æ­¤é—®é¢˜ï¼Œæ¯”å¦‚ï¼šRibbonå’ŒHystrix</p><p>å¦‚æœéœ€è¦å…³é—­ Eureka çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œåˆ™å¯ä»¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eureka:</span><br><span class="line">  server:</span><br><span class="line">    enable-self-preservation: false # false å…³é—­ Eureka çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œé»˜è®¤æ˜¯å¼€å¯,ä¸€èˆ¬ä¸å»ºè®®å¤§å®¶ä¿®æ”¹</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å¿ƒè·³åŒ…çš„å‘¨æœŸ"><a href="#ä¿®æ”¹å¿ƒè·³åŒ…çš„å‘¨æœŸ" class="headerlink" title="ä¿®æ”¹å¿ƒè·³åŒ…çš„å‘¨æœŸ"></a>ä¿®æ”¹å¿ƒè·³åŒ…çš„å‘¨æœŸ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">instance:</span><br><span class="line">  #å¿ƒè·³æ£€æµ‹ä¸ç»­çº¦æ—¶é—´</span><br><span class="line">  #å¼€å‘æ—¶è®¾ç½®å°ç‚¹ï¼Œä¿è¯æœåŠ¡å…³é—­åæ³¨å†Œä¸­å¿ƒåŠæ—¶å‰”é™¤æœåŠ¡</span><br><span class="line">  #Eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’ï¼ˆé»˜è®¤æ˜¯30ç§’ï¼‰</span><br><span class="line">  lease-renewal-interval-in-seconds: 1</span><br><span class="line">  #EurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºç§’ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰ï¼Œè¶…æ—¶å°†å‰”é™¤æœåŠ¡</span><br><span class="line">  lease-expiration-duration-in-seconds: 2</span><br></pre></td></tr></table></figure><h3 id="ä¸»æœºåç§°-æœåŠ¡åç§°ä¿®æ”¹"><a href="#ä¸»æœºåç§°-æœåŠ¡åç§°ä¿®æ”¹" class="headerlink" title="ä¸»æœºåç§°:æœåŠ¡åç§°ä¿®æ”¹"></a>ä¸»æœºåç§°:æœåŠ¡åç§°ä¿®æ”¹</h3><p>è‡ªå®šä¹‰ä¸€ä¸ªå®¢æˆ·ç«¯çš„åå­—</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070113270.png"></p><p>åªéœ€è¦åœ¨ application.yml æ–‡ä»¶ä¸­åŠ ä¸Š:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    instance-id: payment8001</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®ä¿¡æ¯æœ‰IPä¿¡æ¯æç¤º"><a href="#è®¿é—®ä¿¡æ¯æœ‰IPä¿¡æ¯æç¤º" class="headerlink" title="è®¿é—®ä¿¡æ¯æœ‰IPä¿¡æ¯æç¤º"></a>è®¿é—®ä¿¡æ¯æœ‰IPä¿¡æ¯æç¤º</h3><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070113450.png"></p><p>å¦‚æœä½ å·¦ä¸‹è§’è“è‰²é•¿æ–¹å½¢ä¸­çš„ç½‘å€æ²¡æœ‰ ip æ˜¾ç¤ºåˆ™éœ€è¦:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    prefer-ip-address: true</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨DiscoveryClientæœåŠ¡å‘ç°"><a href="#ä½¿ç”¨DiscoveryClientæœåŠ¡å‘ç°" class="headerlink" title="ä½¿ç”¨DiscoveryClientæœåŠ¡å‘ç°"></a>ä½¿ç”¨<code>DiscoveryClient</code>æœåŠ¡å‘ç°</h2><ol><li>åœ¨ application å¯åŠ¨ç±»ä¸Šæ·»åŠ <code>@EnableDiscoveryClient</code>æ³¨è§£</li><li>å»controlleré‡Œé¢æ³¨å…¥</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Resource</span><br><span class="line">private DiscoveryClient discoveryClient;</span><br><span class="line"></span><br><span class="line">@RequestMapping(value = &quot;discovery&quot;)</span><br><span class="line">@ResponseBody</span><br><span class="line">public Object discovery() &#123;</span><br><span class="line">    List&lt;String&gt; services = this.discoveryClient.getServices();</span><br><span class="line">    for (String service : services) &#123;</span><br><span class="line">        log.info(&quot;*********** service: &quot; + service);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(&quot;CLOUD-PAYMENT-SERVICE&quot;);</span><br><span class="line">    for (ServiceInstance instance : instances) &#123;</span><br><span class="line">        log.info(&quot;service application host = &#123;&#125;, port = &#123;&#125;, uri = &#123;&#125;&quot;, instance.getHost(), instance.getPort(), instance.getUri());</span><br><span class="line">    &#125;</span><br><span class="line">    return this.discoveryClient;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c.z.s.controller.PaymentController: *********** service: cloud-payment-service</span><br><span class="line">c.z.s.controller.PaymentController: service application host = 192.168.19.1, port = 8001, uri = http://192.168.19.1:8001</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;services&quot;: [</span><br><span class="line">    &quot;cloud-payment-service&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;order&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Eurekaåœæ›´"><a href="#Eurekaåœæ›´" class="headerlink" title="Eurekaåœæ›´"></a>Eurekaåœæ›´</h2><p>Eureka ç›®å‰å·²ç»åœæ›´å¥½å‡ å¹´äº†ï¼Œå¾ˆå¤šå…¬å¸ä¹Ÿæ—©æ—©è½¬ç§»æˆ˜åœº</p><p>ç›®å‰å¸‚é¢ä¸Šçš„ä»£æ›¿æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼š</p><ol><li>zookeeperï¼ˆCPï¼‰ paxos å…±è¯†</li><li>consulï¼ˆCPï¼‰ raft å…±è¯†</li><li>nacosï¼ˆCPã€APï¼‰ jraft + distro â˜… æ¨èä½¿ç”¨</li></ol><h1 id="zookeeperä»£æ›¿æ–¹æ¡ˆ"><a href="#zookeeperä»£æ›¿æ–¹æ¡ˆ" class="headerlink" title="zookeeperä»£æ›¿æ–¹æ¡ˆ"></a>zookeeperä»£æ›¿æ–¹æ¡ˆ</h1><h2 id="zkå¯åŠ¨"><a href="#zkå¯åŠ¨" class="headerlink" title="zkå¯åŠ¨"></a>zkå¯åŠ¨</h2><p>ç›´æ¥åœ¨ linux çš„ docker ç¯å¢ƒä¸‹å¯åŠ¨</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070113964.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.9&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  zoo1:</span><br><span class="line">    image: zookeeper:3.8.0</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: zoo1</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;2181:2181&quot;</span><br><span class="line">    environment:</span><br><span class="line">      ZOO_MY_ID: 1</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;/root/zookeeper/zoo.cfg:/conf/zoo.cfg&quot;</span><br><span class="line">    privileged: true</span><br><span class="line">    container_name: zoo1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/data</span><br><span class="line">dataLogDir=/datalog</span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br><span class="line">autopurge.snapRetainCount=3</span><br><span class="line">autopurge.purgeInterval=0</span><br><span class="line">maxClientCnxns=60</span><br><span class="line">standaloneEnabled=true</span><br><span class="line">admin.enableServer=true</span><br><span class="line">server.1=localhost:2888:3888;2181</span><br></pre></td></tr></table></figure><p><code>docker compose up -d</code> åˆ›å»ºå¹¶å¯åŠ¨ <code>zookeeper</code></p><p>è¿™é‡Œéœ€è¦æ³¨æ„ zookeeper çš„ç‰ˆæœ¬ 3.8.0</p><p>å¦‚æœåœ¨windowä¸‹å¯åŠ¨, éœ€è¦ä¿®æ”¹ <code>zoo_sample.cfg</code>ä¸º <code>zoo.cfg</code></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070113616.png"></p><p>ç„¶ååœ¨æ§åˆ¶å°ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zkServer.cmd</span><br></pre></td></tr></table></figure><h2 id="zkæœåŠ¡æä¾›æ–¹"><a href="#zkæœåŠ¡æä¾›æ–¹" class="headerlink" title="zkæœåŠ¡æä¾›æ–¹"></a>zkæœåŠ¡æä¾›æ–¹</h2><p>åˆ›å»ºé¡¹ç›®ï¼š</p><p><code>cloud-provider-payment8004</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;springcloud_study_parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.zhazha&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-provider-payment8004&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.zhazha&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cloud-api-common&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- SpringBootæ•´åˆzookeeperå®¢æˆ·ç«¯,è¿™é‡Œä¸å†ä½¿ç”¨Eurekaè¿›è¡ŒæœåŠ¡æ³¨å†Œï¼Œæ‰€ä»¥è¿™é‡Œå¯¼å…¥çš„æ˜¯Zookeeperçš„ç›¸å…³ä¾èµ– --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt;</span><br><span class="line">            &lt;!-- å…ˆæ’é™¤è‡ªå¸¦çš„zookeeper --&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">            &lt;/exclusions&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--æ·»åŠ zookeeper3.8.0ç‰ˆæœ¬ï¼Œæ³¨æ„è¿™é‡Œè¦å’Œ zookeeper åº”ç”¨å¯åŠ¨çš„ç‰ˆæœ¬ä¸€è‡´ --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.8.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- çƒ­éƒ¨ç½²ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ <code>zookeeper </code>çš„ç‰ˆæœ¬ <code>jar </code>åŒ… æ˜¯ <code>3.8.0</code>ï¼Œè¦å’Œ <code>docker </code>çš„ <code>zookeeper </code>ç‰ˆæœ¬ä¸€è‡´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">public class PaymentMain8004 &#123;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">SpringApplication.run(PaymentMain8004.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.zhazha.springcloud.controller;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">import java.util.UUID;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class PaymentController &#123;</span><br><span class="line"></span><br><span class="line">@Value(&quot;$&#123;server.port&#125;&quot;)</span><br><span class="line">private String serverPort;</span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;payment/zk&quot;)</span><br><span class="line">public String paymentZk() &#123;</span><br><span class="line">    return &quot;springcloud with zookeeper:&quot;+serverPort+&quot;\t&quot;+ UUID.randomUUID();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ° zookeeper ä¸­è¢«æ³¨å†Œçš„æœåŠ¡ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070114008.png"></p><p>è®¿é—®ï¼š<a href="http://localhost:8004/payment/zk">http://localhost:8004/payment/zk</a></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070114257.png"></p><p>å½“æˆ‘ä»¬å…³é—­ 8004 é¡¹ç›®ï¼Œzookeeper ä¼šä¸€å®šæ—¶é—´å†…å¿ƒè·³éªŒè¯</p><p>ç„¶åç«‹å³åˆ é™¤æ‰æœåŠ¡</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070114613.png"></p><p>è¿™å’ŒEurekaä¸ç›¸åŒ</p><p>zookeeper CP ä¸ Eureka AP</p><p>å†ä¹…ä¸€ç‚¹è¿ <code>service</code> èŠ‚ç‚¹éƒ½æ²¡äº†</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd798a5c807a4c89b0d00c9edcdb6881~tplv-k3u1fbpfcp-zoom-1.image"></p><h2 id="zkæœåŠ¡æ¶ˆè´¹æ–¹"><a href="#zkæœåŠ¡æ¶ˆè´¹æ–¹" class="headerlink" title="zkæœåŠ¡æ¶ˆè´¹æ–¹"></a>zkæœåŠ¡æ¶ˆè´¹æ–¹</h2><p>åˆ›å»º <code>cloud-consumerzk-order80</code> é¡¹ç›®</p><p><code>pom.xml</code> å’Œ 8004 é¡¹ç›®ä¸€è‡´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 80</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-consumer-order</span><br><span class="line">  cloud:</span><br><span class="line">    zookeeper:</span><br><span class="line">      connect-string: 192.168.0.155:2181</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line">import org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class OrderZKMain80 &#123;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">@LoadBalanced</span><br><span class="line">public RestTemplate restTemplate() &#123;</span><br><span class="line">return new RestTemplate();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">SpringApplication.run(OrderZKMain80.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.zhazha.springcloud.controller;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class OrderZKController &#123;</span><br><span class="line"></span><br><span class="line">public static final String INVOKE_URL = &quot;http://cloud-provider-payment&quot;;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;/consumer/payment/zk&quot;)</span><br><span class="line">public String paymentInfo() &#123;</span><br><span class="line">return restTemplate.getForObject(INVOKE_URL + &quot;/payment/zk&quot;, String.class);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®ï¼š<a href="http://localhost/consumer/payment/zk">http://localhost/consumer/payment/zk</a></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070114708.png"></p><p>è¿œç¨‹è°ƒç”¨æˆåŠŸ</p><h1 id="Consulä»£æ›¿æ–¹æ¡ˆ"><a href="#Consulä»£æ›¿æ–¹æ¡ˆ" class="headerlink" title="Consulä»£æ›¿æ–¹æ¡ˆ"></a>Consulä»£æ›¿æ–¹æ¡ˆ</h1><h2 id="Consulæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Consulæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Consulæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Consulæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>ConsulåŒ…å«å¤šä¸ªç»„ä»¶,ä½†æ˜¯ä½œä¸ºä¸€ä¸ªæ•´ä½“,ä¸ºä½ çš„åŸºç¡€è®¾æ–½æä¾›<strong>æœåŠ¡å‘ç°</strong>å’Œ<strong>æœåŠ¡é…ç½®</strong>çš„å·¥å…·.ä»–æä¾›ä»¥ä¸‹å…³é”®ç‰¹æ€§:</p><ul><li><strong>æœåŠ¡å‘ç°</strong> Consulçš„å®¢æˆ·ç«¯å¯ç”¨æä¾›ä¸€ä¸ªæœåŠ¡,æ¯”å¦‚ api æˆ–è€…mysql ,å¦å¤–ä¸€äº›å®¢æˆ·ç«¯å¯ç”¨ä½¿ç”¨Consulå»å‘ç°ä¸€ä¸ªæŒ‡å®šæœåŠ¡çš„æä¾›è€….é€šè¿‡DNSæˆ–è€…HTTPåº”ç”¨ç¨‹åºå¯ç”¨å¾ˆå®¹æ˜“çš„æ‰¾åˆ°ä»–æ‰€ä¾èµ–çš„æœåŠ¡.</li><li><strong>å¥åº·æ£€æŸ¥</strong> Consulå®¢æˆ·ç«¯å¯ç”¨æä¾›ä»»æ„æ•°é‡çš„å¥åº·æ£€æŸ¥,æŒ‡å®šä¸€ä¸ªæœåŠ¡(æ¯”å¦‚:webserveræ˜¯å¦è¿”å›äº†200 OK çŠ¶æ€ç )æˆ–è€…ä½¿ç”¨æœ¬åœ°èŠ‚ç‚¹(æ¯”å¦‚:å†…å­˜ä½¿ç”¨æ˜¯å¦å¤§äº90%). è¿™ä¸ªä¿¡æ¯å¯ç”±operatorç”¨æ¥ç›‘è§†é›†ç¾¤çš„å¥åº·.è¢«æœåŠ¡å‘ç°ç»„ä»¶ç”¨æ¥é¿å…å°†æµé‡å‘é€åˆ°ä¸å¥åº·çš„ä¸»æœº.</li><li><strong>Key&#x2F;Valueå­˜å‚¨</strong> åº”ç”¨ç¨‹åºå¯ç”¨æ ¹æ®è‡ªå·±çš„éœ€è¦ä½¿ç”¨Consulçš„å±‚çº§çš„Key&#x2F;Valueå­˜å‚¨.æ¯”å¦‚åŠ¨æ€é…ç½®,åŠŸèƒ½æ ‡è®°,åè°ƒ,é¢†è¢–é€‰ä¸¾ç­‰ç­‰,ç®€å•çš„HTTP APIè®©ä»–æ›´æ˜“äºä½¿ç”¨.</li><li><strong>å®‰å…¨æœåŠ¡é€šä¿¡</strong>ï¼šConsulå¯ä»¥ä¸ºæœåŠ¡ç”Ÿæˆå’Œåˆ†å‘TLSè¯ä¹¦ï¼Œä»¥å»ºç«‹ç›¸äº’çš„TLSè¿æ¥ã€‚æ„å›¾å¯ç”¨äºå®šä¹‰å…è®¸å“ªäº›æœåŠ¡é€šä¿¡ã€‚æœåŠ¡åˆ†å‰²å¯ä»¥å¾ˆå®¹æ˜“åœ°è¿›è¡Œç®¡ç†ï¼Œå…¶ç›®çš„æ˜¯å¯ä»¥å®æ—¶æ›´æ”¹çš„ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤æ‚çš„ç½‘ç»œæ‹“æ‰‘å’Œé™æ€é˜²ç«å¢™è§„åˆ™ã€‚</li><li><strong>å¤šæ•°æ®ä¸­å¿ƒ</strong>: Consulæ”¯æŒå¼€ç®±å³ç”¨çš„å¤šæ•°æ®ä¸­å¿ƒ.è¿™æ„å‘³ç€ç”¨æˆ·ä¸éœ€è¦æ‹…å¿ƒéœ€è¦å»ºç«‹é¢å¤–çš„æŠ½è±¡å±‚è®©ä¸šåŠ¡æ‰©å±•åˆ°å¤šä¸ªåŒºåŸŸ.</li></ul><p>Consulé¢å‘DevOpså’Œåº”ç”¨å¼€å‘è€…å‹å¥½.æ˜¯ä»–é€‚åˆç°ä»£çš„å¼¹æ€§çš„åŸºç¡€è®¾æ–½.</p><p>éœ€è¦æ³¨æ„å®ƒæ˜¯ç”¨ golang å†™çš„</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070114129.png"></p><ol><li>èŠ‚ç‚¹åˆ†ç±»</li></ol><!----><ol><li><ol><li>Consul åˆ†ä¸º Client å’Œ Serverä¸¤ç§èŠ‚ç‚¹(æ‰€æœ‰çš„èŠ‚ç‚¹ä¹Ÿè¢«ç§°ä¸ºAgent)ï¼Œå…¶ä¸­Server èŠ‚ç‚¹ä¿å­˜æ•°æ®ï¼ŒClient è´Ÿè´£å¥åº·æ£€æŸ¥åŠè½¬å‘æ•°æ®è¯·æ±‚åˆ°Serverã€‚æ‰€æœ‰çš„ Server èŠ‚ç‚¹ç»„æˆäº†ä¸€ä¸ªé›†ç¾¤ï¼Œä»–ä»¬ä¹‹é—´è¿è¡Œ Raft åè®®ï¼Œé€šè¿‡å…±è¯†ä»²è£é€‰ä¸¾å‡º Leaderã€‚æ‰€æœ‰çš„ä¸šåŠ¡æ•°æ®éƒ½é€šè¿‡ Leader å†™å…¥åˆ°é›†ç¾¤ä¸­åšæŒä¹…åŒ–ï¼Œå½“æœ‰åŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹å­˜å‚¨äº†è¯¥æ•°æ®åï¼ŒServeré›†ç¾¤æ‰ä¼šè¿”å›ACKï¼Œä»è€Œä¿éšœäº†æ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚æ‰€æœ‰çš„ Follower ä¼šè·Ÿéš Leader çš„è„šæ­¥ï¼Œä¿è¯å…¶æœ‰æœ€æ–°çš„æ•°æ®å‰¯æœ¬</li></ol></li></ol><!----><ol start="2"><li>æ•°æ®ä¸­å¿ƒå†…éƒ¨é€šä¿¡</li></ol><!----><ol><li><ol><li>Consul æ•°æ®ä¸­å¿ƒå†…éƒ¨çš„æ‰€æœ‰èŠ‚ç‚¹é€šè¿‡ Gossip åè®®ï¼ˆ8301ç«¯å£ï¼‰ç»´æŠ¤æˆå‘˜å…³ç³»ï¼Œè¿™ä¹Ÿè¢«å«åšLAN GOSSIPã€‚å½“æ•°æ®ä¸­å¿ƒå†…éƒ¨å‘ç”Ÿæ‹“æ‰‘å˜åŒ–æ—¶ï¼Œå­˜æ´»çš„èŠ‚ç‚¹ä»¬èƒ½å¤ŸåŠæ—¶æ„ŸçŸ¥ï¼Œæ¯”å¦‚ServerèŠ‚ç‚¹downæ‰åï¼ŒClient å°±ä¼šå°†å¯¹åº”ServerèŠ‚ç‚¹ä»å¯ç”¨åˆ—è¡¨ä¸­å‰¥ç¦»å‡ºå»ã€‚é›†ç¾¤å†…æ•°æ®çš„è¯»å†™è¯·æ±‚æ—¢å¯ä»¥ç›´æ¥å‘åˆ°Serverï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Client è½¬å‘åˆ°Serverï¼Œè¯·æ±‚æœ€ç»ˆä¼šåˆ°è¾¾ Leader èŠ‚ç‚¹ã€‚åœ¨å…è®¸æ•°æ®è½»å¾®é™ˆæ—§çš„æƒ…å†µä¸‹ï¼Œè¯»è¯·æ±‚ä¹Ÿå¯ä»¥åœ¨æ™®é€šçš„ServerèŠ‚ç‚¹å®Œæˆï¼Œé›†ç¾¤å†…æ•°æ®çš„è¯»å†™å’Œå¤åˆ¶éƒ½æ˜¯é€šè¿‡8300ç«¯å£å®Œæˆ</li></ol></li></ol><!----><ol start="3"><li>è·¨æ•°æ®ä¸­å¿ƒé€šä¿¡</li></ol><!----><ol><li><ol><li>Consulæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼Œä¸Šå›¾ä¸­æœ‰ä¸¤ä¸ª DataCenterï¼Œä»–ä»¬é€šè¿‡ç½‘ç»œäº’è”ï¼Œæ³¨æ„ä¸ºäº†æé«˜é€šä¿¡æ•ˆç‡ï¼Œåªæœ‰ServerèŠ‚ç‚¹æ‰åŠ å…¥è·¨æ•°æ®ä¸­å¿ƒçš„é€šä¿¡ã€‚è·¨æ•°æ®ä¸­å¿ƒçš„ Gossip åè®®ä½¿ç”¨8302ç«¯å£ï¼Œä¹Ÿè¢«ç§°ä¸ºWAN GOSSIPï¼Œæ˜¯å…¨å±€èŒƒå›´å†…å”¯ä¸€çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸åŒçš„Consulæ•°æ®ä¸­å¿ƒä¹‹é—´ä¸ä¼šå¤åˆ¶æ•°æ®ã€‚å½“è¯·æ±‚å¦ä¸€ä¸ªæ•°æ®ä¸­å¿ƒçš„èµ„æºæ—¶ï¼ŒServer ä¼šå°†å…¶è½¬å‘åˆ°ç›®æ ‡æ•°æ®ä¸­å¿ƒçš„éšæœºServer èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹éšåå¯ä»¥è½¬å‘ç»™æœ¬åœ° Leader å¤„ç†</li></ol></li></ol><table><thead><tr><th><strong>ç«¯å£</strong></th><th><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td>8300</td><td>RPC è°ƒç”¨</td></tr><tr><td>8301</td><td>æ•°æ®ä¸­å¿ƒå†…éƒ¨ GOSSIP åè®®ä½¿ç”¨</td></tr><tr><td>8302</td><td>è·¨æ•°æ®ä¸­å¿ƒ GOSSIP åè®®ä½¿ç”¨</td></tr><tr><td>8500</td><td>HTTP API å’Œ Web æ¥å£ä½¿ç”¨</td></tr><tr><td>8600</td><td>ç”¨äº DNS æœåŠ¡ç«¯</td></tr></tbody></table><h2 id="ConsulæœåŠ¡çš„æ³¨å†Œä¸å‘ç°"><a href="#ConsulæœåŠ¡çš„æ³¨å†Œä¸å‘ç°" class="headerlink" title="ConsulæœåŠ¡çš„æ³¨å†Œä¸å‘ç°"></a>ConsulæœåŠ¡çš„æ³¨å†Œä¸å‘ç°</h2><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070114096.png"></p><p>ç»¿è‰²æ–¹æ¡†æ˜¯æœåŠ¡çš„æ³¨å†Œä¸­å¿ƒï¼Œä½¿ç”¨ raft å…±è¯†ç®—æ³•é€‰ä¸¾å‡º leader å’Œ follower ä¸¤ç§èŠ‚ç‚¹</p><p>çº¢è‰²æ˜¯æœåŠ¡çš„æ³¨å†Œæ–¹ï¼Œconsul çš„ clientæ¨¡å¼ å°†æœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ</p><p>è“è‰²æ˜¯æœåŠ¡çš„æ¶ˆè´¹æ–¹ï¼Œconsul client å»æ³¨å†Œä¸­å¿ƒæ‹¿æœåŠ¡ä¿¡æ¯ï¼Œæ¥ç€è¯†åˆ«ä¿¡æ¯è¿œç¨‹è°ƒç”¨çº¢è‰²èŠ‚ç‚¹çš„æœåŠ¡</p><p>dubboç»å…¸è°ƒç”¨å…³ç³».jpg</p><h2 id="springcloudæ•´åˆConsul"><a href="#springcloudæ•´åˆConsul" class="headerlink" title="springcloudæ•´åˆConsul"></a>springcloudæ•´åˆConsul</h2><h3 id="æœåŠ¡çš„æä¾›æ–¹"><a href="#æœåŠ¡çš„æä¾›æ–¹" class="headerlink" title="æœåŠ¡çš„æä¾›æ–¹"></a>æœåŠ¡çš„æä¾›æ–¹</h3><p>åˆ›å»º<code>cloud-providerconsul-payment8006</code>é¡¹ç›®</p><p>æ·»åŠ <code>pom.xml</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;springcloud_study_parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.zhazha&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-providerconsul-payment8006&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;&lt;!--SpringCloud consul-server --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.zhazha&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cloud-api-common&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8006</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: consul-provider-payment</span><br><span class="line">  cloud:</span><br><span class="line">    consul:</span><br><span class="line">      port: 8500</span><br><span class="line">      host: 127.0.0.1</span><br><span class="line">      discovery:</span><br><span class="line">        service-name: service-producer</span><br></pre></td></tr></table></figure><table><thead><tr><th>If you use <a href="https://docs.spring.io/spring-cloud-consul/docs/current/reference/html/#spring-cloud-consul-config">Spring Cloud Consul Config</a>, and you have set spring.cloud.bootstrap.enabled&#x3D;true or spring.config.use-legacy-processing&#x3D;true or use spring-cloud-starter-bootstrap, then the above values will need to be placed in bootstrap.yml instead of application.yml.</th></tr></thead></table><p>è¿™é‡Œéœ€è¦æ³¨æ„åˆ°ï¼Œå¦‚æœæ˜¯å¼€å¯äº† bootstrap ä¸»é”®ï¼Œåˆ™éœ€è¦å°† ä¸Šé¢çš„ é…ç½®ä» application.yml è½¬ç§»åˆ° bootstrap.yml ä¸­</p><p>To disable the Consul Discovery Client you can set spring.cloud.consul.discovery.enabled to false. Consul Discovery Client will also be disabled when spring.cloud.discovery.enabled is set to false.</p><p>å¹¶ä¸”å¦‚æœä½ éœ€è¦ç¦æ­¢ Consul Discovery Clientï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬ç°åœ¨è¿™ä¸ªé¡¹ç›®ï¼‰å»å‘ç°æœåŠ¡ï¼Œå¯ä»¥<code>spring.cloud.consul.discovery.enabled </code>è®¾ç½®ä¸º<code> false</code></p><p>To disable the service registration you can set spring.cloud.consul.discovery.register to false.</p><p>åŒæ—¶å‘¢ï¼Œè¦ç¦æ­¢æœåŠ¡æ³¨å†Œï¼Œä½ å¯ä»¥è®¾ç½® <code>spring.cloud.consul.discovery.register</code>ä¸º <code>false</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class PaymentConsulMain8006 &#123;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">SpringApplication.run(PaymentConsulMain8006.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®ï¼š<a href="http://localhost:8500/">http://localhost:8500/</a></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070114418.png"></p><p>å¯ä»¥çœ‹åˆ°<code>spring.cloud.consul.discovery.service-name=service-producer</code>é…ç½®å†³å®šäº† service ä¸­çš„åå­—ï¼Œ<strong>åæœŸå®¢æˆ·ç«¯ä¼šæ ¹æ®è¿™ä¸ªåç§°æ¥è¿›è¡ŒæœåŠ¡è°ƒç”¨ã€‚</strong></p><p>è€Œæˆ‘ä»¬çš„ <code>spring.application.name=consul-provider-payment-8006</code>å‡ºç°åœ¨<img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070114458.png"></p><p>è¡¨ç¤º <code>service-producer</code>ä¸‹é¢æœ‰ä¸€ä¸ªå«<code>consul-provider-payment-8006</code>çš„å®ä¾‹</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211070114951.png"></p><h3 id="æœåŠ¡çš„æ¶ˆè´¹æ–¹"><a href="#æœåŠ¡çš„æ¶ˆè´¹æ–¹" class="headerlink" title="æœåŠ¡çš„æ¶ˆè´¹æ–¹"></a>æœåŠ¡çš„æ¶ˆè´¹æ–¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">       &lt;!--SpringCloud consul-server --&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">           &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">           &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">           &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">           &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">   &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">###consulæœåŠ¡ç«¯å£å·</span><br><span class="line">server:</span><br><span class="line">  port: 80</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-consumer-order</span><br><span class="line">  ####consulæ³¨å†Œä¸­å¿ƒåœ°å€</span><br><span class="line">  cloud:</span><br><span class="line">    consul:</span><br><span class="line">      host: 127.0.0.1</span><br><span class="line">      port: 8500</span><br><span class="line">      discovery:</span><br><span class="line">        #hostname: 127.0.0.1</span><br><span class="line">        service-name: $&#123;spring.application.name&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å¦‚æœè¦æŠŠæ¶ˆè´¹ç«¯å˜å¾—æ›´åŠ çº¯ç²¹ï¼Œå¯ä»¥æ·»åŠ <code>spring.cloud.consul.discovery.register=false</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line">import org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class OrderConsulMain80 &#123;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">@LoadBalanced</span><br><span class="line">public RestTemplate restTemplate() &#123;</span><br><span class="line">return new RestTemplate();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">SpringApplication.run(OrderConsulMain80.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package com.zhazha.springcloud.controller;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@Slf4j</span><br><span class="line">public class OrderConsulController &#123;</span><br><span class="line"></span><br><span class="line">// æœåŠ¡çš„æä¾›çš„ spring.cloud.consul.discovery.service-name=service-producer </span><br><span class="line">// é…ç½®å†³å®šäº†ï¼ŒæœåŠ¡çš„æ¶ˆè´¹æ–¹ä½¿ç”¨çš„åœ°å€</span><br><span class="line">// è¿™é‡Œçš„åœ°å€ä¸å†æ˜¯æœåŠ¡æä¾›æ–¹çš„ spring.application.name</span><br><span class="line">public static final String INVOKE_URL = &quot;http://service-producer&quot;;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;consumer/payment/consul&quot;)</span><br><span class="line">public String paymentInfo() &#123;</span><br><span class="line">return restTemplate.getForObject(INVOKE_URL + &quot;/payment/consul&quot;, String.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h1><p>ä¸‹æœŸ</p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> eureka </tag>
            
            <tag> zookeeper </tag>
            
            <tag> consul </tag>
            
            <tag> æœåŠ¡å‘ç° </tag>
            
            <tag> æ³¨å†Œä¸­å¿ƒ </tag>
            
            <tag> æœåŠ¡æ³¨å†Œ </tag>
            
            <tag> è´Ÿè½½å‡è¡¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿˜ç”¨ä»€ä¹ˆmybatisï¼Ÿè¿™äº›æ–¹æ³•ä¸é¦™ä¹ˆï¼Ÿä¸é¦™</title>
      <link href="/2022/11/07/03ORM/01%E8%BF%98%E7%94%A8%E4%BB%80%E4%B9%88mybatis%EF%BC%9F%E8%BF%99%E4%BA%9B%E6%96%B9%E6%B3%95%E4%B8%8D%E9%A6%99%E4%B9%88%EF%BC%9F%E4%B8%8D%E9%A6%99/"/>
      <url>/2022/11/07/03ORM/01%E8%BF%98%E7%94%A8%E4%BB%80%E4%B9%88mybatis%EF%BC%9F%E8%BF%99%E4%BA%9B%E6%96%B9%E6%B3%95%E4%B8%8D%E9%A6%99%E4%B9%88%EF%BC%9F%E4%B8%8D%E9%A6%99/</url>
      
        <content type="html"><![CDATA[<h1 id="å„ç§ç©æ³•"><a href="#å„ç§ç©æ³•" class="headerlink" title="å„ç§ç©æ³•"></a>å„ç§ç©æ³•</h1><ol><li>æ³¨è§£å’ŒXMLæ–¹å¼</li><li>mybatis çš„ SQL è¯­å¥æ„å»ºå™¨(ä¸å¥½ç”¨)</li><li>æ•´åˆmybatis-dynamic-sql(ä¸å¥½ç”¨)</li><li>fluent-mybatis(è¿˜ä¸é”™, ä½†ä¸æ¨èä½¿ç”¨)</li><li>jpa + queryDSL(æœ€èˆ’æœ)</li></ol><h2 id="æ­ä¸ªåŸºç¡€æ¶æ„"><a href="#æ­ä¸ªåŸºç¡€æ¶æ„" class="headerlink" title="æ­ä¸ªåŸºç¡€æ¶æ„"></a>æ­ä¸ªåŸºç¡€æ¶æ„</h2><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211072109613.png" alt="image-20221107210959557"></p><p>Userè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">USER</span> (</span><br><span class="line"> `id`<span class="type">INT</span>(<span class="number">11</span>)<span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line"> `username` <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>,</span><br><span class="line"> `telephone`    <span class="type">VARCHAR</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ‰‹æœº&#x27;</span>,</span><br><span class="line"> `birthday`DATETIME <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”Ÿæ—¥&#x27;</span>,</span><br><span class="line"> `gender`  <span class="type">CHAR</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ€§åˆ«&#x27;</span>,</span><br><span class="line"> `address` <span class="type">VARCHAR</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åœ°å€&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY  (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure><p>Accountè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `account` (</span><br><span class="line">  `ID` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç¼–å·&#x27;</span>,</span><br><span class="line">  `UID` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·ç¼–å·&#x27;</span>,</span><br><span class="line">  `MONEY` <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é‡‘é¢&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`ID`),</span><br><span class="line">  KEY `FK_Reference_8` (`UID`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure><p>roleè¡¨:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `role` (</span><br><span class="line">  `ID` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç¼–å·&#x27;</span>,</span><br><span class="line">  `ROLE_NAME` <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;èŒä½&#x27;</span>,</span><br><span class="line">  `ROLE_DESC` <span class="type">varchar</span>(<span class="number">60</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æè¿°&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`ID`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure><p>user_roleè¡¨:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `user_role` (</span><br><span class="line">  `UID` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·ç¼–å·&#x27;</span>,</span><br><span class="line">  `RID` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;èŒä½ç¼–å·&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`UID`,`RID`),</span><br><span class="line">  KEY `FK_Reference_10` (`RID`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `FK_Reference_10` <span class="keyword">FOREIGN</span> KEY (`RID`) <span class="keyword">REFERENCES</span> `role` (`ID`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `FK_Reference_9` <span class="keyword">FOREIGN</span> KEY (`UID`) <span class="keyword">REFERENCES</span> `<span class="keyword">user</span>` (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-extension<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">mybatis-base</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/jpa?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span> <span class="comment"># mybatis plus sqlæ§åˆ¶å°æ‰“å°å‡ºæ¥</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.zhazha.xml.entity</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">banner:</span> <span class="string">off</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨EasyCodeæ’ä»¶ç”Ÿæˆå¯¹åº”ä»£ç </p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211072112350.png" alt="image-20221107211223266"></p><h2 id="åŸºæ“ï¼šXML-çš„æ–¹å¼"><a href="#åŸºæ“ï¼šXML-çš„æ–¹å¼" class="headerlink" title="åŸºæ“ï¼šXML çš„æ–¹å¼"></a>åŸºæ“ï¼šXML çš„æ–¹å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_">Model</span>&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="comment">//ç”¨æˆ·å</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="comment">//æ‰‹æœº</span></span><br><span class="line"><span class="keyword">private</span> String telephone;</span><br><span class="line"><span class="comment">//ç”Ÿæ—¥</span></span><br><span class="line"><span class="keyword">private</span> Date birthday;</span><br><span class="line"><span class="comment">//æ€§åˆ«</span></span><br><span class="line"><span class="keyword">private</span> String gender;</span><br><span class="line"><span class="comment">//åœ°å€</span></span><br><span class="line"><span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Set&lt;Account&gt; accounts;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> <span class="keyword">extends</span> <span class="title class_">Model</span>&lt;Account&gt; &#123;</span><br><span class="line"><span class="comment">//ç¼–å·</span></span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="comment">//ç”¨æˆ·ç¼–å·</span></span><br><span class="line"><span class="keyword">private</span> Integer uid;</span><br><span class="line"><span class="comment">//é‡‘é¢</span></span><br><span class="line"><span class="keyword">private</span> Long money;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> User user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜:</p><p>ç”±äºæˆ‘ä»¬çš„ä»£ç éƒ½æ˜¯ç”± EasyCode æ’ä»¶ç”Ÿæˆ, æ‰€ä»¥æ‰€æœ‰çš„Daoä»£ç éƒ½ä¼šç»§æ‰¿ä¸€ä¸ªBaseMapperæ¥å£, ç»§æ‰¿è¿™ä¸ªæ¥å£</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211081031727.png" alt="image-20221108103020026"></p><p>ä¹‹å<code>UserDao</code>çš„ <code>sql</code>éƒ½æ˜¯ç”± <code>mybatis-plus</code>æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆçš„, ç”Ÿæˆçš„ä»£ç å°†ä¼šæ˜¯è¿™æ ·<code>select id, username, telephone, birthday, gender, address, accounts from user u </code>, è¿™é‡Œæœ‰ä¸€ä¸ªå­—æ®µ<code>accounts</code>å¹¶ä¸æ˜¯<code>user</code>è¡¨çš„å­—æ®µ</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211081035633.png" alt="image-20221108103552549"></p><p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¸æ³¨æ„è¿™ç‚¹, é‚£ä¹ˆå°±ä¼šæŠ¥é”™</p><p>è€Œä¸”æˆ‘æ‰¾äº†æºç å‘ç°ä»–æ˜¯ç›´æ¥ä½¿ç”¨çš„ <code>User.class.getFields()</code> è¿™ç§æ–¹å¼æ‹¿åˆ°çš„å­—æ®µ, åŸºæœ¬ä¸Šæ²¡æœ‰ä»»ä½•åŠæ³•è§„é¿æ‰<code>accounts</code></p><p>ä½†æ˜¯å¯ä»¥é€šè¿‡<code>@TableField(exist = false)</code> è¿™ä¸ªæ³¨è§£å®ç°, æˆ‘ä»¬åªè¦:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonInclude(value = JsonInclude.Include.NON_ABSENT)</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;Account&gt; accounts;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¸ä¼šæŠ¥é”™äº†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_">Model</span>&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="comment">//ç”¨æˆ·å</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="comment">//æ‰‹æœº</span></span><br><span class="line"><span class="keyword">private</span> String telephone;</span><br><span class="line"><span class="comment">//ç”Ÿæ—¥</span></span><br><span class="line"><span class="keyword">private</span> Date birthday;</span><br><span class="line"><span class="comment">//æ€§åˆ«</span></span><br><span class="line"><span class="keyword">private</span> String gender;</span><br><span class="line"><span class="comment">//åœ°å€</span></span><br><span class="line"><span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonInclude(value = JsonInclude.Include.NON_ABSENT)</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;Account&gt; accounts;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonInclude(value = JsonInclude.Include.NON_ABSENT)</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;Role&gt; roles;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ä¸»é”®å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ä¸»é”®å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Serializable <span class="title function_">pkVal</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> <span class="keyword">extends</span> <span class="title class_">Model</span>&lt;Account&gt; &#123;</span><br><span class="line"><span class="comment">//ç¼–å·</span></span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="comment">//ç”¨æˆ·ç¼–å·</span></span><br><span class="line"><span class="keyword">private</span> Integer uid;</span><br><span class="line"><span class="comment">//é‡‘é¢</span></span><br><span class="line"><span class="keyword">private</span> Long money;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonInclude(value = JsonInclude.Include.NON_ABSENT)</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ä¸»é”®å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ä¸»é”®å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Serializable <span class="title function_">pkVal</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Role</span> <span class="keyword">extends</span> <span class="title class_">Model</span>&lt;Role&gt; &#123;</span><br><span class="line"><span class="comment">//ç¼–å·</span></span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="comment">//èŒä½</span></span><br><span class="line"><span class="keyword">private</span> String roleName;</span><br><span class="line"><span class="comment">//æè¿°</span></span><br><span class="line"><span class="keyword">private</span> String roleDesc;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonInclude(value = JsonInclude.Include.NON_ABSENT)</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> List&lt;User&gt; users;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ä¸»é”®å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ä¸»é”®å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Serializable <span class="title function_">pkVal</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRole</span> <span class="keyword">extends</span> <span class="title class_">Model</span>&lt;UserRole&gt; &#123;</span><br><span class="line"><span class="comment">//ç”¨æˆ·ç¼–å·</span></span><br><span class="line"><span class="keyword">private</span> Integer uid;</span><br><span class="line"><span class="comment">//èŒä½ç¼–å·</span></span><br><span class="line"><span class="keyword">private</span> Integer rid;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ä¸»é”®å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ä¸»é”®å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Serializable <span class="title function_">pkVal</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.uid;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>@JsonInclude(value = JsonInclude.Include.NON_ABSENT)</code> æ³¨è§£å¯ä»¥åœ¨jsonåºåˆ—åŒ–çš„æ—¶å€™çœç•¥ nullçš„å­—æ®µå’Œ <code>Optional.isEmpty</code>çš„å­—æ®µ</p></blockquote><h3 id="ä¸€å¯¹å¤š"><a href="#ä¸€å¯¹å¤š" class="headerlink" title="ä¸€å¯¹å¤š"></a>ä¸€å¯¹å¤š</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.zhazha.xml.entity.User&quot;</span> <span class="attr">id</span>=<span class="string">&quot;UserMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;telephone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;telephone&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;CustomMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;UserMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;accounts&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;account&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;aid&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;roles&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;role&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;rid&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>UserDaoï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select *, a.ID as aid from orm.user u join orm.account a where a.UID = u.id&quot;)</span></span><br><span class="line"><span class="meta">@ResultMap(value = &quot;UserMap&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUserAccount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211080050200.png" alt="image-20221108005034087"></p><blockquote><p>æ³¨æ„çœ‹ä¸Šé¢çš„ä»£ç , sqlè¯­å¥ä¸­çš„ <code>aid</code> å’Œ <code>resultMap</code> ä¸­çš„ <code>column=&quot;aid&quot;</code> ç›¸åŒ, å¦‚æœä¸è¿™ä¹ˆåš, é‚£ä¹ˆ <code>account</code>çš„ <code>id</code> æŸ¥è¯¢å‡ºæ¥çš„ç»“æœå°†ä¼šæ˜¯ <code>user</code> çš„ <code>id</code>å’Œ<code>account</code>çš„ <code>id</code>ç›¸åŒ, å¦‚ä¸‹å›¾:</p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211080053051.png" alt="image-20221108005311918"></p><p>ä¿®æ”¹äº†ä¹‹åï¼Œå°†ä¼šæ˜¯è¿™æ ·ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211080054187.png" alt="image-20221108005442087"></p><p>è¿™æ ·æ‰æ˜¯æ­£ç¡®ç»“æœ</p><h3 id="å¤šå¯¹ä¸€"><a href="#å¤šå¯¹ä¸€" class="headerlink" title="å¤šå¯¹ä¸€"></a>å¤šå¯¹ä¸€</h3><p>AccountDao.xmlï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.zhazha.xml.entity.Account&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AccountMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;ID&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;UID&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;money&quot;</span> <span class="attr">column</span>=<span class="string">&quot;MONEY&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;UID&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>AccountDaoï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from orm.account a join orm.user u on u.id = a.UID&quot;)</span></span><br><span class="line"><span class="meta">@ResultMap(&quot;AccountMap&quot;)</span></span><br><span class="line">List&lt;Account&gt; <span class="title function_">findAccountUser</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211080059892.png" alt="image-20221108005906803"></p><p>è¿™é‡Œå°† <code>Account</code> å¯¹è±¡ <code>UID</code> çš„å€¼å­˜å‚¨åœ¨ <code>User</code> å¯¹è±¡çš„ <code>id</code> ä¸Š, å› ä¸ºä»–ä»¬ä¸¤ä¸ªçš„å€¼æ˜¯ç›¸åŒçš„</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211080101042.png" alt="image-20221108010106966"></p><p>è¿™æ ·çœ‹èµ·æ¥ä¹Ÿä¸æ˜¯å¾ˆéº»çƒ¦</p><p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥è¿™ä¹ˆæï¼Œè¿™æ ·ä¸éœ€è¦ä½¿ç”¨ <code>autoMapping</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.zhazha.xml.entity.User&quot;</span> <span class="attr">id</span>=<span class="string">&quot;UserMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;telephone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;telephone&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;accounts&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;com.zhazha.xml.dao.AccountDao.AccountMap&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ä½†æ˜¯è¿™æ ·è¿˜æ˜¯ä¼šå­˜åœ¨ <code>account</code> çš„ <code>id</code> ç­‰äº <code>user</code> <code>id</code> çš„é—®é¢˜</p></blockquote><h3 id="ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨autoMapping"><a href="#ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨autoMapping" class="headerlink" title="ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨autoMapping?"></a>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨<code>autoMapping</code>?</h3><p>å¾ˆå¤šäººéƒ½ä¼šè¯´ <code>autoMapping</code> æ…ç”¨ï¼Œä½†æˆ‘è§‰å¾—è¿™å’ŒCè¯­è¨€çš„gotoè¯­å¥ä¸€æ ·, å¹¶ä¸æ˜¯ä¸å¯ä»¥ç”¨</p><p>è€Œæ˜¯åœ¨ä½¿ç”¨å‰éœ€è¦å°†å…¶æ¶åœ¨ä¸€ä¸ªæ–¹æ¡†ä¸‹é¢</p><h2 id="åŸºæ“ï¼šå¯¹è±¡ç»§æ‰¿æ–¹å¼å¤šè¡¨æŸ¥è¯¢"><a href="#åŸºæ“ï¼šå¯¹è±¡ç»§æ‰¿æ–¹å¼å¤šè¡¨æŸ¥è¯¢" class="headerlink" title="åŸºæ“ï¼šå¯¹è±¡ç»§æ‰¿æ–¹å¼å¤šè¡¨æŸ¥è¯¢"></a>åŸºæ“ï¼šå¯¹è±¡ç»§æ‰¿æ–¹å¼å¤šè¡¨æŸ¥è¯¢</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAccount</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Double money;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line"><span class="meta">@Select(&quot;select u.*, a.MONEY from orm.user u join orm.account a on u.id = a.UID&quot;)</span></span><br><span class="line">List&lt;UserAccount&gt; <span class="title function_">listUserAccount</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">listUserAccount</span><span class="params">()</span> &#123;</span><br><span class="line">    PageHelper.startPage(<span class="number">20</span>, <span class="number">10</span>);</span><br><span class="line">    List&lt;UserAccount&gt; userAccounts = userDao.listUserAccount();</span><br><span class="line">    System.err.println(userAccounts);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211072117236.png" alt="image-20221107211729135"></p><h2 id="ä½¿ç”¨mybatis-SQL-è¯­å¥æ„å»ºå™¨-ä¸å¥½ç”¨"><a href="#ä½¿ç”¨mybatis-SQL-è¯­å¥æ„å»ºå™¨-ä¸å¥½ç”¨" class="headerlink" title="ä½¿ç”¨mybatis SQL è¯­å¥æ„å»ºå™¨(ä¸å¥½ç”¨)"></a>ä½¿ç”¨mybatis SQL è¯­å¥æ„å»ºå™¨(ä¸å¥½ç”¨)</h2><blockquote><p>ä¸å¥½ç”¨, ç®€å•è¿‡ä¸‹</p></blockquote><p>å®˜æ–¹æ–‡æ¡£: <a href="https://mybatis.org/mybatis-3/zh/statement-builders.html">mybatis â€“ MyBatis 3 | SQL è¯­å¥æ„å»ºå™¨</a></p><p>å¦‚æœä½ ä»”ç»†ç ”ç©¶mybatiså®˜æ–¹, ä½ ä¼šå‘ç°è¿™é¡¹åŠŸèƒ½çš„æœ¬è´¨å°±æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥</p><p>å€ŸåŠ©æ³¨è§£åœ¨Mapperæ¥å£ä¸Šçš„<code>@xxxProvider</code>(ä¾‹å¦‚<code>@SelectProvider</code>), ä»£æ›¿åŸå…ˆçš„æ³¨è§£<code>@Select</code>æä¾›ç”¨æˆ·è‡ªå®šä¹‰ <code>sqlè¯­å¥</code> </p><p>è¯¥<code>@SelectProvider</code>æ³¨è§£çš„<code>value</code>å±æ€§å¯ä»¥æ ‡è®°ä¸€ä¸ªç±»å, <code>method</code>æ ‡è®°ä¸€ä¸ªå‡½æ•°å</p><p>ç±»ä¼¼äº:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SelectProvider(value = UserDaoProvider.class, method = &quot;findUser&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUser</span><span class="params">(<span class="meta">@Param(&quot;gender&quot;)</span> String gender, <span class="meta">@Param(&quot;address&quot;)</span> String address)</span>;</span><br></pre></td></tr></table></figure><p>è€Œ<code>UserDaoProvider</code>ç±»æ˜¯è¿™æ ·:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoProvider</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">findUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">                .SELECT(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .FROM(<span class="string">&quot;user u&quot;</span>)</span><br><span class="line">                .WHERE(<span class="string">&quot;u.gender = #&#123;gender&#125;&quot;</span>)</span><br><span class="line">                .WHERE(<span class="string">&quot;address like concat(#&#123;address&#125;, &#x27;%&#x27;)&quot;</span>)</span><br><span class="line">                .toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è®°ä½è¿™é‡Œéœ€è¦æ³¨æ„ç±»æ˜¯<code>publicç±»</code>, å‡½æ•°æ˜¯ <code>static public å‡½æ•°</code></p></blockquote><p>åŒæ—¶<code>UserDaoProvider</code>ç±»ä¹Ÿå¯ä»¥å®ç°<code>ProviderMethodResolver</code>æ¥å£ä»¥å®ç°ä¸æŒ‡å®š<code>method</code>å°±èƒ½æ‰¾åˆ°å‡½æ•°å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoProvider</span> <span class="keyword">implements</span> <span class="title class_">ProviderMethodResolver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">findUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">                .SELECT(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .FROM(<span class="string">&quot;user u&quot;</span>)</span><br><span class="line">                .WHERE(<span class="string">&quot;u.gender = #&#123;gender&#125;&quot;</span>)</span><br><span class="line">                .WHERE(<span class="string">&quot;address like concat(#&#123;address&#125;, &#x27;%&#x27;)&quot;</span>)</span><br><span class="line">                .toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¤ªéº»çƒ¦äº†, æˆ‘è¿˜ä¸å¦‚ç”¨å­—ç¬¦ä¸²æ‹¼æ¥</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SelectProvider(value = UserDaoProvider.class)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">findUser</span><span class="params">(<span class="meta">@Param(&quot;gender&quot;)</span> String gender, <span class="meta">@Param(&quot;address&quot;)</span> String address)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">findUser</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">    List&lt;User&gt; userList = userDao.findUser(<span class="string">&quot;å¥³&quot;</span>, <span class="string">&quot;122&quot;</span>);</span><br><span class="line">    System.err.println(objectMapper.writeValueAsString(userList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211081927887.png" alt="image-20221108192619171"></p><h2 id="æ•´åˆmybatis-dynamic-sql-ä¸å¥½ç”¨"><a href="#æ•´åˆmybatis-dynamic-sql-ä¸å¥½ç”¨" class="headerlink" title="æ•´åˆmybatis-dynamic-sql(ä¸å¥½ç”¨)"></a>æ•´åˆmybatis-dynamic-sql(ä¸å¥½ç”¨)</h2><h3 id="éœ€è¦åšä»€ä¹ˆ"><a href="#éœ€è¦åšä»€ä¹ˆ" class="headerlink" title="éœ€è¦åšä»€ä¹ˆ?"></a>éœ€è¦åšä»€ä¹ˆ?</h3><p>ä¿®æ”¹mybatis generatoré¡¹ç›®, ç„¶åç”Ÿæˆä»£ç </p><p>æ–°å»ºä¸€ä¸ªé¡¹ç›®å«åš mybatis_generator</p><p>ç„¶åå¯¼å…¥ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.dynamic-sql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-dynamic-sql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç´§æ¥ç€åˆ›å»º<code>generatorConfig.xml</code>:</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211090038377.png" alt="image-20221109003759785"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">generatorConfiguration</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Mybatis Generatorç›®å‰æœ‰5ç§è¿è¡Œæ¨¡å¼ï¼Œåˆ†åˆ«ä¸ºï¼šMyBatis3DynamicSqlã€MyBatis3Kotlinã€MyBatis3ã€MyBatis3Simpleã€MyBatis3DynamicSqlV1ã€‚--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;springboot-base&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3DynamicSql&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ˜¯å¦å»é™¤è‡ªåŠ¨ç”Ÿæˆçš„æ³¨é‡Š trueï¼šæ˜¯ ï¼š false:å¦ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span></span></span><br><span class="line"><span class="tag">                <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/orm?tinyInt1isBit=false<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=utf-8<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>nullCatalogMeansCurrent=true&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- é»˜è®¤falseï¼ŒæŠŠJDBC DECIMAL å’Œ NUMERIC ç±»å‹è§£æä¸º Integerï¼Œ ä¸º trueæ—¶æŠŠJDBC DECIMAL</span></span><br><span class="line"><span class="comment">            å’Œ NUMERIC ç±»å‹è§£æä¸ºjava.math.BigDecimal --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ˜¯å¦è¯•ç”¨jdk8æ—¶é—´ç±»--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useJSR310Types&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- targetProject:ç”ŸæˆPOç±»çš„ä½ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span></span></span><br><span class="line"><span class="tag">                <span class="attr">targetPackage</span>=<span class="string">&quot;com.zhazha.dynamic.entity&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- enableSubPackages:æ˜¯å¦è®©schemaä½œä¸ºåŒ…çš„åç¼€ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ä»æ•°æ®åº“è¿”å›çš„å€¼è¢«æ¸…ç†å‰åçš„ç©ºæ ¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- targetProject:mapperæ˜ å°„æ–‡ä»¶ç”Ÿæˆçš„ä½ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;mapper&quot;</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">targetProject</span>=<span class="string">&quot;src/main/resources&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- enableSubPackages:æ˜¯å¦è®©schemaä½œä¸ºåŒ…çš„åç¼€ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- targetPackageï¼šmapperæ¥å£ç”Ÿæˆçš„ä½ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span></span></span><br><span class="line"><span class="tag">                <span class="attr">targetPackage</span>=<span class="string">&quot;com.zhazha.dynamic.mapper&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- enableSubPackages:æ˜¯å¦è®©schemaä½œä¸ºåŒ…çš„åç¼€ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--ç”Ÿæˆå…¨éƒ¨è¡¨tableNameè®¾ä¸º%--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;%&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- æŒ‡å®šæ•°æ®åº“è¡¨</span></span><br><span class="line"><span class="comment">  schema:æ•°æ®åº“çš„schema,å¯ä»¥ä½¿ç”¨SQLé€šé…ç¬¦åŒ¹é…ã€‚å¦‚æœè®¾ç½®äº†è¯¥å€¼ï¼Œç”ŸæˆSQLçš„è¡¨åä¼šå˜æˆå¦‚schema.tableNameçš„å½¢å¼ã€‚</span></span><br><span class="line"><span class="comment">  domainObjectName:ç”Ÿæˆå¯¹è±¡çš„åŸºæœ¬åç§°ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼ŒMBGä¼šè‡ªåŠ¨æ ¹æ®è¡¨åæ¥ç”Ÿæˆåç§°ã€‚</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;table schema=&quot;&quot; tableName=&quot;&quot; domainObjectName=&quot;&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ›å»ºMybatisGenerator:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.mybatis.generator.api.MyBatisGenerator;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.xml.ConfigurationParser;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.internal.DefaultShellCallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisGenerator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//MBG æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è­¦å‘Šä¿¡æ¯</span></span><br><span class="line">        List&lt;String&gt; warnings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è¯»å–æˆ‘ä»¬çš„ MBG é…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> MybatisGenerator.class.getResourceAsStream(<span class="string">&quot;/mybatis/generatorConfig.xml&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">ConfigurationParser</span> <span class="variable">cp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationParser</span>(warnings);</span><br><span class="line">            <span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> cp.parseConfiguration(is);</span><br><span class="line">            <span class="comment">//å½“ç”Ÿæˆçš„ä»£ç é‡å¤æ—¶ï¼Œä¸è¦è¦†ç›–åŸä»£ç </span></span><br><span class="line">            <span class="type">DefaultShellCallback</span> <span class="variable">callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShellCallback</span>(<span class="literal">false</span>);</span><br><span class="line">            <span class="comment">//åˆ›å»º MBG</span></span><br><span class="line">            <span class="type">MyBatisGenerator</span> <span class="variable">myBatisGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBatisGenerator</span>(config, callback, warnings);</span><br><span class="line">            <span class="comment">//æ‰§è¡Œç”Ÿæˆä»£ç </span></span><br><span class="line">            myBatisGenerator.generate(<span class="literal">null</span>);</span><br><span class="line">            <span class="comment">//è¾“å‡ºè­¦å‘Šä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">for</span> (String warning : warnings) &#123;</span><br><span class="line">                System.out.println(warning);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›´æ¥è¿è¡Œå°±èƒ½ç”Ÿæˆ mybatis-dynamic çš„ä»£ç , è€Œä¸æ˜¯ Example é‚£ä¸€å¥—äº†</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211090040119.png" alt="image-20221109004001973"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211090040835.png" alt="image-20221109004021457"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211090040059.png" alt="image-20221109004043957"></p><p>ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•</p><ol><li>é™æ€å¯¼å…¥</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.zhazha.dynamic.mapper.UserDynamicSqlSupport.user;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mybatis.dynamic.sql.SqlBuilder.select;</span><br></pre></td></tr></table></figure><ol start="2"><li>å…¥é—¨ä»£ç </li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">dsl</span> <span class="operator">=</span> select(user.allColumns())</span><br><span class="line">        .from(user)</span><br><span class="line">        .limit(<span class="number">10</span>)</span><br><span class="line">        .offset(<span class="number">20</span>)</span><br><span class="line">        .build()</span><br><span class="line">        .render(RenderingStrategies.MYBATIS3);</span><br><span class="line">    List&lt;User&gt; userList = userMapper.selectMany(dsl);</span><br><span class="line">    System.err.println(objectMapper.writeValueAsString(userList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿˜æ˜¯ä¸å¥½ç”¨, å¤šè¡¨å…³è”è¿˜æ˜¯å¾—é…ç½®<code>ResultMap</code>, è¿˜ä¸å¦‚ XML æ–¹å¼, è¿™ç§æ–¹æ³•å°±ä¸è¦çœ‹äº†</p></blockquote><h2 id="æ•´åˆfluent-mybatisï¼ˆè¿˜æ˜¯ä¸æ¨èï¼‰"><a href="#æ•´åˆfluent-mybatisï¼ˆè¿˜æ˜¯ä¸æ¨èï¼‰" class="headerlink" title="æ•´åˆfluent-mybatisï¼ˆè¿˜æ˜¯ä¸æ¨èï¼‰"></a>æ•´åˆfluent-mybatisï¼ˆè¿˜æ˜¯ä¸æ¨èï¼‰</h2><blockquote><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://toscode.gitee.com/fluent-mybatis/fluent-mybatis/wikis">https://toscode.gitee.com/fluent-mybatis/fluent-mybatis/wikis</a></p></blockquote><h3 id="fluent-mybatisç‰¹æ€§"><a href="#fluent-mybatisç‰¹æ€§" class="headerlink" title="fluent mybatisç‰¹æ€§"></a>fluent mybatisç‰¹æ€§</h3><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211090103538.png" alt="FluentMybatisç‰¹æ€§"></p><h3 id="fluent-mybatisåŸç†"><a href="#fluent-mybatisåŸç†" class="headerlink" title="fluent mybatisåŸç†"></a>fluent mybatisåŸç†</h3><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211090105235.png" alt="FluentMybatisåŸç†"></p><h3 id="quick-start"><a href="#quick-start" class="headerlink" title="quick start"></a>quick start</h3><h4 id="1-å¯¼å…¥å¿…è¦çš„ä¾èµ–"><a href="#1-å¯¼å…¥å¿…è¦çš„ä¾èµ–" class="headerlink" title="1. å¯¼å…¥å¿…è¦çš„ä¾èµ–"></a>1. å¯¼å…¥å¿…è¦çš„ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.atool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fluent-mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.atool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fluent-mybatis-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-ç”Ÿæˆå¿…è¦ä»£ç "><a href="#2-ç”Ÿæˆå¿…è¦ä»£ç " class="headerlink" title="2. ç”Ÿæˆå¿…è¦ä»£ç "></a>2. ç”Ÿæˆå¿…è¦ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.org.atool.generator.FileGenerator;</span><br><span class="line"><span class="keyword">import</span> cn.org.atool.generator.annotation.Table;</span><br><span class="line"><span class="keyword">import</span> cn.org.atool.generator.annotation.Tables;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EntityGeneratorDemo</span> &#123;</span><br><span class="line">    <span class="comment">// æ•°æ®æº url</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/orm?useUnicode=true&amp;characterEncoding=utf8&quot;</span>;</span><br><span class="line">    <span class="comment">// æ•°æ®åº“ç”¨æˆ·å</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="comment">// æ•°æ®åº“å¯†ç </span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generate</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// å¼•ç”¨é…ç½®ç±»ï¼Œbuildæ–¹æ³•å…è®¸æœ‰å¤šä¸ªé…ç½®ç±»</span></span><br><span class="line">        FileGenerator.build(Empty.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tables(</span></span><br><span class="line"><span class="meta">            // è®¾ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯</span></span><br><span class="line"><span class="meta">            url = url, username = username, password = password,</span></span><br><span class="line"><span class="meta">            // è®¾ç½®entityç±»ç”Ÿæˆsrcç›®å½•, ç›¸å¯¹äº user.dir</span></span><br><span class="line"><span class="meta">            srcDir = &quot;src/main/java&quot;,</span></span><br><span class="line"><span class="meta">            // è®¾ç½®entityç±»çš„packageå€¼</span></span><br><span class="line"><span class="meta">            basePack = &quot;com.zhazha.fluent&quot;,</span></span><br><span class="line"><span class="meta">            // è®¾ç½®daoæ¥å£å’Œå®ç°çš„srcç›®å½•, ç›¸å¯¹äº user.dir</span></span><br><span class="line"><span class="meta">            daoDir = &quot;src/main/java&quot;,</span></span><br><span class="line"><span class="meta">            // è®¾ç½®å“ªäº›è¡¨è¦ç”ŸæˆEntityæ–‡ä»¶</span></span><br><span class="line"><span class="meta">            tables = &#123;@Table(value = &#123;&quot;account&quot;, &quot;user&quot;&#125;)&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Empty</span> &#123; <span class="comment">//ç±»åéšä¾¿å–, åªæ˜¯é…ç½®å®šä¹‰çš„ä¸€ä¸ªè½½ä½“</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è®°å¾—ä¿®æ”¹å¿…è¦çš„ä»£ç </p></blockquote><p>æ‰§è¡Œåä¼šåˆ›å»ºä¸‹é¢ä¸¤ä¸ªåŒ…</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211090150289.png" alt="image-20221109015047193"></p><blockquote><p>ä»£ç ç”Ÿæˆå®Œæ¯•, å‘ç°æŠ¥é”™äº†, ç¼–è¯‘ä¸‹é¡¹ç›®, è¿™æ ·å°±å¯ä»¥åœ¨ target ç›®å½•ä¸‹æ‰¾åˆ°</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211090152688.png" alt="image-20221109015240564"></p><p>å¦‚æœ<code>annotations</code>ä¸æ˜¯è“è‰²å›¾æ ‡ï¼Œå¯ä»¥ç‚¹å‡»è¿™é‡Œ</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211090151983.png" alt="image-20221109015143855"></p><p>å¦‚æœè¿˜ä¸æ˜¯è¿˜å¯ä»¥è¿™æ ·ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211091230265.png" alt="image-20221109122529326"></p></blockquote><h4 id="3-ç»™å¯åŠ¨ç±»æ·»åŠ Mapperæ‰«ææ³¨è§£"><a href="#3-ç»™å¯åŠ¨ç±»æ·»åŠ Mapperæ‰«ææ³¨è§£" class="headerlink" title="3. ç»™å¯åŠ¨ç±»æ·»åŠ Mapperæ‰«ææ³¨è§£"></a>3. ç»™å¯åŠ¨ç±»æ·»åŠ Mapperæ‰«ææ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MapperScan(&#123;&quot;com.zhazha.fluent.mapper&quot;&#125;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FluentApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(FluentApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211090155138.png" alt="image-20221109015503967"></p><h4 id="4-æ·»åŠ applicationé…ç½®"><a href="#4-æ·»åŠ applicationé…ç½®" class="headerlink" title="4. æ·»åŠ applicationé…ç½®"></a>4. æ·»åŠ applicationé…ç½®</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">fluent-mybatis-demo</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/orm?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">lazy-loading-enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.zhazha.fluent.entity</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:/mapper/**/*.xml</span></span><br></pre></td></tr></table></figure><h4 id="5-æ·»åŠ fluent-mybatiså¿…è¦çš„Bean"><a href="#5-æ·»åŠ fluent-mybatiså¿…è¦çš„Bean" class="headerlink" title="5. æ·»åŠ fluent mybatiså¿…è¦çš„Bean"></a>5. æ·»åŠ fluent mybatiså¿…è¦çš„Bean</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.org.atool.fluent.mybatis.spring.MapperFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FluentConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MapperFactory <span class="title function_">mapperFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MapperFactory</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-ä½¿ç”¨"><a href="#6-ä½¿ç”¨" class="headerlink" title="6. ä½¿ç”¨"></a>6. ä½¿ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// å–åˆ†é¡µç¬¬ä¸€ä¸ªï¼Œ å¦åˆ™ä¸‹é¢çš„ findOne ä¼šæŠ¥é”™</span></span><br><span class="line">    PageHelper.startPage(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="type">UserQuery</span> <span class="variable">query</span> <span class="operator">=</span> UserQuery.query();</span><br><span class="line">    query.where()</span><br><span class="line">        .username()</span><br><span class="line">        .startWith(<span class="string">&quot;s&quot;</span>, <span class="literal">false</span>)</span><br><span class="line">        .end();</span><br><span class="line">    <span class="type">UserEntity</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.findOne(query);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// å…³è” user å’Œ account è¡¨</span></span><br><span class="line">    PageHelper.startPage(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="type">UserQuery</span> <span class="variable">userQuery</span> <span class="operator">=</span> UserQuery.query().select(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    <span class="type">AccountQuery</span> <span class="variable">accountQuery</span> <span class="operator">=</span> AccountQuery.query().where.id().isNull().end();</span><br><span class="line">    <span class="type">var</span> <span class="variable">joinQuery</span> <span class="operator">=</span> JoinBuilder.from(userQuery)</span><br><span class="line">        .leftJoin(accountQuery).on(userQuery1 -&gt; userQuery1.where.id(), accountQuery1 -&gt; accountQuery1.where.uid()).endJoin()</span><br><span class="line">        .build();</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢è¡¨</span></span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; mapList = userMapper.listMaps(joinQuery);</span><br><span class="line">    <span class="comment">// æ‰¹é‡æ·»åŠ  account å¯¹è±¡</span></span><br><span class="line">    <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>(<span class="number">10000000</span>);</span><br><span class="line">    ArrayList&lt;AccountEntity&gt; accountEntities = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    mapList.forEach(stringObjectMap -&gt; &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">id</span> <span class="operator">=</span> (Integer) stringObjectMap.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="type">AccountEntity</span> <span class="variable">accountEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountEntity</span>();</span><br><span class="line">        accountEntity.setMoney(random.nextDouble()).setUid(id);</span><br><span class="line">        accountEntities.add(accountEntity);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> accountMapper.insertBatchWithPk(accountEntities);</span><br><span class="line">    System.out.println(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç±»sqlè¯­å¥å…³è”æŸ¥è¯¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test05</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    PageHelper.startPage(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">userSql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FreeQuery</span>(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;u&quot;</span>).select(<span class="string">&quot;u.*&quot;</span>);</span><br><span class="line">    <span class="type">FreeQuery</span> <span class="variable">accountSql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FreeQuery</span>(<span class="string">&quot;account&quot;</span>, <span class="string">&quot;a&quot;</span>).select(<span class="string">&quot;a.*&quot;</span>).orderBy.asc(<span class="string">&quot;a.id&quot;</span>).end();</span><br><span class="line">    <span class="type">JoinQuery</span> <span class="variable">query</span> <span class="operator">=</span> JoinBuilder.from(userSql)</span><br><span class="line">        .join(accountSql).onEq(<span class="string">&quot;u.id&quot;</span>, <span class="string">&quot;a.uid&quot;</span>).endJoin().build();</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; mapList = userMapper.listMaps(query);</span><br><span class="line">    System.err.println(JSONUtil.toJsonStr(mapList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­˜åœ¨çš„é—®é¢˜"><a href="#å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜"></a>å­˜åœ¨çš„é—®é¢˜</h3><p>æˆ‘ä»¬åœ¨è¯•è¯•è¿™ä¸ªsqlï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> <span class="keyword">user</span> u</span><br><span class="line"><span class="keyword">join</span> user_role ur <span class="keyword">on</span> u.id <span class="operator">=</span> ur.UID</span><br><span class="line"><span class="keyword">join</span> role r <span class="keyword">on</span> r.ID <span class="operator">=</span> ur.RID</span><br><span class="line"><span class="keyword">where</span> u.gender <span class="operator">=</span> <span class="string">&#x27;å¥³&#x27;</span> <span class="keyword">and</span> r.ID <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test07</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">UserQuery</span> <span class="variable">userQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserQuery</span>().select(<span class="string">&quot;*&quot;</span>).where.gender().eq(<span class="string">&quot;å¥³&quot;</span>).end();</span><br><span class="line">    <span class="type">UserRoleQuery</span> <span class="variable">userRoleQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserRoleQuery</span>(<span class="string">&quot;ur&quot;</span>);</span><br><span class="line">    <span class="type">RoleQuery</span> <span class="variable">roleQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoleQuery</span>().where.id().eq(<span class="number">2</span>).end();</span><br><span class="line">    <span class="type">var</span> <span class="variable">query</span> <span class="operator">=</span> JoinBuilder.from(userQuery)</span><br><span class="line">        .join(userRoleQuery).on(userQuery1 -&gt; userQuery1.where.id(), userRoleQuery1 -&gt; userRoleQuery1.where.uid()).endJoin()</span><br><span class="line">        .join(roleQuery).onEq(UserRoleEntity::getRid, RoleEntity::getId).endJoin()</span><br><span class="line">        .build();</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; mapList = userMapper.listMaps(query);</span><br><span class="line">    System.err.println(JSONUtil.toJsonStr(mapList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½†æ˜¯æŠ¥é”™äº†</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211100103212.png" alt="image-20221110010340087"></p><p>å‚æ•°ç±»å‹ä¸åŒ¹é…ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211100056862.png" alt="image-20221110005601742"></p></blockquote><p>å°è¯•è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test07</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">UserQuery</span> <span class="variable">userQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserQuery</span>(<span class="string">&quot;u&quot;</span>).select(<span class="string">&quot;*&quot;</span>).where.gender().eq(<span class="string">&quot;å¥³&quot;</span>).end();</span><br><span class="line">    <span class="type">UserRoleQuery</span> <span class="variable">userRoleQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserRoleQuery</span>(<span class="string">&quot;ur&quot;</span>);</span><br><span class="line">    <span class="type">RoleQuery</span> <span class="variable">roleQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoleQuery</span>(<span class="string">&quot;r&quot;</span>).where.id().eq(<span class="number">2</span>).end();</span><br><span class="line">    <span class="type">var</span> <span class="variable">query</span> <span class="operator">=</span> JoinBuilder.from(userQuery)</span><br><span class="line">        .join(userRoleQuery).on(userQuery1 -&gt; userQuery1.where.id(), userRoleQuery1 -&gt; userRoleQuery1.where.uid()).endJoin()</span><br><span class="line">        .join(roleQuery).onEq(<span class="string">&quot;r.id&quot;</span>, <span class="string">&quot;ur.rid&quot;</span>).endJoin()</span><br><span class="line">        .build();</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; mapList = userMapper.listMaps(query);</span><br><span class="line">    System.err.println(JSONUtil.toJsonStr(mapList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æˆåŠŸ</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211100107216.png" alt="image-20221110010718102"></p><p>ä½†ï¼Œæœ‰å¿…è¦è¿™æ ·ä¹ˆï¼Ÿ</p><p>ä¸ºä»€ä¹ˆä¸ä½¿ç”¨MybatisCodeHelperæ’ä»¶å‘¢ï¼Ÿ</p><p><strong><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211101426078.png"></strong></p><p>éƒ½å¯ä»¥ç”Ÿæˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResultMap(&quot;CustomMap&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">selectAllJoinRole</span><span class="params">(<span class="meta">@Param(&quot;gender&quot;)</span> String gender, <span class="meta">@Param(&quot;roleId&quot;)</span> Integer roleId)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllJoinRole&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CustomMap&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from user u</span><br><span class="line">    join user_role ur on u.id = ur.UID</span><br><span class="line">    join role r on r.ID = ur.RID</span><br><span class="line">    where u.gender = #&#123;gender&#125;</span><br><span class="line">          and r.ID = #&#123;roleId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="JPA"><a href="#JPA" class="headerlink" title="JPA"></a>JPA</h2><h3 id="JPAæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#JPAæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="JPAæ˜¯ä»€ä¹ˆï¼Ÿ"></a>JPAæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>JPAæ˜¯ä¸€å¥—APIï¼Œ ç”¨æˆ·javaæŒä¹…å±‚ä½¿ç”¨çš„APIï¼Œæ›´å‡†ç¡®çš„è¯´ï¼Œjpaæ˜¯ä¸€å¥—ç”¨äºæŒä¹…å±‚çš„è§„èŒƒï¼ˆæ¥å£ï¼‰</p><h3 id="JPAå’Œhibernateçš„å…³ç³»"><a href="#JPAå’Œhibernateçš„å…³ç³»" class="headerlink" title="JPAå’Œhibernateçš„å…³ç³»"></a>JPAå’Œhibernateçš„å…³ç³»</h3><p>hibernateæ˜¯ORMï¼Œå®ƒåªæ˜¯è¾ƒå¥½çš„å®ç°äº†JPAè§„èŒƒ</p><p>æ¢å¥è¯è¯´ï¼Œ JPAç›¸å½“äºè§„å®šäº†æ¥å£ï¼Œhibernateåˆ™æ˜¯å®ç°ç±»ï¼Œåªä¸è¿‡hibernateæä¾›äº†æ›´å¤šçš„åŠŸèƒ½ç½¢äº†</p><h3 id="JPAæ€ä¹ˆç©ï¼Ÿ"><a href="#JPAæ€ä¹ˆç©ï¼Ÿ" class="headerlink" title="JPAæ€ä¹ˆç©ï¼Ÿ"></a>JPAæ€ä¹ˆç©ï¼Ÿ</h3><h4 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h4><p>JPA Buddy æ’ä»¶ï¼šå¿…å¤‡ï¼Œæ–¹ä¾¿å¾ˆå¤šï¼Œæ–°ç‰ˆæœ¬æ”¶è´¹ï¼Œå¯ä»¥é€‰æ‹©æ—§ç‚¹çš„ç‰ˆæœ¬</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211101939432.png" alt="image-20221110193957265"></p><h4 id="åˆ›å»ºEntity"><a href="#åˆ›å»ºEntity" class="headerlink" title="åˆ›å»ºEntity"></a>åˆ›å»ºEntity</h4><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211101940229.png" alt="image-20221110194038117"></p><p>é¼ æ ‡å³é”®è¡¨ï¼Œé€‰æ‹©</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211101941009.png" alt="image-20221110194105920"></p><p>é€‰æ‹© DB connectionï¼Œé¡¹ç›®</p><p>å¡«å†™å¥½ç”Ÿæˆä»£ç çš„åŒ…ä½ç½®</p><p>æœ€åé€‰æ‹© Mapped Relationså’ŒTables</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211101943551.png" alt="image-20221110194311429"></p><p>ä»£ç ç”ŸæˆæˆåŠŸ</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211101942133.png" alt="image-20221110194226030"></p><p>åˆ†é…æ•°æ®æº</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211101944970.png" alt="image-20221110194426871"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211101944865.png" alt="image-20221110194459761"></p><p>æ·»åŠ Lombokæ³¨è§£</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211101945207.png" alt="image-20221110194529079"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211101945520.png" alt="image-20221110194551413"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211101946560.png" alt="image-20221110194610426"></p><p>ç”Ÿæˆrepositoryä»£ç ï¼š</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211101947771.png" alt="image-20221110194710643"></p><h3 id="å¤šè¡¨å…³è”"><a href="#å¤šè¡¨å…³è”" class="headerlink" title="å¤šè¡¨å…³è”"></a>å¤šè¡¨å…³è”</h3><h4 id="ä¸€å¯¹å¤šå…³ç³»"><a href="#ä¸€å¯¹å¤šå…³ç³»" class="headerlink" title="ä¸€å¯¹å¤šå…³ç³»"></a>ä¸€å¯¹å¤šå…³ç³»</h4><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211102143370.png" alt="image-20221110214323266"></p><p>æ€è·¯ï¼š</p><p>userè‚¯å®šéœ€è¦ä¸€ä¸ªaccounté›†åˆï¼Œè¡¨ç¤ºä¸€å¯¹å¤š</p><p>accountéœ€è¦ä¸€ä¸ªuserè¡¨ç¤ºä¸€å¯¹ä¸€</p><p>ç»¼åˆä¾èµ–å°±æ˜¯ä¸€å¯¹å¤šå…³ç³»</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211102152219.png" alt="image-20221110215246072"></p><ul><li>userè‚¯å®šéœ€è¦ä¸€ä¸ªaccounté›†åˆï¼Œè¡¨ç¤ºä¸€å¯¹å¤š</li></ul><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211102147703.png" alt="image-20221110214742479"></p><p>ä½†ä¸è¡Œå•Šï¼Œä½ å¾—å‘Šè¯‰JPAï¼Œä¸€å¯¹å¤šå¯¹åº”ç€<code>Account</code>å¯¹è±¡é‚£è¾¹çš„å“ªä¸ªå­—æ®µï¼Ÿ</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211102200029.png" alt="image-20221110220047897"></p><p>å¥½åƒå¯ä»¥äº†ï¼Ÿè¯•è¯•</p><h5 id="JPQLæ–¹æ¡ˆ"><a href="#JPQLæ–¹æ¡ˆ" class="headerlink" title="JPQLæ–¹æ¡ˆ"></a>JPQLæ–¹æ¡ˆ</h5><p>æŠŠè¿™ä¸ªsqlè¯­å¥ä½¿ç”¨jpaçš„æ–¹å¼å®ç°å‡ºæ¥</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211110956351.png" alt="image-20221111095607779"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="built_in">avg</span>( a.money ) <span class="keyword">AS</span> money,</span><br><span class="line">u.username <span class="keyword">AS</span> username </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">account a</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="keyword">USER</span> u <span class="keyword">ON</span> ( u.id <span class="operator">=</span> a.uid ) </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">u.gender <span class="operator">=</span> <span class="string">&#x27;å¥³&#x27;</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">u.username</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯JPQLçš„æ–¹å¼:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Account, Integer&gt;, JpaSpecificationExecutor&lt;Account&gt; &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Query(&quot;select new com.zhazha.jpa.entity.AccountDto(avg(a.money), u.username) \n&quot; +</span></span><br><span class="line"><span class="meta">       &quot;from Account a join User u on u.id=a.uid where u.gender=:gender \n&quot; +</span></span><br><span class="line"><span class="meta">       &quot;group by u.username &quot;)</span></span><br><span class="line">List&lt;AccountDto&gt; <span class="title function_">avgMoneyByGender</span><span class="params">(<span class="meta">@Param(&quot;gender&quot;)</span> <span class="type">char</span> gender)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211110957638.png" alt="image-20221111095706527"></p><p>æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®åŸºæœ¬æ²¡ä»€ä¹ˆé—®é¢˜</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211111023099.png" alt="image-20221111102318890"></p><h5 id="åŸç”Ÿsqlæ–¹æ¡ˆ"><a href="#åŸç”Ÿsqlæ–¹æ¡ˆ" class="headerlink" title="åŸç”Ÿsqlæ–¹æ¡ˆ"></a>åŸç”Ÿsqlæ–¹æ¡ˆ</h5><p>AccountRepository:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(value = &quot;select avg(a.MONEY) as money, u.username from account a join user u on u.id = a.UID where u.gender=:gender group by u.username&quot;, nativeQuery = true)</span></span><br><span class="line">List&lt;AccountDto&gt; <span class="title function_">nativeAvgMoneyByGender</span><span class="params">(<span class="meta">@Param(&quot;gender&quot;)</span> <span class="type">char</span> gender)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">nativeAvgMoneyByGender</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;AccountDto&gt; accountList = accountRepository.nativeAvgMoneyByGender(<span class="string">&#x27;å¥³&#x27;</span>);</span><br><span class="line">    System.err.println(JSONUtil.toJsonStr(accountList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¼šæŠ¥é”™, å› ä¸º <code>AccountDto</code> ä¸æ˜¯JPAçš„ <code>Entity</code></p><p>ç½‘ç«™æ‰¾è¿‡è§£å†³æ–¹æ¡ˆ, ä¸è¿‡éƒ½å¾ˆéº»çƒ¦(æœ‰ç‚¹åƒå†™äº†ä¸ªMybatisçš„ ResultMap æ¯”è¿™è¿˜éº»çƒ¦)</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211111027342.png" alt="image-20221111102721206"></p><p>ç¬¬ä¸€æ­¥:</p><p>AccountRepository: </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(nativeQuery = true)</span></span><br><span class="line">List&lt;AccountDto&gt; <span class="title function_">nativeAvgMoneyByGender</span><span class="params">(<span class="meta">@Param(&quot;gender&quot;)</span> <span class="type">char</span> gender)</span>;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NamedNativeQuery(name = &quot;Account.nativeAvgMoneyByGender&quot;,</span></span><br><span class="line"><span class="meta">query = &quot;select avg(a.MONEY) as money, u.username from account a join user u on u.id = a.UID where u.gender=:gender group by u.username&quot;,</span></span><br><span class="line"><span class="meta">resultSetMapping = &quot;Mapping.AccountDto&quot;)</span></span><br><span class="line"><span class="meta">@SqlResultSetMapping(name = &quot;Mapping.AccountDto&quot;,</span></span><br><span class="line"><span class="meta">classes = @ConstructorResult(targetClass = AccountDto.class,</span></span><br><span class="line"><span class="meta">columns = &#123;@ColumnResult(name = &quot;money&quot;),</span></span><br><span class="line"><span class="meta">@ColumnResult(name = &quot;username&quot;)&#125;))</span></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211111051017.png" alt="image-20221111105149867"></p><p>ç¬¬ä¸‰æ­¥:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">nativeAvgMoneyByGender</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;AccountDto&gt; accountList = accountRepository.nativeAvgMoneyByGender(<span class="string">&#x27;å¥³&#x27;</span>);</span><br><span class="line">    System.err.println(JSONUtil.toJsonStr(accountList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æˆåŠŸäº†</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211111053221.png" alt="image-20221111105336113"></p><h5 id="åŠ¨æ€æŸ¥è¯¢"><a href="#åŠ¨æ€æŸ¥è¯¢" class="headerlink" title="åŠ¨æ€æŸ¥è¯¢"></a>åŠ¨æ€æŸ¥è¯¢</h5><p>è¿™ç§æ–¹å¼ä¸éœ€è¦å¦å¤–å†™sqlè¯­å¥äº†, æˆ‘ä¹Ÿæ²¡ç”¨è¿‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    List&lt;Account&gt; accountList = accountRepository.findAll((root, query, criteriaBuilder) -&gt; &#123;</span><br><span class="line">        ArrayList&lt;Predicate&gt; predicates = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Join&lt;Object, Object&gt; user = root.join(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        predicates.add(criteriaBuilder.like(user.get(<span class="string">&quot;username&quot;</span>), <span class="string">&quot;é»„%&quot;</span>));</span><br><span class="line">        predicates.add(criteriaBuilder.equal(user.get(<span class="string">&quot;gender&quot;</span>), <span class="string">&#x27;ç”·&#x27;</span>));</span><br><span class="line">        <span class="keyword">return</span> query.where(predicates.toArray(<span class="keyword">new</span> <span class="title class_">Predicate</span>[<span class="number">0</span>])).getRestriction();</span><br><span class="line">    &#125;);</span><br><span class="line">    accountList.forEach(System.err::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å…¶ä»–å¤šå¯¹å¤šå…³ç³»"><a href="#å…¶ä»–å¤šå¯¹å¤šå…³ç³»" class="headerlink" title="å…¶ä»–å¤šå¯¹å¤šå…³ç³»"></a>å…¶ä»–å¤šå¯¹å¤šå…³ç³»</h4><blockquote><p>å…¶ä»–å¤šè¡¨å…³è”æˆ‘å°±ä¸ä¸€ä¸€ä¸¾ä¾‹äº†, å¯ä»¥çœ‹æ³¨è§£çš„æ³¨é‡Š</p><p>æ¯”å¦‚ <code>OneToOne</code> æ³¨è§£å†…çš„æ³¨é‡Š, åˆ—ä¸¾äº†ä¸‰ç§é€‚åº”åœºæ™¯</p><p>å¤–é”®å…³ç³»çš„<code>OneToOne</code></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120200843.png" alt="image-20221112020042319"></p><p>ä¸»é”®ç›¸åŒçš„<code>OneToOne</code></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120201745.png" alt="image-20221112020112527"></p><p>ä»å¯åµŒå…¥çš„ç±»åˆ°å…¶ä»–<code>Entity</code>ä¹‹é—´çš„<code>OneToOne</code>å…³ç³»</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120201057.png" alt="image-20221112020128900"></p><p>è€Œ<code>OneToMany</code>ä¹Ÿæ˜¯ç½—åˆ—äº†ä¸‰ç§æƒ…å†µ, æ³›å‹, éæ³›å‹å’Œå•å‘çš„<code>OneToMany</code>å…³ç³»</p></blockquote><h3 id="å­˜åœ¨çš„é—®é¢˜-1"><a href="#å­˜åœ¨çš„é—®é¢˜-1" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜"></a>å­˜åœ¨çš„é—®é¢˜</h3><p>çœ‹äº†ç‚¹çš®æ¯›æ˜¯ä¸æ˜¯è§‰å¾—JPAä¹Ÿå°±è¿™æ ·?</p><p>ç¡®å®, ä¸ä»…æ›´éš¾ç”¨äº†, è¿˜å¾—çº ç»“å¤šè¡¨å…³è”æ³¨è§£çš„é€‰æ‹©</p><p>æœ‰ä»€ä¹ˆåŠæ³•ç®€åŒ–ä¹ˆ?</p><h3 id="QueryDSL"><a href="#QueryDSL" class="headerlink" title="QueryDSL"></a>QueryDSL</h3><h4 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ?"></a>æ˜¯ä»€ä¹ˆ?</h4><p>å®˜æ–¹åœ°å€:<a href="http://querydsl.com/">Querydsl - Unified Queries for Java</a></p><p>QueryDSLä»…ä»…æ˜¯ä¸€ä¸ªé€šç”¨çš„æŸ¥è¯¢æ¡†æ¶ï¼Œä¸“æ³¨äºé€šè¿‡Java APIæ„å»ºç±»å‹å®‰å…¨çš„SQLæŸ¥è¯¢ã€‚</p><p>Querydslå¯ä»¥é€šè¿‡ä¸€ç»„é€šç”¨çš„æŸ¥è¯¢APIä¸ºç”¨æˆ·æ„å»ºå‡ºé€‚åˆä¸åŒç±»å‹ORMæ¡†æ¶æˆ–è€…æ˜¯SQLçš„æŸ¥è¯¢è¯­å¥ï¼Œä¹Ÿå°±æ˜¯è¯´QueryDSLæ˜¯åŸºäºå„ç§ORMæ¡†æ¶ä»¥åŠSQLä¹‹ä¸Šçš„ä¸€ä¸ªé€šç”¨çš„æŸ¥è¯¢æ¡†æ¶ã€‚</p><p>å€ŸåŠ©QueryDSLå¯ä»¥åœ¨ä»»ä½•æ”¯æŒçš„ORMæ¡†æ¶æˆ–è€…SQLå¹³å°ä¸Šä»¥ä¸€ç§é€šç”¨çš„APIæ–¹å¼æ¥æ„å»ºæŸ¥è¯¢ã€‚ç›®å‰QueryDSLæ”¯æŒçš„å¹³å°åŒ…æ‹¬JPA,JDO,SQL,Mongodb ç­‰ç­‰</p><h4 id="å†°å±±ä¸€è§’"><a href="#å†°å±±ä¸€è§’" class="headerlink" title="å†°å±±ä¸€è§’"></a>å†°å±±ä¸€è§’</h4><p>ç®€å•çœ‹çœ‹ queryDSLå€¼ä¸å€¼å¾—å­¦</p><p>åŒæ ·æ˜¯å‰é¢çš„sql åœ¨ queryDSL ä¸‹å¯ä»¥è¿™ä¹ˆç©</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">QAccount</span> <span class="variable">qAccount</span> <span class="operator">=</span> QAccount.account;</span><br><span class="line">    <span class="type">QUser</span> <span class="variable">qUser</span> <span class="operator">=</span> QUser.user;</span><br><span class="line">    List&lt;Tuple&gt; tupleList = jpaQuery.select(qAccount.money, qUser.username).from(qAccount)</span><br><span class="line">        .join(qUser).on(qUser.id.eq(qAccount.uid))</span><br><span class="line">        .where(qUser.gender.eq(<span class="string">&#x27;å¥³&#x27;</span>))</span><br><span class="line">        .groupBy(qUser.username)</span><br><span class="line">        .fetch();</span><br><span class="line">    </span><br><span class="line">    List&lt;AccountDto&gt; accountDtoList = tupleList.stream().map(tuple -&gt; &#123;</span><br><span class="line">        <span class="type">Double</span> <span class="variable">money</span> <span class="operator">=</span> tuple.get(qAccount.money);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> tuple.get(qUser.username);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AccountDto</span>(money, username);</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// å¤šä½™ä»£ç </span></span><br><span class="line">    accountDtoList.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®Œæ•´ä»£ç åœ¨åé¢æœ‰, è¿™é‡Œåªæ˜¯ç»™ä½ çœ‹çœ‹å¥½ä¸å¥½ç”¨</p></blockquote><h4 id="æ€ä¹ˆç©"><a href="#æ€ä¹ˆç©" class="headerlink" title="æ€ä¹ˆç©?"></a>æ€ä¹ˆç©?</h4><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- querydsl --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.querydsl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>querydsl-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.querydsl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>querydsl-apt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>JPAAnnotationProcessor</code> æ‰¾åˆ°æ³¨è§£äº†<code>javax.persistence.Entity</code>çš„é¢†åŸŸç±»å‹, å¹¶ä¸”ä¸ºé¢†åŸŸç±»å‹ç”ŸæˆæŸ¥è¯¢ä»£ç </p><p>å¦‚æœä½ åœ¨<code>entity</code>å¯¹è±¡ä¸Šä½¿ç”¨ <code>Hibernate</code> æ³¨è§£, ä½ åº”è¯¥ä½¿ç”¨<code>APT processor</code>(ä¾èµ–) <code>com.querydsl.apt.hibernate.HibernateAnnotationProcessor</code>ä»£æ›¿</p><p>maven è¿è¡Œ <code>clean install</code>  æ¥ç€ä½ å°†ä¼šè·å¾—åœ¨ <code>target/generated-sources/java</code>ç›®å½•ä¸­ç”Ÿæˆçš„æŸ¥è¯¢ç±»</p><p>å¦‚æœä½ ä½¿ç”¨ eclipse, è¿è¡Œ <code>mvn eclipse:eclipse</code> ä»¥æ›´æ–°ä½ çš„Eclipseé¡¹ç›®, ä»¤ä½ å¾—é¡¹ç›®åŒ…å«<code>target/generated-sources/java</code>ç›®å½•ä½œä¸º æºç ç›®å½•</p><p>ç°åœ¨, ä½ å¯ä»¥å»æ„é€ ä¸€ä¸ªJPQLæŸ¥è¯¢å®ä¾‹å’ŒæŸ¥è¯¢é¢†åŸŸå¯¹è±¡çš„Modelå®ä¾‹</p><blockquote><p>è®°ä½, ç”Ÿæˆçš„ä»£ç éœ€è¦è®¾ç½®ä¸‹</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120328969.png" alt="image-20221112032801841"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120328948.png" alt="image-20221112032830797"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120328289.png" alt="image-20221112032845157"></p></blockquote><p>ç°åœ¨è¿˜è®°å¾—å‰é¢çš„è¿™ä¸ªsqlè¯­å¥ä¹ˆ?</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="built_in">avg</span>( a.money ) <span class="keyword">AS</span> money,</span><br><span class="line">u.username <span class="keyword">AS</span> username </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">account a</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="keyword">USER</span> u <span class="keyword">ON</span> ( u.id <span class="operator">=</span> a.uid ) </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">u.gender <span class="operator">=</span> <span class="string">&#x27;å¥³&#x27;</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">u.username</span><br></pre></td></tr></table></figure><p>ç”¨ queryDSL æ€ä¹ˆç©?</p><p>éå¸¸ç®€å•</p><p>äº‹å…ˆéœ€è¦åˆ›å»ºå¥½å¯¹è±¡ <code>JPAQueryFactory</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AccountTest</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PersistenceContext</span></span><br><span class="line"><span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"><span class="keyword">private</span> JPAQueryFactory jpaQueryFactory;</span><br><span class="line"><span class="keyword">private</span> JPAQuery&lt;Void&gt; jpaQuery;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">jpaQuery = <span class="keyword">new</span> <span class="title class_">JPAQuery</span>&lt;&gt;(<span class="built_in">this</span>.entityManager);</span><br><span class="line">jpaQueryFactory = <span class="keyword">new</span> <span class="title class_">JPAQueryFactory</span>(<span class="built_in">this</span>.entityManager);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterEach</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„: <img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120333972.png" alt="image-20221112033306854"></p><p>è¿™ä¸¤ä¸ªå¯¹è±¡å¯ä»¥æ— ç¼è¡”æ¥, ä¸¤ä¸ªéƒ½å¯ä»¥ç”¨</p><p>githubä¸Šæ˜¯è¿™æ ·: </p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120334144.png" alt="image-20221112033435997"></p><p>å®˜ç½‘è¿™è¾¹ä¹Ÿç¨å¾®è®²äº†ç‚¹</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120340597.png" alt="image-20221112034013476"></p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120344478.png" alt="image-20221112034409334"></p><p>ä¸Šé¢é‚£å¥è¯ä¹Ÿè®²äº† <code>JPAQueryFactory</code> ä¼šè·å–<code>JPAQuery</code>å¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">QAccount</span> <span class="variable">qAccount</span> <span class="operator">=</span> QAccount.account;</span><br><span class="line">    <span class="type">QUser</span> <span class="variable">qUser</span> <span class="operator">=</span> QUser.user;</span><br><span class="line">    List&lt;Tuple&gt; tupleList = jpaQuery.select(qAccount.money, qUser.username).from(qAccount)</span><br><span class="line">        .join(qUser).on(qUser.id.eq(qAccount.uid))</span><br><span class="line">        .where(qUser.gender.eq(<span class="string">&#x27;å¥³&#x27;</span>))</span><br><span class="line">        .groupBy(qUser.username)</span><br><span class="line">        .fetch();</span><br><span class="line">    List&lt;AccountDto&gt; accountDtoList = tupleList.stream().map(tuple -&gt; &#123;</span><br><span class="line">        <span class="type">Double</span> <span class="variable">money</span> <span class="operator">=</span> tuple.get(qAccount.money);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> tuple.get(qUser.username);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AccountDto</span>(money, username);</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    accountDtoList.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æé«˜æµ‹è¯•æ•ˆç‡"><a href="#æé«˜æµ‹è¯•æ•ˆç‡" class="headerlink" title="æé«˜æµ‹è¯•æ•ˆç‡"></a>æé«˜æµ‹è¯•æ•ˆç‡</h4><p>ä¸ºäº†æé«˜æµ‹è¯•ä»£ç æ‰§è¡Œçš„æ•ˆç‡, ç»•è¿‡ springboot é‚£ä¸€å¥—, éœ€è¦åšä¸ªç®€å•çš„æ”¹é€ </p><p>åœ¨ <code>META-INF</code> ä¸‹åˆ›å»º<code>persistence.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">persistence</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/persistence&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">version</span>=<span class="string">&quot;2.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">persistence-unit</span> <span class="attr">name</span>=<span class="string">&quot;JPADemo&quot;</span> <span class="attr">transaction-type</span>=<span class="string">&quot;RESOURCE_LOCAL&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é…ç½®JPAè§„èŒƒçš„æœåŠ¡æä¾›å•† --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">provider</span>&gt;</span>org.hibernate.jpa.HibernatePersistenceProvider<span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.dialect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.hibernate.dialect.MySQL8Dialect&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.url&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/orm?characterEncoding=utf8<span class="symbol">&amp;amp;</span>connectTimeout=1000<span class="symbol">&amp;amp;</span>socketTimeout=3000<span class="symbol">&amp;amp;</span>autoReconnect=true<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=UTC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.show_sql&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.format_sql&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">persistence-unit</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">persistence</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.querydsl.core.Tuple;</span><br><span class="line"><span class="keyword">import</span> com.querydsl.jpa.impl.JPAQueryFactory;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.AfterEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Persistence;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JPATest</span> &#123;</span><br><span class="line"><span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"><span class="keyword">private</span> JPAQueryFactory jpaQueryFactory;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="type">QAccount</span> <span class="variable">qAccount</span> <span class="operator">=</span> QAccount.account;</span><br><span class="line"><span class="type">QUser</span> <span class="variable">qUser</span> <span class="operator">=</span> QUser.user;</span><br><span class="line">List&lt;Tuple&gt; tupleList = jpaQueryFactory.select(qAccount.money, qUser.username).from(qAccount)</span><br><span class="line">.join(qUser).on(qUser.id.eq(qAccount.uid))</span><br><span class="line">.where(qUser.gender.eq(<span class="string">&#x27;å¥³&#x27;</span>))</span><br><span class="line">.groupBy(qUser.username)</span><br><span class="line">.fetch();</span><br><span class="line">tupleList.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">EntityManagerFactory</span> <span class="variable">entityManagerFactory</span> <span class="operator">=</span> Persistence.createEntityManagerFactory(<span class="string">&quot;JPADemo&quot;</span>);</span><br><span class="line">entityManager = entityManagerFactory.createEntityManager();</span><br><span class="line">jpaQueryFactory = <span class="keyword">new</span> <span class="title class_">JPAQueryFactory</span>(<span class="built_in">this</span>.entityManager);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterEach</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.entityManager.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="QueryDSLä½¿å¾—JPAå…³è”æ³¨è§£å¯æœ‰å¯æ— "><a href="#QueryDSLä½¿å¾—JPAå…³è”æ³¨è§£å¯æœ‰å¯æ— " class="headerlink" title="QueryDSLä½¿å¾—JPAå…³è”æ³¨è§£å¯æœ‰å¯æ— "></a>QueryDSLä½¿å¾—JPAå…³è”æ³¨è§£å¯æœ‰å¯æ— </h4><blockquote><p>ä½¿ç”¨äº†queryDSL, JPAçš„é‚£äº›å¤šå¯¹å¤š ä¸€å¯¹å¤š å¤šå¯¹ä¸€æ³¨è§£å˜å¾—å¯æœ‰å¯æ— äº†</p><p>å³ä½¿æˆ‘ä»¬æŠŠä»£ç æ”¹æˆå®Œå…¨å’Œ mysql å­—æ®µä¸Šä¸€æ¨¡ä¸€æ ·éƒ½å¯ä»¥æ‰§è¡ŒæŸ¥è¯¢</p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120438599.png" alt="image-20221112043857425"></p><blockquote><p>å°±æ¯”å¦‚: </p><p>åŸå…ˆ åº”è¯¥æ˜¯è¿™æ ·</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120450910.png" alt="image-20221112045020774"> </p><p>ç°åœ¨å˜æˆ</p><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120451688.png" alt="image-20221112045115582"></p></blockquote><p>æ³¨æ„çœ‹ä¸Šå›¾Entityå±æ€§æ ¹æœ¬å°±æ²¡æœ‰ä»»ä½•çš„å¤šè¡¨å…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   <span class="type">QUser</span> <span class="variable">qUser</span> <span class="operator">=</span> QUser.user;</span><br><span class="line">   <span class="type">QRole</span> <span class="variable">qRole</span> <span class="operator">=</span> QRole.role;</span><br><span class="line">   <span class="type">QUserRole</span> <span class="variable">qUserRole</span> <span class="operator">=</span> QUserRole.userRole;</span><br><span class="line">   List&lt;Tuple&gt; tupleList = jpaQueryFactory.select(qUser, qRole, qUserRole).from(qUser)</span><br><span class="line">         .join(qUserRole).on(qUserRole.id.uid.eq(qUser.id))</span><br><span class="line">         .join(qRole).on(qRole.id.eq(qUserRole.id.rid))</span><br><span class="line">         .where(qRole.id.eq(<span class="number">2</span>))</span><br><span class="line">         .limit(<span class="number">10</span>)</span><br><span class="line">         .fetch();</span><br><span class="line">   tupleList.forEach(tuple -&gt; &#123;</span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> tuple.get(qUser);</span><br><span class="line">      <span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> tuple.get(qRole);</span><br><span class="line">      <span class="type">UserRole</span> <span class="variable">userRole</span> <span class="operator">=</span> tuple.get(qUserRole);</span><br><span class="line">      System.err.println(user);</span><br><span class="line">      System.err.println(role);</span><br><span class="line">      System.err.println(userRole); <span class="comment">// UserRole(id=com.zhazha.jpa.entity.UserRoleId@537)</span></span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†ä¸Šé¢çš„æŸ¥è¯¢å¯ä»¥æŸ¥åˆ°æ•°æ®:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">user0_.id <span class="keyword">AS</span> id1_2_0_,</span><br><span class="line">role2_.ID <span class="keyword">AS</span> id1_1_1_,</span><br><span class="line">userrole1_.RID <span class="keyword">AS</span> rid1_3_2_,</span><br><span class="line">userrole1_.UID <span class="keyword">AS</span> uid2_3_2_,</span><br><span class="line">user0_.address <span class="keyword">AS</span> address2_2_0_,</span><br><span class="line">user0_.birthday <span class="keyword">AS</span> birthday3_2_0_,</span><br><span class="line">user0_.gender <span class="keyword">AS</span> gender4_2_0_,</span><br><span class="line">user0_.telephone <span class="keyword">AS</span> telephon5_2_0_,</span><br><span class="line">user0_.username <span class="keyword">AS</span> username6_2_0_,</span><br><span class="line">role2_.ROLE_DESC <span class="keyword">AS</span> role_des2_1_1_,</span><br><span class="line">role2_.ROLE_NAME <span class="keyword">AS</span> role_nam3_1_1_ </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"><span class="keyword">USER</span> user0_</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> user_role userrole1_ <span class="keyword">ON</span> ( userrole1_.UID <span class="operator">=</span> user0_.id )</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> role role2_ <span class="keyword">ON</span> ( role2_.ID <span class="operator">=</span> userrole1_.RID ) </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">role2_.ID <span class="operator">=</span><span class="number">2</span></span><br><span class="line">LIMIT <span class="number">10</span></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/bangiao/blog_images@main/blog/202211120441860.png" alt="image-20221112044130705"></p><p>è¿™æ ·ä¹Ÿå°±ä¸å­˜åœ¨ N + 1 é—®é¢˜äº†</p>]]></content>
      
      
      <categories>
          
          <category> ORM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mybatis </tag>
            
            <tag> jpa </tag>
            
            <tag> hibernate </tag>
            
            <tag> XML </tag>
            
            <tag> DSL </tag>
            
            <tag> mysql </tag>
            
            <tag> queryDSL </tag>
            
            <tag> fluent mybatis </tag>
            
            <tag> JPQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼‚æ­¥å’ŒåŒæ­¥çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</title>
      <link href="/2022/11/04/01%E9%AB%98%E5%B9%B6%E5%8F%91/001%E5%90%8C%E6%AD%A5%E5%92%8C%E5%BC%82%E6%AD%A5%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/"/>
      <url>/2022/11/04/01%E9%AB%98%E5%B9%B6%E5%8F%91/001%E5%90%8C%E6%AD%A5%E5%92%8C%E5%BC%82%E6%AD%A5%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼‚æ­¥å’ŒåŒæ­¥çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å¼‚æ­¥å’ŒåŒæ­¥çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¼‚æ­¥å’ŒåŒæ­¥çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å¼‚æ­¥å’ŒåŒæ­¥çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>ä¸€èµ·æ¢è®¨æ¢è®¨è¿™ä¹ˆåˆ¤æ–­æ˜¯å¦æœ‰é—®é¢˜ï¼Ÿ</p><h2 id="å‰ææˆ–è€…è¯´æ˜¯å…±è¯†"><a href="#å‰ææˆ–è€…è¯´æ˜¯å…±è¯†" class="headerlink" title="å‰ææˆ–è€…è¯´æ˜¯å…±è¯†"></a>å‰ææˆ–è€…è¯´æ˜¯å…±è¯†</h2><p>å­¦ä¹ å¼‚æ­¥å’ŒåŒæ­¥ä½ å¯èƒ½éœ€è¦äº†è§£ä¸€äº›å‰æ</p><ol><li>å¼‚æ­¥ã€åŒæ­¥æ˜¯æŒ‡ä¸¤ä¸ªåŠä»¥ä¸Šæœ‰äº¤ç»‡çš„ä¸ªä½“é—´çš„äº‹æƒ…ï¼ˆæœ‰äº¤ç»‡æ˜¯æŒ‡æœ‰ä¸ºåŒä¸€é—´äº‹æƒ…ä»˜å‡ºè¿‡ï¼Œæˆ–è€…æ˜¯è¡¨ç¤ºæœ‰å› æœå…³ç³»çš„ï¼‰</li><li>å¼‚æ­¥ã€åŒæ­¥æ˜¯ç›¸å¯¹äº‹ä»¶ï¼ˆéœ€è¦æœ‰å¯¹ç…§æ‰èƒ½åˆ¤æ–­ï¼‰</li><li>éœ€è¦è§„å®šæŸä¸ªæ—¶é—´æ®µå†…å‘ç”Ÿï¼ˆä½ ä¸å¯èƒ½è¦æ±‚ä¸¤ä¸ªä¸ªä½“åœ¨ä»»ä½•æ—¶é—´éƒ½å¤„äºåŒæ­¥æˆ–è€…å¼‚æ­¥çš„æƒ…å†µï¼ŒåŒåµåŒèƒèƒéƒ½åšä¸åˆ°ï¼‰</li></ol><p>äº†è§£è¿™ä¸¤ç‚¹ï¼Œä½ æ‰èƒ½äº†è§£ä»€ä¹ˆæ˜¯å¼‚æ­¥ã€åŒæ­¥ã€‚</p><h1 id="å¼‚æ­¥å’ŒåŒæ­¥æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å¼‚æ­¥å’ŒåŒæ­¥æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¼‚æ­¥å’ŒåŒæ­¥æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å¼‚æ­¥å’ŒåŒæ­¥æ˜¯ä»€ä¹ˆï¼Ÿ</h1><h2 id="æ ¸å¿ƒ"><a href="#æ ¸å¿ƒ" class="headerlink" title="æ ¸å¿ƒ"></a>æ ¸å¿ƒ</h2><ol><li>å‰æï¼šä¸¤ä¸ªä¸ªä½“</li><li>æ—¶é—´å’Œäº‹ä»¶æ˜¯å¦ç›¸åŒ</li></ol><p><strong>å¼‚æ­¥ç›¸å½“äºï¼šä¸¤ä¸ªæœ‰äº¤ç»‡çš„ä¸ªä½“ ç›¸åŒçš„æ—¶é—´ï¼Œä¸åŒçš„äº‹ä»¶ and ç›¸åŒçš„äº‹ä»¶ï¼Œä¸åŒçš„æ—¶é—´ï¼ˆå¼ºè°ƒäº¤é”™ï¼‰</strong></p><p><strong>åŒæ­¥ç›¸å½“äºï¼šä¸¤ä¸ªæœ‰äº¤ç»‡çš„ä¸ªä½“ ç›¸åŒçš„æ—¶é—´ï¼Œç›¸åŒçš„äº‹ä»¶ and ç›¸åŒçš„äº‹ä»¶ï¼Œç›¸åŒçš„æ—¶é—´ï¼ˆå¼ºè°ƒç›¸åŒï¼‰</strong></p><h2 id="æ¢ç´¢è¿‡ç¨‹"><a href="#æ¢ç´¢è¿‡ç¨‹" class="headerlink" title="æ¢ç´¢è¿‡ç¨‹"></a>æ¢ç´¢è¿‡ç¨‹</h2><p>å¼‚æ­¥å’ŒåŒæ­¥ï¼Œæˆ‘ä»¬éœ€è¦æ‹†å¼€çœ‹</p><p>é¦–å…ˆäº†è§£ä»€ä¹ˆæ˜¯ â€œå¼‚â€ä»€ä¹ˆæ˜¯â€œåŒâ€ï¼Ÿ</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de38a2ef79064ba9b3bd6d9e3c586e0a~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/874e2def73d1485ba1bebb04ce11811c~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p>åˆ†åˆ«è¡¨ç¤º<strong>ä¸åŒå’Œç›¸åŒ</strong>ä¸¤ä¸ªæ¦‚å¿µ</p><p>é‚£ä¹ˆæ­¥å‘¢ï¼Ÿ</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d91751c40f4e4d06a26e549b6b2db8b3~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p>æˆ‘è§‰å¾—è¡¨ç¤ºé˜¶æ®µï¼›**æ­¥é•¿ï¼›é˜¶æ®µ ** æˆ–è€…æ›´åŠ å®½æ³›ç‚¹æˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ˜¯ <strong>åŠ¨ä½œå’Œæ—¶é—´</strong></p><p>å†å®½æ³›ç‚¹æˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ˜¯ <strong>äº‹ä»¶å’Œæ—¶é—´</strong></p><p><strong>ç»¼åˆèµ·æ¥å°±è¡¨ç¤ºï¼š</strong></p><p><strong>å¼‚æ­¥ç›¸å½“äºï¼šä¸¤ä¸ªæœ‰äº¤ç»‡çš„ä¸ªä½“ ç›¸åŒçš„æ—¶é—´ï¼Œä¸åŒçš„äº‹ä»¶ and ç›¸åŒçš„äº‹ä»¶ï¼Œä¸åŒçš„æ—¶é—´ï¼ˆå¼ºè°ƒäº¤é”™ï¼‰</strong></p><p><strong>åŒæ­¥ç›¸å½“äºï¼šä¸¤ä¸ªæœ‰äº¤ç»‡çš„ä¸ªä½“ ç›¸åŒçš„æ—¶é—´ï¼Œç›¸åŒçš„äº‹ä»¶ and ç›¸åŒçš„äº‹ä»¶ï¼Œç›¸åŒçš„æ—¶é—´ï¼ˆå¼ºè°ƒç›¸åŒï¼‰</strong></p><p>PS: è¿™é‡Œçš„æ—¶é—´è¡¨ç¤ºæŸæ®µæ—¶é—´ï¼Œè€Œä¸æ˜¯ä¸€ç›´éƒ½æ˜¯è¿™æ ·</p><blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤ä¸ªæœ‰äº¤ç»‡çš„ä¸ªä½“æ˜¯åœ¨åŒä¸€æ—¶é—´æ®µå†…ï¼ˆåŒæ­¥ï¼‰è¿˜æ˜¯é”™ä½æ—¶é—´æ®µå†…ï¼ˆå¼‚æ­¥ï¼‰ä¸ºåŒä¸€ä»¶äº‹æƒ…èŠ±è´¹ç²¾åŠ›</p></blockquote><p>ç°åœ¨å¸¦å…¥ç°å®ç”Ÿæ´»ä¸­å»çœ‹çœ‹ï¼š</p><h1 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h1><blockquote><p>æ¡ˆä¾‹è½¬è½½è‡ªï¼š<a href="https://blog.csdn.net/chenyang_wei/article/details/124102547">ä»å°ç™½åˆ°é«˜æ‰‹ï¼Œ10 å›¾æ•™ä½ åŒæ­¥ä¸å¼‚æ­¥</a></p></blockquote><h2 id="ç¬¬ä¸€ä¸ªæ¡ˆä¾‹"><a href="#ç¬¬ä¸€ä¸ªæ¡ˆä¾‹" class="headerlink" title="ç¬¬ä¸€ä¸ªæ¡ˆä¾‹"></a>ç¬¬ä¸€ä¸ªæ¡ˆä¾‹</h2><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf5262011c534dfb946b0770e7a4cc97~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p>é¦–å…ˆè€æ¿åœ¨æ•°é’±çš„æ—¶å€™ä½ è¿˜æ²¡æ¬ç –</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/13e7ce707aff43d09be65c579bb9f7ec~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p>å¦‚æœä½ åªçœ‹è¿™æ®µæ—¶é—´çš„è¯ï¼Œä½ å¯ä»¥è®¤ä¸ºä»–æ˜¯å¼‚æ­¥ï¼ŒåŒ…æ‹¬åº•ä¸‹è¿™æ®µä¹Ÿæ˜¯</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/77f284d5731742368a6c76a3d2c2fc9c~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><blockquote><p>å½“ç„¶ä½ è¦è¯´æ•°é’±æ˜¯ä¸ª IO æ“ä½œé‚£ä¹ˆï¼Œä¸Šå›¾è¿™æ®µéœ€è¦ä¸¤æ ¹æŸ±å­ï¼Œä¸€æ ¹æ˜¯ç¨‹åºé˜»å¡ç­‰å¾…ï¼Œå¦ä¸€æ ¹æ˜¯DMAå¤„ç†IOæ“ä½œã€‚åŒæ­¥å¼‚æ­¥æœ¬èº«å°±éšæ—¶å‘ç”Ÿç€ï¼Œè¿™å°±è·Ÿçˆ±å› æ–¯å¦ç›¸å¯¹è®ºä¸€æ ·ï¼Œçœ‹ä½ å‚è€ƒç³»åˆ†çš„ç»†ä¸ç»†å’¯ã€‚</p></blockquote><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ab11c1a415594931965381fdd9fd6b34~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p>ä¸Šé¢è¿™æ®µå¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ¥æ˜¯ ç›¸åŒæ—¶é—´ï¼Œç›¸åŒäº‹ä»¶ï¼Œè¿™æ˜¯åŒæ­¥æ“ä½œ</p><p>è€æ¿é˜»å¡ç­‰å¾…ä½ æ¬ç –å®Œæ¯•ï¼Œéƒ½æ˜¯å†ä¸ºä½ æ¬ç –èŠ±è´¹ç²¾åŠ›ï¼Œåªä¸è¿‡ä½ èŠ±çš„å¤šï¼Œä»–èŠ±çš„å°‘è€Œå·²</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0935abe18fa441efaa167e5245e2119b~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p>ä¸‹å›¾è¿™æ®µæ˜¯ç›¸åŒæ—¶é—´ï¼Œä¸åŒäº‹ä»¶å¹¶ä¸”ä»–ä»¬æ˜¯æœ‰äº¤ç»‡çš„ï¼Œæˆ–è€…è¯´ä»–ä»¬æ˜¯æœ‰å› æœå…³ç³»çš„ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f10f28a7fcb44dc1a3e5889c30857bc3~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><h2 id="ç¬¬äºŒä¸ªæ¡ˆä¾‹"><a href="#ç¬¬äºŒä¸ªæ¡ˆä¾‹" class="headerlink" title="ç¬¬äºŒä¸ªæ¡ˆä¾‹"></a>ç¬¬äºŒä¸ªæ¡ˆä¾‹</h2><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21b044b521db419981959bd8a310c252~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f41c6e0a9074c9580fa434f5d90090e~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><h2 id="ç¬¬ä¸‰ä¸ªæ¡ˆä¾‹"><a href="#ç¬¬ä¸‰ä¸ªæ¡ˆä¾‹" class="headerlink" title="ç¬¬ä¸‰ä¸ªæ¡ˆä¾‹"></a>ç¬¬ä¸‰ä¸ªæ¡ˆä¾‹</h2><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f2a0f2561424682bb2c9c78732cd01a~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/34876efdc9a34ebe87f7866a9dd5677d~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d16196d74864b0ab739a92991b0f7fa~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><h2 id="ç¬¬å››ä¸ªæ¡ˆä¾‹"><a href="#ç¬¬å››ä¸ªæ¡ˆä¾‹" class="headerlink" title="ç¬¬å››ä¸ªæ¡ˆä¾‹"></a>ç¬¬å››ä¸ªæ¡ˆä¾‹</h2><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/27a4e1353cd84a46ba83a8cdb747225d~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41460c920b1c44bba2ab92f82f90f802~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8f6fe0a60a614de69a8f046f2668b661~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><blockquote><p>æœ€åéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æƒ…å†µä¸‹å¼‚æ­¥éƒ½ä¸€å®šæ¯”åŒæ­¥é«˜æ•ˆï¼Œè¿˜éœ€è¦ç»“åˆå…·ä½“ä¸šåŠ¡ä»¥åŠIOçš„å¤æ‚åº¦å…·ä½“æƒ…å†µå…·ä½“åˆ†æã€‚</p></blockquote><blockquote><p>ç”±äºæ˜¯å¾ˆä¹…ä»¥å‰è®°å¾—ç¬”è®°ï¼Œå¿˜è®°æ˜¯å“ªä¸ªå¤§ä½¬è®¾è®¡çš„å›¾ç‰‡ï¼Œæ‰€ä»¥ä¸å¥½æ„æ€ï¼Œæ²¡æœ‰ç•™å›¾ç‰‡è½¬å‘åœ°å€</p></blockquote><h1 id="å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>å¦‚æœæŸä¸ªç³»ç»Ÿæ”¯æŒä¸¤ä¸ªæˆ–è€…å¤šä¸ªåŠ¨ä½œï¼ˆActionï¼‰<strong>åŒæ—¶å­˜åœ¨</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªç³»ç»Ÿå°±æ˜¯ä¸€ä¸ª<strong>å¹¶å‘ç³»ç»Ÿ</strong>ã€‚å¦‚æœæŸä¸ªç³»ç»Ÿæ”¯æŒä¸¤ä¸ªæˆ–è€…å¤šä¸ªåŠ¨ä½œ<strong>åŒæ—¶æ‰§è¡Œ</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªç³»ç»Ÿå°±æ˜¯ä¸€ä¸ª<strong>å¹¶è¡Œç³»ç»Ÿ</strong>ã€‚å¹¶å‘ç³»ç»Ÿä¸å¹¶è¡Œç³»ç»Ÿè¿™ä¸¤ä¸ªå®šä¹‰ä¹‹é—´çš„å…³é”®å·®å¼‚åœ¨äº<strong>â€œå­˜åœ¨â€</strong>è¿™ä¸ªè¯ã€‚<br />åœ¨å¹¶å‘ç¨‹åºä¸­å¯ä»¥åŒæ—¶æ‹¥æœ‰ä¸¤ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœç¨‹åºåœ¨å•æ ¸å¤„ç†å™¨ä¸Šè¿è¡Œï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªçº¿ç¨‹å°†äº¤æ›¿åœ°æ¢å…¥æˆ–è€…æ¢å‡ºå†…å­˜ã€‚è¿™äº›çº¿ç¨‹æ˜¯åŒæ—¶â€œå­˜åœ¨â€çš„â€”â€”æ¯ä¸ªçº¿ç¨‹éƒ½å¤„äºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æŸä¸ªçŠ¶æ€ã€‚å¦‚æœç¨‹åºèƒ½å¤Ÿå¹¶è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆå°±ä¸€å®šæ˜¯è¿è¡Œåœ¨å¤šæ ¸å¤„ç†å™¨ä¸Šã€‚æ­¤æ—¶ï¼Œç¨‹åºä¸­çš„æ¯ä¸ªçº¿ç¨‹éƒ½å°†åˆ†é…åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å¤„ç†å™¨æ ¸ä¸Šï¼Œå› æ­¤å¯ä»¥åŒæ—¶è¿è¡Œã€‚<br />æˆ‘ç›¸ä¿¡ä½ å·²ç»èƒ½å¤Ÿå¾—å‡ºç»“è®ºâ€”â€”<strong>â€œå¹¶è¡Œâ€æ¦‚å¿µæ˜¯â€œå¹¶å‘â€æ¦‚å¿µçš„ä¸€ä¸ªå­é›†</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªæ‹¥æœ‰å¤šä¸ªçº¿ç¨‹æˆ–è€…è¿›ç¨‹çš„å¹¶å‘ç¨‹åºï¼Œä½†å¦‚æœæ²¡æœ‰å¤šæ ¸å¤„ç†å™¨æ¥æ‰§è¡Œè¿™ä¸ªç¨‹åºï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä»¥å¹¶è¡Œæ–¹å¼æ¥è¿è¡Œä»£ç ã€‚å› æ­¤ï¼Œå‡¡æ˜¯åœ¨æ±‚è§£å•ä¸ªé—®é¢˜æ—¶æ¶‰åŠå¤šä¸ªæ‰§è¡Œæµç¨‹çš„ç¼–ç¨‹æ¨¡å¼æˆ–è€…æ‰§è¡Œè¡Œä¸ºï¼Œéƒ½å±äºå¹¶å‘ç¼–ç¨‹çš„èŒƒç•´ã€‚<br />æ‘˜è‡ªï¼šã€Šå¹¶å‘çš„è‰ºæœ¯ã€‹ â€” ã€”ç¾ã€•å¸ƒé›·è°¢æ–¯</p>]]></content>
      
      
      <categories>
          
          <category> é«˜å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> å¹¶å‘ </tag>
            
            <tag> åŒæ­¥ </tag>
            
            <tag> å¼‚æ­¥ </tag>
            
            <tag> å¹¶è¡Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wikié¦–é¡µ</title>
      <link href="/1999/01/01/Home/"/>
      <url>/1999/01/01/Home/</url>
      
        <content type="html"><![CDATA[<h1 id="Bangiao"><a href="#Bangiao" class="headerlink" title="Bangiao"></a>Bangiao</h1><p>ç¬”è®°</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
